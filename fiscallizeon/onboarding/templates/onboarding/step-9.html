{% load static %}

<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Integração realizada com sucesso - Lize</title>
  <link href="{% static 'favicon/favicon.ico' %}" rel="shortcut icon" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  <link href="{% static 'tw/full/output.css' %}" rel="stylesheet">
  <script src="https://unpkg.com/vue@2"></script>
</head>
<body class="flex flex-col h-screen">
  <main id="app" class="h-full overflow-y-auto">
    <div class="h-full flex flex-col justify-center items-center">
      <p class="font-['Roboto'] text-2xl leading-7 font-medium text-[#001737] text-center mb-10">Conte o que achou do processo de integração</p>
      <div class="min-w-[32.5rem] border border-[#E5E7EA] rounded-lg px-6 pt-[1.625rem] pb-6">
        <form>
          <div>
            <div>
              <div class="grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6">
                <div class="col-span-full">
                  <label for="username" class="block text-sm leading-[1.125rem] font-semibold text-[#001737] text-center">
                    Como está se sentindo com o resultado?
                  </label>
                  <div class="mt-4">
                    <div class="flex gap-2">
                      <div class="cursor-pointer" @click="rating = '1'">
                        <span
                          class="flex justify-center rounded-xl px-5 py-4"
                          :class="{'bg-[#FFF9F5] border-2 border-[#FFE0C9]': rating === '1', 'border border-[#E5E7EA]': rating !== '1'}"
                        >
                          <img
                            src="{% static 'onboarding/1.gif' %}"
                            class="w-12 h-12"
                            :class="{'grayscale': rating !== '1'}"
                            alt="Opção 1"
                          />
                        </span>
                        <p
                          class="font-['Roboto'] text-xs text-center mt-2"
                          :class="{'font-semibold text-[#001737]': rating === '1', 'text-[#6C727F]': rating !== '1'}"
                        >
                          Decepcionado
                        </p>
                        <input type="radio" value="1" v-model="rating" class="hidden">
                      </div>
                      <div class="cursor-pointer" @click="rating = '2'">
                        <span
                          class="flex justify-center rounded-xl px-5 py-4"
                          :class="{'bg-[#FFF9F5] border-2 border-[#FFE0C9]': rating === '2', 'border border-[#E5E7EA]': rating !== '2'}"
                        >
                          <img
                            src="{% static 'onboarding/2.gif' %}"
                            class="w-12 h-12"
                            :class="{'grayscale': rating !== '2'}"
                            alt="Opção 2"
                          />
                        </span>
                        <p
                          class="font-['Roboto'] text-xs text-center mt-2"
                          :class="{'font-semibold text-[#001737]': rating === '2', 'text-[#6C727F]': rating !== '2'}"
                        >
                          Não gostei
                        </p>
                        <input type="radio" value="2" v-model="rating" class="hidden">
                      </div>
                      <div class="cursor-pointer" @click="rating = '3'">
                        <span
                          class="flex justify-center rounded-xl px-5 py-4"
                          :class="{'bg-[#FFF9F5] border-2 border-[#FFE0C9]': rating === '3', 'border border-[#E5E7EA]': rating !== '3'}"
                        >
                          <img
                            src="{% static 'onboarding/3.gif' %}"
                            class="w-12 h-12"
                            :class="{'grayscale': rating !== '3'}"
                            alt="Opção 3"
                          />
                        </span>
                        <p
                          class="font-['Roboto'] text-xs text-center mt-2"
                          :class="{'font-semibold text-[#001737]': rating === '3', 'text-[#6C727F]': rating !== '3'}"
                        >
                          Indiferente
                        </p>
                        <input type="radio" value="3" v-model="rating" class="hidden">
                      </div>
                      <div class="cursor-pointer" @click="rating = '4'">
                        <span
                          class="flex justify-center rounded-xl px-5 py-4"
                          :class="{'bg-[#FFF9F5] border-2 border-[#FFE0C9]': rating === '4', 'border border-[#E5E7EA]': rating !== '4'}"
                        >
                          <img
                            src="{% static 'onboarding/4.gif' %}"
                            class="w-12 h-12"
                            :class="{'grayscale': rating !== '4'}"
                            alt="Opção 4"
                          />
                        </span>
                        <p
                          class="font-['Roboto'] text-xs text-center mt-2"
                          :class="{'font-semibold text-[#001737]': rating === '4', 'text-[#6C727F]': rating !== '4'}"
                        >
                          Satisfeito(a)
                        </p>
                        <input type="radio" value="4" v-model="rating" class="hidden">
                      </div>
                      <div class="cursor-pointer" @click="rating = '5'">
                        <span
                          class="flex justify-center rounded-xl px-5 py-4"
                          :class="{'bg-[#FFF9F5] border-2 border-[#FFE0C9]': rating === '5', 'border border-[#E5E7EA]': rating !== '5'}"
                        >
                          <img
                            src="{% static 'onboarding/5.gif' %}"
                            class="w-12 h-12"
                            :class="{'grayscale': rating !== '5'}"
                            alt="Opção 5"
                          />
                        </span>
                        <p
                          class="font-['Roboto'] text-xs text-center mt-2"
                          :class="{'font-semibold text-[#001737]': rating === '5', 'text-[#6C727F]': rating !== '5'}"
                        >
                          Super feliz!
                        </p>
                        <input type="radio" value="5" v-model="rating" class="hidden">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-span-full">
                  <label for="about" class="block text-sm leading-[1.125rem] font-semibold text-[#001737] text-center">
                    O que poderíamos melhorar?
                  </label>
                  <div class="mt-4">
                    <textarea id="about" name="about" rows="3" class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-[#D2D6DB] placeholder:text-[#6C727F] focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6" placeholder="Escreva aqui..." v-model="ratingDescription"></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-6 flex flex-col gap-6">
            <button
              type="button"
              class="rounded-md bg-primary-600 px-4 py-3 text-sm font-semibold text-white shadow-sm hover:bg-primary-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600"
              :disabled="processFilesStatus === 'loading' || !rating"
              @click="processFiles"
            >
              [[ processFilesStatus !== 'loading' ? 'Avaliar e encerrar' : 'Processando...' ]]
            </button>
            <a href="{% url 'core:dashboard_coordination' %}" class="text-center text-sm font-semibold leading-6 text-primary-600">Avaliar depois</a>
          </div>
        </form>
      </div>
    </div>
  </main>
  <footer class="flex justify-center px-[11.5rem] py-4">
    <svg width="52" height="32" viewBox="0 0 52 32" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M15.362 21.6376C13.5956 20.8193 11.5161 20.3893 9.87081 20.1636C8.22555 19.938 4.7732 19.7265 2.71343 20.1197C3.46911 12.9932 3.92787 4.67531 4.08972 1.44461C4.12465 0.746213 3.64726 0.110763 2.96959 0.0133674C2.19645 -0.0970939 1.5153 0.490845 1.47571 1.26645C1.34879 3.81419 0.417295 15.6561 0.00627239 20.8276C-0.0892059 22.0272 0.919138 23.0131 2.08933 22.8622C2.96261 22.7506 4.05595 22.6556 5.31812 22.6164C6.5803 22.5772 8.11378 22.671 8.60747 22.7173C11.4148 22.981 13.2801 23.601 14.3257 24.0571C14.937 24.3232 15.6449 24.0737 15.9663 23.481C16.3331 22.804 16.0524 21.956 15.362 21.6365V21.6376ZM13.6996 2.87095C14.4286 2.91699 15.0538 2.32674 15.1977 1.61019C15.351 0.849951 14.9971 1.41725e-09 14.0075 1.41725e-09C13.3458 1.41725e-09 12.638 0.495805 12.5507 1.43783C12.4811 2.17564 12.9577 2.82373 13.7008 2.87095H13.6996ZM48.6574 10.4645C48.9523 9.78699 49.7227 9.44167 50.3917 9.72983L50.3905 9.72864C51.07 10.0216 51.38 10.8182 51.0933 11.5029C49.9697 14.1797 47.5595 19.269 41.4359 19.269C40.6561 19.269 39.8904 19.1713 39.1596 18.9725C37.0326 18.3926 35.3449 16.9327 34.6421 14.8274C32.923 17.1447 30.8717 18.982 28.5826 19.8631C28.9987 21.4421 29.1385 23.2866 28.9311 25.3549C28.4847 29.8929 25.8728 32.3482 23.0546 31.96C20.5196 31.6111 18.7107 28.9938 19.3762 25.7681C20.2772 21.4183 22.6898 19.4119 25.015 18.2521C24.7527 17.8996 24.4753 17.6174 24.1921 17.3983C23.8203 17.1101 23.6035 16.66 23.635 16.1849L23.6944 15.2799C23.7481 14.4607 24.1991 13.7153 24.9077 13.3259C26.3157 12.5531 27.8472 11.0647 27.8472 8.24616C27.8472 7.09589 27.4346 6.5279 26.5837 6.32428C25.107 5.96705 23.1839 7.34595 21.8215 10.3002L21.7445 10.2633L21.8226 10.3014C21.7475 10.4614 21.6524 10.6789 21.5381 10.9404C20.4805 13.3593 17.7795 19.5366 14.0487 18.7081C12.5521 18.3795 11.6337 17.1506 11.5358 15.4228C11.4029 13.1044 12.15 5.92895 12.1932 5.54315C12.2771 4.80488 12.9391 4.27261 13.657 4.35358C14.375 4.43455 14.8832 5.11566 14.8261 5.85036C14.721 7.20467 14.6146 8.39185 14.5201 9.446C14.3546 11.2929 14.2256 12.7314 14.2048 13.9451C14.1827 15.2549 15.0615 16.3207 16.3925 14.4333C17.4473 12.9377 18.6967 10.7682 19.452 9.16065C20.9298 5.95515 23.6816 2.87109 27.1851 3.71891C29.4369 4.25951 30.4404 6.26117 30.4707 8.20567C30.5115 10.8349 28.9847 14.0939 26.3308 15.7431C26.8064 16.2087 27.2294 16.7612 27.5872 17.384C29.874 16.5159 32.2679 14.0356 34.1269 10.761C34.5057 10.0942 34.8239 9.39404 35.113 8.68197C35.1444 8.60219 35.1782 8.52241 35.212 8.44263C37.0162 4.24522 40.1258 2.60913 42.6958 3.74868C44.9009 4.72629 45.8928 7.4936 44.7075 10.1811C43.6154 12.6448 40.3414 14.1654 36.881 12.5222C36.8706 15.1085 38.7668 16.5921 41.4382 16.5921C45.8415 16.5921 47.5257 13.0663 48.6574 10.4645ZM41.6527 6.2052C40.9394 5.88965 39.1433 5.95634 37.613 9.51907H37.6142C37.5741 9.61297 37.5695 9.62227 37.5655 9.63178C37.5606 9.643 37.5565 9.65451 37.4953 9.80604C40.0069 11.3254 41.81 10.2252 42.3193 9.07611C43.0023 7.52575 42.359 6.51837 41.6527 6.2052ZM23.4054 29.3082C24.2457 29.4237 25.9555 28.8379 26.325 25.0846C26.4963 23.3747 26.3809 21.897 26.0896 20.7002C24.3599 21.5635 22.6466 22.9281 21.9427 26.323C21.5359 28.2949 22.5487 29.1903 23.4054 29.3082Z" fill="#E5E7EA"/>
    </svg>
  </footer>
  <script>
    function redirect(to, permanent = false) {
      if (permanent) {
        window.location.replace(to);
      } else {
        window.location.href = to;
      }
    }

    const app = new Vue({
      el: '#app',
      delimiters: ['[[', ']]'],
      data() {
        return {
          rating: '',
          ratingDescription: '',
          processFilesStatus: 'idle',
        }
      },
      methods: {
        async processFiles() {
          if (this.processFilesStatus === 'loading') return;
          this.processFilesStatus = 'loading';

          let formData = new FormData();
          formData.append('rating', this.rating);
          formData.append('ratingDescription', this.ratingDescription);
          formData.append('notification', '{{ notification.pk }}');

          try {
            const response = await fetch("{% url 'api:feedback-generic' %}", {
              method: 'POST',
              body: formData,
            });
            const data = await response.json();
            if (response.status < 200 || response.status >= 300) {
              throw new Error(data.detail);
            }
            this.processFilesStatus = 'success';
            redirect("{% url 'core:dashboard_coordination' %}?status=onboarding-success");
          } catch (error) {
            console.log('error', error);
            this.processFilesStatus = 'error';
          }
        },
      },
    });
  </script>
</body>
</html>
