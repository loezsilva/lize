{% extends 'redesign/base.html' %}
{% comment %}{% extends 'dashboard/base_fixed.html' %}{% endcomment %}
{% load static %}

{% block title %}Correção por enunciado - Lize{% endblock title %}

{% block css-additional %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.2/viewer.css" integrity="sha512-HGWrJz+Lr07phD0DNoLsSVwn3przno/eSLf1cGOrLzr6c7NUZROZJPhQdSPmLHNbsO0HP2UfUnpKTMiVxonEHw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css"> -->
<!-- <link href="{% static 'administration/lib/select2/css/select2.min.css' %}" rel="stylesheet" /> -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@recogito/annotorious-openseadragon@2.6.0/dist/annotorious.min.css">
<style>
    .modal-fullscreen{
        width:100vw;
        max-width:none;
        height:100%;
        margin:0
    }
    .modal-fullscreen .modal-content{
        height:100%;
        border:0;
        border-radius:0
    }
    .modal-fullscreen .modal-footer,.modal-fullscreen .modal-header{
        border-radius:0
    }
    .modal-fullscreen .modal-body{
        overflow-y:auto
    }
    .card-detail{
        max-height: 70vh;
        overflow: auto;
    }
    #question-details {
        border-width: 1px;
        border-style: solid;
        border-color: #d9d7d7;
    }

    #question-details img {
        min-width: 200px;
        max-width: 100%;
    }

    .text-main {
        color: #001737 !important;
    }

    table#student-responses td {
        min-width: 53.85px;
    }

    td.bg-gray:hover {
        background-color: #dedede !important;
        cursor: pointer;
    }

    td.bg-success, td.bg-pink, td.bg-warning {
        color: white !important;
    }

    td.bg-success:hover {
        background-color: #10753c !important;
        cursor: pointer;
    }

    td.bg-pink:hover {
        background-color: #a80051 !important;
        cursor: pointer;
    }

    td.bg-warning:hover {
        cursor: pointer;
    }

    td.alternative-correct {
        background-color: #10b75990 !important;
    }

    td.alternative-incorrect {
        background-color: #dc354590 !important;
    }
    #viewerTitle0 {
        font-size: 1.5rem;
        font-weight: bold;
        color: #001737;
        opacity: 0.8;
    }
    .remove-p-margin p {
        margin: 0;
    }
    aside {
        z-index: 1 !important;    
    }
    .overlay {
        overflow: hidden;
        z-index: 10000 !important;
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        transition: .5s ease;
        background: rgba(0, 0, 0, 0.8);
    }
    .overlay i {
        cursor: pointer;
    }
    .overlay i:hover {
        color: coral !important;
    }

    .dropdown-toggle-without-chevron::after {
      display: none;
    }
    .ui-accordion-header {
      background-color: white;
      padding: 16px 24px;
      border: 0;
      /* border-bottom: 1px solid #E2E8F0; */
      border-radius: unset;
    }
    .ui-accordion-header .ui-accordion-header-icon {
      left: 0;
      top: 20px;
      margin-right: 0;
      width: 16px;
      height: 16px;
    }
    .ui-accordion-header.ui-state-active {
      color: #334155;
      background-color: white;
      border-width: unset;
    }
    .ui-accordion-header:hover {
      color: #334155;
      background-color: white;
    }
    .ui-accordion-header .ui-accordion-header-icon::before {
      content: '\f3d1';
      font-size: 24px;
      font-weight: 400;
      color: #FD853A;
    }
    .ui-accordion-header.ui-state-active .ui-accordion-header-icon::before {
      content: '\f3d0';
    }
    .ui-accordion-header ~ .ui-accordion-header {
      margin-top: unset;
    }
    .ui-accordion-content {
      border: unset;
      padding: unset;
    }
    .alternative-correct {
      background-color: #F6FEF9 !important;
      border: 2px solid #12B76A !important;
    }
    .alternative-incorrect {
      background-color: #FFFBFA !important;
      border: 2px solid #FECDCA !important;
    }
    .custom-checkbox .custom-control-label::before, .custom-checkbox .custom-control-label::after, .custom-radio .custom-control-label::before, .custom-radio .custom-control-label::after, .custom-switch .custom-control-label::before, .custom-switch .custom-control-label::after {
      top: 50%;
    }
    .custom-radio .custom-control-input:checked ~ .custom-control-label::after {
      background-image: unset;
    }
    .custom-control-input:checked ~ .custom-control-label::before {
      color: unset;
      border-color: unset;
      background-color: unset;
    }
    .custom-control-label::before {
      content: "";
      position: absolute;
      top: 0.25rem;
      left: -1.5rem;
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 50%;
      border: 2px solid #E2E8F0;
      background-color: transparent;
      box-sizing: border-box;
    }
    .custom-control-label::after {
      content: "";
      position: absolute;
      left: -1.0625rem;
      width: 0.625rem;
      height: 0.625rem;
      border-radius: 50%;
      background-color: transparent;
      transform: translate(-50%, -50%);
      transition: all 0.2s ease;
    }
    .custom-control-input:checked ~ .custom-control-label::before {
      border-color: #12B76A;
    }
    .custom-control-input:checked ~ .custom-control-label::after {
      background-color: #12B76A;
    }
    .alternative-correct .custom-control-input:checked ~ .custom-control-label::before {
      border-color: #12B76A;
    }
    .alternative-correct .custom-control-input:checked ~ .custom-control-label::after {
      background-color: #12B76A;
    }
    .alternative-correct .custom-control-label::before {
      border-color: #12B76A;
    }
    .alternative-incorrect .custom-control-input:checked ~ .custom-control-label::before {
      border-color: #F04438;
    }
    .alternative-incorrect .custom-control-input:checked ~ .custom-control-label::after {
      background-color: #F04438;
    }
    .alternative-incorrect .custom-control-label::before {
      border-color: #F04438;
    }
</style>

{% endblock %}

{% block js-header-additional %}
    <script src="{% static 'js/annotorious/openseadragon.min.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/@recogito/annotorious@2.6.0/dist/annotorious.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@recogito/annotorious-openseadragon@2.6.0/dist/openseadragon-annotorious.min.js"></script>
{% endblock js-header-additional %}

{% block main %}{% endblock main %}
{% block content-fixed %}
<main class="tw-h-full tw-flex tw-flex-col tw-gap-6 tw-pt-6">
  <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8">
    <div class="tw-flex tw-flex-col tw-gap-8">
      <div class="tw-flex tw-flex-col">
        <div class="tw-flex tw-items-center tw-justify-between">
          <div class="tw-flex tw-flex-col tw-gap-4">
            <a href="#" onclick="history.back()" class="tw-flex tw-items-center tw-gap-3 tw-text-sm tw-leading-6 tw-text-gray-700">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="#9BA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              Cadernos
            </a>
            <h1 class="tw-text-2xl tw-font-semibold tw-text-gray-700">{{ object.name }}</h1>
          </div>
        </div>
      </div>
      <div class="tw-flex tw-gap-4">
        <!-- <div class="tw-grid tw-grid-cols-1 sm:tw-gap-4 sm:tw-grid-cols-2 lg:tw-grid-cols-4 tw-bg-white tw-rounded-lg tw-border tw-border-slate-200 tw-py-6"></div> -->
        <div>
          <form method="GET">
            <select name="turma" class="tw-col-start-1 tw-row-start-1 tw-w-96 tw-appearance-none tw-rounded-md tw-bg-white tw-py-1.5 tw-pl-3 tw-pr-8 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:outline-blue-600 sm:text-sm/6" @change="changeSchoolClass">
              <option value="">Selecione uma turma</option>
              <option value="all">Todas as turmas</option>
              {% for school_class in school_classes %}
                <option
                  value="{{ school_class.pk }}"
                  {% if school_class.pk|stringformat:"s" == request.GET.turma %}selected="selected"{% endif %}
                >
                  {{ school_class }}
                </option>
              {% endfor %}
            </select>
          </form>
        </div>
        <!-- <div>
          <input type="date" />
        </div> -->
      </div>
    </div>
  </div>
  <div class="tw-flex-1 tw-bg-white tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-6">
    {% if school_class_pk %}
      {% if exam_questions %}
        <div class="tw-flex tw-flex-col tw-gap-6">
          <div class="tw-flex tw-items-center tw-justify-center">
            <span class="tw-isolate tw-inline-flex tw-rounded-lg">
              <button
                type="button"
                class="tw-relative tw-inline-flex tw-items-center tw-rounded-l-lg tw-px-4 tw-py-1.5 tw-text-sm tw-ring-inset tw-ring-gray-200 focus:tw-z-10"
                :class="['Objetiva', 'Discursiva', 'Arquivo anexado', 'Somatório'].every(item => questionCategories.includes(item)) ? 'tw-bg-white tw-font-semibold tw-text-slate-950 tw-ring-1 hover:tw-bg-gray-50' : 'tw-bg-slate-50 tw-text-slate-500 hover:tw-bg-slate-100'"
                @click="questionCategories = ['Objetiva', 'Discursiva', 'Arquivo anexado', 'Somatório']"
              >
                Todas
              </button>
              <button
                v-for="(btn, index) in visibleButtons"
                type="button"
                class="tw-relative tw-inline-flex tw-items-center tw-px-4 tw-py-1.5 tw-text-sm tw-ring-inset tw-ring-gray-200 focus:tw-z-10"
                :class="[
                  getLastRoundedClasses(index),
                  {
                    'tw-bg-white tw-font-semibold tw-text-slate-950 tw-ring-1 hover:tw-bg-gray-50':
                      (btn === 'Objetivas' && questionCategories.length === 1 && questionCategories.includes('Objetiva')) ||
                      (btn === 'Dissertativas' && questionCategories.length === 2 && ['Discursiva', 'Arquivo anexado'].every(item => questionCategories.includes(item))) ||
                      (btn === 'Somatórias' && questionCategories.length === 1 && questionCategories.includes('Somatório')),
                    'tw-bg-slate-50 tw-text-slate-500 hover:tw-bg-slate-100':
                      !(
                        (btn === 'Objetivas' && questionCategories.length === 1 && questionCategories.includes('Objetiva')) ||
                        (btn === 'Dissertativas' && questionCategories.length === 2 && ['Discursiva', 'Arquivo anexado'].every(item => questionCategories.includes(item))) ||
                        (btn === 'Somatórias' && questionCategories.length === 1 && questionCategories.includes('Somatório'))
                      )
                  }
                ]"
                @click="
                  questionCategories = btn === 'Objetivas'
                    ? ['Objetiva']
                    : btn === 'Dissertativas'
                    ? ['Discursiva', 'Arquivo anexado']
                    : ['Somatório']
                "
              >
                ${btn}
              </button>
            </span>
          </div>

          <div role="list" class="tw-mx-auto tw-grid tw-max-w-2xl tw-grid-cols-1 tw-gap-4 sm:tw-grid-cols-2 lg:tw-mx-0 lg:tw-max-w-none lg:tw-grid-cols-3">
            <div
              class="tw-bg-white tw-flex tw-flex-col tw-gap-6 tw-border tw-border-gray-200 tw-rounded-lg tw-p-5"
              v-for="examQuestion in examQuestions.filter(e => ['Discursiva', 'Arquivo anexado'].includes(e.category) && questionCategories.includes('Discursiva') || e.category == 'Objetiva' && questionCategories.includes('Objetiva') || e.category == 'Somatório' && questionCategories.includes('Somatório'))"
            >
              <div class="tw-flex tw-flex-col tw-gap-4">
                <div class="tw-flex tw-flex-col tw-gap-2">
                  <h3 class="tw-text-base tw-font-semibold tw-text-slate-800">
                    Questão ${examQuestion.question_number}
                  </h3>
                  <p class="tw-text-xs/4.5 tw-text-gray-400 tw-line-clamp-2">
                    ${examQuestion.enunciation}
                  </p>
                </div>
                <div class="tw-flex tw-items-center tw-justify-between">
                  <div class="tw-flex tw-items-center tw-gap-6">
                    <div>
                      <span class="tw-flex tw-items-center tw-gap-1">
                        <span class="tw-text-lg tw-font-semibold tw-text-slate-800">
                          ${examQuestion.correctAnswers}
                        </span>
                        <span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M11.0306 5.96938C11.1005 6.03905 11.156 6.12185 11.1939 6.21301C11.2317 6.30417 11.2512 6.40191 11.2512 6.50063C11.2512 6.59934 11.2317 6.69708 11.1939 6.78824C11.156 6.8794 11.1005 6.9622 11.0306 7.03188L7.53063 10.5319C7.46095 10.6018 7.37816 10.6573 7.28699 10.6951C7.19583 10.733 7.09809 10.7525 6.99938 10.7525C6.90067 10.7525 6.80293 10.733 6.71176 10.6951C6.6206 10.6573 6.53781 10.6018 6.46813 10.5319L4.96813 9.03187C4.89836 8.96211 4.84302 8.87929 4.80527 8.78814C4.76751 8.69698 4.74808 8.59929 4.74808 8.50062C4.74808 8.40196 4.76751 8.30427 4.80527 8.21311C4.84302 8.12196 4.89836 8.03914 4.96813 7.96938C5.03789 7.89961 5.12072 7.84427 5.21187 7.80651C5.30302 7.76876 5.40072 7.74932 5.49938 7.74932C5.59804 7.74932 5.69574 7.76876 5.78689 7.80651C5.87804 7.84427 5.96086 7.89961 6.03063 7.96938L7 8.9375L9.96938 5.9675C10.0392 5.89789 10.122 5.84272 10.2131 5.80513C10.3042 5.76755 10.4018 5.7483 10.5004 5.74847C10.599 5.74865 10.6965 5.76825 10.7875 5.80615C10.8785 5.84405 10.9611 5.89952 11.0306 5.96938ZM14.75 8C14.75 9.33502 14.3541 10.6401 13.6124 11.7501C12.8707 12.8601 11.8165 13.7253 10.5831 14.2362C9.34971 14.7471 7.99252 14.8808 6.68314 14.6203C5.37377 14.3598 4.17104 13.717 3.22703 12.773C2.28303 11.829 1.64015 10.6262 1.3797 9.31686C1.11925 8.00749 1.25292 6.65029 1.76382 5.41689C2.27471 4.18349 3.13987 3.12928 4.2499 2.38758C5.35994 1.64588 6.66498 1.25 8 1.25C9.78961 1.25199 11.5053 1.96378 12.7708 3.22922C14.0362 4.49466 14.748 6.2104 14.75 8ZM13.25 8C13.25 6.96165 12.9421 5.94661 12.3652 5.08326C11.7883 4.2199 10.9684 3.54699 10.0091 3.14963C9.04978 2.75227 7.99418 2.6483 6.97578 2.85088C5.95738 3.05345 5.02192 3.55346 4.28769 4.28769C3.55347 5.02191 3.05345 5.95738 2.85088 6.97578C2.64831 7.99418 2.75228 9.04978 3.14964 10.0091C3.547 10.9684 4.2199 11.7883 5.08326 12.3652C5.94662 12.9421 6.96165 13.25 8 13.25C9.39193 13.2485 10.7264 12.6949 11.7107 11.7107C12.6949 10.7264 13.2485 9.39193 13.25 8Z" fill="#12B76A" />
                          </svg>
                        </span>
                      </span>
                      <span class="tw-text-xs/4.5 tw-text-gray-400">Acertos</span>
                    </div>
                    <div>
                      <span class="tw-flex tw-items-center tw-gap-1">
                        <span class="tw-text-lg tw-font-semibold tw-text-slate-800">
                          ${examQuestion.incorrectAnswers}
                        </span>
                        <span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M10.5306 6.53062L9.0625 8L10.5325 9.46937C10.6734 9.61027 10.7526 9.80137 10.7526 10.0006C10.7526 10.1999 10.6734 10.391 10.5325 10.5319C10.3916 10.6728 10.2005 10.7519 10.0013 10.7519C9.802 10.7519 9.6109 10.6728 9.47 10.5319L8 9.0625L6.53063 10.5325C6.38973 10.6734 6.19864 10.7526 5.99938 10.7526C5.80012 10.7526 5.60902 10.6734 5.46813 10.5325C5.32723 10.3916 5.24808 10.2005 5.24808 10.0013C5.24808 9.80199 5.32723 9.6109 5.46813 9.47L6.9375 8L5.46938 6.53062C5.39961 6.46086 5.34427 6.37804 5.30652 6.28689C5.26876 6.19573 5.24933 6.09804 5.24933 5.99937C5.24933 5.80012 5.32848 5.60902 5.46938 5.46812C5.61027 5.32723 5.80137 5.24807 6.00063 5.24807C6.19989 5.24807 6.39098 5.32723 6.53188 5.46812L8 6.9375L9.46938 5.4675C9.61027 5.3266 9.80137 5.24745 10.0006 5.24745C10.1999 5.24745 10.391 5.3266 10.5319 5.4675C10.6728 5.6084 10.7519 5.79949 10.7519 5.99875C10.7519 6.19801 10.6728 6.3891 10.5319 6.53L10.5306 6.53062ZM14.75 8C14.75 9.33502 14.3541 10.6401 13.6124 11.7501C12.8707 12.8601 11.8165 13.7253 10.5831 14.2362C9.34971 14.7471 7.99252 14.8808 6.68314 14.6203C5.37377 14.3598 4.17104 13.717 3.22703 12.773C2.28303 11.829 1.64015 10.6262 1.3797 9.31686C1.11925 8.00749 1.25292 6.65029 1.76382 5.41689C2.27471 4.18349 3.13987 3.12928 4.2499 2.38758C5.35994 1.64588 6.66498 1.25 8 1.25C9.78961 1.25199 11.5053 1.96378 12.7708 3.22922C14.0362 4.49466 14.748 6.2104 14.75 8ZM13.25 8C13.25 6.96165 12.9421 5.94661 12.3652 5.08326C11.7883 4.2199 10.9684 3.54699 10.0091 3.14963C9.04978 2.75227 7.99418 2.6483 6.97578 2.85088C5.95738 3.05345 5.02192 3.55346 4.28769 4.28769C3.55347 5.02191 3.05345 5.95738 2.85088 6.97578C2.64831 7.99418 2.75228 9.04978 3.14964 10.0091C3.547 10.9684 4.2199 11.7883 5.08326 12.3652C5.94662 12.9421 6.96165 13.25 8 13.25C9.39193 13.2485 10.7264 12.6949 11.7107 11.7107C12.6949 10.7264 13.2485 9.39193 13.25 8Z" fill="#F04438" />
                          </svg>
                        </span>
                      </span>
                      <span class="tw-text-xs/4.5 tw-text-gray-400">Erros</span>
                    </div>
                    <div>
                      <span class="tw-flex tw-items-center tw-gap-1">
                        <span class="tw-text-lg tw-font-semibold tw-text-slate-800">
                          ${examQuestion.partialAnswers}
                        </span>
                        <span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M14.75 7.99929C14.75 9.7895 14.0388 11.5064 12.773 12.7723C11.5071 14.0381 9.79021 14.7493 8 14.7493C6.20979 14.7493 4.4929 14.0381 3.22703 12.7723C1.96116 11.5064 1.25 9.7895 1.25 7.99929C1.25 5.34179 2.79562 2.91554 5.1875 1.81804C5.27738 1.77422 5.37511 1.74882 5.47494 1.74332C5.57478 1.73783 5.67471 1.75235 5.76885 1.78604C5.86299 1.81972 5.94945 1.87189 6.02314 1.93948C6.09682 2.00707 6.15625 2.08871 6.19792 2.1796C6.23959 2.27049 6.26267 2.36879 6.2658 2.46873C6.26893 2.56867 6.25204 2.66823 6.21613 2.76155C6.18022 2.85486 6.12601 2.94006 6.05669 3.01212C5.98738 3.08418 5.90435 3.14166 5.8125 3.18116C3.9525 4.03491 2.75 5.92616 2.75 7.99929C2.75 9.39167 3.30312 10.727 4.28769 11.7116C5.27225 12.6962 6.60761 13.2493 8 13.2493C9.39239 13.2493 10.7277 12.6962 11.7123 11.7116C12.6969 10.727 13.25 9.39167 13.25 7.99929C13.25 5.92616 12.0475 4.03491 10.1875 3.18116C10.0956 3.14166 10.0126 3.08418 9.94331 3.01212C9.87399 2.94006 9.81978 2.85486 9.78387 2.76155C9.74796 2.66823 9.73107 2.56867 9.7342 2.46873C9.73733 2.36879 9.76041 2.27049 9.80208 2.1796C9.84375 2.08871 9.90318 2.00707 9.97686 1.93948C10.0506 1.87189 10.137 1.81972 10.2311 1.78604C10.3253 1.75235 10.4252 1.73783 10.5251 1.74332C10.6249 1.74882 10.7226 1.77422 10.8125 1.81804C13.2044 2.91554 14.75 5.34179 14.75 7.99929Z" fill="#FDB022" />
                          </svg>
                        </span>
                      </span>
                      <span class="tw-text-xs/4.5 tw-text-gray-400">Parciais</span>
                    </div>
                  </div>
                  <div>
                    <div class="tw-flex tw-flex-col tw-items-center">
                      <span class="tw-flex tw-items-center tw-gap-1">
                        <span class="tw-text-lg tw-font-semibold tw-text-slate-800">
                          ${Number(examQuestion.correctRate).toFixed(2)}%
                        </span>
                        <span>
                          <svg width="17" height="16" viewBox="0 0 17 16" fill="none">
                            <path d="M15.5835 3.5V7.5C15.5835 7.69891 15.5044 7.88968 15.3638 8.03033C15.2231 8.17098 15.0324 8.25 14.8335 8.25C14.6346 8.25 14.4438 8.17098 14.3031 8.03033C14.1625 7.88968 14.0835 7.69891 14.0835 7.5V5.3125L9.36409 10.0325C9.29442 10.1024 9.21162 10.1579 9.12046 10.1958C9.02929 10.2336 8.93155 10.2531 8.83284 10.2531C8.73413 10.2531 8.63639 10.2336 8.54523 10.1958C8.45407 10.1579 8.37127 10.1024 8.30159 10.0325L6.33347 8.0625L2.36409 12.0306C2.2232 12.1715 2.0321 12.2507 1.83284 12.2507C1.63359 12.2507 1.44249 12.1715 1.30159 12.0306C1.1607 11.8897 1.08154 11.6986 1.08154 11.4994C1.08154 11.3001 1.1607 11.109 1.30159 10.9681L5.80159 6.46813C5.87127 6.39821 5.95407 6.34273 6.04523 6.30487C6.13639 6.26702 6.23413 6.24753 6.33284 6.24753C6.43155 6.24753 6.52929 6.26702 6.62046 6.30487C6.71162 6.34273 6.79442 6.39821 6.86409 6.46813L8.83347 8.4375L13.021 4.25H10.8335C10.6346 4.25 10.4438 4.17098 10.3031 4.03033C10.1625 3.88968 10.0835 3.69891 10.0835 3.5C10.0835 3.30109 10.1625 3.11032 10.3031 2.96967C10.4438 2.82902 10.6346 2.75 10.8335 2.75H14.8335C15.0324 2.75 15.2231 2.82902 15.3638 2.96967C15.5044 3.11032 15.5835 3.30109 15.5835 3.5Z" fill="#CBD5E1" />
                          </svg>
                        </span>
                      </span>
                      <span class="tw-text-xs/4.5 tw-text-gray-400">Aproveitamento</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tw-flex tw-items-center tw-justify-between">
                <div>
                  <h4 class="tw-sr-only">Situação</h4>
                  <p class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                    <span class="tw-font-semibold tw-text-slate-800">${examQuestion.totalAnswers - examQuestion.awaitCorrection} de ${examQuestion.totalAnswers}</span> corrigidas
                  </p>
                  <div class="tw-min-w-50 tw-mt-1.5" aria-hidden="true">
                    <div class="tw-flex tw-items-center tw-gap-1">
                      <div
                        v-for="(bar, index) in 4"
                        class="tw-flex-1 tw-overflow-hidden tw-rounded-full tw-bg-slate-200"
                      >
                        <div class="tw-h-1.5 tw-rounded-full tw-bg-mint-600" :style="{ width: getBarWidth(index, getCorrectionTotalProgress(examQuestion)) }"></div>
                      </div>
                    </div>
                  </div>
                </div>
                <div>
                  <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-rounded-lg tw-px-4 tw-py-1.5 tw-text-sm tw-font-semibold tw-text-gray-700 tw-whitespace-nowrap tw-border tw-border-neutral-300 hover:tw-bg-gray-50" @click.prevent.default="getAnswers(examQuestion.id)">Corrigir</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <div class="tw-h-full tw-flex tw-items-center tw-justify-center">
          <div class="tw-text-center">
            <h3 class="tw-text-lg tw-font-semibold tw-text-gray-900">
              Nenhuma questão encontrada
            </h3>
          </div>
        </div>
      {% endif %}
    {% else %}
      <div class="tw-h-full tw-flex tw-items-center tw-justify-center">
        <div class="tw-text-center">
          <h3 class="tw-text-lg tw-font-semibold tw-text-gray-900">
            Selecione uma turma para exibir os resultados
          </h3>
          <p class="tw-mt-1 tw-text-lg tw-text-gray-500">
            Você deve selecionar uma turma para continuar com a correção.
          </p>
        </div>
      </div>
    {% endif %}
  </div>
</main>
{% endblock content-fixed %}
{% block endmain %}{% endblock endmain %}

{% block extra-modal %}
<div class="modal" tabindex="-1" role="dialog" id="detailModal">
  <div class="modal-dialog modal-fullscreen" role="document">
    <div class="modal-content">
      <template v-if="loadingAnswers">
        <div class="tw-flex tw-flex-col tw-items-center tw-justify-center tw-gap-4 tw-mt-8">
          <h6 class="tw-text-base tw-font-medium tw-text-slate-700 tw-mb-0">Carregando...</h6>
          <div class="spinner-border tw-text-primary-600" role="status">
            <span class="tw-sr-only">Carregando...</span>
          </div>
        </div>
      </template>
      <template v-else>
        <div class="tw-sticky tw-top-0 tw-z-10 tw-flex tw-justify-between tw-items-center tw-bg-white tw-border-b tw-border-slate-200 tw-px-4 tw-py-2">
          <div class="tw-flex tw-items-center tw-justify-between tw-flex-1">
            <div class="tw-flex tw-flex-col tw-justify-center tw-min-w-0 tw-flex-auto">
              <p class="tw-text-sm tw-font-semibold tw-text-slate-950">
                {{ object.name }}
              </p>
            </div>
            <div class="tw-flex tw-gap-x-2">
              <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-text-gray-500 tw-whitespace-nowrap tw-border tw-border-gray-200" :class="previousSelectedQuestion ? 'tw-opacity-100 hover:tw-bg-gray-50' : 'tw-opacity-50'" @click="previousSelectedQuestion ? changeQuestion('previous') : ''" :disabled="!previousSelectedQuestion">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-size-4 tw-text-gray-300">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
                </svg>
                Anterior
              </button>
              <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-text-gray-500 tw-whitespace-nowrap tw-border tw-border-gray-200" :class="nextSelectedQuestion ? 'tw-opacity-100 hover:tw-bg-gray-50' : 'tw-opacity-50'" @click="nextSelectedQuestion ? changeQuestion('next') : ''" :disabled="!nextSelectedQuestion">
                Próximo
                <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-size-4 tw-text-gray-300">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                </svg>
              </button>
            </div>
          </div>
          <div class="tw-flex tw-items-center tw-justify-end tw-flex-1">
            <div class="tw-flex tw-items-center tw-gap-2">
              <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-p-2 tw-text-xs/4.5 tw-font-semibold tw-text-gray-500 tw-whitespace-nowrap hover:tw-bg-gray-50" data-dismiss="modal" aria-label="Fechar">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-size-6 tw-text-gray-500">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div class="tw-flex tw-items-start tw-flex-1">
          <!-- Left column -->
          <div class="tw-w-[50%] tw-top-[3.5625rem] tw-fixed tw-inset-y-0 tw-left-0 tw-bg-white tw-overflow-y-auto tw-border-r tw-border-slate-200">
            <div>
              <div class="tw-p-6">
                <template v-if="selectedQuestion.question">
                  <div class="tw-flex tw-items-center tw-gap-2 tw-mb-2">
                    <p class="tw-text-sm tw-font-semibold tw-text-orange-400">
                      Questão ${selectedQuestion.question_number}
                    </p>
                    <span class="tw-bg-gray-50 tw-rounded tw-text-xs/4.5 tw-font-medium tw-text-slate-500 tw-px-3 tw-py-1">Valor da questão: <span class="tw-font-semibold tw-text-slate-700">${selectedQuestion.weight}</span></span>
                  </div>

                  <!-- :class="expandedEnunciation ? '' : 'tw-max-h-12'" -->
                  <div
                    id="collapseEnunciation"
                    class="tw-text-xs/4.5 tw-font-semibold tw-text-gray-800"
                    :class="expandedEnunciation ? '' : 'tw-max-h-12'"
                    v-html="selectedQuestion.question.enunciation"
                    style="transition: height 200ms; overflow: auto;"
                  ></div>
                  <div class="tw-mt-4">
                    <button type="button" :aria-expanded="expandedEnunciation" aria-controls="collapseEnunciation" class="tw-inline-flex tw-items-center tw-gap-1 tw-text-xs/4.5 tw-font-semibold tw-text-slate-500 tw-bg-white tw-ring-1 tw-ring-slate-200 tw-rounded-lg tw-px-4 tw-py-1 hover:tw-bg-gray-50" @click="expandedEnunciation = !expandedEnunciation">
                      Detalhes da questão
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-transform tw-transition-transform tw-duration-300" :class="expandedEnunciation ? 'tw-rotate-180' : ''">
                        <path d="M13.5306 6.53122L8.5306 11.5312C8.46092 11.6011 8.37813 11.6566 8.28696 11.6945C8.1958 11.7323 8.09806 11.7518 7.99935 11.7518C7.90064 11.7518 7.8029 11.7323 7.71173 11.6945C7.62057 11.6566 7.53778 11.6011 7.4681 11.5312L2.4681 6.53122C2.3272 6.39033 2.24805 6.19923 2.24805 5.99997C2.24805 5.80072 2.3272 5.60962 2.4681 5.46872C2.60899 5.32783 2.80009 5.24867 2.99935 5.24867C3.19861 5.24867 3.3897 5.32783 3.5306 5.46872L7.99997 9.9381L12.4693 5.4681C12.6102 5.3272 12.8013 5.24805 13.0006 5.24805C13.1999 5.24805 13.391 5.3272 13.5318 5.4681C13.6727 5.60899 13.7519 5.80009 13.7519 5.99935C13.7519 6.19861 13.6727 6.3897 13.5318 6.5306L13.5306 6.53122Z" fill="#CBD5E1" />
                      </svg>
                    </button>
                  </div>

                  <div id="answers-accordion" class="tw-mt-2 accordion">
                    <template v-for="(application_student, index) in selectedQuestion.applications_student">
                      <h6
                        class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-700"
                        @click="clearFeedbackMessage(), selectApplicationStudent(application_student, index)"
                      >
                        <span class="tw-flex tw-items-center tw-justify-between">
                          <span>${application_student.student_name}</span>
                          <span class="tw-flex tw-items-center tw-gap-6">
                            <span v-if="application_student.similar_answers.length" class="badge badge-danger">${application_student.similar_answers.length} Respotas similares</span>
                            <span>
                              <template v-if="application_student.is_omr && !application_student.missed">
                                <svg width="20" height="21" viewBox="0 0 20 21" fill="none">
                                  <g clip-path="url(#clip0_3777_9082)">
                                    <path d="M11.9142 13.0411C12.8337 12.3182 13.505 11.3267 13.8347 10.2044C14.1643 9.08218 14.1359 7.88508 13.7534 6.77973C13.3709 5.67438 12.6534 4.71576 11.7007 4.03726C10.7479 3.35876 9.60734 2.99414 8.43768 2.99414C7.26802 2.99414 6.12746 3.35876 5.17471 4.03726C4.22196 4.71576 3.50441 5.67438 3.12193 6.77973C2.73945 7.88508 2.71105 9.08218 3.04069 10.2044C3.37033 11.3267 4.04161 12.3182 4.96112 13.0411C3.48239 13.6441 2.17566 14.6033 1.15721 15.8333C0.997252 16.0238 0.919488 16.2699 0.941026 16.5177C0.962563 16.7654 1.08164 16.9945 1.27205 17.1544C1.46247 17.3144 1.70863 17.3922 1.95639 17.3706C2.20414 17.3491 2.43319 17.23 2.59315 17.0396C3.66268 15.7661 5.54706 14.249 8.43768 14.249C11.3283 14.249 13.2127 15.7661 14.2822 17.0396C14.4422 17.23 14.6712 17.3491 14.919 17.3706C15.1667 17.3922 15.4129 17.3144 15.6033 17.1544C15.7937 16.9945 15.9128 16.7654 15.9343 16.5177C15.9559 16.2699 15.8781 16.0238 15.7181 15.8333C14.6999 14.603 13.3931 13.6438 11.9142 13.0411ZM4.68768 8.62396C4.68768 7.88228 4.90761 7.15726 5.31967 6.54057C5.73172 5.92389 6.31739 5.44324 7.00262 5.15941C7.68784 4.87558 8.44184 4.80132 9.16927 4.94601C9.8967 5.09071 10.5649 5.44786 11.0893 5.97231C11.6138 6.49676 11.9709 7.16494 12.1156 7.89237C12.2603 8.6198 12.1861 9.3738 11.9022 10.059C11.6184 10.7442 11.1378 11.3299 10.5211 11.742C9.90438 12.154 9.17936 12.374 8.43768 12.374C7.44344 12.3729 6.49021 11.9775 5.78717 11.2745C5.08413 10.5714 4.68871 9.6182 4.68768 8.62396ZM19.726 11.4747L17.226 13.9747C17.1389 14.0621 17.0354 14.1315 16.9214 14.1788C16.8075 14.2261 16.6853 14.2505 16.5619 14.2505C16.4385 14.2505 16.3163 14.2261 16.2024 14.1788C16.0884 14.1315 15.9849 14.0621 15.8978 13.9747L14.6478 12.7247C14.4717 12.5486 14.3728 12.3098 14.3728 12.0607C14.3728 11.8116 14.4717 11.5727 14.6478 11.3966C14.824 11.2205 15.0628 11.1216 15.3119 11.1216C15.561 11.1216 15.7998 11.2205 15.976 11.3966L16.5627 11.9833L18.3994 10.1458C18.4866 10.0586 18.5901 9.98945 18.7041 9.94226C18.818 9.89506 18.9401 9.87077 19.0635 9.87077C19.1868 9.87077 19.3089 9.89506 19.4228 9.94226C19.5368 9.98945 19.6403 10.0586 19.7275 10.1458C19.8147 10.233 19.8839 10.3366 19.9311 10.4505C19.9783 10.5644 20.0026 10.6866 20.0026 10.8099C20.0026 10.9332 19.9783 11.0553 19.9311 11.1693C19.8839 11.2832 19.8147 11.3868 19.7275 11.474L19.726 11.4747Z" fill="#12B76A"/>
                                  </g>
                                  <defs>
                                    <clipPath id="clip0_3777_9082">
                                      <rect width="20" height="20" fill="white" transform="translate(0 0.810547)"/>
                                    </clipPath>
                                  </defs>
                                </svg>
                              </template>
                              <template v-else>
                                <svg width="20" height="21" viewBox="0 0 20 21" fill="none">
                                  <g clip-path="url(#clip0_3777_9110)">
                                    <path d="M20.0002 11.4353C20.0002 11.6839 19.9014 11.9224 19.7256 12.0982C19.5498 12.274 19.3113 12.3728 19.0627 12.3728H15.9377C15.689 12.3728 15.4506 12.274 15.2748 12.0982C15.099 11.9224 15.0002 11.6839 15.0002 11.4353C15.0002 11.1866 15.099 10.9482 15.2748 10.7724C15.4506 10.5966 15.689 10.4978 15.9377 10.4978H19.0627C19.3113 10.4978 19.5498 10.5966 19.7256 10.7724C19.9014 10.9482 20.0002 11.1866 20.0002 11.4353ZM15.7181 15.8322C15.8781 16.0226 15.9559 16.2687 15.9343 16.5165C15.9128 16.7642 15.7937 16.9933 15.6033 17.1533C15.4129 17.3132 15.1667 17.391 14.919 17.3694C14.6712 17.3479 14.4422 17.2288 14.2822 17.0384C13.2127 15.765 11.3283 14.2478 8.43768 14.2478C6.18065 14.2478 4.10487 15.2384 2.59315 17.0384C2.43319 17.2288 2.20414 17.3479 1.95639 17.3694C1.70863 17.391 1.46247 17.3132 1.27205 17.1533C1.08164 16.9933 0.962563 16.7642 0.941026 16.5165C0.919488 16.2687 0.997252 16.0226 1.15721 15.8322C2.17575 14.602 3.48243 13.6426 4.96112 13.0392C4.04161 12.3163 3.37033 11.3247 3.04069 10.2025C2.71105 9.08022 2.73945 7.88313 3.12193 6.77778C3.50441 5.67243 4.22196 4.7138 5.17471 4.03531C6.12746 3.35681 7.26802 2.99219 8.43768 2.99219C9.60734 2.99219 10.7479 3.35681 11.7007 4.03531C12.6534 4.7138 13.3709 5.67243 13.7534 6.77778C14.1359 7.88313 14.1643 9.08022 13.8347 10.2025C13.505 11.3247 12.8337 12.3163 11.9142 13.0392C13.3931 13.6424 14.6998 14.6018 15.7181 15.8322ZM8.43768 12.3728C9.17936 12.3728 9.90438 12.1529 10.5211 11.7408C11.1378 11.3287 11.6184 10.7431 11.9022 10.0579C12.1861 9.37263 12.2603 8.61863 12.1156 7.8912C11.9709 7.16377 11.6138 6.49558 11.0893 5.97114C10.5649 5.44669 9.8967 5.08954 9.16927 4.94484C8.44184 4.80015 7.68784 4.87441 7.00262 5.15824C6.31739 5.44207 5.73172 5.92271 5.31967 6.5394C4.90761 7.15608 4.68768 7.88111 4.68768 8.62279C4.68871 9.61703 5.08413 10.5703 5.78717 11.2733C6.49021 11.9763 7.44344 12.3718 8.43768 12.3728Z" fill="#F04438"/>
                                  </g>
                                  <defs>
                                    <clipPath id="clip0_3777_9110">
                                      <rect width="20" height="20" fill="white" transform="translate(0 0.810547)"/>
                                    </clipPath>
                                  </defs>
                                </svg>
                              </template>
                            </span>
                            <template v-if="application_student.is_omr && !application_student.missed">
                              <span class="tw-bg-gray-50 tw-rounded tw-text-xs/4.5 tw-font-medium tw-text-slate-500 tw-px-3 tw-py-1">
                                <template v-if="application_student.answers.at(0)">
                                  <template v-if="application_student.answers.at(0).percent_grade >= 0 && selectedQuestion.question.category != 'Objetiva'">
                                    <template v-if="![null, undefined].includes(application_student.answers.at(0).teacher_grade)">
                                      Valor: <span class="tw-font-semibold tw-tabular-nums" :class="{'tw-text-mint-600': parseFloat(application_student.answers.at(0).percent_grade).toFixed(2) == parseFloat(1.0).toFixed(2), 'tw-text-poppy-700': parseFloat(application_student.answers.at(0).percent_grade) === 0, 'tw-text-honey-500': parseFloat(application_student.answers.at(0).percent_grade).toFixed(2) !== parseFloat(1.0).toFixed(2) && parseFloat(application_student.answers.at(0).percent_grade) !== 0}">${parseFloat(application_student.answers.at(0).percent_grade) !== 0 ? parseFloat(selectedQuestion.weight * application_student.answers.at(0).percent_grade).toFixed(2) : (0).toFixed(2)}</span>
                                    </template>
                                    <template v-else-if="application_student.answers.at(0)">
                                      <span class="tw-font-semibold tw-text-slate-400 tw-tabular-nums">-</span>
                                    </template>
                                  </template>
                                  <template v-if="selectedQuestion.question.category == 'Objetiva'">
                                    Valor: <span class="tw-font-semibold tw-tabular-nums" :class="application_student.answers.at(0).is_correct ? 'tw-text-mint-600' : 'tw-text-poppy-700'">${application_student.answers.at(0).teacher_grade}</span>
                                  </template>
                                  <template v-else-if="selectedQuestion.question.category == 'Somatório'">
                                    Valor: <span class="tw-font-semibold tw-tabular-nums" :class="parseFloat(application_student.answers.at(0).teacher_grade) === parseFloat(selectedQuestion.weight) ? 'tw-text-mint-600' : parseFloat(application_student.answers.at(0).teacher_grade) === 0 ? 'tw-text-poppy-700' : 'tw-text-honey-500'">
                                      ${application_student.answers.at(0).teacher_grade}
                                    </span>
                                  </template>
                                </template>
                                <template v-else>
                                  Valor: <span class="tw-font-semibold tw-text-slate-400 tw-tabular-nums">0</span>
                                </template>
                              </span>
                            </template>
                            <template v-else>
                              <span class="tw-bg-gray-50 tw-rounded tw-text-xs/4.5 tw-font-medium tw-text-slate-500 tw-px-3 tw-py-1">
                                Valor: <span class="tw-font-semibold tw-text-slate-400 tw-tabular-nums">0</span>
                              </span>
                            </template>
                          </span>
                        </span>
                      </h6>
                      <div class="tw-py-6">
                        <template v-if="selectedApplicationStudent.can_be_corrected">
                          <template v-if="selectedQuestion.question.category == 'Objetiva'">
                            <template v-if="selectedApplicationStudent.answers.at(0) && selectedApplicationStudent.answers.at(0).created_by_name">
                              <div class="tw-rounded-lg tw-bg-honey-100 tw-px-4 tw-py-3 tw--mt-6 tw-mb-4">
                                <div class="tw-flex tw-items-center">
                                  <div class="tw-shrink-0">
                                    <svg class="tw-size-5 tw-text-honey-800" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
                                    </svg>
                                  </div>
                                  <div class="tw-ml-3">
                                    <div class="tw-text-xs/4.5 tw-font-medium tw-text-honey-800">
                                      <p class="tw-mb-0">
                                        Resposta alterada manualmente por <span class="tw-font-bold">${selectedApplicationStudent.answers.at(0).created_by_name}</span> em <span class="tw-font-bold">${moment(selectedApplicationStudent.answers.at(0).created_at).format('LLL')}</span>.
                                      </p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </template>
                            <div class="tw-flex tw-flex-col tw-gap-4">
                              <div
                                v-for="(alternative, indexAlternative) in selectedQuestion.question.alternatives"
                                class="tw-rounded-lg tw-border tw-border-gray-200 tw-p-4"
                                :class="getOptionClass(alternative, selectedApplicationStudent.answers.at(0).option_answer)"
                              >
                                <div class="custom-control custom-radio">
                                  <input
                                    type="radio"
                                    :id="'alternative-'+index+'-'+ alternative.id"
                                    :name="'alternatives-' + index"
                                    class="custom-control-input"
                                    :checked="selectedApplicationStudent.answers.at(0) ? alternative.id == selectedApplicationStudent.answers.at(0).option_answer : ''"
                                    :value="alternative.id"
                                    @change="handlerChangeOption(index, selectedApplicationStudent.answers.at(0) ? selectedApplicationStudent.answers.at(0).option_answer:''), updateChoiceAnswer(index)"
                                  />
                                  <label class="custom-control-label remove-p-margin tw-flex tw-items-center tw-gap-4 tw-pb-0" :for="'alternative-'+index+'-'+ alternative.id">
                                    <span
                                      class="tw-text-2xl tw-font-semibold tw-ml-4"
                                      :class="[alternative.is_correct ? 'tw-text-mint-900' : (alternative.id === selectedQuestion.answer && !alternative.is_correct) ? 'tw-text-poppy-800' : 'tw-text-slate-400']"
                                    >
                                      ${generateAlternativeOrder(indexAlternative)}
                                    </span>
                                    <span
                                      class="tw-text-sm"
                                      :class="[alternative.is_correct ? 'tw-text-mint-900' : 'tw-text-slate-600']"
                                      v-html="alternative.text"
                                    >
                                    </span>
                                  </label>
                                </div>
                              </div>
                            </div>
                            <div class="tw-flex tw-items-center tw-mt-4">
                              <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-text-gray-500 tw-whitespace-nowrap tw-border tw-border-gray-200 hover:tw-bg-gray-50" title="Deletar nota" v-if="selectedApplicationStudent.answers.at(0) && selectedApplicationStudent.answers.at(0).option_answer" @click="removeGradeAlert(isOption = true, index = index)">
                                Apagar resposta
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                  <path d="M13.5 3H2.5C2.30109 3 2.11032 3.07902 1.96967 3.21967C1.82902 3.36032 1.75 3.55109 1.75 3.75C1.75 3.94891 1.82902 4.13968 1.96967 4.28033C2.11032 4.42098 2.30109 4.5 2.5 4.5H2.75V13C2.75 13.3315 2.8817 13.6495 3.11612 13.8839C3.35054 14.1183 3.66848 14.25 4 14.25H12C12.3315 14.25 12.6495 14.1183 12.8839 13.8839C13.1183 13.6495 13.25 13.3315 13.25 13V4.5H13.5C13.6989 4.5 13.8897 4.42098 14.0303 4.28033C14.171 4.13968 14.25 3.94891 14.25 3.75C14.25 3.55109 14.171 3.36032 14.0303 3.21967C13.8897 3.07902 13.6989 3 13.5 3ZM11.75 12.75H4.25V4.5H11.75V12.75ZM4.75 1.25C4.75 1.05109 4.82902 0.860322 4.96967 0.71967C5.11032 0.579018 5.30109 0.5 5.5 0.5H10.5C10.6989 0.5 10.8897 0.579018 11.0303 0.71967C11.171 0.860322 11.25 1.05109 11.25 1.25C11.25 1.44891 11.171 1.63968 11.0303 1.78033C10.8897 1.92098 10.6989 2 10.5 2H5.5C5.30109 2 5.11032 1.92098 4.96967 1.78033C4.82902 1.63968 4.75 1.44891 4.75 1.25Z" fill="#F04438"/>
                                </svg>
                              </button>
                            </div>
                          </template>
                          <template v-else-if="selectedQuestion.question.category == 'Somatório'">
                            <div class="tw-flex tw-flex-col tw-gap-4">
                              <template v-if="selectedApplicationStudent.answers.at(0) && selectedApplicationStudent.answers.at(0).created_by_name">
                                <div class="tw-rounded-lg tw-bg-honey-100 tw-px-4 tw-py-3 tw--mt-6 tw-mb-4">
                                  <div class="tw-flex tw-items-center">
                                    <div class="tw-shrink-0">
                                      <svg class="tw-size-5 tw-text-honey-800" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
                                      </svg>
                                    </div>
                                    <div class="tw-ml-3">
                                      <div class="tw-text-xs/4.5 tw-font-medium tw-text-honey-800">
                                        <p class="tw-mb-0">
                                          Resposta alterada manualmente por <span class="tw-font-bold">${selectedApplicationStudent.answers.at(0).created_by_name}</span> em <span class="tw-font-bold">${moment(selectedApplicationStudent.answers.at(0).created_at).format('LLL')}</span>.
                                        </p>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </template>
                              <div>
                                <fieldset>
                                  <legend class="tw-sr-only">Itens</legend>
                                  <div class="tw-flex tw-flex-col tw-gap-4">
                                    <div class="tw-flex tw-items-center tw-gap-4 tw-rounded-lg tw-border tw-border-gray-200 tw-p-4" v-for="(alternative, index) in selectedQuestion.question.alternatives" :class="selectedApplicationStudent.answers.at(0) ? getOptionClass(alternative, selectedApplicationStudent.answers.at(0).option_answer) : ''">
                                      <div class="tw-flex tw-h-6 tw-shrink-0 tw-items-center">
                                        <div class="tw-group tw-grid tw-size-4 tw-grid-cols-1">
                                          <input :id="'alternative-'+index+'-'+ alternative.id" :name="'alternatives-' + index" type="checkbox" :value="alternative.id" :checked="selectedApplicationStudent.answers.at(0) && selectedApplicationStudent.answers.at(0).checked_options.includes(alternative.id)" disabled class="tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white checked:tw-border-mint-600 checked:tw-bg-mint-600 indeterminate:tw-border-mint-600 indeterminate:tw-bg-mint-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-mint-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                          <svg class="tw-pointer-events-none tw-col-start-1 tw-row-start-1 tw-size-3.5 tw-self-center tw-justify-self-center tw-stroke-white group-has-[:disabled]:tw-stroke-gray-950/25" viewBox="0 0 14 14" fill="none">
                                            <path class="tw-opacity-0 group-has-[:checked]:tw-opacity-100" d="M3 8L6 11L11 3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            <path class="tw-opacity-0 group-has-[:indeterminate]:tw-opacity-100" d="M3 7H11" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                          </svg>
                                        </div>
                                      </div>
                                      <div class="tw-text-sm/6">
                                        <label class="remove-p-margin tw-flex tw-items-center tw-gap-4" :for="'alternative-'+index+'-'+ alternative.id">
                                          <span class="tw-text-2xl tw-font-semibold tw-text-slate-400">
                                            ${2**index}
                                          </span>
                                          <span class="tw-text-sm tw-text-slate-600" v-html="alternative.text"></span>
                                        </label>
                                      </div>
                                    </div>
                                  </div>
                                </fieldset>
                              </div>
                              <div>
                                <label for="sumValue" class="tw-block tw-text-sm/6 tw-font-medium tw-text-gray-900">
                                  Valor informado na resposta do aluno
                                </label>
                                <div class="mt-2">
                                  <input type="number" id="sumValue" class="tw-block tw-w-full tw-rounded-md tw-bg-white tw-px-3 tw-py-1.5 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600 sm:tw-text-sm/6" placeholder="Digite o valor do somatório" v-model="selectedApplicationStudent.answers.at(0).sum_value" v-if="selectedApplicationStudent.answers.at(0)" />
                                  <input type="number" id="sumValue" class="tw-block tw-w-full tw-rounded-md tw-bg-white tw-px-3 tw-py-1.5 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600 sm:tw-text-sm/6" placeholder="Digite o valor do somatório" v-model="newSumAnswer" v-else />
                                </div>
                                <p class="tw-mt-2 tw-text-sm tw-text-gray-500" id="sumValue-description">
                                  Você pode ajustar o valor informado pelo aluno, caso identifique algum erro na resposta.
                                </p>
                              </div>
                              <div class="tw-flex tw-items-center tw-justify-between tw-mt-2">
                                <!-- <div class="tw-flex tw-items-center tw-gap-2"></div> -->
                                <div>
                                  <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-text-white tw-whitespace-nowrap hover:tw-bg-primary-950/2" :class="selectedApplicationStudent.answers.at(0) && selectedApplicationStudent.answers.at(0).sum_value < 1 ? 'tw-bg-primary-400' : 'tw-bg-primary-600'" @click="updateSumQuestionAnswer(selectedApplicationStudent.answers.at(0).sum_value, selectedQuestion.question)" :disabled="selectedApplicationStudent.answers.at(0) && selectedApplicationStudent.answers.at(0).sum_value < 1" v-if="selectedApplicationStudent.answers.at(0)">
                                    Salvar
                                  </button>
                                  <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-text-white tw-whitespace-nowrap hover:tw-bg-primary-950/2" :class="newSumAnswer < 1 ? 'tw-bg-primary-400' : 'tw-bg-primary-600'" @click="updateSumQuestionAnswer(newSumAnswer, selectedQuestion.question)" :disabled="newSumAnswer < 1" v-else>
                                    Salvar
                                  </button>
                                </div>
                              </div>
                            </div>
                          </template>
                          <template v-else>
                            <div class="tw-flex tw-flex-col tw-gap-4">
                              <div v-if="selectedApplicationStudent.answers.at(0)">
                                <template v-if="selectedQuestion.question.category == 'Arquivo anexado'">
                                  {% if object.group_attachments %}
                                    <div class="row row-xs" v-if="getAttachmentsExamTeacherSubject(selectedQuestion.exam_teacher_subject)">
                                      <div class="col-sm-12 col-lg-6 col-xl-6 p-1" v-for="(attachment, index) in getAttachmentsExamTeacherSubject(selectedQuestion.exam_teacher_subject).attachments">
                                        <div class="card">
                                          <div class="card-body py-2 d-flex justify-content-between align-items-center">
                                            <div class="d-flex align-items-center">
                                              <i class="fas fa-file fa-2x text-primary"></i>
                                              <h6 class="ml-1 mb-0"><a :href="attachment.file" target="_blank" class="link-02">Anexo ${index + 1}</a></h6>
                                            </div>
                                            <div>
                                              <template v-if="checkAnswerType(attachment.file)">
                                                <a href="javascript:void(0)" class="btn btn-xs btn-primary" data-animation="effect-scale" @click="showAnnotorious(false, false, attachment.file)"><i class="fas fa-image"></i></a>
                                              </template>
                                              <template v-else>
                                                <a :href="attachment.file" target="_blank" class="btn btn-xs btn-primary"><i class="fas fa-download"></i></a>
                                              </template>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                      <span class="text-danger" v-if="selectedQuestion && !getAttachmentsExamTeacherSubject(selectedQuestion.exam_teacher_subject).attachments.length">O aluno não enviou arquivo</span>
                                    </div>
                                  {% else %}
                                    <template v-if="selectedApplicationStudent.answers.at(0).corrected_but_no_answer">
                                      <span class="text-danger">A questão foi corrigida, mas a resposta do aluno não foi detectada automaticamente. Verifique na imagem do cartão ao lado.</span>
                                    </template>
                                    <template v-else>
                                      <div class="d-flex justify-content-center">
                                        <template v-if="selectedApplicationStudent.answers.at(0).file">
                                          <img @click="checkAnswerType(selectedApplicationStudent.answers.at(0)) ? showAnnotorious(true, false, selectedApplicationStudent.answers.at(0).file):''" :src="checkAnswerType(selectedApplicationStudent.answers.at(0)) ? selectedApplicationStudent.answers.at(0).file:''" class="img-fluid cp" style="max-height: 400px;">
                                        </template>
                                        <template v-else>
                                          <span class="text-danger">Resposta não detectada automaticamente. Verifique o cartão reposta ao lado para atribuir nota.</span>
                                        </template>
                                      </div>
                                    </template>
                                  {% endif %}
                                </template>
                                <template v-if="selectedQuestion.category == 'Discursiva'">
                                  <span class="font-weight-bold">Resposta do aluno:</span>
                                  <p v-if="selectedQuestion.textual_answer">${selectedApplicationStudent.answers.at(0).text}</p>
                                  <span class="text-danger" v-else>Nenhuma resposta enviada.</span>
                                </template>
                              </div>
                              <div class="col-12 col-md-6" v-if="application_student.similar_answers && application_student.similar_answers.length">
                                <h6>Respostas similares</h6>
                                <div id="accordion">
                                  <div class="card" v-for="similar in application_student.similar_answers">
                                    <div class="card-header p-2">
                                      <a :href="'#collapse-'+application_student.answers.at(0).id+'-'+similar.student_application.pk" data-toggle="collapse">
                                        ${similar.student_application.student}
                                      </a>
                                      <span class="badge badge-primary float-right">
                                        ${(parseFloat(similar.similarity) * 100).toFixed(2)} %
                                      </span>
                                    </div>
                                    <div class="collapse card-body p-2" :id="'collapse-'+application_student.answers.at(0).id+'-'+similar.student_application.pk" data-parent="#accordion" style="background: #f5f6fa;">
                                      <p class="mb-0">${similar.content}</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <template v-if="selectedApplicationStudent.answers.at(0) && selectedApplicationStudent.answers.at(0).id">
                                <template v-if="selectedApplicationStudent.answers.length > 0 && selectedApplicationStudent.answers[0].suggestions && selectedApplicationStudent.answers[0].suggestions.length > 0">
                                  <div>
                                    <div class="tw-rounded-lg tw-bg-orange-50 tw-border tw-border-orange-300 tw-p-6">
                                      <div class="tw-flex tw-items-center">
                                        <div class="tw-shrink-0">
                                          <svg class="tw-size-4 tw-text-orange-500" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z" />
                                          </svg>
                                        </div>
                                        <div class="tw-ml-1">
                                          <h3 class="tw-text-xs/4.5 tw-text-orange-800">
                                            Sugestões da <span class="tw-font-semibold">Lize AI</span>
                                          </h3>
                                        </div>
                                      </div>
                                      <div class="tw-divide-y tw-divide-orange-200 tw-mt-2">
                                        <div class="tw-flex tw-items-center tw-justify-between tw-gap-2 tw-py-3">
                                          <div class="tw-flex tw-items-center tw-gap-2">
                                            <p class="tw-text-xs/4.5 tw-text-orange-800 tw-font-semibold tw-mb-0">
                                              Nota da IA
                                            </p>
                                            <span class="tw-bg-orange-100 tw-rounded tw-text-xs/4.5 tw-text-orange-800 tw-py-1 tw-px-4">
                                              <!-- <span class="tw-font-bold">0.67</span> de 0.67 -->
                                              <span class="tw-font-bold">
                                                ${selectedApplicationStudent.answers[0].suggestions[0].grade * 100}%
                                              </span>
                                            </span>
                                          </div>
                                          <div>
                                            <button type="button" class="tw-flex tw-items-center tw-gap-1.5 tw-rounded-lg tw-text-orange-600 tw-border tw-border-orange-600 tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-whitespace-nowrap hover:tw-text-white tw-shadow-sm hover:tw-bg-orange-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-orange-600 tw-transition-colors" title="Aprovar nota" @click="setSuggestion(selectedApplicationStudent.answers[0].suggestions[0])">
                                              <svg width="16" height="17" viewBox="0 0 16 17" fill="none">
                                                <path d="M14.8125 5.65242C14.6482 5.46632 14.4462 5.3173 14.2199 5.21525C13.9936 5.11321 13.7482 5.06047 13.5 5.06055H10.25V4.31055C10.2492 3.58146 9.95918 2.88246 9.44363 2.36692C8.92808 1.85137 8.22909 1.56137 7.5 1.56055C7.36077 1.56056 7.2243 1.59933 7.10585 1.67252C6.98741 1.7457 6.89168 1.85041 6.82937 1.97492L4.53625 6.56055H2C1.66848 6.56055 1.35054 6.69224 1.11612 6.92666C0.881696 7.16108 0.75 7.47903 0.75 7.81055V13.3105C0.75 13.6421 0.881696 13.96 1.11612 14.1944C1.35054 14.4289 1.66848 14.5605 2 14.5605H12.75C13.1765 14.5605 13.5883 14.4047 13.9081 14.1223C14.2278 13.84 14.4334 13.4507 14.4862 13.0274L15.2362 7.02742C15.2671 6.78129 15.2453 6.53141 15.1722 6.29436C15.0992 6.0573 14.9765 5.83849 14.8125 5.65242ZM2.25 8.06055H4.25V13.0605H2.25V8.06055ZM13.75 6.8418L13 12.8418C12.9923 12.9025 12.9627 12.9584 12.9166 12.9987C12.8705 13.039 12.8112 13.061 12.75 13.0605H5.75V7.48742L7.92625 3.13555C8.1676 3.2231 8.37615 3.38284 8.52353 3.59307C8.67091 3.80329 8.74998 4.0538 8.75 4.31055V5.81055C8.75 6.00946 8.82902 6.20022 8.96967 6.34088C9.11032 6.48153 9.30109 6.56055 9.5 6.56055H13.5C13.5356 6.56027 13.5709 6.56761 13.6035 6.58208C13.636 6.59655 13.6651 6.61781 13.6888 6.64445C13.7125 6.67108 13.7302 6.70247 13.7407 6.73651C13.7513 6.77054 13.7545 6.80644 13.75 6.8418Z" fill="currentColor" />
                                              </svg>
                                              Aprovar a nota
                                            </button>
                                          </div>
                                        </div>
                                        <div class="tw-flex tw-items-center tw-justify-between tw-gap-2 tw-py-3">
                                          <div>
                                            <p class="tw-text-xs/4.5 tw-text-orange-800 tw-font-semibold tw-mb-0">
                                              Feedback da IA
                                            </p>
                                            <p class="tw-text-xs/4.5 tw-text-orange-800 tw-mt-1 tw-mb-0">
                                              ${selectedApplicationStudent.answers[0].suggestions[0].teacher_feedback}
                                            </p>
                                          </div>
                                          <div>
                                            <button type="button" class="tw-flex tw-items-center tw-gap-1.5 tw-rounded-lg tw-text-orange-600 tw-border tw-border-orange-600 tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-whitespace-nowrap hover:tw-text-white tw-shadow-sm hover:tw-bg-orange-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-orange-600 tw-transition-colors" title="Aprovar nota e feedback" @click="setSuggestion(selectedApplicationStudent.answers[0].suggestions[0], true)">
                                              <svg width="16" height="17" viewBox="0 0 16 17" fill="none">
                                                <path d="M14.8125 5.65242C14.6482 5.46632 14.4462 5.3173 14.2199 5.21525C13.9936 5.11321 13.7482 5.06047 13.5 5.06055H10.25V4.31055C10.2492 3.58146 9.95918 2.88246 9.44363 2.36692C8.92808 1.85137 8.22909 1.56137 7.5 1.56055C7.36077 1.56056 7.2243 1.59933 7.10585 1.67252C6.98741 1.7457 6.89168 1.85041 6.82937 1.97492L4.53625 6.56055H2C1.66848 6.56055 1.35054 6.69224 1.11612 6.92666C0.881696 7.16108 0.75 7.47903 0.75 7.81055V13.3105C0.75 13.6421 0.881696 13.96 1.11612 14.1944C1.35054 14.4289 1.66848 14.5605 2 14.5605H12.75C13.1765 14.5605 13.5883 14.4047 13.9081 14.1223C14.2278 13.84 14.4334 13.4507 14.4862 13.0274L15.2362 7.02742C15.2671 6.78129 15.2453 6.53141 15.1722 6.29436C15.0992 6.0573 14.9765 5.83849 14.8125 5.65242ZM2.25 8.06055H4.25V13.0605H2.25V8.06055ZM13.75 6.8418L13 12.8418C12.9923 12.9025 12.9627 12.9584 12.9166 12.9987C12.8705 13.039 12.8112 13.061 12.75 13.0605H5.75V7.48742L7.92625 3.13555C8.1676 3.2231 8.37615 3.38284 8.52353 3.59307C8.67091 3.80329 8.74998 4.0538 8.75 4.31055V5.81055C8.75 6.00946 8.82902 6.20022 8.96967 6.34088C9.11032 6.48153 9.30109 6.56055 9.5 6.56055H13.5C13.5356 6.56027 13.5709 6.56761 13.6035 6.58208C13.636 6.59655 13.6651 6.61781 13.6888 6.64445C13.7125 6.67108 13.7302 6.70247 13.7407 6.73651C13.7513 6.77054 13.7545 6.80644 13.75 6.8418Z" fill="currentColor" />
                                              </svg>
                                              Aprovar nota e feedback
                                            </button>
                                          </div>
                                        </div>
                                        <div class="tw-flex tw-items-center tw-justify-between tw-py-3">
                                          <div>
                                            <p class="tw-text-xs/4.5 tw-text-orange-800 tw-font-semibold tw-mb-0">
                                              Justificativa
                                            </p>
                                            <p class="tw-text-xs/4.5 tw-text-orange-800 tw-mt-1 tw-mb-0">
                                              ${selectedApplicationStudent.answers[0].suggestions[0].comment}
                                            </p>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </template>
                                <!-- <div>
                                  <div class="d-flex justify-content-between">
                                    <div>
                                      <span class="font-weight-bold">Valor da questão:</span>
                                      <span class="badge badge-info">${selectedQuestion.weight}</span>
                                    </div>
                                  </div>
                                </div> -->
                                <template v-if="!selectedQuestion.question.text_correction && selectedApplicationStudent.answers.at(0)">
                                  <div class="tw-flex tw-flex-col tw-gap-2">
                                    <div class="tw-flex tw-items-center tw-justify-between">
                                      <div>
                                        <span class="tw-flex tw-items-center tw-gap-2">
                                          <svg width="16" height="17" viewBox="0 0 16 17" fill="none">
                                            <path d="M10.75 6.80089C10.75 6.9998 10.671 7.19057 10.5304 7.33122C10.3897 7.47187 10.1989 7.55089 10 7.55089H6.00003C5.80112 7.55089 5.61035 7.47187 5.4697 7.33122C5.32905 7.19057 5.25003 6.9998 5.25003 6.80089C5.25003 6.60198 5.32905 6.41121 5.4697 6.27056C5.61035 6.12991 5.80112 6.05089 6.00003 6.05089H10C10.1989 6.05089 10.3897 6.12991 10.5304 6.27056C10.671 6.41121 10.75 6.60198 10.75 6.80089ZM10 8.55089H6.00003C5.80112 8.55089 5.61035 8.62991 5.4697 8.77056C5.32905 8.91121 5.25003 9.10198 5.25003 9.30089C5.25003 9.4998 5.32905 9.69057 5.4697 9.83122C5.61035 9.97187 5.80112 10.0509 6.00003 10.0509H10C10.1989 10.0509 10.3897 9.97187 10.5304 9.83122C10.671 9.69057 10.75 9.4998 10.75 9.30089C10.75 9.10198 10.671 8.91121 10.5304 8.77056C10.3897 8.62991 10.1989 8.55089 10 8.55089ZM14.75 8.05089C14.7503 9.20712 14.4535 10.344 13.8882 11.3526C13.3229 12.3612 12.508 13.2077 11.5216 13.8109C10.5351 14.4141 9.41033 14.7538 8.25493 14.7975C7.09952 14.8412 5.95227 14.5873 4.92316 14.0603L2.89628 14.7384C2.67563 14.8128 2.4386 14.824 2.2119 14.7709C1.98519 14.7178 1.77783 14.6024 1.61319 14.4377C1.44854 14.2731 1.33316 14.0657 1.28004 13.839C1.22691 13.6123 1.23817 13.3753 1.31253 13.1546L1.98816 11.1278C1.52421 10.219 1.27233 9.21687 1.25145 8.19673C1.23057 7.1766 1.44123 6.16501 1.8676 5.23801C2.29396 4.31102 2.92494 3.49274 3.71308 2.84472C4.50123 2.19669 5.42603 1.73577 6.41795 1.49662C7.40988 1.25747 8.44311 1.2463 9.43997 1.46397C10.4368 1.68163 11.3714 2.12246 12.1733 2.75331C12.9753 3.38415 13.6238 4.1886 14.0701 5.10617C14.5164 6.02374 14.7489 7.03054 14.75 8.05089ZM13.25 8.05089C13.2497 7.2456 13.0642 6.45118 12.7077 5.72908C12.3513 5.00698 11.8335 4.37655 11.1944 3.88657C10.5554 3.39658 9.81216 3.06018 9.02229 2.90338C8.23241 2.74658 7.41706 2.77358 6.63929 2.9823C5.86153 3.19102 5.1422 3.57587 4.53696 4.10706C3.93171 4.63826 3.45678 5.30156 3.1489 6.04567C2.84101 6.78977 2.70843 7.59473 2.76141 8.39827C2.81438 9.20181 3.0515 9.9824 3.45441 10.6796C3.50766 10.7716 3.54077 10.8738 3.55155 10.9795C3.56232 11.0852 3.55051 11.192 3.51691 11.2928L2.89628 13.1546L4.75816 12.534C4.83475 12.5085 4.91493 12.4954 4.99566 12.4953C5.12738 12.4955 5.25672 12.5304 5.37066 12.5965C6.1688 13.0583 7.0745 13.3018 7.99662 13.3024C8.91875 13.303 9.82476 13.0607 10.6235 12.5999C11.4222 12.1391 12.0855 11.4761 12.5466 10.6775C13.0077 9.87894 13.2503 8.97301 13.25 8.05089Z" fill="#94A3B8" />
                                          </svg>
                                          <span class="tw-text-xs/4.5 tw-font-semibold tw-text-gray-500">Comentários</span>
                                        </span>
                                      </div>
                                      <div>
                                        <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-text-gray-500 tw-whitespace-nowrap tw-border tw-border-gray-200 hover:tw-bg-gray-50" data-toggle="collapse" :data-target="`#collapseTeacherComment${index}`" aria-expanded="false" :aria-controls="`collapseTeacherComment${index}`">
                                          Adicionar comentário
                                          <svg width="16" height="17" viewBox="0 0 16 17" fill="none">
                                            <path d="M14.25 8.05078C14.25 8.24969 14.171 8.44046 14.0303 8.58111C13.8897 8.72176 13.6989 8.80078 13.5 8.80078H8.75V13.5508C8.75 13.7497 8.67098 13.9405 8.53033 14.0811C8.38968 14.2218 8.19891 14.3008 8 14.3008C7.80109 14.3008 7.61032 14.2218 7.46967 14.0811C7.32902 13.9405 7.25 13.7497 7.25 13.5508V8.80078H2.5C2.30109 8.80078 2.11032 8.72176 1.96967 8.58111C1.82902 8.44046 1.75 8.24969 1.75 8.05078C1.75 7.85187 1.82902 7.6611 1.96967 7.52045C2.11032 7.3798 2.30109 7.30078 2.5 7.30078H7.25V2.55078C7.25 2.35187 7.32902 2.1611 7.46967 2.02045C7.61032 1.8798 7.80109 1.80078 8 1.80078C8.19891 1.80078 8.38968 1.8798 8.53033 2.02045C8.67098 2.1611 8.75 2.35187 8.75 2.55078V7.30078H13.5C13.6989 7.30078 13.8897 7.3798 14.0303 7.52045C14.171 7.6611 14.25 7.85187 14.25 8.05078Z" fill="#94A3B8" />
                                          </svg>
                                        </button>
                                      </div>
                                    </div>
                                    <div class="collapse" :id="`collapseTeacherComment${index}`">
                                      <textarea rows="3" name="feedback-textarea" id="feedback-textarea" class="tw-block tw-w-full tw-rounded-md tw-bg-white tw-px-3 tw-py-1.5 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600 sm:tw-text-sm/6" placeholder="Deixe um feedback personalizado..." @blur="sendTeacherFeedback()" v-model="selectedApplicationStudent.answers.at(0).teacher_feedback"></textarea>
                                    </div>
                                  </div>
                                </template>
                              </template>
                              <template v-if="selectedQuestion.question.text_correction">
                                <div class="tw-overflow-hidden tw-border-2 tw-border-gray-100 sm:tw-rounded-lg">
                                  <table class="tw-min-w-full tw-divide-y-2 tw-divide-gray-100">
                                    <thead class="tw-bg-gray-50">
                                      <tr>
                                        <th scope="col" class="tw-py-3.5 tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900 sm:tw-pl-6">
                                          Competências
                                        </th>
                                        <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">
                                          Pontos
                                        </th>
                                      </tr>
                                    </thead>
                                    <tbody class="tw-divide-y tw-divide-gray-200 tw-bg-white">
                                      <tr v-for="criterion in selectedQuestion.question.generate_correction_criterion">
                                        <td class="tw-whitespace-nowrap tw-py-4 tw-pl-4 tw-pr-3 tw-text-sm tw-font-medium tw-text-gray-900 sm:tw-pl-6">
                                          ${criterion.name}
                                        </td>
                                        <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-gray-500">
                                          <div class="tw-flex tw-items-center tw-gap-2">
                                            <label
                                              v-for="point in criterion.value"
                                              :for="'line-competence-enem-' + criterion.id + '-' + point"
                                              class="tw-flex tw-cursor-pointer tw-items-center tw-justify-center tw-rounded-md tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-gray-900 tw-ring-1 tw-ring-inset focus:tw-outline-none sm:tw-flex-1"
                                              :class="criterion.checkedLabel === point ? 'tw-bg-blue-50 tw-text-blue-700 tw-ring-blue-700/10' : 'tw-bg-white tw-text-gray-900 tw-ring-gray-200'"
                                              @click="selectedCorrection(criterion.question, criterion.order, point, criterion.id); criterion.checkedLabel = point; $forceUpdate()"
                                            >
                                              <input type="radio" :id="'line-competence-enem-' + criterion.id + '-' + point" :name="'line_competence_enem-' + criterion.id" :value="point.toString().replace('.',',')" class="tw-sr-only" />
                                              <span>
                                                ${point.toString().replace('.',',')}
                                              </span>
                                            </label>
                                          </div>
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                              </template>
                              <div class="tw-flex tw-items-center tw-justify-between tw-border-y tw-border-slate-200 tw-py-4">
                                <div class="tw-relative">
                                  <label class="tw-absolute tw--top-2 tw-left-2 tw-inline-block tw-rounded-lg tw-bg-white tw-px-1 tw-text-xs tw-font-medium tw-text-gray-900">Nota</label>
                                  <input v-if="selectedQuestion.question.text_correction" type="number" id="grade" class="tw-block tw-w-full tw-rounded-md tw-bg-white tw-px-3 tw-py-1.5 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600 sm:tw-text-sm/6" placeholder="0,00" disabled step="0.01" value="0" />
                                  <input v-else type="number" :id="'inputSetGrade-' + index" class="tw-block tw-w-full tw-rounded-md tw-bg-white tw-px-3 tw-py-1.5 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600 sm:tw-text-sm/6" placeholder="0,00" :disabled="selectedQuestion.text_correction" step="0.01" value="0" min="0" :max="selectedQuestion.weight" v-model="totalPoints" @input="handlerCheckInput()" @keyup.enter="setGrade(totalPoints, index)" />
                                </div>
                                <div>
                                  <div class="tw-flex tw-items-center tw-gap-1" v-if="selectedQuestion">
                                    <button type="button" class="tw-flex tw-items-center tw-rounded-lg tw-p-2 tw-text-poppy-600 tw-border tw-border-poppy-600 hover:tw-text-white hover:tw-bg-poppy-600" title="Atribuir nota zero" @click="setGrade(0, index)">
                                      <span class="tw-sr-only">0%</span>
                                      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-size-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3" />
                                      </svg>
                                    </button>
                                    <button type="button" class="tw-flex tw-items-center tw-rounded-lg tw-px-2 tw-py-1.75 tw-text-honey-600 tw-border tw-border-honey-500 hover:tw-text-white hover:tw-bg-honey-600" @click="setGrade(parseFloat(selectedQuestion.weight * 0.25).toFixed(4), index)">
                                      <span class="tw-text-xs/4.5 tw-font-semibold">25%</span>
                                      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-size-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                      </svg>
                                    </button>
                                    <button type="button" class="tw-flex tw-items-center tw-rounded-lg tw-px-2 tw-py-1.75 tw-text-honey-600 tw-border tw-border-honey-500 hover:tw-text-white hover:tw-bg-honey-600" @click="setGrade(parseFloat(selectedQuestion.weight * 0.5).toFixed(4), index)">
                                      <span class="tw-text-xs/4.5 tw-font-semibold">50%</span>
                                      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-size-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                      </svg>
                                    </button>
                                    <button type="button" class="tw-flex tw-items-center tw-rounded-lg tw-px-2 tw-py-1.75 tw-text-honey-600 tw-border tw-border-honey-500 hover:tw-text-white hover:tw-bg-honey-600" @click="setGrade(parseFloat(selectedQuestion.weight * 0.75).toFixed(4), index)">
                                      <span class="tw-text-xs/4.5 tw-font-semibold">75%</span>
                                      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-size-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                      </svg>
                                    </button>
                                    <button type="button" class="tw-flex tw-items-center tw-rounded-lg tw-p-2 tw-text-mint-600 tw-border tw-border-mint-600 hover:tw-text-white hover:tw-bg-mint-600" title="Atribuir nota máxima" @click="setGrade(selectedQuestion.weight, index)">
                                      <span class="tw-sr-only">100%</span>
                                      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-size-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 10.5 12 3m0 0 7.5 7.5M12 3v18" />
                                      </svg>
                                    </button>
                                  </div>
                                </div>
                              </div>

                              <div v-if="spinnerFeedbackSaved || (savingApplicationStudent.includes(selectedApplicationStudent.id) || unsavedApplicationStudent.includes(selectedApplicationStudent.id) || savedApplicationStudent.includes(selectedApplicationStudent.id) || saveErrorApplicationStudent.includes(selectedApplicationStudent.id))">
                                <div v-if="spinnerFeedbackSaved">
                                  <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="sr-only">Carregando...</span>
                                  </div>
                                  <span class="text-info">Salvando nota...</span>
                                </div>
                                <div v-if="savingApplicationStudent.includes(selectedApplicationStudent.id) || unsavedApplicationStudent.includes(selectedApplicationStudent.id) || savedApplicationStudent.includes(selectedApplicationStudent.id) || saveErrorApplicationStudent.includes(selectedApplicationStudent.id)">
                                  <span class="text-info" v-if="savingApplicationStudent.includes(selectedApplicationStudent.id)">Salvando alteração...</span>
                                  <span class="text-danger" v-if="unsavedApplicationStudent.includes(selectedApplicationStudent.id)">A alteração ainda não foi salva, pressione ENTER para salvar</span>
                                  <span class="text-info" v-if="savedApplicationStudent.includes(selectedApplicationStudent.id)">Correção salva!</span>
                                  <span class="text-danger" v-if="saveErrorApplicationStudent.includes(selectedApplicationStudent.id)">Erro no envio, tente novamente</span>
                                </div>
                              </div>

                              <div class="tw-flex tw-items-center tw-justify-between tw-mt-2">
                                <div class="tw-flex tw-items-center tw-gap-2">
                                  <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-text-gray-500 tw-whitespace-nowrap tw-border tw-border-gray-200 hover:tw-bg-gray-50" v-if="(selectedQuestion.textual_answer || selectedQuestion.file_answer)" title="Apagar resposta" @click="removeGradeAlert()">
                                    Apagar resposta
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M13.5 3H2.5C2.30109 3 2.11032 3.07902 1.96967 3.21967C1.82902 3.36032 1.75 3.55109 1.75 3.75C1.75 3.94891 1.82902 4.13968 1.96967 4.28033C2.11032 4.42098 2.30109 4.5 2.5 4.5H2.75V13C2.75 13.3315 2.8817 13.6495 3.11612 13.8839C3.35054 14.1183 3.66848 14.25 4 14.25H12C12.3315 14.25 12.6495 14.1183 12.8839 13.8839C13.1183 13.6495 13.25 13.3315 13.25 13V4.5H13.5C13.6989 4.5 13.8897 4.42098 14.0303 4.28033C14.171 4.13968 14.25 3.94891 14.25 3.75C14.25 3.55109 14.171 3.36032 14.0303 3.21967C13.8897 3.07902 13.6989 3 13.5 3ZM11.75 12.75H4.25V4.5H11.75V12.75ZM4.75 1.25C4.75 1.05109 4.82902 0.860322 4.96967 0.71967C5.11032 0.579018 5.30109 0.5 5.5 0.5H10.5C10.6989 0.5 10.8897 0.579018 11.0303 0.71967C11.171 0.860322 11.25 1.05109 11.25 1.25C11.25 1.44891 11.171 1.63968 11.0303 1.78033C10.8897 1.92098 10.6989 2 10.5 2H5.5C5.30109 2 5.11032 1.92098 4.96967 1.78033C4.82902 1.63968 4.75 1.44891 4.75 1.25Z" fill="#F04438"/>
                                    </svg>
                                  </button>
                                </div>
                                <div>
                                  <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-px-3 tw-py-2 tw-text-xs/4.5 tw-font-semibold tw-bg-primary-600 tw-text-white tw-whitespace-nowrap hover:tw-bg-primary-950/2" @click="setGrade(totalPoints, index, true)">
                                    Salvar
                                  </button>
                                  <!-- <button type="button" class="btn btn-xs btn-primary" title="Salvar nota e ir para a próxima questão" :disabled="!(parseFloat(selectedQuestion.teacher_grade) >= 0 && parseFloat(selectedQuestion.teacher_grade) <= parseFloat(selectedQuestion.question_weight))" @click="sendTeacherFeedback(selectedQuestion, true)" v-if="applicationStudent.questions.findIndex(question => question.pk == selectedQuestion.pk) != applicationStudent.questions.length - 1"> <i class="fas fa-arrow-right"></i></button> -->
                                </div>
                              </div>
                              <!-- <div class="form-group col-12">
                                <label for="grade">Nota </label>
                                <input v-if="selectedQuestion.question.text_correction" type="number" class="form-control" step='0.01' value='0.00' placeholder='0.00' disabled>
                                <input v-else type="number" @input="handlerCheckInput()" @keyup.enter="setGrade(totalPoints, index)" v-model="totalPoints" class="form-control" :id="'inputSetGrade-' + index" min="0" :max="selectedQuestion.weight" step="0.01" placeholder="0.00">
                              </div> -->
                            </div>
                          </template>
                        </template>
                        <template v-else>
                          <div class="tw-rounded-lg tw-bg-honey-100 tw-px-4 tw-py-3 tw--mt-6">
                            <div class="tw-flex tw-items-center">
                              <div class="tw-shrink-0">
                                <svg class="tw-size-5 tw-text-honey-800" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
                                </svg>
                              </div>
                              <div class="tw-ml-3">
                                <div class="tw-text-xs/4.5 tw-font-medium tw-text-honey-800">
                                  <p class="tw-mb-0">Essa prova não poderá ser corrigida, a data limite para correção expirou!</p>
                                </div>
                              </div>
                            </div>
                          </div>
                        </template>
                        {% if user_type == 'coordination' %}
                          <div v-if="selectedQuestion.question.category == 'Discursiva' && application_student.answers.at(0) && application_student.answers.at(0).teacher_grade >= 0">
                            <hr />
                            <span class="font-weight-bold">Comentário do professor:</span>
                            <span>${application_student.answers.at(0) ? application_student.answers.at(0).teacher_feedback : undefined || 'Sem feedback'}</span>
                          </div>
                        {% endif %}
                      </div>
                      <div class="tw-w-full tw-h-px tw-bg-slate-200"></div>
                    </template>
                  </div>
                </template>
                <img id="image" class="d-none" />
              </div>
            </div>
          </div>
          <!-- Right column -->
          <div class="tw-ml-[50%] tw-w-full tw-bg-slate-200 tw-min-h-full tw-overflow-y-auto">
            <template v-if="hasFiles(selectedApplicationStudent)">
              <div class="tw-px-11 tw-pt-4 tw-pb-8">
                <div class="tw-flex tw-flex-col tw-items-center tw-justify-center">
                  <div>
                    <div class="tw-flex tw-items-center tw-justify-center">
                      <span class="tw-isolate tw-inline-flex tw-rounded-lg tw-gap-2">
                        <!-- <button
                          type="button"
                          class="tw-relative tw-inline-flex tw-items-center tw-rounded-l-lg tw-px-3 tw-py-1.5 tw-text-sm focus:tw-z-10"
                          :class="true ? 'tw-bg-slate-700 tw-font-semibold tw-text-white' : 'tw-bg-white tw-text-gray-500 hover:tw-bg-gray-50'"
                          @click=""
                        >
                          Todas
                        </button> -->
                        <template v-if="selectedQuestion.question.category == 'Objetiva'">
                          <button
                            type="button"
                            class="tw-relative tw-inline-flex tw-items-center tw-rounded-lg tw-px-3 tw-py-1.5 tw-text-sm focus:tw-z-10"
                            :class="shownImage === url ? 'tw-bg-slate-700 tw-font-semibold tw-text-white' : 'tw-bg-white tw-text-gray-500 hover:tw-bg-gray-50'"
                            @click="selectImage(url)"
                            v-for="(url, index) in selectedApplicationStudent.files_urls.objectives_urls.filter(u => u.length)"
                          >
                            Objetivas
                          </button>
                        </template>
                        <template v-else>
                          <button
                            type="button"
                            class="tw-relative tw-inline-flex tw-items-center tw-rounded-lg tw-px-3 tw-py-1.5 tw-text-sm focus:tw-z-10"
                            :class="shownImage === url ? 'tw-bg-slate-700 tw-font-semibold tw-text-white' : 'tw-bg-white tw-text-gray-500 hover:tw-bg-gray-50'"
                            @click="selectImage(url, 'Discursivas')"
                            v-for="(url, index) in selectedApplicationStudent.files_urls.discursive_urls.filter(u => u.length)"
                          >
                            ${index + 1}ª folha discursiva
                          </button>
                        </template>
                      </span>
                    </div>
                  </div>
                  <template v-if="imgLoading">
                    <div class="tw-flex tw-flex-col tw-items-center tw-justify-center tw-gap-4 tw-mt-4">
                      <h6 class="tw-text-sm tw-font-medium tw-text-slate-700 tw-mb-0">Carregando, aguarde...</h6>
                      <div class="spinner-border tw-text-primary-600" role="status">
                        <span class="tw-sr-only">Carregando...</span>
                      </div>
                    </div>
                  </template>
                </div>
                <img :src="shownImage" @click="viewImage()" id="previewImage" onLoad="app.imgLoading = false" v-show="!imgLoading" class="tw-max-w-full tw-h-auto tw-shadow tw-mt-6" style="cursor: zoom-in;" />
              </div>
            </template>
            <template v-else>
              <div class="tw-px-11 tw-py-8">
                <div class="tw-flex tw-flex-col tw-items-center tw-justify-center">
                  <div class="tw-flex tw-flex-col tw-items-center tw-justify-center">
                    <p class="tw-text-sm tw-font-medium tw-text-slate-700 tw-mb-0">
                      Nenhum arquivo encontrado para o aluno selecionado.
                    </p>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>
      </template>
    </div>
  </div>
</div>

<div class="overlay text-center d-none">
  <div class="row m-0 shadow bg-secondary fixed-top">
    <div class="col">
      <h4 class="text-white pt-3 m-0 pb-1">Pressione SHIFT e mova o mouse para criar uma seleção, ou clique na imagem e arraste o mouse para move-la <i class="fas fa-times text-white fa-2x float-right" @click="showAnnotorious(close = true)"></i></h4>
    </div>
    <div class="col-12 pb-2">
      <div id="toolbarDiv">
        <div class="row m-0 d-flex justify-content-center">
          <i class="fas fa-home m-2 text-white" style="font-size: 1.1rem;" id="home"></i>
          <i class="fas fa-search-plus m-2 text-white" style="font-size: 1.1rem;" id="zoom-in"></i>
          <i class="fas fa-search-minus m-2 text-white" style="font-size: 1.1rem;" id="zoom-out"></i>
          <i class="fas fa-undo m-2 text-white" style="font-size: 1.1rem;" id="rotate-left"></i>
          <i class="fas fa-undo m-2 text-white" style="transform: rotate(-90deg); transform: scaleX(-1); font-size: 1.1rem;" id="rotate-right"></i>
          <i class="fas fa-expand-arrows-alt m-2 text-white" style="font-size: 1.1rem;" id="full-page"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="row m-0" style="padding-top: 100px;">
    <div class="container p-0">
      <div class="row d-flex justify-content-center">
        <div class="col">
          <div class="overlay-content" id="img-content" style="height: 720px;"></div>
        </div>
      </div>
    </div>
    <div class="bg-dark p-2 shadow py-4 rounded" style="position: absolute; width: 300px; right: 0; top: 20%" id="annotations-list" v-if="annotationsList.length > 0">
      <h5 class="text-white">Lista de Anotações</h5>
      <div class="row m-0 mt-3" v-for="(annotation, indexAnnotation) in annotationsList">
        <div class="col-12">
          <div class="dropdown">
            <button class="btn btn-xs btn-secondary py-0 m-1 dropdown-toggle float-right" data-toggle="dropdown" @mouseenter="anno.selectAnnotation(annotation.id)"> Adicionar tag <i class="fas fa-tags mx-1"></i></button>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
              <h6 class="dropdown-header tx-uppercase tx-12 tx-bold tx-inverse">Adicionar TAG especial</h6>
              <a class="dropdown-item bg-danger text-white my-1" href="#" @click="createTagInAnnotation('ERRO', annotation)">Tag de Erro</a>
              <a class="dropdown-item bg-warning my-1" href="#" @click="createTagInAnnotation('ATENÇÃO', annotation)">Tag de Atenção</a>
            </div>
          </div>
        </div>
        <div class="col-12">
          <div class="card" style="cursor: pointer;" @click="anno.selectAnnotation(annotation.id)">
            <div class="card-body p-1">
              <p class="mb-0 pt-1 text-truncate" v-for="(comment, index) in annotation.comments"> ${comment} </p>
              <div class="mt-1" v-if="annotation.tags.length > 0">
                <strong class="tx-10">TAG(S):</strong> <span class="badge mx-1" v-bind:class="getBadgeColor(tag)" v-for="tag in annotation.tags">${tag}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row m-0 fixed-bottom bg-secondary" v-if="selectedApplicationStudent">
    <div class="col shadow">
      <h4 class="text-center text-white py-2">Aluno: ${selectedApplicationStudent.student_name}</h4>
    </div>
  </div>
</div>

<div class="modal fade" id="modalImgAnnotorious" tabindex="-1" aria-labelledby="modalImgAnnotoriousLabel">
  <div class="modal-dialog modal-xl">
    <div class="modal-content border-0">
      <div class="modal-body">
        <div class="row text-center">
          <div class="col">
            <div id="img-content" style="height: 720px;"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer controls">
        <button type="button" class="btn btn-dark" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>
{% endblock extra-modal %}


{% block js-additional %}
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script> -->
<!-- <script src="{% static 'administration/lib/select2/js/select2.min.js' %}"></script> -->
<script src="{% static 'administration/lib/jqueryui/jquery-ui.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.10.2/viewer.min.js" integrity="sha512-lzNiA4Ry7CjL8ewMGFZ5XD4wIVaUhvV3Ct9BeFmWmyq6MFc42AdOCUiuUtQgkrVVELHA1kT7xfSLoihwssusQw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script type="text/javascript">
    moment.locale('pt-br')
    var app = new Vue({
        delimiters: ['${', '}'],
        el: '#app',
        data: {
            expandedEnunciation: false,
            questionCategories: ["Objetiva", "Discursiva", "Arquivo anexado", "Somatório"],
            selectedApplicationStudent: null,
            totalPoints: 0,
            selectPoint: [],
            imgLoading: false,
            shownImage: null,
            type: 'Objetiva',
            alternativeUpdate: null,
            imagesLoaded: [],
            urls: {
                textualAnswerUpdate: "{% url 'answers:text_remove_grade_update' pk='00000000-0000-0000-0000-000000000000' %}",
                fileAnswerUpdate: "{% url 'answers:file_remove_grade_update' pk='00000000-0000-0000-0000-000000000000' %}",
                fileAnswerDelete: "{% url 'answers:file_delete_answer' pk='00000000-0000-0000-0000-000000000000' %}",
                textualAnswerDelete: "{% url 'answers:textual_delete_answer' pk='00000000-0000-0000-0000-000000000000' %}",
                optionAnswerDelete: "{% url 'answers:option_delete_answer' pk='00000000-0000-0000-0000-000000000000' %}",
                clearApplicationStudent: "{% url 'applications:api_clear_and_missed_applicationstudent' pk='00000000-0000-0000-0000-000000000000' %}",            
            },
            spinnerFeedbackSaved: false, 
            feedbackSaved: false, 
            feedbackError: false,
            loadingSaveApplicationStudent: [],
            unsavedApplicationStudent: [],
            savedApplicationStudent: [],
            savingApplicationStudent: [],
            saveErrorApplicationStudent: [],
            anno: '',
            annotationsList: [],
            ordering: {
                label: 'Nome A-Z',
                type: 'name',
                asc: 'asc',
            },
            debouncedSearch: null,
            newSumAnswer: 0,
            {% include 'dashboard/exams/includes/exam-detail-enunciation-data.js' %}
            {% include 'dashboard/exams/includes/exam-detail-data.js' %}

        },
        watch: {
            selectedApplicationStudent: function(val) {
                this.getFile()
            },
        },
        computed: {
          previousSelectedQuestion: function () {
            let index = this.examQuestions.findIndex(question => question.id === this.selectedQuestion.id)
            if (index === 0 || index === -1) {
              return null
            }
            return this.examQuestions[index - 1]
          },
          nextSelectedQuestion: function () {
            let index = this.examQuestions.findIndex(question => question.id === this.selectedQuestion.id)
            if (index === this.examQuestions.length - 1 || index === -1) {
              return null
            }
            return this.examQuestions[index + 1]
          },
          availableCategories() {
            let categories = this.examQuestions.map(question => question.category)
            return {
              choice: categories.includes('Objetiva'),
              discursive: categories.includes('Discursiva') || categories.includes('Arquivo anexado'),
              sum: categories.includes('Somatório'),
            }
          },
          visibleButtons() {
            let buttons = []
            if (this.availableCategories.choice) buttons.push('Objetivas')
            if (this.availableCategories.discursive) buttons.push('Dissertativas')
            if (this.availableCategories.sum) buttons.push('Somatórias')
            return buttons
          },
        },
        methods: {
            {% include 'dashboard/exams/includes/exam-detail-enunciation-functions.js' %},
            {% include 'dashboard/exams/includes/exam-annotations-methods.js' %},
            viewImage(title = 'Folha de resposta') {
                const viewer = new Viewer(document.getElementById('previewImage'), {
                    inline: false,
                    viewed() {
                        viewer.zoomTo(0.4);
                    },
                    toolbar: {
                        zoomIn: 2,
                        zoomOut: 4,
                        oneToOne: 4,
                        reset: 4,
                        prev: 0,
                        play: {
                            show: 1,
                            size: 'large',
                        },
                        next: 0,
                        rotateLeft: 4,
                        rotateRight: 4,
                        flipHorizontal: 0,
                        flipVertical: 0,
                    },
                    title: [4, () => `${title}`],
                })
                $('#previewImage').click()
            },
            moment(date) {
                return moment(date)
            },
            checkAnswerType(answer) {
                const types = ['.jpeg', '.jpg', '.jpe', '.jfif', '.png', '.bmp', '.gif', '.tif', '.psd', '.tiff', '.exif', '.raw', '.crw', '.cr2', '.nef', '.nrw', '.eps', '.svg', '.webp']
                if(answer && answer.file && types.find(type => answer.file.toLowerCase().includes(type))) {
                    return true
                }
                return false
            },
            showAnswerImage(application_student, answer) {
                $('#image').attr('src', answer.file)
                const viewer = new Viewer(document.getElementById('image'), {
                    inline: false,
                    toolbar: {
                        zoomIn: 4,
                        zoomOut: 4,
                        oneToOne: 4,
                        reset: 4,
                        prev: 0,
                        play: {
                            show: 4,
                            size: 'large',
                        },
                        next: 0,
                        rotateLeft: 4,
                        rotateRight: 4,
                        flipHorizontal: 0,
                        flipVertical: 0,
                    },
                    title: [4, () => `Aluno: ${student_application.student_name.toUpperCase()} - Questão: ${this.selectedQuestion.order || this.selectedQuestion.index}`],
                    ready() {
                        $('#detailModal').modal({ keyboard: false })
                    },
                    hide() {
                        $('#detailModal').modal({ keyboard: true })
                    }
                })
                $('#image').click()
            },
            changeQuestion(option) {
                currentIndex = this.examQuestions.find(e => e.id == this.selectedQuestion.id).index
                let examQuestion = this.examQuestions.at(option == 'next' ? currentIndex + 1 : currentIndex - 1)
                if(examQuestion) {
                    this.getAnswers(examQuestion.id)
                }
            },
            getFile() {
                if(this.hasFiles(this.selectedApplicationStudent)) {
                    let objectives_urls = this.selectedApplicationStudent.files_urls.objectives_urls.filter(u => u.length)
                    let discursive_urls = this.selectedApplicationStudent.files_urls.discursive_urls.filter(u => u.length)
                    let url = ''
                    if(['Objetiva', 'Somatório'].includes(this.selectedQuestion.question.category)) {
                        url = objectives_urls.at(objectives_urls.length - 1)
                    } else {
                        url = discursive_urls.at(0)
                    }
                    this.shownImage = url
                    this.handleImageLoad(url)
                }
            },
            hasFiles(application_student) {
                if((application_student && application_student.files_urls) && (application_student.files_urls.objectives_urls.length || application_student.files_urls.discursive_urls.length)) {
                    return true;
                }
                return false;
            },
            handleImageLoad(url) {
                if(!this.imagesLoaded.includes(url)) {
                    this.imgLoading = true
                }
                this.imagesLoaded.push(url)
            },
            selectImage(url, type = 'Objetiva') {
                this.handleImageLoad(url)
                this.shownImage = url
                this.type = type
            },
            handlerChangeOption(index, option) {
                if(option) {
                    if($(`[name="${'alternatives-' + index}"]:checked`).val() == option) {
                        return $(this.$refs['buttonSaveAlternative-' + index]).prop('disabled', true)
                    }
                    return $(this.$refs['buttonSaveAlternative-' + index]).prop('disabled', false)
                }
            },
            handleApplicationStudentStatus(option) {
                this.unsavedApplicationStudent.splice(this.selectedApplicationStudent.id, 1)
                this.savingApplicationStudent.splice(this.selectedApplicationStudent.id, 1)
                this.savedApplicationStudent.splice(this.selectedApplicationStudent.id, 1)
                this.saveErrorApplicationStudent.splice(this.selectedApplicationStudent.id, 1)

                if(option == 'unsaved') {
                    if(!this.unsavedApplicationStudent.includes(this.selectedApplicationStudent.id)) {
                        this.unsavedApplicationStudent.push(this.selectedApplicationStudent.id)
                    }
                }
                if(option == 'saving') {
                    if(!this.savingApplicationStudent.includes(this.selectedApplicationStudent.id)) {
                        this.savingApplicationStudent.push(this.selectedApplicationStudent.id)
                    }
                }
                if(option == 'saved') {
                    if(!this.savedApplicationStudent.includes(this.selectedApplicationStudent.id)) {
                        this.savedApplicationStudent.push(this.selectedApplicationStudent.id)
                    }
                }
                if(option == 'error') {
                    if(!this.saveErrorApplicationStudent.includes(this.selectedApplicationStudent.id)) {
                        this.saveErrorApplicationStudent.push(this.selectedApplicationStudent.id)
                    }
                }
            },
            handlerCheckInput() {
                let total = Number(this.totalPoints)
                let max = Number(this.selectedQuestion.weight)
                if(total < 0) {
                    this.totalPoints = 0
                } else if(total > max) {
                    this.totalPoints = max
                }
                this.handleApplicationStudentStatus('unsaved')
            },
            handlerOrdering(type, asc, label) {
                this.ordering.type = type
                this.ordering.label = label
                this.ordering.asc = asc
                this.handlerApplicationsStudent()
            },
            handlerApplicationsStudent() {
                if(this.ordering.type == 'name') {
                    this.selectedQuestion.applications_student = this.selectedQuestion.applications_student.sort((a, b) => this.ordering.asc == 'asc' ? a.student_name.localeCompare(b.student_name) : b.student_name.localeCompare(a.student_name))
                }
                if(this.ordering.type == 'answer') {
                    this.selectedQuestion.applications_student = this.selectedQuestion.applications_student.sort((a, b) => this.ordering.asc == 'asc' ? b.answers.length - a.answers.length : a.answers.length - b.answers.length)
                }
            },
            selectApplicationStudent(applicationStudent, index=0) {                
                let currentIndex = this.selectedQuestion.applications_student.indexOf(this.selectedQuestion.applications_student.find(e => e.id == applicationStudent.id))
                this.selectedApplicationStudent = applicationStudent
                this.fetchGetCorrectionAnswers(applicationStudent)
                setTimeout(() => {
                    if(this.selectedApplicationStudent.answers.at(0)) {
                        this.totalPoints = this.selectedApplicationStudent.answers.at(0).teacher_grade
                    } else {
                        this.totalPoints = null
                    }
                    $(`#inputSetGrade-${currentIndex}`).focus().select()
                }, 100)
                this.$forceUpdate()
            },
            fetchGetCorrectionAnswers(applicationStudent){
                axios.get("{% url 'questions:get_correction_answers' %}", {
                    params: {
                        student_id: applicationStudent.id,
                        question_id: this.selectedQuestion.question.id
                    }
                }).then(response => {
                    this.selectedQuestion.question.text_correction_answer = response.data
                    // if(response.data && response.data.length) {
                    //     this.totalPoints = 0
                    // }
                    this.selectedQuestion.question.generate_correction_criterion.forEach(generate => {
                        generate.question = this.selectedQuestion.question.id
                    })
                    this.selectedQuestion.question.generate_correction_criterion.forEach((criterion) => {
                        criterion.checkedLabel = null; 
                    });
                    
                    this.selectedQuestion.question.generate_correction_criterion.forEach((criterion) => {
                        if (criterion.question === this.selectedQuestion.question.id) {
                            response.data.forEach((correction) => {
                                if (criterion.order === correction.order) {
                                    criterion.checkedLabel = correction.point;
                                }  
                            });
                        }
                    }); 

                    response.data.forEach((correction) => {
                        this.selectedCorrection(this.selectedQuestion.question.id, correction.order, correction.point, correction.correction_criterion);
                    }); 
                })
            },
            goTo(selector) {
                try {
                    $("#answers-accordion").accordion({
                        heightStyle: "content",
                        activate: function(event, ui) {
                            let activePanel = $("#scrollableDiv .ui-accordion-content-active");
                            if (activePanel.length) {
                                let scrollTop = $("#scrollableDiv").scrollTop() + activePanel.position().top - 85;
                                $("#scrollableDiv").animate({
                                    scrollTop: scrollTop
                                }, 100);
                            }
                        }
                    });
                }
                catch {

                }
            },
            changeStudent(index) {
                if(index >= 0) {
                    $('#answers-accordion').accordion("option", "active", index);
                } else {
                    let currentIndex = this.selectedQuestion.applications_student.indexOf(this.selectedQuestion.applications_student.find(e => e.id == this.selectedApplicationStudent.id))
                    currentIndex = currentIndex + 1

                    let nextStudent = this.selectedQuestion.applications_student.at(currentIndex)

                    if(nextStudent) {
                        this.goTo(`#accordion-${nextStudent.id}`)
                        this.selectApplicationStudent(nextStudent)
                    }
                    $('#answers-accordion').accordion("option", "active", currentIndex); 
                }
            },
            async saveUpdateCorrection(student_id) {
                const firstAnswer = this.selectedApplicationStudent.answers[0].id; 
                this.selectPoint.forEach(async (competence) => {
                    
                    let answerCorrection = this.selectedQuestion.question.category === 'Discursiva' ? 'textual_answer' : 'file_answer';
                    let correction = this.selectedQuestion.question.text_correction_answer.find((item) => item.order == competence.order)
                    let formData = new FormData();
                    formData.append('correction_criterion', competence.criterion_id);
                    formData.append('point', competence.point);
                    formData.append(answerCorrection, firstAnswer);

                    if (!correction) {
                        let correctionAnswerUrl = '';
                        if(this.selectedQuestion.question.category === 'Discursiva'){
                            correctionAnswerUrl = "{% url 'corrections:correction_textual_answer_list_create' %}"
                        }else{
                            correctionAnswerUrl = "{% url 'corrections:correction_file_answer_list_create' %}"
                        }
                        try {
                            let response = await axios.post(correctionAnswerUrl, formData);
                            let correctionAnswerKey = this.selectedQuestion.question.category === 'Discursiva' ? 'textual_answer' : 'file_answer';
                            this.selectedQuestion.question.text_correction_answer.push({
                                'correction_criterion': competence.criterionId,
                                'order': competence.order,
                                'id': response.data.id,
                                'point': response.data.point,
                                'corretionAnswer': response.data[correctionAnswerKey]
                            });
                        } catch (error) {
                            console.error("Error saving correction: ", error);
                        }
                    } else {            
                        if(this.selectedQuestion.question.category === 'Discursiva'){
                            correctionUpdateUrl = "{% url 'corrections:correction_textual_answer_update' pk='00000000-0000-0000-0000-000000000000' %}"
                        }else
                            correctionUpdateUrl = "{% url 'corrections:correction_file_answer_update' pk='00000000-0000-0000-0000-000000000000' %}"
                        try {
                            await axios.put(correctionUpdateUrl.replace("00000000-0000-0000-0000-000000000000", correction.id), formData)
                        } catch (error) {
                            console.error("Error updating correction: ", error);
                        }
                    } 
                });
            
            },
          changeSchoolClass(event) {
            event.target.form.submit()
          },
          getCorrectionTotalProgress(examQuestion) {
            let value = (examQuestion.totalAnswers - examQuestion.awaitCorrection) / examQuestion.totalAnswers
            return value * 100
          },
          getBarWidth(index, totalProgress) {
            let value = Math.min(Math.max(totalProgress - (index * 25), 0), 25)
            let percent = (value / 25) * 100
            return `${percent}%`
          },
          generateAlternativeOrder(index, isSum = false) {
            if (isSum) {
              return Math.pow(2, index)
            }
            return 'abcdefghijk'[index]
          },
          getLastRoundedClasses(index) {
            let last = index === this.visibleButtons.length - 1
            return {'tw-rounded-r-lg': last}
          },
        },
        mounted() {
            navigator.serviceWorker.getRegistrations().then(registrations => {
                registrations.forEach(reg => reg.unregister());
            });
            $('[data-toggle="tooltip"]').tooltip()
            $('[data-toggle="popover"]').popover({ trigger: "hover" })   
            
            this.examQuestions = this.examQuestions.map((el, index) => ({
                ...el, index: index, correctRate: this.getCorrectPercentage(el)
            }))
            // $("select").selectpicker({
            //     style: 'btn-white',
            //     placeholder: "Selecione uma opção",
            //     noneSelectedText: 'Nenhuma seleção',
            //     noneResultsText: 'Nenhum resultado encontrado',
            //     selectAllText: 'Todos',
            //     deselectAllText: 'Nenhum'
            // })
            
        },
        updated: function(){
            $('#answers-accordion').accordion({
                heightStyle: 'content',
                header: "h6",
                collapsible: true,
            });
        },
    })
</script>

{% endblock js-additional %}