{% extends 'redesign/base.html' %}
{% comment %} {% extends 'dashboard/base_fixed.html' %} {% endcomment %}
{% load static %}
{% load cleaned_params %}
{% load call_function_with_params %}
{% load get_value_from_dict %}
{% load permissions %}

{% block title %}Cadernos - Lize{% endblock title %}

{% block css-additional %}
<link href="{% static 'administration/lib/select2/css/select2.min.css' %}" rel="stylesheet" />
<link href="{% static 'administration/lib/bootstrap-tagsinput/bootstrap-tagsinput.css' %}" rel="stylesheet">
<link rel="stylesheet" href="{% static 'administration/lib/datatables.net-responsive-dt/css/responsive.dataTables.min.css' %}">
<link rel="stylesheet" href="https://unpkg.com/@sjmc11/tourguidejs/dist/css/tour.min.css">
<style>
  .tg-backdrop{
    z-index: 9999 !important;
  }
  .select2-selection__choice__remove {
    display: none !important;
  }
  .dropdown-menu { margin-top: 0 !important; }
  
  #green-bar, #yellow-bar {
    transition: width 1s ease-in-out, background-color 1s ease-in-out;
  }
</style>

{% endblock %}

{% block top-menu %}
<header>
  <div class="tw-flex tw-justify-center">
    <nav class="ls add afa agv arx tw-max-w-[100rem] tw-flex-1" style="display: flex; overflow-x: auto; border-width: 0px; border-style: solid; border-color: rgb(229, 231, 235); border-bottom-width: 1px; border-color: #E2E5ED; padding-top: 1rem; padding-bottom: 1rem;">
      <ul data-tg-title="Tipos de instrumentos" data-tg-order="2" data-tg-tour='Clique em "Caderno de prova" ou "Lista de Exercício" para filtrar a listagem de instrumentos avaliativos.' data-tg-group="default-exam-list" role="list" class="ls tn uj aad ard avv awb awk axk cer dcv" style="list-style: none; margin: 0px; min-width: 100%; flex: 0 0 auto; column-gap: 1.5rem; font-size: 0.875rem; line-height: 1.5rem; font-weight: 500;">
        <li><a href="{% url 'exams:exams_list' %}?category=exam" class="axz font-display" style="{% if request.resolver_match.url_name == 'exams_list' and request.GET.category == 'exam' %}color: #FEA464;{% else %}color: #9CA3AF;{% endif %}">Caderno de prova</a></li>
        <li><a href="{% url 'exams:exams_list' %}?category=homework" class="font-display" style="{% if request.resolver_match.url_name == 'exams_list' and request.GET.category == 'homework' %}color: #FEA464;{% else %}color: #9CA3AF;{% endif %}">Lista de Exercício</a></li>
      </ul>
    </nav>
  </div>
</header>
{% endblock top-menu %}

{% block content-fixed %}
<div class="tw-flex tw-justify-center">
  <div class="ard cer dcv tw-pb-8 tw-max-w-[100rem] tw-flex-1 tw-mb-16">
    <div class="ls" style="margin-top: 1.25rem; margin-bottom: 1.5rem; justify-content: space-between;">
      <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-6 sm:tw-flex-nowrap tw-w-full">
        <h1 class="tw-text-xl tw-font-semibold tw-leading-7 tw-text-[#374151] sm:tw-truncate sm:tw-text-2xl sm:tw-tracking-tight tw-mb-0">
          {% if category == 'homework' %}
            Atividades de casa
          {% elif category == 'exam' %}
            Cadernos de prova
          {% else %}
            Cadernos
          {% endif %}
        </h1>
        <div class="tw-order-last tw-flex tw-w-full tw-gap-x-8 tw-text-sm tw-font-semibold tw-leading-6 sm:tw-order-none sm:tw-w-auto sm:tw-border-l sm:tw-border-gray-200 sm:tw-pl-6 sm:tw-leading-7">
          <button data-tg-title="Agendar aplicações" data-tg-order="2" data-tg-tour="Agora você pode acessar a janela de filtros detalhados clicando aqui." data-tg-group="default-exam-list" type="button" class="tw-flex tw-items-center tw-text-[#667085] tw-off-canvas-menu" id="headlessui-slider-over-button-1" data-toggle-off-canvas="#right-off-canvas" @click="filters.createNewFilter = false">
            <span>Filtrar</span>
            <span class="ml-2">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M5 10H15M2.5 5H17.5M7.5 15H12.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </button>
        </div>          
        <div class="tw-ml-auto tw-flex tw-gap-3">
          {% include "redesign/includes/breadcrumb-year.html" with year=year|force_escape %}
          {% if user_type == 'coordination' %}
            {% comment %} <button type="button" data-toggle="modal" data-target="#searchProof" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold hover:tw-text-white tw-shadow-sm hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">Pesquisar comprovantes</button> {% endcomment %}
            {% if user|has_perm:'exams.export_results_exam' %}
              <div>
                <button class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold hover:tw-text-white tw-shadow-sm hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" type="button" id="dropdownMenuButton-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Exportar resultados
                  <svg class="tw--mr-1 tw-h-5 tw-w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                  </svg>
                </button>
                <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-w-56 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-1" style="font-size: inherit;">
                  <div class="tw-py-1" role="none">
                      <a href="{% url 'exports:exams_export_erp' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">
                        Resumido (para ERPs)
                      </a>
                      <a href="{% url 'exports:exams_export_answers' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                        Respostas detalhadas
                      </a>
                      <a href="{% url 'exports:exams_export_simple_report' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                        Acertos e erros
                      </a>
                  </div>
                </div>
              </div>
            {% endif %}
            
            {% if user|has_perm:'exams.can_import_exams' or user|has_perm:'exams.can_import_examteachersubjects' %}
              <div>
                <button class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold hover:tw-text-white tw-shadow-sm hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" type="button" id="dropdownMenuButton-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Importar
                  <svg class="tw--mr-1 tw-h-5 tw-w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                  </svg>
                </button>
                <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-w-56 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-1" style="font-size: inherit;">
                  <div class="tw-py-1" role="none">
                    {% if user|has_perm:'exams.can_import_exams' %}
                      <a href="{% url 'exams:exams_import' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">
                        Instrumentos avaliativos
                      </a>
                    {% endif %}
                    {% if user|has_perm:'exams.can_import_examteachersubjects' %}
                      <a href="{% url 'exams:exams_request_import' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                        Solicitações à professores
                      </a>
                    {% endif %}
                    {% if user|has_perm:'exams.can_import_examteachersubjects' %}
                      <a href="{% url 'exams:essay_grade_import' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                        Notas de redação
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endif %}
            {% if user|has_perm:'exams.add_exam' %}
              <a id="btn_request_questoes_teachers" href="{% url 'exams:exams_create' %}?category={{category}}" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600 hover:tw-text-white">
                Solicite questões a professores
              </a>
            {% endif %}
          {% elif user_type == 'teacher' and user.client_teachers_can_elaborate_exam %}
            {% if user|has_perm:'inspectors.can_add_exercice_list' %}  
              <a href="{% url 'exams:exam_teacher_create' %}?v=2&category=homework" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600 hover:tw-text-white">
                Criar Lista de Exercício
              </a>
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
    <div data-tg-title="Filtros aplicados" data-tg-order="2" data-tg-tour='Visualize os filtros já aplicados nesta listagem, remova-os individualmente clicando no "x" ou todos de uma vez clicando em "Limpar filtro".' data-tg-group="default-exam-list" v-if="filters.selected || {{ count_filters|default:0|safe }}" class="tw-bg-white sm:tw-rounded-lg tw-py-5 tw-border tw-border-[#E5E7EA] tw-mb-4">
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8" >
        <div class="tw-flex tw-justify-between">
          <div class="tw-flex tw-items-center">
            <p class="mb-0 tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900 sm:tw-pl-0">
              Filtrando por
            </p>
            <div class="tw-space-x-2">
              <span class="filter-elements tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]" v-for="filter in filters.labels()" >
                <div id="container">
                  <button type="button" @click="removeFilter(filter)" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                    <span class="tw-sr-only">Remove</span>
                    <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                      <path d="M4 4l6 6m0-6l-6 6" />
                    </svg>
                    <span class="tw-absolute tw--inset-1"></span>
                  </button>
                </div>
                ${ filter.label }<template v-if="filter.showValues">:<span v-if="!filter.showCount">${ filter.values.join(', ') }</span><span v-else>${ filter.values.length }</span></template>
              </span>
            </div>
          </div>
          <div class="tw-flex tw-items-center">
            <button type="button" class="tw-text-left tw-text-sm tw-font-semibold tw-text-[#667085] tw-flex tw-items-center" @click="cleanFilter({{ year|force_escape }})">
              Limpar filtro
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="tw-ml-2">
                <path d="M15 5L5 15M5 5L15 15" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="tw-bg-white sm:tw-rounded-lg tw-pt-5 tw-border tw-border-[#E5E7EA]">
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8">
        <div class="tw-flow-root">
          <div class="tw--mx-4 tw--my-2 tw-overflow-x-auto sm:tw--mx-6 lg:tw--mx-8">
            <div class="tw-inline-block tw-min-w-full tw-py-2 tw-align-middle sm:tw-px-6 lg:tw-px-8" style="min-height: 350px;">
              <div class="tw-relative">
                <div v-if="selectionList.length > 0" class="tw-absolute tw-top-0 tw-left-14 tw-flex tw-h-12 tw-items-center tw-space-x-3 tw-bg-white sm:tw-left-12">
                  <button type="button" class="tw-inline-flex tw-items-center tw-rounded tw-bg-white tw-px-2 tw-py-1 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50 disabled:tw-cursor-not-allowed disabled:tw-opacity-30 disabled:hover:tw-bg-white" @click="changeAllStatus()">Alterar situação</button>
                  <button type="button" class="tw-inline-flex tw-items-center tw-rounded tw-bg-white tw-px-2 tw-py-1 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50 disabled:tw-cursor-not-allowed disabled:tw-opacity-30 disabled:hover:tw-bg-white" @click="removeAllSelected()">Remover selecionadas</button>
                </div>
                <table class="tw-min-w-full tw-table-fixed tw-divide-y tw-divide-gray-300">
                  <thead>
                    <tr>
                      <th data-tg-title="Selecione vários" data-tg-order="2" data-tg-tour="Selecione vários instrumentos avaliativos ao mesmo tempo e aplique ações em massa." data-tg-group="default-exam-list" scope="col" class="tw-relative tw-px-7 sm:tw-w-12 sm:tw-px-6">
                        {% if user.user_type == "coordination" %}
                          <input type="checkbox" class="tw-absolute tw-left-4 tw-top-1/2 tw--mt-2 tw-h-4 tw-w-4 tw-rounded tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600" :checked="isIndeterminate || selectionList.length === exams.length" :indeterminate.prop="isIndeterminate" @change="selectionList = $event.target.checked ? exams.map((e) => e.pk) : []" />
                        {% endif  %}
                      </th>
                      <th scope="col" class="tw-min-w-[12rem] tw-w-full tw-py-3.5 tw-pr-3 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Nome</th>
                      {% if user.client_has_offset_answer_sheet or user.client_has_salta_answer_sheet %}
                      <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Código</th>
                      {% endif %}
                      <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Disciplinas</th>
                      <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">
                        <span class="tw-flex tw-items-center">
                          Questões
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Questões ativas no caderno e seus respectivos status de revisão.">
                            <g clip-path="url(#clip0_8_3857)">
                              <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </g>
                            <defs>
                              <clipPath id="clip0_8_3857">
                                <rect width="16" height="16" fill="white"/>
                              </clipPath>
                            </defs>
                          </svg>
                        </span>
                      </th>
                      <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Situação</th>
                      <th scope="col" class="tw-relative tw-py-3.5 tw-pl-3 tw-pr-4 sm:tw-pr-3">
                        <span class="tw-sr-only">Ações</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody class="tw-divide-y tw-divide-gray-200 tw-bg-white">
                    {% for exam in object_list %}
                      {% with questions_count=exam.count_availables_questions applications_count=exam.count_applications_count %}
                        <tr id="tr-{{ exam.pk }}" :class="[selectionList.includes('{{ exam.pk }}') && 'bg-gray-50']">
                          <td class="tw-relative tw-px-7 sm:tw-w-12 sm:tw-px-6">
  
                            {% if user.user_type == 'coordination' or user.user_type == 'teacher' and exam.created_by == user %}

                              <div v-if="selectionList.includes('{{ exam.pk }}')" class="tw-absolute tw-inset-y-0 tw-left-0 tw-w-0.5 tw-bg-primary-600"></div>
                              <input type="checkbox" class="tw-absolute tw-left-4 tw-top-1/2 tw--mt-2 tw-h-4 tw-w-4 tw-rounded tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600" value="{{ exam.pk }}" v-model="selectionList" />

                            {% endif %}


                          </td>
                          <td :class="['tw-py-4 tw-pr-3 tw-text-sm tw-font-medium', selectionList.includes('{{ exam.pk }}') ? 'tw-text-primary-600' : 'tw-text-gray-900']">
                            <div class="tw-flex tw-items-center">
                              <div>
                                <div class="tw-font-medium tw-text-gray-900 tw-flex tw-items-center" >
                                  <div class="tw-font-medium tw-text-gray-900">{{ exam.name }}</div>
                                  {%if exam.get_is_inspector_ia or exam.has_questions_created_with_ia %}
                                  <div id="question-exam-status-pending-{{ exam.pk }}" class="{% if not exam.question_status_with_ai == "pendente" %}tw-hidden{% endif %}"> 
                                    <span data-toggle="tooltip" data-placement="top" title="Existem questões nesse caderno sendo geradas por IA."
                                        style="width: 32px; height: 32px; color: #FF8F3D;"
                                        class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                                        <img src="{% static 'assets/img/gifs/stars.gif' %}" style="max-height: 30px;" class="img-fluid">
                                    </span>
                                  </div>
                                  <div id="question-exam-status-finished-{{ exam.pk }}" class="{% if not exam.question_status_with_ai == "concluido" and not exam.has_questions_created_with_ia %}tw-hidden{% endif %}"> 
                                    <span data-toggle="tooltip" data-placement="top" title="Existem questões nesse caderno que foram geradas por IA."
                                        style="width: 32px; height: 32px; color: #FF8F3D;"
                                        class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                                          <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                                      </svg>
                                    </span>
                                  </div>
                                {% endif %}
                     
                                </div>
                                <div class="tw-flex tw-gap-3">
                                  <div class="tw-flex tw-mt-1 text-truncate"> {# foi necessário adicionar o text-truncate para resolver problema da task: https://app.clickup.com/t/86a98r2ej #}
                                    <span class="mr-2">
                                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <path d="M9.99996 17.5L9.91658 17.3749C9.33771 16.5066 9.04828 16.0725 8.66588 15.7582C8.32734 15.4799 7.93726 15.2712 7.51796 15.1438C7.04434 15 6.52255 15 5.47898 15H4.33329C3.39987 15 2.93316 15 2.57664 14.8183C2.26304 14.6586 2.00807 14.4036 1.84828 14.09C1.66663 13.7335 1.66663 13.2668 1.66663 12.3333V5.16667C1.66663 4.23325 1.66663 3.76654 1.84828 3.41002C2.00807 3.09641 2.26304 2.84144 2.57664 2.68166C2.93316 2.5 3.39987 2.5 4.33329 2.5H4.66663C6.53347 2.5 7.46689 2.5 8.17993 2.86331C8.80713 3.18289 9.31707 3.69282 9.63665 4.32003C9.99996 5.03307 9.99996 5.96649 9.99996 7.83333M9.99996 17.5V7.83333M9.99996 17.5L10.0833 17.3749C10.6622 16.5066 10.9516 16.0725 11.334 15.7582C11.6726 15.4799 12.0627 15.2712 12.482 15.1438C12.9556 15 13.4774 15 14.5209 15H15.6666C16.6 15 17.0668 15 17.4233 14.8183C17.7369 14.6586 17.9918 14.4036 18.1516 14.09C18.3333 13.7335 18.3333 13.2668 18.3333 12.3333V5.16667C18.3333 4.23325 18.3333 3.76654 18.1516 3.41002C17.9918 3.09641 17.7369 2.84144 17.4233 2.68166C17.0668 2.5 16.6 2.5 15.6666 2.5H15.3333C13.4665 2.5 12.533 2.5 11.82 2.86331C11.1928 3.18289 10.6828 3.69282 10.3633 4.32003C9.99996 5.03307 9.99996 5.96649 9.99996 7.83333" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                      </svg>
                                    </span>
                                    <span class="tw-text-[#9BA3AF]">
                                      {% if exam.get_category_display == 'Prova' %}
                                        Caderno de prova
                                      {% else %}
                                        Lista de Exercício
                                      {% endif %}
                                    </span>
                                    </span>
                                  </div>
                                  <div class="tw-flex tw-mt-1 text-truncate"> {# foi necessário adicionar o text-truncate para resolver problema da task: https://app.clickup.com/t/86a98r2ej #}
                                    <span class="mr-2">
                                      <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                        <g clip-path="url(#clip0_2_1917)">
                                          <path d="M5.83329 7.91664L1.66663 9.99997L9.70182 14.0176C9.81114 14.0722 9.8658 14.0996 9.92313 14.1103C9.97391 14.1198 10.026 14.1198 10.0768 14.1103C10.1341 14.0996 10.1888 14.0722 10.2981 14.0176L18.3333 9.99997L14.1666 7.91664M5.83329 12.0833L1.66663 14.1666L9.70182 18.1842C9.81114 18.2389 9.8658 18.2662 9.92313 18.277C9.97391 18.2865 10.026 18.2865 10.0768 18.277C10.1341 18.2662 10.1888 18.2389 10.2981 18.1842L18.3333 14.1666L14.1666 12.0833M1.66663 5.83331L9.70182 1.81571C9.81114 1.76105 9.86579 1.73372 9.92313 1.72297C9.97391 1.71344 10.026 1.71344 10.0768 1.72297C10.1341 1.73372 10.1888 1.76105 10.2981 1.81571L18.3333 5.83331L10.2981 9.8509C10.1888 9.90556 10.1341 9.93289 10.0768 9.94365C10.026 9.95317 9.97391 9.95317 9.92313 9.94365C9.86579 9.93289 9.81114 9.90556 9.70182 9.8509L1.66663 5.83331Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </g>
                                        <defs>
                                          <clipPath id="clip0_2_1917">
                                            <rect width="20" height="20" fill="white"/>
                                          </clipPath>
                                        </defs>
                                      </svg>
                                    </span>
                                    <span id="questions-count-{{ exam.pk }}" class="tw-text-[#9BA3AF]">{{ questions_count }} questões</span>
                                  </div>
                                </div>
                                <div class="tw-flex tw-mt-1">
                                  
                                  {% if exam.elaboration_deadline %}
                                    <span class="mr-2" data-toggle="tooltip" data-placement="top" title="Prazo para elaboração">
                                      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                        <path d="M21 10H3M16 2V6M8 2V6M10.5 14L12 13V18M10.75 18H13.25M7.8 22H16.2C17.8802 22 18.7202 22 19.362 21.673C19.9265 21.3854 20.3854 20.9265 20.673 20.362C21 19.7202 21 18.8802 21 17.2V8.8C21 7.11984 21 6.27976 20.673 5.63803C20.3854 5.07354 19.9265 4.6146 19.362 4.32698C18.7202 4 17.8802 4 16.2 4H7.8C6.11984 4 5.27976 4 4.63803 4.32698C4.07354 4.6146 3.6146 5.07354 3.32698 5.63803C3 6.27976 3 7.11984 3 8.8V17.2C3 18.8802 3 19.7202 3.32698 20.362C3.6146 20.9265 4.07354 21.3854 4.63803 21.673C5.27976 22 6.11984 22 7.8 22Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                      </svg>
                                    </span>
                                    <span class="tw-text-[#9BA3AF]" data-toggle="tooltip" data-placement="top" title="Prazo para elaboração">
                                      {{ exam.elaboration_deadline }}
                                    </span>
                                  {% endif %}
                                    
                                  {% if exam.is_confidential and today > exam.confidential_date %}
                                  <div class="tw-flex ml-2" data-toggle="tooltip" data-placement="top" title="Esse caderno é mostrado apenas pra quem tem a permissão adequada">
                                    <span class="mr-2">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#9BA3AF" class="bi bi-eye-fill" viewBox="0 0 16 16">
                                        <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                                        <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
                                      </svg>
                                    </span>
                                    <span class="tw-text-[#9BA3AF]">
                                      Confidencial
                                    </span>
                                  </div>
                                  {% endif %}
                                </div>
                                {% if user.client_has_realms_integration %}
                                <div class="tw-flex tw-mt-1" data-toggle="tooltip" data-placement="top" title="Última sincronização">
                                  <span class="mr-2">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                      <path d="M8 16L12 12M12 12L16 16M12 12V21M20 16.7428C21.2215 15.734 22 14.2079 22 12.5C22 9.46243 19.5376 7 16.5 7C16.2815 7 16.0771 6.886 15.9661 6.69774C14.6621 4.48484 12.2544 3 9.5 3C5.35786 3 2 6.35786 2 10.5C2 12.5661 2.83545 14.4371 4.18695 15.7935" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                  <span class="tw-text-[#9BA3AF]">
                                    {{ exam.last_erp_sync|default_if_none:"Nunca" }} {% if exam.id_erp and exam.last_erp_sync %}(ID: {{exam.id_erp}}){% endif %}
                                  </span>
                                </div>
                                {% endif %}
                              </div>
                            </div>
                          </td>
                          {% if user.client_has_offset_answer_sheet or user.client_has_salta_answer_sheet %}
                          <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-gray-500">
                            {{ exam.external_code|default_if_none:""|safe }}
                          </td>
                          {% endif %}
                          <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-gray-500">
                            {% with exam.get_initials_subjects as initials_subjects %}
                              <div class="tw-flex tw--space-x-2 tw-overflow-hidden">
                                {% for initial_subject in initials_subjects|slice:":3" %}
                                  <span class="tw-inline-flex tw-h-8 tw-w-8 tw-items-center tw-justify-center tw-rounded-full tw-ring-2 tw-ring-white tw-bg-gray-500" data-toggle="tooltip" data-placement="top" title="{{ initial_subject.name }}">
                                    <span class="tw-text-sm tw-font-medium tw-leading-none tw-text-white">
                                      {{ initial_subject.initial }}
                                    </span>
                                  </span>
                                {% empty %}
                                  -
                                {% endfor %}
                                {% if initials_subjects|length > 3 %}
                                  <span class="tw-inline-flex tw-h-8 tw-w-8 tw-items-center tw-justify-center tw-rounded-full tw-ring-2 tw-ring-white tw-bg-gray-500" data-toggle="tooltip" data-placement="top" title="Mais {{ initials_subjects|length|add:'-3' }} disciplinas nesse caderno.">
                                    <span class="tw-text-sm tw-font-medium tw-leading-none tw-text-white">
                                      +{{ initials_subjects|length|add:"-3" }}
                                    </span>
                                  </span>
                                {% endif %}
                              </div>
                            {% endwith %}
                          </td>
                          <td class="tw-relative tw-w-[180px] tw-px-3 tw-py-4 tw-text-sm tw-text-gray-500">
                            <div class="tw-flex tw-items-center lz-parent"
                            {% if forloop.counter == 1  %}
                              data-tg-title="Questões entregues" data-tg-order="2" data-tg-tour="Visualize de forma mais rápida a porcentagem de entrega e revisão dos itens enviados pelos professores." data-tg-group="default-exam-list"
                            {% endif  %}
                            >
                              <div id="copy-exam-status-pending-{{ exam.pk }}" class="{% if not exam.copy_exam_with_ia_status == 1 %}tw-hidden{% endif %}"> 
                                <span class=" tw-text-primary-600">
                                  Gerando cópia... 
                                  <i class="fas fa-spinner fa-spin"></i>
                                </span>
                              </div>
                              <div id="copy-exam-status-finished-{{ exam.pk }}" class="{% if not exam.copy_exam_with_ia_status == 2 and not exam.copy_exam_with_ia_status  == 0 %}tw-hidden{% endif %}"> 
                                <div class="tw-relative tw-w-[100px]">
                                  <div class="tw-overflow-hidden tw-text-xs tw-flex tw-rounded-full tw-h-2.5 tw-mr-2 tw-bg-gray-200">
                                    <div style="width: {{ exam.new_percentage_status_questions.approved_and_use_later_questions_percentage }}%" class="tw-shadow-none tw-flex tw-flex-col tw-text-center tw-whitespace-nowrap tw-text-white tw-justify-center tw-bg-green-600"></div>
                                    <div style="width: {{ exam.new_percentage_status_questions.other_questions_percentage }}%" class="tw-shadow-none tw-flex tw-flex-col tw-text-center tw-whitespace-nowrap tw-text-white tw-justify-center tw-bg-yellow-500"></div>
                                  </div>
                                </div>
                              </div>
                                <span  class="{% if not exam.copy_exam_with_ia_status == 2 and not exam.copy_exam_with_ia_status  == 0 %}tw-hidden{% endif %}" id="total-delivered-percentage-{{ exam.pk }}" class="tw-text-[#9BA3AF]">
                                  {{ exam.new_percentage_status_questions.total_delivered_percentage }}%
                                </span>
                              {% with exam.get_status_only_value as get_status_only_value %}
                                {% with no_review_questions=get_status_only_value|get_value_from_dict:'Sem revisão'|default_if_none:0 checked_questions=get_status_only_value|get_value_from_dict:'Visto(s)'|default_if_none:0 awaiting_correction_questions=get_status_only_value|get_value_from_dict:'Aguardando correção'|default_if_none:0 approved_questions=get_status_only_value|get_value_from_dict:'Aprovada(s)'|default_if_none:0 use_later_questions=get_status_only_value|get_value_from_dict:'Usar depois'|default_if_none:0 canceled_questions=get_status_only_value|get_value_from_dict:'Anulada(s)'|default_if_none:0 rejected_questions=get_status_only_value|get_value_from_dict:'Reprovada(s)'|default_if_none:0 %}
                                  {% if no_review_questions > 0 or checked_questions > 0 or awaiting_correction_questions > 0 or approved_questions > 0 or use_later_questions > 0 or canceled_questions > 0 or rejected_questions > 0 %}
                                    <div class="tw-absolute tw-bottom-[-138px] tw-ml-auto tw-max-w-xl tw-min-h-[172px] tw-rounded-lg tw-z-[1] lz-hidden-element"{% if objects_count > 3 and forloop.last %} style="inset: 0px auto auto 0px; transform: translate3d(0px, -140px, 0px);"{% endif %}>
                                    <div class="tw-pointer-events-auto tw-rounded-lg tw-bg-white tw-px-3 tw-pt-2 tw-pb-4 tw-shadow-lg tw-ring-1 tw-ring-gray-900/10">
                                      <p class="tw-text-sm tw-leading-6 tw-text-gray-900 tw-mb-2">
                                        {{ questions_count }} Questões
                                      </p>
                                      <div class="tw-space-y-1 tw-min-w-[12.4rem]">
                                          {% if no_review_questions > 0 %}
                                            <div class="tw-flex tw-items-center tw-gap-2 tw-rounded tw-px-1.5 tw-bg-[#FFCB561A]">
                                              <span>
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                  <path d="M7.99976 6.00015V8.66682M7.99976 11.3335H8.00642M7.07663 2.59464L1.59338 12.0657C1.28924 12.591 1.13717 12.8537 1.15965 13.0693C1.17925 13.2573 1.27776 13.4282 1.43067 13.5394C1.60597 13.6668 1.90948 13.6668 2.5165 13.6668H13.483C14.09 13.6668 14.3935 13.6668 14.5688 13.5394C14.7217 13.4282 14.8203 13.2573 14.8399 13.0693C14.8623 12.8537 14.7103 12.591 14.4061 12.0657L8.92288 2.59463C8.61983 2.07119 8.46831 1.80947 8.27062 1.72157C8.09818 1.64489 7.90133 1.64489 7.72889 1.72157C7.5312 1.80947 7.37968 2.07119 7.07663 2.59464Z" stroke="#FFCB56" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                              </span>
                                              <span>{{ no_review_questions }} sem revisão</span>
                                            </div>
                                          {% endif %}
                                          {% if checked_questions > 0 %}
                                            <div class="tw-flex tw-items-center tw-gap-2 tw-rounded tw-px-1.5 tw-bg-[#0C7BDB1A]">
                                              <span>
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                  <path d="M1.61342 8.47562C1.52262 8.33186 1.47723 8.25998 1.45182 8.14911C1.43273 8.06583 1.43273 7.9345 1.45182 7.85122C1.47723 7.74035 1.52262 7.66847 1.61341 7.52471C2.36369 6.33672 4.59693 3.3335 8.00027 3.3335C11.4036 3.3335 13.6369 6.33672 14.3871 7.52471C14.4779 7.66847 14.5233 7.74035 14.5487 7.85122C14.5678 7.9345 14.5678 8.06583 14.5487 8.14911C14.5233 8.25998 14.4779 8.33186 14.3871 8.47562C13.6369 9.6636 11.4036 12.6668 8.00027 12.6668C4.59693 12.6668 2.36369 9.6636 1.61342 8.47562Z" stroke="#0C7BDB" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                  <path d="M8.00027 10.0002C9.10484 10.0002 10.0003 9.10473 10.0003 8.00016C10.0003 6.89559 9.10484 6.00016 8.00027 6.00016C6.8957 6.00016 6.00027 6.89559 6.00027 8.00016C6.00027 9.10473 6.8957 10.0002 8.00027 10.0002Z" stroke="#0C7BDB" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                              </span>
                                              <span>{{ checked_questions }} visto(s)</span>
                                            </div>
                                          {% endif %}
                                          {% if awaiting_correction_questions > 0 %}
                                            <div class="tw-flex tw-items-center tw-gap-2 tw-rounded tw-px-1.5 tw-bg-[#0C7BDB1A]">
                                              <span>
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                  <g clip-path="url(#clip0_569_1715)">
                                                    <path d="M7.99992 4.00016V8.00016L10.6666 9.3335M14.6666 8.00016C14.6666 11.6821 11.6818 14.6668 7.99992 14.6668C4.31802 14.6668 1.33325 11.6821 1.33325 8.00016C1.33325 4.31826 4.31802 1.3335 7.99992 1.3335C11.6818 1.3335 14.6666 4.31826 14.6666 8.00016Z" stroke="#0C7BDB" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                  </g>
                                                  <defs>
                                                    <clipPath id="clip0_569_1715">
                                                      <rect width="16" height="16" fill="white"/>
                                                    </clipPath>
                                                  </defs>
                                                </svg>
                                              </span>
                                              <span>{{ awaiting_correction_questions }} aguardando correção</span>
                                            </div>
                                          {% endif %}
                                          {% if approved_questions > 0 %}
                                            <div class="tw-flex tw-items-center tw-gap-2 tw-rounded tw-px-1.5 tw-bg-[#41C5881A]">
                                              <span>
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                  <g clip-path="url(#clip0_569_1701)">
                                                    <path d="M14.6666 7.39065V8.00398C14.6658 9.44159 14.2003 10.8404 13.3395 11.9919C12.4787 13.1433 11.2688 13.9856 9.89016 14.3932C8.51154 14.8009 7.03809 14.7519 5.68957 14.2537C4.34104 13.7555 3.18969 12.8347 2.40723 11.6287C1.62476 10.4227 1.25311 8.99602 1.3477 7.56152C1.44229 6.12702 1.99806 4.76153 2.93211 3.66869C3.86615 2.57586 5.12844 1.81423 6.53071 1.49741C7.93298 1.18059 9.4001 1.32554 10.7133 1.91065M14.6666 2.66683L7.99992 9.34016L5.99992 7.34016" stroke="#41C588" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                  </g>
                                                  <defs>
                                                    <clipPath id="clip0_569_1701">
                                                      <rect width="16" height="16" fill="white"/>
                                                    </clipPath>
                                                  </defs>
                                                </svg>
                                              </span>
                                              <span>{{ approved_questions }} aprovada(s)</span>
                                            </div>
                                          {% endif %}
                                          {% if use_later_questions > 0 %}
                                            <div class="tw-flex tw-items-center tw-gap-2 tw-rounded tw-px-1.5 tw-bg-[#D92D201A]">
                                              <span>
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                  <path d="M2.66659 5.33106C2.55725 5.32824 2.47785 5.32191 2.40646 5.30771C1.87754 5.2025 1.46408 4.78904 1.35887 4.26012C1.33325 4.13132 1.33325 3.97644 1.33325 3.66667C1.33325 3.3569 1.33325 3.20201 1.35887 3.07321C1.46408 2.54429 1.87754 2.13083 2.40646 2.02562C2.53526 2 2.69015 2 2.99992 2H12.9999C13.3097 2 13.4646 2 13.5934 2.02562C14.1223 2.13083 14.5358 2.54429 14.641 3.07321C14.6666 3.20201 14.6666 3.3569 14.6666 3.66667C14.6666 3.97644 14.6666 4.13132 14.641 4.26012C14.5358 4.78904 14.1223 5.2025 13.5934 5.30771C13.522 5.32191 13.4426 5.32824 13.3333 5.33106M6.66659 8.66667H9.33325M2.66659 5.33333H13.3333V10.8C13.3333 11.9201 13.3333 12.4802 13.1153 12.908C12.9235 13.2843 12.6176 13.5903 12.2412 13.782C11.8134 14 11.2534 14 10.1333 14H5.86659C4.74648 14 4.18643 14 3.7586 13.782C3.38228 13.5903 3.07632 13.2843 2.88457 12.908C2.66659 12.4802 2.66659 11.9201 2.66659 10.8V5.33333Z" stroke="#D92D20" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                              </span>
                                              <span>{{ use_later_questions }} usar depois</span>
                                            </div>
                                          {% endif %}
                                          {% if canceled_questions > 0 %}
                                            <div class="tw-flex tw-items-center tw-gap-2 tw-rounded tw-px-1.5 tw-bg-[#D92D201A]">
                                              <span>
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                  <g clip-path="url(#clip0_569_1709)">
                                                    <path d="M9.99992 6.00016L5.99992 10.0002M5.99992 6.00016L9.99992 10.0002M14.6666 8.00016C14.6666 11.6821 11.6818 14.6668 7.99992 14.6668C4.31802 14.6668 1.33325 11.6821 1.33325 8.00016C1.33325 4.31826 4.31802 1.3335 7.99992 1.3335C11.6818 1.3335 14.6666 4.31826 14.6666 8.00016Z" stroke="#D92D20" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                  </g>
                                                  <defs>
                                                    <clipPath id="clip0_569_1709">
                                                      <rect width="16" height="16" fill="white"/>
                                                    </clipPath>
                                                  </defs>
                                                </svg>
                                              </span>
                                              <span>{{ canceled_questions }} anulada(s)</span>
                                            </div>
                                          {% endif %}
                                          {% if rejected_questions > 0 %}
                                            <div class="tw-flex tw-items-center tw-gap-2 tw-rounded tw-px-1.5 tw-bg-[#D92D201A]">
                                              <span>
                                                <svg width="14" height="14" viewBox="0 0 16 16" fill="none">
                                                  <path d="M10.6667 4.00016V3.46683C10.6667 2.72009 10.6667 2.34672 10.5213 2.06151C10.3935 1.81063 10.1895 1.60665 9.93865 1.47882C9.65344 1.3335 9.28007 1.3335 8.53333 1.3335H7.46667C6.71993 1.3335 6.34656 1.3335 6.06135 1.47882C5.81046 1.60665 5.60649 1.81063 5.47866 2.06151C5.33333 2.34672 5.33333 2.72009 5.33333 3.46683V4.00016M6.66667 7.66683V11.0002M9.33333 7.66683V11.0002M2 4.00016H14M12.6667 4.00016V11.4668C12.6667 12.5869 12.6667 13.147 12.4487 13.5748C12.2569 13.9511 11.951 14.2571 11.5746 14.4488C11.1468 14.6668 10.5868 14.6668 9.46667 14.6668H6.53333C5.41323 14.6668 4.85318 14.6668 4.42535 14.4488C4.04903 14.2571 3.74307 13.9511 3.55132 13.5748C3.33333 13.147 3.33333 12.5869 3.33333 11.4668V4.00016" stroke="#D92D20" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                                                </svg>
                                              </span>
                                              <span>{{ rejected_questions }} reprovada(s)</span>
                                            </div>
                                          {% endif %}
                                      </div>
                                    </div>
                                    </div>
                                  {% endif %}
                                {% endwith %}
                              {% endwith %}
                            </div>
                          </td>
                          <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-gray-500">
                            <button 
                            {% if forloop.counter == 1  %}
                              data-tg-title="Altere a situação do instrumento" data-tg-order="2" data-tg-tour="Modifique a situação de um instrumento avaliativo sem precisar acessar as configurações do instrumento." data-tg-group="default-exam-list"
                            {% endif  %}
                            class="tw-inline-flex tw-items-center tw-rounded-full tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-ring-1 tw-ring-inset tw-ring-[#E5E7EA] hover:tw-bg-gray-100 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-gray-100" type="button" id="dropdownMenuButton-1-{{ exam.pk }}"
                            {% if user|has_perm:'exams.can_change_status_exam' %}
                              data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                            {% endif %}
                            >                               
                              <!-- <template v-if="updateStatusFetchStatus === 'loading'">
                                Carregando...
                              </template> -->
                              <!-- <template v-else-if="updateStatusFetchStatus === 'error'">
                                Falha ao carregar
                              </template> -->
                              <template v-if="updateStatusFetchStatus === 'error'">
                                Falha ao carregar
                              </template>
                              <template v-else>
                                <template v-if="getExamByPk('{{ exam.pk }}').status === 0">
                                  <span class="ml-1 mr-2">
                                    <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                      <path d="M2 7.5C2 7.5 2.5 7 4 7C5.5 7 6.5 8 8 8C9.5 8 10 7.5 10 7.5V1.5C10 1.5 9.5 2 8 2C6.5 2 5.5 1 4 1C2.5 1 2 1.5 2 1.5L2 11" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                  <span class="tw-text-sm">
                                    Elaborando
                                  </span>
                                  <span class="ml-2">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                </template>
                                <template v-else-if="getExamByPk('{{ exam.pk }}').status === 1">
                                  <span class="ml-1 mr-2">
                                    <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                      <path d="M1.21006 6.35659C1.14197 6.24877 1.10792 6.19486 1.08886 6.11171C1.07455 6.04925 1.07455 5.95075 1.08886 5.88829C1.10792 5.80514 1.14197 5.75123 1.21006 5.64341C1.77276 4.75242 3.4477 2.5 6.0002 2.5C8.5527 2.5 10.2276 4.75242 10.7903 5.64341C10.8584 5.75123 10.8925 5.80514 10.9115 5.88829C10.9259 5.95075 10.9259 6.04925 10.9115 6.11171C10.8925 6.19486 10.8584 6.24877 10.7903 6.35659C10.2276 7.24758 8.5527 9.5 6.0002 9.5C3.4477 9.5 1.77276 7.24758 1.21006 6.35659Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                      <path d="M6.0002 7.5C6.82863 7.5 7.5002 6.82843 7.5002 6C7.5002 5.17157 6.82863 4.5 6.0002 4.5C5.17177 4.5 4.5002 5.17157 4.5002 6C4.5002 6.82843 5.17177 7.5 6.0002 7.5Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                  <span class="tw-text-sm">
                                    Análise de Itens
                                  </span>
                                  <span class="ml-2">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                </template>
                                <template v-else-if="getExamByPk('{{ exam.pk }}').status === 2">
                                  <span class="ml-1 mr-2">
                                    <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                      <g clip-path="url(#clip0_2_3631)">
                                        <path d="M3.75 6L5.25 7.5L8.25 4.5M11 6C11 8.76142 8.76142 11 6 11C3.23858 11 1 8.76142 1 6C1 3.23858 3.23858 1 6 1C8.76142 1 11 3.23858 11 6Z" stroke="#41C588" stroke-linecap="round" stroke-linejoin="round"/>
                                      </g>
                                      <defs>
                                        <clipPath id="clip0_2_3631">
                                          <rect width="16" height="16" fill="white"/>
                                        </clipPath>
                                      </defs>
                                    </svg>
                                  </span>
                                  <span class="tw-text-sm">
                                    Fechado
                                  </span>
                                  <span class="ml-2">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                </template>
                                <template v-else-if="getExamByPk('{{ exam.pk }}').status === 5">
                                  <span class="ml-1 mr-2">
                                    <svg width="17" height="17" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M20 12.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H12M14 11H8M10 15H8M16 7H8M14.5 19L16.5 21L21 16.5" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                  </span>
                                  <span class="tw-text-sm">
                                    Pronto para impressão
                                  </span>
                                  <span class="ml-2">                                    
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                </template>
                                <template v-else-if="getExamByPk('{{ exam.pk }}').status === 3">
                                  <span class="ml-1 mr-2">
                                    <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                      <path d="M1.5 4.5H10.5M4.5 4.5L4.5 10.5M3.9 1.5H8.1C8.94008 1.5 9.36012 1.5 9.68099 1.66349C9.96323 1.8073 10.1927 2.03677 10.3365 2.31901C10.5 2.63988 10.5 3.05992 10.5 3.9V8.1C10.5 8.94008 10.5 9.36012 10.3365 9.68099C10.1927 9.96323 9.96323 10.1927 9.68099 10.3365C9.36012 10.5 8.94008 10.5 8.1 10.5H3.9C3.05992 10.5 2.63988 10.5 2.31901 10.3365C2.03677 10.1927 1.8073 9.96323 1.66349 9.68099C1.5 9.36012 1.5 8.94008 1.5 8.1V3.9C1.5 3.05992 1.5 2.63988 1.66349 2.31901C1.8073 2.03677 2.03677 1.8073 2.31901 1.66349C2.63988 1.5 3.05992 1.5 3.9 1.5Z" stroke="#F3B364" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                  <span class="tw-text-sm">
                                    Revisão gráfica
                                  </span>
                                  <span class="ml-2">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                </template>
                                

                                <template v-else-if="getExamByPk('{{ exam.pk }}').status === 4">
                                  <span class="ml-1 mr-2">
                                    <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                      <path d="M2 3.5C2 3.03406 2 2.80109 2.07612 2.61732C2.17761 2.37229 2.37229 2.17761 2.61732 2.07612C2.80109 2 3.03406 2 3.5 2H8.5C8.96594 2 9.19891 2 9.38268 2.07612C9.62771 2.17761 9.82239 2.37229 9.92388 2.61732C10 2.80109 10 3.03406 10 3.5M4.5 10H7.5M6 2V10" stroke="#F3B364" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                  <span class="tw-text-sm">
                                    Revisão textual
                                  </span>
                                  <span class="ml-2">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                </template>
                                {% if user.questions_configuration.can_add_revision_after_closing_exam %}
                                <template v-else-if="getExamByPk('{{ exam.pk }}').status === 6 && !getExamByPk('{{ exam.pk }}').existBag">
                                  <span class="ml-1 mr-2">
                                    <svg width="17" height="17" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M20 12.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H12M14 11H8M10 15H8M16 7H8M19 19L15 15M15 19L19 15" stroke="#F3B364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                  <span class="tw-text-sm">
                                    Revisão de PDF
                                  </span>
                                  <span class="ml-2">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                      <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                </template>
                                {% endif %}
                              </template>
                            
                            </button>
                            {% if user|has_perm:'exams.can_change_status_exam' %}
                              {% if user.user_type == 'coordination' or user.user_type == 'teacher' and exam.created_by == user %}
                                <div class="dropdown-menu tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-1-{{ exam.pk }}" style="font-size: inherit;">
                                  <div class="tw-py-1" role="none">
                                    <template v-if="getExamByPk('{{ exam.pk }}').status !== 0">
                                      <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0" @click="updateStatus('{{ exam.pk }}', 0)">
                                        <span class="tw-flex tw-items-center">
                                          <span class="mr-2">
                                            <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                              <path d="M2 7.5C2 7.5 2.5 7 4 7C5.5 7 6.5 8 8 8C9.5 8 10 7.5 10 7.5V1.5C10 1.5 9.5 2 8 2C6.5 2 5.5 1 4 1C2.5 1 2 1.5 2 1.5L2 11" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                          </span>
                                          <span>
                                              Elaborando
                                          </span>
                                        </button>
                                      </template>
                                      <template v-if="getExamByPk('{{ exam.pk }}').status !== 1">
                                        <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1" @click="updateStatus('{{ exam.pk }}', 1)">
                                          <span class="tw-flex tw-items-center">
                                            <span class="mr-2">
                                              <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                                <path d="M1.21006 6.35659C1.14197 6.24877 1.10792 6.19486 1.08886 6.11171C1.07455 6.04925 1.07455 5.95075 1.08886 5.88829C1.10792 5.80514 1.14197 5.75123 1.21006 5.64341C1.77276 4.75242 3.4477 2.5 6.0002 2.5C8.5527 2.5 10.2276 4.75242 10.7903 5.64341C10.8584 5.75123 10.8925 5.80514 10.9115 5.88829C10.9259 5.95075 10.9259 6.04925 10.9115 6.11171C10.8925 6.19486 10.8584 6.24877 10.7903 6.35659C10.2276 7.24758 8.5527 9.5 6.0002 9.5C3.4477 9.5 1.77276 7.24758 1.21006 6.35659Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M6.0002 7.5C6.82863 7.5 7.5002 6.82843 7.5002 6C7.5002 5.17157 6.82863 4.5 6.0002 4.5C5.17177 4.5 4.5002 5.17157 4.5002 6C4.5002 6.82843 5.17177 7.5 6.0002 7.5Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </span>
                                            <span>
                                              Análise de Itens
                                            </span>
                                          </span>
                                        </button>
                                      </template>
                                      <template v-if="getExamByPk('{{ exam.pk }}').status !== 3">
                                        <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-3" @click="updateStatus('{{ exam.pk }}', 3)">
                                          <span class="tw-flex tw-items-center">
                                            <span class="mr-2">
                                              <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                                <path d="M1.5 4.5H10.5M4.5 4.5L4.5 10.5M3.9 1.5H8.1C8.94008 1.5 9.36012 1.5 9.68099 1.66349C9.96323 1.8073 10.1927 2.03677 10.3365 2.31901C10.5 2.63988 10.5 3.05992 10.5 3.9V8.1C10.5 8.94008 10.5 9.36012 10.3365 9.68099C10.1927 9.96323 9.96323 10.1927 9.68099 10.3365C9.36012 10.5 8.94008 10.5 8.1 10.5H3.9C3.05992 10.5 2.63988 10.5 2.31901 10.3365C2.03677 10.1927 1.8073 9.96323 1.66349 9.68099C1.5 9.36012 1.5 8.94008 1.5 8.1V3.9C1.5 3.05992 1.5 2.63988 1.66349 2.31901C1.8073 2.03677 2.03677 1.8073 2.31901 1.66349C2.63988 1.5 3.05992 1.5 3.9 1.5Z" stroke="#F3B364" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </span>
                                            <span>
                                              Revisão gráfica
                                            </span>
                                          </span>
                                        </button>
                                      </template>
                                      <template v-if="getExamByPk('{{ exam.pk }}').status !== 4">
                                        <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-4" @click="updateStatus('{{ exam.pk }}', 4)">
                                          <span class="tw-flex tw-items-center">
                                            <span class="mr-2">
                                              <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                                <path d="M2 3.5C2 3.03406 2 2.80109 2.07612 2.61732C2.17761 2.37229 2.37229 2.17761 2.61732 2.07612C2.80109 2 3.03406 2 3.5 2H8.5C8.96594 2 9.19891 2 9.38268 2.07612C9.62771 2.17761 9.82239 2.37229 9.92388 2.61732C10 2.80109 10 3.03406 10 3.5M4.5 10H7.5M6 2V10" stroke="#F3B364" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </span>
                                            <span>
                                              Revisão textual
                                            </span>
                                          </span>
                                        </button>
                                      </template>
                                    
                                      {% if user.questions_configuration.can_add_revision_after_closing_exam %}
                                      <template v-if="getExamByPk('{{ exam.pk }}').status !== 6">
                                        <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-6" @click="handleUpdateStatus('{{ exam.pk }}', 6)">
                                          <span class="tw-flex tw-items-center">
                                            <span class="mr-2">
                                              <svg width="17" height="17" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                  <path d="M20 12.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H12M14 11H8M10 15H8M16 7H8M19 19L15 15M15 19L19 15" stroke="#F3B364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </span>
                                            <span>
                                              Revisão de PDF
                                            </span>
                                          </span>
                                        </button>
                                      </template>
                                      {% endif %}
                                      <template v-if="getExamByPk('{{ exam.pk }}').status !== 2">
                                        <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-2" @click="updateStatus('{{ exam.pk }}', 2)">
                                          <span class="tw-flex tw-items-center">
                                            <span class="mr-2">
                                              <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                                <g clip-path="url(#clip0_2_3631)">
                                                  <path d="M3.75 6L5.25 7.5L8.25 4.5M11 6C11 8.76142 8.76142 11 6 11C3.23858 11 1 8.76142 1 6C1 3.23858 3.23858 1 6 1C8.76142 1 11 3.23858 11 6Z" stroke="#41C588" stroke-linecap="round" stroke-linejoin="round"/>
                                                </g>
                                                <defs>
                                                  <clipPath id="clip0_2_3631">
                                                    <rect width="16" height="16" fill="white"/>
                                                  </clipPath>
                                                </defs>
                                              </svg>
                                            </span>
                                            <span>
                                              Fechado
                                            </span>
                                          </span>
                                        </button>
                                      </template>
                                      <template v-if="getExamByPk('{{ exam.pk }}').status !== 5">
                                        <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-4" @click="updateStatus('{{ exam.pk }}', 5)">
                                          <span class="tw-flex tw-items-center">
                                            <span class="mr-2">
                                              <svg width="17" height="17" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                              <path d="M20 12.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H12M14 11H8M10 15H8M16 7H8M14.5 19L16.5 21L21 16.5" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </span>
                                            <span>
                                              Pronto para impressão
                                            </span>
                                          </span>
                                        </button>
                                      </template>
                                    </div>
                                </div> 
                              {% endif %}
                            {% endif %}
                          </td>
                          <td class="tw-whitespace-nowrap tw-py-4 tw-pl-3 tw-pr-4 tw-text-sm tw-font-medium sm:tw-pr-3">
                            <div class="tw-flex tw-items-center tw-justify-end tw-space-x-4">
                              {% if user_type == 'coordination' %}
                                {% if user|has_perm:'exams.can_review_questions_exam' %}
                                  <a 
                                  {% if forloop.counter == 1  %}
                                    data-tg-title="Revise os itens" data-tg-order="2" data-tg-tour="Acesse rapidamente a tela de revisão dos itens inseridos pelos professores." data-tg-group="default-exam-list"
                                  {% endif  %}
                                  href="{% url 'exams:exam_review' pk=exam.pk %}{{request|cleaned_params}}" class="tw-rounded-full tw-bg-[#F9FAFA] tw-p-2 tw-text-primary-600 tw-shadow-sm hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Analisar questões">
                                    <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                      <path d="M22 11.0857V12.0057C21.9988 14.1621 21.3005 16.2604 20.0093 17.9875C18.7182 19.7147 16.9033 20.9782 14.8354 21.5896C12.7674 22.201 10.5573 22.1276 8.53447 21.3803C6.51168 20.633 4.78465 19.2518 3.61096 17.4428C2.43727 15.6338 1.87979 13.4938 2.02168 11.342C2.16356 9.19029 2.99721 7.14205 4.39828 5.5028C5.79935 3.86354 7.69279 2.72111 9.79619 2.24587C11.8996 1.77063 14.1003 1.98806 16.07 2.86572M22 4L12 14.01L9 11.01" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </a>
                                {% endif %}
                                {% if user|has_perm:'exams.can_diagram_exam' %}
                                  <a 
                                  {% if forloop.counter == 1  %}
                                    data-tg-title="Diagramação do instrumento" data-tg-order="2" data-tg-tour="Acesso rápido à tela de diagramação do instrumento avaliativo." data-tg-group="default-exam-list"
                                  {% endif  %}
                                  {% if exam.is_printed %}@click="diagramationErro()" href="javascript:;"{% else %}href="{% url 'exams:exam-print-v2' pk=exam.pk %}"{% endif %} class="tw-rounded-full tw-bg-[#F9FAFA] tw-p-2 tw-text-primary-600 tw-shadow-sm hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Diagramar">
                                    <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                      <path d="M3 9H21M9 9L9 21M7.8 3H16.2C17.8802 3 18.7202 3 19.362 3.32698C19.9265 3.6146 20.3854 4.07354 20.673 4.63803C21 5.27976 21 6.11984 21 7.8V16.2C21 17.8802 21 18.7202 20.673 19.362C20.3854 19.9265 19.9265 20.3854 19.362 20.673C18.7202 21 17.8802 21 16.2 21H7.8C6.11984 21 5.27976 21 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3 18.7202 3 17.8802 3 16.2V7.8C3 6.11984 3 5.27976 3.32698 4.63803C3.6146 4.07354 4.07354 3.6146 4.63803 3.32698C5.27976 3 6.11984 3 7.8 3Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </a>
                                {% endif %}
                              {% elif user_type == 'teacher' %}
                                {% if user|has_perm:'exams.can_view_result_exam' %}
                                  <a {% if applications_count %}href="{% url 'exams:dash_exam_teacher_detail_questions' exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-rounded-full tw-bg-[#F9FAFA] tw-p-2 tw-text-primary-600 tw-shadow-sm hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Ver resultado">
                                    <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                      <path d="M22 11.0857V12.0057C21.9988 14.1621 21.3005 16.2604 20.0093 17.9875C18.7182 19.7147 16.9033 20.9782 14.8354 21.5896C12.7674 22.201 10.5573 22.1276 8.53447 21.3803C6.51168 20.633 4.78465 19.2518 3.61096 17.4428C2.43727 15.6338 1.87979 13.4938 2.02168 11.342C2.16356 9.19029 2.99721 7.14205 4.39828 5.5028C5.79935 3.86354 7.69279 2.72111 9.79619 2.24587C11.8996 1.77063 14.1003 1.98806 16.07 2.86572M22 4L12 14.01L9 11.01" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </a>
                                {% endif %}
                                {% if user|has_perm:'exams.can_correct_answers_exam' %}
                                  <a {% if applications_count %}href="{% url 'exams:exams_detail_v2' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-rounded-full tw-bg-[#F9FAFA] tw-p-2 tw-text-primary-600 tw-shadow-sm hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Correção de respostas">
                                    <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                      <path d="M3 9H21M9 9L9 21M7.8 3H16.2C17.8802 3 18.7202 3 19.362 3.32698C19.9265 3.6146 20.3854 4.07354 20.673 4.63803C21 5.27976 21 6.11984 21 7.8V16.2C21 17.8802 21 18.7202 20.673 19.362C20.3854 19.9265 19.9265 20.3854 19.362 20.673C18.7202 21 17.8802 21 16.2 21H7.8C6.11984 21 5.27976 21 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3 18.7202 3 17.8802 3 16.2V7.8C3 6.11984 3 5.27976 3.32698 4.63803C3.6146 4.07354 4.07354 3.6146 4.63803 3.32698C5.27976 3 6.11984 3 7.8 3Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </a>
                                {% endif %}  
                              {% endif %}
                              <div class="{% if object_list.count < 3 and forloop.counter == object_list.count %}dropup{% else %}dropdown{% endif %}">
                                <button 
                                  {% if forloop.counter == 1  %}
                                    data-tg-title="Mais opções agrupadas" 
                                    data-tg-order="2" 
                                    data-tg-tour="Acesse outros recursos como edição, relatórios e impressão do instrumento avaliativo." 
                                    data-tg-group="default-exam-list"
                                  {% endif  %}
                                  class="tw-inline-flex tw-w-full tw-justify-center tw-gap-x-1.5 tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-[#667085] tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50" 
                                  type="button" 
                                  id="dropdownMenuButton-{{ exam.pk }}" 
                                  data-toggle="dropdown" 
                                  aria-haspopup="true" 
                                  aria-expanded="false"
                                >
                                  Opções
                                  <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                                  </svg>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-{{ exam.pk }}" style="font-size: inherit;">
                                  <div class="tw-flex tw-gap-1">
                                  <div class="tw-py-1" role="none">
                                    <p class="tw-px-4 tw-py-2" style="font-size: 10px; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Inter UI', Roboto, sans-serif; letter-spacing: .7px; color: #8392a5; text-transform: uppercase;">
                                      Geral
                                    </p>
                                    
                                    {% if user|has_perm:'exams.change_exam' %}
                                      {% if user_type == 'coordination' %}
                                        <a href="{% url 'exams:exams_update' pk=exam.pk %}{{request|cleaned_params}}" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">
                                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                          </svg>
                                          Editar caderno
                                        </a>
                                        <a href="{% url 'exams:exam_review' pk=exam.pk %}{{request|cleaned_params}}" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                                            <path d="M20 6L9 17L4 12" stroke-linecap="round" stroke-linejoin="round"/>
                                          </svg>
                                          Revisar caderno
                                        </a>
                                      {% endif %}
                                    {% endif %}
                                    {% if user_type == 'teacher' and exam.created_by == user and user.client_teachers_can_elaborate_exam %}
                                      <a href="{% url 'exams:exam_teacher_update' exam.pk %}?v=2" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                                        Editar lista
                                      </a>
                                    {% endif %}
                                    {% if user_type != 'student' and user_type != 'teacher' %}
                                      {% if user|has_perm:'exams.can_view_result_exam' %}
                                        <a {% if applications_count %}href="{% url 'exams:dash_exam_teacher_detail_questions' exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-3">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5m.75-9l3-3 2.148 2.148A12.061 12.061 0 0116.5 7.605" />
                                          </svg>
                                          Ver resultados
                                        </a>
                                      {% endif %}
                                    {% endif %}
                                    {% if user|has_perm:'applications.add_application' %}
                                      {%if user_type == "coordination" or user_type == 'teacher' and exam.created_by == user %}
                                      <a href="{% url 'applications:applications_create' %}?exam={{ exam.id }}" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                        </svg>
                                         {%if exam.category == 1 %} Aplicar lista {%else%} Criar aplicação {%endif%}
                                      </a>
                                      {%endif%}
                                    {%endif%}
                                    {% if user|has_perm:'exams.view_wrong' %}
                                      {% if not user_type == 'student' and exam.wrongs_count %}
                                        <a href="{% url 'exams:wrongs_list' %}?exam={{exam.id}}" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-4">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                                          Ver erratas
                                        </a>
                                        {% endif %}
                                      {% endif %}
                                    {% if user_type == 'coordination' or user_type == 'teacher' and exam.created_by == user and user.client_teachers_can_elaborate_exam %}

                                      {% if user|has_perm:'exams.can_duplicate_exam' %}
                                        <a href="javascript:void(0)" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-5" @click="confirmCancelCopy('{% url "exams:exams_copy" exam.pk %}', '{{exam.pk}}')">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 01-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 011.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 00-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 01-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 00-3.375-3.375h-1.5a1.125 1.125 0 01-1.125-1.125v-1.5a3.375 3.375 0 00-3.375-3.375H9.75" />
                                          </svg>
                                          Duplicar prova
                                        </a>
                                      {% endif %}
                                      {% if user|has_perm:'exams.delete_exam' %}
                                        <a href="javascript:void(0)" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-6" onClick="confirmCancel('{% url "exams:exams_delete" exam.pk %}')">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                          </svg>
                                          Remover
                                        </a>
                                      {% endif %}
                                    {% endif %}
                                    {% if questions_count > 0 %}
                                      <a href="{% url 'exams:exams_preview' pk=exam.pk %}" target="_blank" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-7">
                                        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        Visualizar prova
                                      </a>
                                    {% else %}
                                      {% if user_type == 'teacher' %}
                                          <a {% if exam.created_by == user %}href="{% url 'exams:exam_teacher_update' exam.id %}?v=2"{% else %}href="{% url 'core:redirect_dashboard' %}"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-8">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                                            Aguardando Questões
                                          </a>
                                      {% endif %}
                                    {% endif %}
                                  </div>
                                  
                                  {% if user|has_perm:'exams.can_correct_answers_exam' or user|has_perm:'exams.export_results_exam' %}
                                    <div class="tw-py-1" role="none">
                                      <p class="tw-px-4 tw-py-2" style="font-size: 10px; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Inter UI', Roboto, sans-serif; letter-spacing: .7px; color: #8392a5; text-transform: uppercase;">
                                        Relatório
                                      </p>
                                      {% if user|has_perm:'exams.can_correct_answers_exam' %}
                                        <a {% if applications_count %}href="{% url 'exams:exams_detail_v2' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-9">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                                          </svg>
                                          Relatório por aluno
                                        </a>
                                        {% if not user_type == 'student' %}
                                          <a {% if applications_count %}href="{% url 'exams:exams_detail_v2' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-10">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                              <path d="M17.9995 13L10.9995 6.00004M20.9995 21H7.99955M10.9368 20.0628L19.6054 11.3941C20.7935 10.2061 21.3875 9.61207 21.6101 8.92709C21.8058 8.32456 21.8058 7.67551 21.6101 7.07298C21.3875 6.388 20.7935 5.79397 19.6054 4.60592L19.3937 4.39415C18.2056 3.2061 17.6116 2.61207 16.9266 2.38951C16.3241 2.19373 15.675 2.19373 15.0725 2.38951C14.3875 2.61207 13.7935 3.2061 12.6054 4.39415L4.39366 12.6059C3.20561 13.794 2.61158 14.388 2.38902 15.073C2.19324 15.6755 2.19324 16.3246 2.38902 16.9271C2.61158 17.6121 3.20561 18.2061 4.39366 19.3941L5.06229 20.0628C5.40819 20.4087 5.58114 20.5816 5.78298 20.7053C5.96192 20.815 6.15701 20.8958 6.36108 20.9448C6.59126 21 6.83585 21 7.32503 21H8.67406C9.16324 21 9.40784 21 9.63801 20.9448C9.84208 20.8958 10.0372 20.815 10.2161 20.7053C10.418 20.5816 10.5909 20.4087 10.9368 20.0628Z" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                            Correção de respostas
                                          </a>
                                          <a {% if applications_count %}href="{% url 'exams:exams_detail_enunciation_v2' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-11">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                              <path d="M17.9995 13L10.9995 6.00004M20.9995 21H7.99955M10.9368 20.0628L19.6054 11.3941C20.7935 10.2061 21.3875 9.61207 21.6101 8.92709C21.8058 8.32456 21.8058 7.67551 21.6101 7.07298C21.3875 6.388 20.7935 5.79397 19.6054 4.60592L19.3937 4.39415C18.2056 3.2061 17.6116 2.61207 16.9266 2.38951C16.3241 2.19373 15.675 2.19373 15.0725 2.38951C14.3875 2.61207 13.7935 3.2061 12.6054 4.39415L4.39366 12.6059C3.20561 13.794 2.61158 14.388 2.38902 15.073C2.19324 15.6755 2.19324 16.3246 2.38902 16.9271C2.61158 17.6121 3.20561 18.2061 4.39366 19.3941L5.06229 20.0628C5.40819 20.4087 5.58114 20.5816 5.78298 20.7053C5.96192 20.815 6.15701 20.8958 6.36108 20.9448C6.59126 21 6.83585 21 7.32503 21H8.67406C9.16324 21 9.40784 21 9.63801 20.9448C9.84208 20.8958 10.0372 20.815 10.2161 20.7053C10.418 20.5816 10.5909 20.4087 10.9368 20.0628Z" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                            Correção por enunciado
                                          </a>
                                          
                                          {% if user.client_has_essay_system %}
                                            <a {% if not exam.has_essay_questions %}href="#" @click="alertExamNoEssayQuestion()"{% elif applications_count %}href="{% url 'exams:exams_detail_essay' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-11">
                                              <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                                <path d="M17.9995 13L10.9995 6.00004M20.9995 21H7.99955M10.9368 20.0628L19.6054 11.3941C20.7935 10.2061 21.3875 9.61207 21.6101 8.92709C21.8058 8.32456 21.8058 7.67551 21.6101 7.07298C21.3875 6.388 20.7935 5.79397 19.6054 4.60592L19.3937 4.39415C18.2056 3.2061 17.6116 2.61207 16.9266 2.38951C16.3241 2.19373 15.675 2.19373 15.0725 2.38951C14.3875 2.61207 13.7935 3.2061 12.6054 4.39415L4.39366 12.6059C3.20561 13.794 2.61158 14.388 2.38902 15.073C2.19324 15.6755 2.19324 16.3246 2.38902 16.9271C2.61158 17.6121 3.20561 18.2061 4.39366 19.3941L5.06229 20.0628C5.40819 20.4087 5.58114 20.5816 5.78298 20.7053C5.96192 20.815 6.15701 20.8958 6.36108 20.9448C6.59126 21 6.83585 21 7.32503 21H8.67406C9.16324 21 9.40784 21 9.63801 20.9448C9.84208 20.8958 10.0372 20.815 10.2161 20.7053C10.418 20.5816 10.5909 20.4087 10.9368 20.0628Z" stroke-linecap="round" stroke-linejoin="round" />
                                              </svg>
                                              Correção de redação
                                            </a>
                                          {% endif %}
                                            
                                        {% endif %}
                                        <a {% if applications_count %}href="{% url 'exams:exams_detail_enunciation_v2' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-12">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zM3.75 12h.007v.008H3.75V12zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm-.375 5.25h.007v.008H3.75v-.008zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                                          </svg>
                                          Relatório por enunciado
                                        </a>
                                      {% endif %}
                                      {% if user|has_perm:'exams.export_results_exam' %}
                                       
                                      
                                      
                                      {% comment %}
                                      <!--- comentado para desativar tela de exportação que não usa celery --->
                                      <a {% if applications_count %}href="{% url 'exports:exam_export' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-13">
                                        {% endcomment %}
                                        <a {% if applications_count %}href="{% url 'exports:exams_export_erp' %}?q_exam_id={{exam.pk}}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-13">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path d="M21 6H17.8C16.1198 6 15.2798 6 14.638 6.32698C14.0735 6.6146 13.6146 7.07354 13.327 7.63803C13 8.27976 13 9.11984 13 10.8V12M21 6L18 3M21 6L18 9M10 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V14" stroke-linecap="round" stroke-linejoin="round" />
                                          </svg>
                                          Exportar dados (Verão nova)
                                        </a>
                                        <a {% if applications_count %}href="{% url 'exports:exam_export' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-13">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path d="M21 6H17.8C16.1198 6 15.2798 6 14.638 6.32698C14.0735 6.6146 13.6146 7.07354 13.327 7.63803C13 8.27976 13 9.11984 13 10.8V12M21 6L18 3M21 6L18 9M10 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V14" stroke-linecap="round" stroke-linejoin="round" />
                                          </svg>
                                          Exportar dados (Versão antiga)
                                        </a>
                                        {% if exam.has_text_correction_questions %}
                                          <a {% if applications_count %}href="{% url 'exports:exams_export_essay' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-14">
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                              <path d="M21 6H17.8C16.1198 6 15.2798 6 14.638 6.32698C14.0735 6.6146 13.6146 7.07354 13.327 7.63803C13 8.27976 13 9.11984 13 10.8V12M21 6L18 3M21 6L18 9M10 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V14" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                            Exportar notas de redações
                                          </a>
                                        {% endif %}
                                        {% if exam.has_file_answers and user_type == 'coordination' %}
                                          <a href="#" data-exam-id="{{ exam.pk }}" data-exam-name="{{ exam }}" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-14">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                              <path d="M21 6H17.8C16.1198 6 15.2798 6 14.638 6.32698C14.0735 6.6146 13.6146 7.07354 13.327 7.63803C13 8.27976 13 9.11984 13 10.8V12M21 6L18 3M21 6L18 9M10 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V14" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                            Exportar respostas de anexo
                                          </a>
                                        {% endif %}
                                      {% endif %}
                                    </div>
                                  {% endif %}
                                    
                                  {% if user|has_perm:'exams.can_print_exam' or user|has_perm:'exams.can_diagram_exam' %}
                                    <div class="py-1" role="none">
                                      <p class="tw-px-4 tw-py-2" style="font-size: 10px; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Inter UI', Roboto, sans-serif; letter-spacing: .7px; color: #8392a5; text-transform: uppercase;">
                                        Impressão
                                      </p>
                                      {% if user|has_perm:'exams.can_print_exam' %}
                                        <a href="javascript:void(0)" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-14" @click="changeIsPrinted('{{exam.urls.change_is_printed}}')">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.125 2.25h-4.5c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125v-9M10.125 2.25h.375a9 9 0 019 9v.375M10.125 2.25A3.375 3.375 0 0113.5 5.625v1.5c0 .621.504 1.125 1.125 1.125h1.5a3.375 3.375 0 013.375 3.375M9 15l2.25 2.25L15 12" />
                                          </svg>
                                          {% if exam.is_printed %}
                                            Não foi impresso
                                          {% else %}
                                            Já foi impresso
                                          {% endif %}
                                        </a>
                                        {% if not exam.is_printed %}
                                          <a href="javascript:void(0)" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-15" @click="getPrintDefaults(), getExamPrintConfigs('{{exam.urls.print_configs}}').finally(() => openConfigurePrintModal(`{% url 'exams:exam_print' pk=exam.pk %}`))">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z" />
                                            </svg>
                                            Imprimir caderno
                                          </a>
                                        {% endif %}
                                        {% if user|has_perm:'exams.print_template_exam' %}
                                          <a 
                                            class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" 
                                            role="menuitem" 
                                            tabindex="-1" 
                                            id="menu-item-17" 
                                            {% if exam.is_randomized %}
                                              href="{% url 'exams:exam_randomized_template_print' pk=exam.pk %}"
                                              target="_blank"
                                            {% else %}
                                                href="javascript:void(0)" 
                                                @click="getExamPrintConfigs('{{exam.urls.print_configs}}').finally(() => openConfigurePrintModal(`{% url 'exams:exam_template_print' pk=exam.pk %}`, '#configureTemplatePrintModal', 'configure_template_print_form_id'))"
                                            {% endif %}
                                          >
                                              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                              </svg>
                                              Gabarito para divulgação
                                          </a>
                                        {% endif %}
                                      {% endif %}

                                      {% if user|has_perm:'exams.can_diagram_exam' %}
                                        {% if user_type == 'teacher' %}
                                          <a {% if exam.is_printed %}@click="diagramationErro()"{% else %}href="{% url 'exams:exam-print-v2' pk=exam.pk %}"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-16">
                                            <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                                            </svg>
                                            Diagramar caderno
                                          </a>
                                        {% endif %}
                                      {% endif %}

                                      {% if user.client_has_realms_integration and user_type == 'coordination' %}
                                        <a @click="syncRealms('{{exam.id}}')" href="#" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-16">
                                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" width="16" height="16" style="margin-right: 0.3rem;">
                                            <path d="M8 16L12 12M12 12L16 16M12 12V21M20 16.7428C21.2215 15.734 22 14.2079 22 12.5C22 9.46243 19.5376 7 16.5 7C16.2815 7 16.0771 6.886 15.9661 6.69774C14.6621 4.48484 12.2544 3 9.5 3C5.35786 3 2 6.35786 2 10.5C2 12.5661 2.83545 14.4371 4.18695 15.7935" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          </svg>
                                          Sincronizar com CMSP
                                        </a>
                                      {% endif %}
                                    </div>
                                  {% endif %}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </td>
                        </tr>
                      {% endwith %}
                    {% empty %}
                      <tr>
                        <td colspan="4"><p class="tw-py-4">Não há cadernos cadastrados</p></td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        {% include 'redesign/includes/pagination.html' %}
      </div>
    </div>
  </div>
</div>
{% endblock content-fixed %}

{% block slide-over %}
<div class="tw-relative tw-z-[1000] tw-off-canvas tw-off-canvas-right tw-invisible" aria-labelledby="slide-over-title" role="dialog" aria-modal="true" id="right-off-canvas">
  <div class="tw-fixed tw-inset-0 tw-bg-[#9BA3AF] tw-bg-opacity-60 tw-transition-opacity"></div>
  <div class="tw-fixed tw-inset-0 tw-overflow-hidden">
    <div class="tw-absolute tw-inset-0 tw-overflow-hidden">
      <div class="tw-pointer-events-none tw-fixed tw-inset-y-0 tw-right-0 tw-flex tw-max-w-full tw-pl-10" v-click-outside="onClickOutsideFilters">
        <div class="tw-pointer-events-auto tw-w-screen tw-max-w-xs" v-if="filters.list.length > 0">
          <div class="tw-flex tw-h-full tw-flex-col tw-overflow-y-scroll tw-bg-[#F9FAFA] tw-py-6 tw-shadow-xl">
            <div class="tw-px-4 sm:tw-px-6">
              <h2 class="tw-text-base tw-font-semibold tw-leading-6 tw-text-gray-900">
                Filtros salvos
              </h2>
            </div>
            <div class="tw-px-4 sm:tw-px-6 tw-mb-5">
              <label for="id-search-filter" class="tw-sr-only">Pesquisar</label>
              <div class="tw-relative tw-mt-6 tw-flex-1">
                <div class="tw-relative tw-mt-2 tw-rounded-md tw-shadow-sm">
                  <input type="text" name="search-filter" id="id-search-filter" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pr-10 tw-text-gray-900 tw-bg-transparent tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Pesquisar filtro" v-model="searchFilter" />
                  <div class="tw-pointer-events-none tw-absolute tw-inset-y-0 tw-right-0 tw-flex tw-items-center tw-pr-3">
                    <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-h-5 tw-w-5 tw-text-gray-400" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                    </svg>
                  </div>
                </div>
              </div>
            </div>
            <div class="tw-space-y-3 tw-px-4 sm:tw-px-6">
              <div class="tw-bg-white tw-border tw-rounded" v-for="filter in filteredList">
                <div class="tw-px-2 tw-py-5 sm:tw-px-4">
                  <div class="tw-flex tw-space-x-3 tw-mb-3">
                    <div class="tw-min-w-0 tw-flex-1">
                      <p class="tw-text-sm tw-font-semibold tw-text-gray-900">
                        ${ filter.name }
                      </p>
                    </div>
                    <div class="tw-flex tw-flex-shrink-0 tw-self-center">
                      <div class="tw-relative tw-inline-block tw-text-left">
                        <button type="button" class="tw--m-2 tw-flex tw-items-center tw-rounded-full tw-p-2 tw-text-gray-400 hover:tw-text-gray-600" :id="`dropdownMenuButton-${ filter.id }`" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          <span class="tw-sr-only">Open options</span>
                          <svg class="tw-h-5 tw-w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                            <path d="M10 3a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM10 8.5a1.5 1.5 0 110 3 1.5 1.5 0 010-3zM11.5 15.5a1.5 1.5 0 10-3 0 1.5 1.5 0 003 0z" />
                          </svg>
                        </button>
                        <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-w-56 tw-origin-top-right tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none" role="menu" aria-orientation="vertical" :aria-labelledby="`dropdownMenuButton-${ filter.id }`" tabindex="-1">
                          <div class="tw-py-1" role="none">
                            <button type="button" class="tw-text-gray-700 tw-flex tw-px-4 tw-py-2 tw-text-sm tw-w-full hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-0-item-0" @click="applyFilter(`${filter.fullUrl}&selected_filter=${filter.id}`)">
                              <span>Aplicar filtro</span>
                            </button>
                            <button type="button" class="tw-text-gray-700 tw-flex tw-px-4 tw-py-2 tw-text-sm tw-w-full hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-0-item-1" @click="removeDefaultFilter(filter)">
                              <span>Deletar filtro</span>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="tw-space-y-2">
                    <span class="tw-inline-flex tw-items-center tw-justify-between tw-gap-x-0.5 tw-rounded-md tw-bg-[#F9FAFA] tw-px-3 tw-py-2 tw-text-sm tw-font-medium tw-text-[#667085] tw-w-full" v-for="filter in filters.parseParamsInLabels(filter.params)" v-html="filter" v-if="filter.length">
                      <!-- <span>Disciplina do caderno</span><span>1</span> -->
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="tw-pointer-events-auto tw-w-screen tw-max-w-md">
          <div class="tw-flex tw-h-full tw-flex-col tw-divide-y tw-divide-gray-200 tw-bg-white tw-border-l">
            <div class="tw-h-0 tw-flex-1 tw-overflow-y-auto">
              <div class="tw-px-4 tw-pt-6 sm:tw-px-6">
                <div class="tw-flex tw-items-center tw-justify-between">
                  <h2 class="tw-text-base tw-font-semibold tw-leading-6 tw-text-gray-900" id="slide-over-title">
                    Filtrar cadernos
                  </h2>
                  <div class="tw-ml-3 tw-flex tw-h-7 tw-items-center">
                    <button type="button" class="tw-relative tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2 tw-off-canvas-close" id="headlessui-slider-over-close-button-1">
                      <span class="tw-absolute tw--inset-2.5"></span>
                      <span class="tw-sr-only">Close panel</span>
                      <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="tw-mt-1">
                  <p class="tw-text-sm tw-text-gray-500">
                    Adiciona abaixo os filtros que você deseja aplicar na listagem abaixo.
                  </p>
                </div>
              </div>
              <form id="filterForm" method="GET" class="tw-flex tw-flex-1 tw-flex-col tw-justify-between">
                <input type="hidden" value="{{ year|force_escape }}" name="year" />
                <div class="tw-divide-y tw-divide-gray-200 tw-px-4 sm:tw-px-6">
                  <div class="tw-space-y-6 tw-pb-5 tw-pt-6">
                    <div>
                      <label for="exam_name_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Nome do caderno</label>
                      <div class="tw-mt-2">
                        <input type="text" id="exam_name_id" name="q_name" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" value="{{ q_name }}" placeholder="Digite o nome da prova aqui" />
                      </div>
                    </div>
                    <div>
                      <label for="status_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Situação do caderno</label>
                      <div class="tw-mt-2">
                        <select id="status_id" name="q_status" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" multiple="multiple">
                          <option value="0" {% if '0' in q_status %}selected="selected"{% endif %}>Elaborando</option>
                          <option value="1" {% if '1' in q_status %}selected="selected"{% endif %}>Análise de Itens</option>
                          <option value="3" {% if '3' in q_status %}selected="selected"{% endif %}>Revisão Gráfica</option>
                          <option value="4" {% if '4' in q_status %}selected="selected"{% endif %}>Revisão de Texto</option>
                          <option value="6" {% if '6' in q_status and user.questions_configuration.can_add_revision_after_closing_exam %}selected="selected"{% endif %}>Revisão de PDF</option>
                          <option value="2" {% if '2' in q_status %}selected="selected"{% endif %}>Fechada</option>
                          <option value="5" {% if '5' in q_status %}selected="selected"{% endif %}>Pronto para impressão</option>

                        </select>
                      </div>
                    </div>
                    <div>
                      <label for="id_category" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Categoria</label>
                      <div class="tw-mt-2">
                        <select id="id_category" name="category" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                          <option value=""></option>
                          <option value="exam" {% if category == 'exam' %}selected="selected"{% endif %}>Caderno de prova</option>
                          <option value="homework" {% if category == 'homework' %}selected="selected"{% endif %}>Lista de Exercício</option>
                        </select>
                      </div>
                    </div>

                    <div>
                      <label for="segment_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Coordenações/Segmentos</label>
                      <div class="tw-mt-2">
                        <select id="segment_id" name="q_segments" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" multiple="multiple">
                          <option value="1" {% if '1' in q_segments %}selected="selected"{% endif %}>
                            Anos iniciais
                          </option>
                          <option value="2" {% if '2' in q_segments %}selected="selected"{% endif %}>
                            Anos finais
                          </option>
                          <option value="0" {% if '0' in q_segments %}selected="selected"{% endif %}>
                            Ensino médio
                          </option>
                        </select>
                      </div>
                    </div>
                    <div>
                      <label for="unit_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Unidades</label>
                      <div class="tw-mt-2">
                        <select id="unit_id" name="q_units" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" multiple="multiple">
                          {% for unit in units %}
                            <option value="{{ unit.pk }}" {% if unit.pk|stringformat:'s' in q_units %}selected="selected"{% endif %}>
                              {{ unit }}
                            </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>

                    <div>
                      <label for="subject_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Disciplinas do caderno</label>
                      <div class="tw-mt-2">
                        <select id="subject_id" name="q_subjects" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" multiple="multiple">
                          {% for subject in subjects %}
                            <option value="{{ subject.pk }}" {% if subject.pk|stringformat:'s' in q_subjects %}selected="selected"{% endif %}>
                              {{ subject.name }} > {{ subject.knowledge_area__name }}
                            </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div>
                      <label for="grade_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Séries</label>
                      <div class="tw-mt-2">
                        <select id="grade_id" name="q_grades" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" multiple="multiple">
                          {% for grade in grades %}
                            <option value="{{ grade.pk }}" {% if grade.pk|stringformat:'s' in q_grades %}selected="selected"{% endif %}>
                              {{ grade }}
                            </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div>
                      <label for="teaching_stage_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Etapa de ensino</label>
                      <div class="tw-mt-2">
                        <select id="teaching_stage_id" name="q_teaching_stages" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" multiple="multiple">
                          {% for stage in teaching_stages %}
                            <option value="{{ stage.pk }}" {% if stage.pk|stringformat:'s' in q_teaching_stages %}selected="selected"{% endif %}>
                              {{ stage }}
                            </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <div>
                      <label for="education_system_id" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Sistema de ensino</label>
                      <div class="tw-mt-2">
                        <select id="education_system_id" name="q_education_systems" class="tw-mt-2 tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" multiple="multiple">
                          {% for system in education_systems %}
                            <option value="{{ system.pk }}" {% if system.pk|stringformat:'s' in q_education_systems %}selected="selected"{% endif %}>
                              {{ system }}
                            </option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    {% if user.client_teachers_can_elaborate_exam %}
                      <div class="custom-control custom-switch">
                        <input {% if q_created_by %}checked="checked"{% endif %} type="checkbox" id="created_by_id" name="q_created_by" class="custom-control-input" />
                        <label class="custom-control-label" for="created_by_id">Elaborado por mim</label>
                      </div>
                    {% endif %}
                    <div class="custom-control custom-switch">
                      <input {% if q_has_questions %}checked="checked"{% endif %} type="checkbox" id="has_questions_id" name="q_has_questions" class="custom-control-input" />
                      <label class="custom-control-label" for="has_questions_id">Caderno com questões</label>
                    </div>
                    <div class="custom-control custom-switch">
                      <input type="checkbox" id="is_unprecedented" name="q_is_unprecedented" class="custom-control-input" {% if q_is_unprecedented %}checked="checked"{% endif %} />
                      <label class="custom-control-label" for="is_unprecedented">Caderno inéditos</label>
                    </div>
                    <div class="custom-control custom-switch">
                      <input type="checkbox" id="has_wrongs_await" name="q_has_wrongs_await" class="custom-control-input" {% if q_has_wrongs_await %}checked="checked"{% endif %} />
                      <label class="custom-control-label" for="has_wrongs_await">Erratas aguardando revisão</label>
                    </div>
                    <div class="custom-control custom-switch">
                      <input type="checkbox" id="id_unanswered" name="q_unanswered" class="custom-control-input" {% if q_unanswered %}checked="checked"{% endif %} />
                      <label class="custom-control-label" for="id_unanswered">Cadernos aguardando correção</label>
                    </div>
                    <div class="custom-control custom-switch">
                      <input type="checkbox" id="is_printed_id" name="q_is_printed" class="custom-control-input" {% if q_is_printed %}checked="checked"{% endif %} />
                      <label class="custom-control-label" for="is_printed_id">Cadernos que já foram impressos</label>
                    </div>
                    <div class="custom-control custom-switch">
                      <input type="checkbox" id="is_late_id" name="q_is_late" class="custom-control-input" {% if q_is_late %}checked="checked"{% endif %} />
                      <label class="custom-control-label" for="is_late_id">Apenas cadernos atrasados</label>
                    </div>
                  </div>
                </div>
              </form>
            </div>
            <div class="tw-flex tw-flex-wrap tw-space-y-3 sm:tw-space-x-3 sm:tw-space-y-0 tw-px-4 tw-py-4">
              <button type="submit" class="tw-inline-flex tw-w-full tw-flex-shrink-0 tw-items-center tw-justify-center tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600 sm:tw-flex-1" v-if="!filters.createNewFilter" form="filterForm">
                Aplicar filtro
              </button>
              <template v-if="filters.selected">
                <button type="button" class="tw-inline-flex tw-w-full tw-flex-1 tw-items-center tw-justify-center tw-rounded-md tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-primary-600 tw-border tw-border-primary-600 tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600" @click="saveFilter(filters.selected)">
                  Atualizar filtro padrão
                </button>
              </template>
              <template v-else>
                <button type="button" class="tw-inline-flex tw-w-full tw-flex-1 tw-items-center tw-justify-center tw-rounded-md tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-primary-600 tw-border tw-border-primary-600 tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600" @click="saveFilter()">
                  Criar filtro padrão
                </button>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock slide-over %}

{% block extra-modal %}

{% include 'includes/confirm_modal.html' %}

{% include 'dashboard/exams/includes/exam/confirm_duplicate_exam.html' %}

<div aria-hidden="true" class="modal  fade" id="configurePrintModal" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Configure a impressão de prova</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form id="configure_print_form_id" action="" method="get" target="_blank">
      <div class="modal-body" style="max-height: fit-content; height: fit-content;">
        {% include 'dashboard/exams/includes/exam/print/modal_print.html' %}
        <div class="custom-control custom-switch mt-4">
          <input type="checkbox" id="no_disclosed_id" name="print_correct_answers" v-model="examPrintConfig.printWithCorrectAnswers" class="custom-control-input" value="1">
          <label class="custom-control-label" for="no_disclosed_id">
          <h6 class="mb-0">Imprimir prova gabaritada<span class="badge badge-danger ml-1">Atenção</span></h6>
          </label>
          <small class="form-text text-muted mt-0">
            Selecione essa opção se deseja imprimir a <br/>prova com o gabarito inserido.
          </small>
        </div>
      </div>
      <div class="modal-footer">
          <div class="form-buttons-w text-right">
            <button class="btn btn-primary not-disable" type="submit">
              <i class="os-icon os-icon-check"></i>
              <span>Imprimir prova</span>
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<div aria-hidden="true" class="modal fade" id="defaultFilters" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-truncate" id="modal-exam-export-title">Lista com seus filtros</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table class="table" id="datatableFilters">
          <thead>
            <tr>
              <th class="bg-white">Detalhes do filtro padrão</th>
              <th>Opções</th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="filter in filters.list">
              <td style="max-width: 560px;">
                <strong class="mr-1">${filter.name}</strong>
                <div class="table-responsive">
                  <div class="d-flex">
                    <span class="badge badge-primary rounded-pill m-1 d-flex align-items-center" v-for="filter in filters.parseParamsInLabels(filter.params)" v-html="filter" v-if="filter.length"></span>
                  </div>
                </div>
              </td>
              <td class="align-middle text-right" style="background-color: #f3f4f7;">
                <span class="badge badge-success tx-12 cp tooltips align-self-middle" v-if="filters.selected != filter" data-tippy-content="Aplicar o filtro padrão" @click="window.location.href = `${filter.fullUrl}`"><i class="fas fa-check"></i> Aplicar filtro</span>
                <span class="badge badge-danger tx-12 cp tooltips ml-1 align-self-middle" data-tippy-content="Clique para deletar o filtro padrão." @click="removeDefaultFilter(filter)"><i class="fas fa-times"></i> Deletar filtro</span>
              </td>
            </tr>
            <tr v-if="!filters.list.length">
              <td colspan="2">Nenhum filtro padrão encontrado</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer justify-content-center"></div>
    </div>
  </div>
</div>

<div aria-hidden="true" class="modal  fade" id="exportAttachmentsModal" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-truncate" id="modal-exam-export-title"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="max-height: fit-content; height: fit-content;">
        <div id="exporting-info">
          <h6>Exportação em andamento... <i class="fas fa-spinner fa-spin text-primary mt-2"></i></h6>
          <p>Mantenha esta janela aberta enquanto geramos o link para download.</p>
        </div>
        <div id="exported-info" class="d-none">
          <p>Você pode baixar o arquivo ZIP com as respostas de anexo clicando no botão abaixo:</p>
          <a href="#" target="_blank" id="download-attachments-url" class="btn btn-primary btn-block">
            <i class="fas fa-download"></i>
              Baixar respostas
          </a>
        </div>
        <div id="exported-error" class="d-none">
          <p class="text-danger">Um erro aconteceu no processo de exportação. Tente novamente mais tarde.</p>
        </div>
      </div>
      <div class="modal-footer justify-content-center"></div>
    </div>
  </div>
</div>

<div aria-hidden="true" class="modal fade" id="configureTemplatePrintModal" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">Configure a impressão do gabarito</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      <form id="configure_template_print_form_id" action="" method="get" target="_blank">
          <div class="modal-body" style="max-height: fit-content; height: fit-content;">            
            <h6>Tipo de colunas:</h6>
            <div class="btn-group btn-group-toggle mb-3" data-toggle="buttons">
                <label class="btn btn-outline-primary btn-lg active">
                <input type="radio" name="separate_subjects" id="separate_subjects_default" value="0" autocomplete="off" checked>
                    <i class="fas fa-file fa-lg"></i>
                    Sequencial 
                </label>
                <label class="btn btn-outline-primary btn-lg">
                <input type="radio" name="separate_subjects" id="separate_subjects_" value="1" autocomplete="off">
                    <i class="fas fa-copy fa-lg"></i>
                    Agrupado por disciplina
                </label>
            </div>
            <div class="modal-footer">
                <div class="form-buttons-w text-right">
                <button class="btn btn-primary not-disable" type="submit">
                    <i class="os-icon os-icon-check"></i>
                    <span>Imprimir Gabarito</span>
                </button>
                </div>
            </div>
          </div>
      </form>
    </div>
  </div>
</div>

<div aria-hidden="true" class="modal fade" id="searchProof" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title">Pesquisar comprovante de resposta</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-12">
            <p class="mb-2">Digite o código do comprovante</p>
            <input type="search" class="form-control" @keyup="searchProof" ref="searchProofInput">
          </div>
          <div class="col-12 my-4" v-if="proofs.length">
            <table class="table">
              <thead>
                <tr>
                  <th>Código</th>
                  <th>Aluno</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="proof in proofs">
                  <td class="tx-bold text-uppercase">#${proof.code}</td>
                  <td>${proof.student_name}</td>
                  <td>
                    <a :href="getUrl(urls.proofDetail, proof.id)" target="_blank" class="btn btn-primary btn-sm"><i class="fas fa-receipt"></i> Ver Comprovante</a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% if user.client_has_realms_integration and user_type == 'coordination' %}
<div aria-hidden="true" class="modal  fade" id="syncRealms" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Integração CMSP</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="max-height: fit-content; height: fit-content;">
        <div class="text-center" v-if="realms.status == 'loading'">
          <i class="fas fa-spinner fa-spin text-primary"></i> Aguarde enquanto este caderno está sendo sincronizado com o CMSP
        </div>
        <div v-if="realms.status == 'success'">
          <i class="fas fa-check-circle text-primary"></i> Sincronização concluída com sucesso!
        </div>
        <div v-if="realms.status == 'error'">
          <i class="fas fa-exclamation-circle text-danger"></i> Erro no processo de sincronização
          <p class="mt-2 text-muted">${realms.apiResponse}</p>
        </div>
      </div>
      <div class="modal-footer" v-if="realms.status != 'loading'">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock extra-modal %}

{% block js-additional %}
<script src="{% static 'administration/lib/bootstrap-tagsinput/bootstrap-tagsinput.min.js' %}"></script>
<script src="{% static 'administration/lib/select2/js/select2.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.20/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="{% static 'js/tippy/popper.min.js' %}"></script>
<script src="{% static 'js/tippy/tippy.min.js' %}"></script>
<script src="{% static 'administration/lib/datatables.net-responsive-dt/js/responsive.dataTables.min.js' %}"></script>
<script src="{% static 'administration/lib/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="https://unpkg.com/@sjmc11/tourguidejs/dist/tour.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
  var app = new Vue({
    delimiters: ['${', '}'],
    components: {
      {% include 'includes/components/vue-filters.html' %}
    },
    el: '#app',
    data: {
      exams: [
        {% for exam in object_list %}
          { 
            pk: "{{ exam.pk }}", 
            status: {{ exam.status }},
            questionStatusWithAi:  "{{ exam.question_status_with_ai }}",
            copyExamWithIACount: {{ exam.copy_exam_with_ia_count }},
            copyExamWithIaStatus: {{ exam.copy_exam_with_ia_status }},
            examUsedForCopying:  "{{ exam.exam_used_for_copying }} ",
            newPercentageStatusQuestionsOtherQuestions: {{exam.new_percentage_status_questions.other_questions_percentage}},
            questionCount: {{exam.count_availables_questions}},
            existBag: null,
          },
        {% endfor %}
      ],
      canAddRevisionAfterClosingExam: {{ user.questions_configuration.can_add_revision_after_closing_exam|lower|default:"false" }},
      getExamByPk(pk) {
        return this.exams.find((exam) => exam.pk === pk);
      },
      teste:  "nada",
      updateStatusFetchStatus: 'idle',
      searchFilter: '',
      filters: {
        selected: null,
        list: [],
        createNewFilter: false,
        selectedParams: '',
        parseParamsInLabels(params) {
          let query = {}, labels = [];
          let pairs = (params[0] === '?' ? params.substr(1) : params).split('&');
          for (var i = 0; i < pairs.length; i++) {
            var pair = pairs[i].split('=');
            query[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1] || '');
          }
          for(key in query) {
            if(query[key]) {
              const count = params.match(new RegExp(`\\b(${key})\\b`, 'g')).length;
              let input = $(`[name="${key}"]`), inputId = input.attr('id'), label = `${$(`[for="${inputId}"]`).text()}`
              if(input.prop('type') == 'select-multiple') {
                label += `: <span class="badge badge-dark rounded-circle">${count}</span>`
              } else {
                if(input.prop('type') == 'select-one') {
                  label += `: ${input.find(`option[value=${query[key]}]`).text()}`
                }
                if(input.prop('type') == 'text') {
                  label += `: ${query[key]}`
                }
              }
              labels.push(label)
            }
          }
          return labels
        },
        labels() {
          let labels = []
          
          $('#filterForm').find('select, input').each((index, input) => {
            let values = [], showValues = true, showCount = false
            if(input.id) {
              if(input.type.includes('select')  ) {
                if(input.type == 'select-multiple') {
                  showCount = true
                }
                values = $(`#${input.id} option:selected`).toArray().map(item => item.text)
              }
              else if(input.type == 'checkbox' || input.type == 'radio') {
                value = $(`#${input.id}:checked`).val()
                if(value == 'on' || value === true) {
                  showValues = false
                  values.push(true)
                }
              } else {
                values.push($(`#${input.id}`).val())
              }
              if(values.filter(value => value).length) {
                labels.push({
                  name: $(`#${input.id}`).attr('name'),
                  label: $(`[for=${input.id}]`).text(),
                  showValues: showValues,
                  showCount: showCount,
                  values: values,
                })
              }
            }
          })
          return labels
        },
      },
      selectionList: [],
      elementsRemove: [],
      proofs: [],
      urls: {
        proofDetail: "{% url 'answers:proof_of_answers_coordination'  pk='00000000-0000-0000-0000-000000000000' %}"
      },
      examPrintConfigObject: {
        header: '',
        backgroundImage: '',
        customPages: [],
        headerFormat: 1,
        columnType: 0,
        kind: 0,
        textQuestionFormat: 1,
        lineHeight: 0,
        fontSize: 0,
        fontFamily: 0,
        printSubjectsName: false,
        printWithCorrectAnswers: false,
        hideAlternativesIndicator: false,
        hideQuestionsReferencies: false,
        hideKnowledgeAreasName: false,
        printBlackAndWhiteImages: false,
        hyphenate: false,
        discursiveLineHeight: 1,
      },
      examPrintConfig: {},
      printDefaults: [],
      duplicateMode: "no-copy-questions",
      loadedPrintDefaults: false,
      lastTask: {
        status: '',
        details: '',
      },
      reducedEnunciation: false,
      reducedQuantityAlternatives: false,
      reducedTextAlternatives: false,
      examPk:"",
      generatingCopy: false,
      showDiagrammingOptions: 0,
      realms: {
        status: 'idle',
        examId: '',
        apiResponse: '',
      }
    },
    methods: {
      handleUpdateStatus(examId, newStatus){
        this.checkExistBag(examId).then(exists => {
          if (!exists) {
            this.updateStatus(examId, newStatus);
          } else {
            Swal.fire({
              icon: 'warning',
              title: 'Atenção',
              text: 'Este caderno já possui um malote gerado e não poderá haver a revisão de PDF.',
            });
          }
        });
      },
      checkExistBag(examId) {
        let url = "{% url 'exams:exam_bag_existence_check' pk='00000000-0000-0000-0000-000000000000' %}"; 
        url = url.replace('00000000-0000-0000-0000-000000000000', examId); 
        
        return axios.get(url, {})
        .then((response) => {
            const exam = this.exams.find(e => e.pk === examId);
            if (exam) {
              return response.data.exists;
            }
        }).catch((error) => {
          console.log(error)
          return false;
        });
      },
      updateExamStatusCopyOnScreen(exam) {
        
        const statusElementPending = document.getElementById(`copy-exam-status-pending-${exam.pk}`);
        const statusElementFinished = document.getElementById(`copy-exam-status-finished-${exam.pk}`);
        
        if (exam.copyExamWithIaStatus == 1) {
            statusElementPending.classList.remove("tw-hidden");
            statusElementFinished.classList.add("tw-hidden");
        } else if (exam.copyExamWithIaStatus == 2) {
            statusElementFinished.classList.remove("tw-hidden");
            statusElementPending.classList.add("tw-hidden");
            old_exam = this.getExamByPk(exam.examUsedForCopying.trim())
            const otherProgressBar = document.querySelector(`#copy-exam-status-finished-${exam.pk} .tw-bg-yellow-500`);

            if (otherProgressBar) {
                otherProgressBar.style.width = `${old_exam.newPercentageStatusQuestionsOtherQuestions}%`;
            }
            const totalDeliveredPercentageElement = document.getElementById(`total-delivered-percentage-${exam.pk}`);
            if (totalDeliveredPercentageElement) {
                totalDeliveredPercentageElement.textContent = `${old_exam.newPercentageStatusQuestionsOtherQuestions}%`;
                totalDeliveredPercentageElement.classList.remove("tw-hidden");
            }
            const questionsCountElement = document.getElementById(`questions-count-${exam.pk}`);
            if (questionsCountElement) {
                questionsCountElement.textContent = `${old_exam.questionCount} questões`;
            }
        }
      },
      fetchExamCopyStatus(exam) {
        let url = `{% url 'exams:exam_copy_ia_task_status' %}?pk=${exam.examUsedForCopying.trim()}&export_version=${exam.copyExamWithIACount}`
        
        fetch(url)
        .then(response => response.json())
        .then(data => {
          switch (data.status) {
            case 'PENDING':
              console.log('PENDING')
              setTimeout(() => this.fetchExamCopyStatus(exam), 10000)
              break
            case 'STARTED':
              console.log('STARTED')
              setTimeout(() => this.fetchExamCopyStatus(exam), 10000)
              break
            case 'SUCCESS':
              exam.copyExamWithIaStatus = 2
              console.log('SUCCESS')
              break
            case 'FAILURE':

              break;
          }
          this.updateExamStatusCopyOnScreen(exam);

        })
      },
      updateExamStatusOnScreen(exam) {
        const statusElementPending = document.getElementById(`question-exam-status-pending-${exam.pk}`);
        const statusElementFinished = document.getElementById(`question-exam-status-finished-${exam.pk}`);
        if (exam.questionStatusWithAi ==  "pendente") {
            statusElementPending.classList.remove("tw-hidden")
            statusElementFinished.classList.add("tw-hidden")
        } else if  (exam.questionStatusWithAi ==  "concluido") {
            statusElementFinished.classList.remove("tw-hidden")
            statusElementPending.classList.add("tw-hidden")
        }
      },
      fetchStatus(exam){
        const url = `{% url 'exams:get_generate_question_ia_task_status' %}?exam_id=${exam.pk}`;
        fetch(url)
        .then(response => response.json())
          .then(data => {
            exam.questionStatusWithAi = data.status_exam
            this.updateExamStatusOnScreen(exam);
            switch (data.status_exam) {
              case 'pendente':
                setTimeout(() => this.fetchStatus(exam), 10000)
                break 
              case 'concluido':
                break
              case 'initial':
                break; 
            }

          })
      },
      removerFilter(filter){
        console.log(filter)
      },
      filterFormChanged() {
        let params = ''
        $('#filterForm').find('select, input').each((index, input) => {
          if(input.id) {
            if(input.type.includes('select')  ) {
              let name = $(`#${input.id}`).attr('name')
              let values = $(`#${input.id} option:selected`).toArray().map(item => item.value)
              if(values.length){
                values.forEach((value, index) => {
                  params += `${name}=${value}&`
                })
              }
            }else if(input.type == 'checkbox' || input.type == 'radio') {
              name = $(`#${input.id}`).attr('name')
              value = $(`#${input.id}:checked`).val()
              if(value == 'on' || value === true) {
                params += `${name}=true&`
              }
            } else {
              name = $(`#${input.id}`).attr('name')
              value = $(`#${input.id}`).val()
              if(value) {
                params += `${name}=${value}&`
              }
            }
          }
        })
        this.filters.selectedParams = params
      },
      alertExamNoAnswers(){
        Swal.fire({
          title: 'Erro',
          text: "Este caderno ainda não possui respostas associadas pois não foi usado em nenhuma aplicação",
          icon: 'warning',
          confirmButtonText: 'Voltar'
        })
      },
      alertExamNoEssayQuestion(){
        Swal.fire({
          title: 'Erro',
          text: "Este caderno não possiu questões do tipo redação.",
          icon: 'warning',
          confirmButtonText: 'Voltar'
        })
      },
      cleanFilter(year) {
        window.location.href = "{% url 'exams:exams_list' %}?year=" + year;
      },
      diagramationErro(){
        Swal.fire({
          title: 'Já impresso',
          text: 'Instrumentos avaliativos marcados como "já impresso" não podem ser diagramados.',
          icon: 'warning',
          confirmButtonText: 'Voltar'
        })
      },
      async syncRealms(examId){
        let taskId = ''
        this.realms.status = 'loading'
        $("#syncRealms"). modal();

        try {
            const response = await fetch("{% url 'integrations:realms-sync-exams' %}", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify([{ exam_id: examId}])
            });

            if (!response.ok) {
              throw new Error(`Erro ${response.status}: ${response.statusText}`)
            }

            const data = await response.json()
            taskId = data.task_id

        } catch (err) {
            console.error('Erro na requisição:', err.message);
            this.realms.status = 'error'
            this.realms.apiResponse = await response.json()
            return
        }

        let intervalId = setInterval(() => {
          const url = '{% url "core:get_generic_task_status" %}'
          fetch(`${url}?task_id=${taskId}`)
            .then(response => {
              if (response.ok) {
                return response.json()
              } else {
                throw new Error('Error')
              }
            })
            .then(data => {
              data.details = data.details.replace(/'/g, '"')
              const details = JSON.parse(data.details)

              if (data.status === 'SUCCESS') {
                clearInterval(intervalId)

                if (details.errors && details.errors > 0) {
                  this.realms.status = 'error'
                  this.realms.apiResponse = details.errors[0]
                } else {
                  this.realms.status = 'success'
                }
              }
              if (data.status === 'ERROR' || data.status === 'FAILURE') {
                clearInterval(intervalId)
                this.realms.status = 'error'
                this.realms.apiResponse = details.errors
              }
            })
            .catch(error => {
              console.error('Failed to fetch task status', error)
              clearInterval(intervalId)
            })
        }, 2000)
      },
      applyFilter(url) {
        window.location.href = url;
      },
      async updateStatus(pk, newStatus) {

        const url = "{% url 'api:exams-api:exam-update-status' exam_id='00000000-0000-0000-0000-000000000000' %}".replace('00000000-0000-0000-0000-000000000000', pk);

        this.updateStatusFetchStatus = 'loading';
        const res = await fetch(url, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: newStatus })
        })
        if (!res.ok) {
          this.updateStatusFetchStatus = 'error'
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        const data = await res.json()
        this.exams.find(exam => exam.pk === pk).status = data.status;
        this.updateStatusFetchStatus = 'success';
        const message = 'Situação alterada com sucesso!';
        this.showToast(`<div class="tw-pointer-events-auto tw-w-full tw-max-w-sm tw-overflow-hidden tw-rounded-lg tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5"><div class="tw-p-4"><div class="tw-flex tw-items-start"><div class="tw-flex-shrink-0"><svg class="tw-h-6 tw-w-6 tw-text-green-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><div class="tw-ml-3 tw-w-0 tw-flex-1 tw-pt-0.5"><p class="tw-text-sm tw-font-medium tw-text-gray-900">${message}</p></div></div></div><div class="tw-relative tw-h-1 tw-overflow-hidden tw--mt-1"><div id="toast-progressbar" class="tw-w-full tw-h-1 tw-rounded-b-md tw-bg-[#00000033]"></div></div></div>`);
      },
      getExamPrintConfigs(url) {
        return axios.get(url).then((response) => this.examPrintConfig = response.data)
      },
      openConfigurePrintModal(url, selector = "#configurePrintModal", formID = "configure_print_form_id") {

        document.getElementById(formID).action = url
        $(selector).modal("show")
      },
      removeFilter(filter) {
        const url = new URL(window.location.href);
        const urlParams = url.searchParams;
        urlParams.delete(filter.name);
        url.search = urlParams.toString();
        window.location.href = url.href;
  
      },
      confirmCancelCopy(url, exam_pk) {
        this.exam_pk = exam_pk
        document.getElementById('confirmCancelCopyFormId').action = url
        $("#confirmCancelCopyModal").modal("show")
      },
      activeCancelSelection(param) {
        if (param == true) {
          $("#btn-remove").show();
          $('.check-selection').show();
          $("#btn-cancel-selection").show();
          $("#btn-change-status").show();
          $('.selectbox').show();
          $("#btn-selection-all").hide();
        } else {
          $('.check-selection').hide();
          $("#btn-remove").hide();
          $("#btn-cancel-selection").hide();
          $("#btn-change-status").hide();
          $("#btn-selection-all").show();
          $('.selectbox').hide().prop('checked', false)
          this.selectionList = []
        }
      },
      removeAllSelected(){
        if (this.selectionList.length > 0){
          Swal.fire({
            title: 'Tem certeza?',
            text: "Você não será capaz de reverter isso!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sim, exclua!'
          }).then((result) => {
            if (result.isConfirmed) {
              this.selectionList.forEach((item, index) => {
                urls = "{% url 'exams:exams_api_delete_all' pk='00000000-0000-0000-0000-000000000000' %}"
                axios.delete(urls.replace("00000000-0000-0000-0000-000000000000", item ))
                .then(response => {
                  $(`#tr-${item}`).remove()
                  $(".selectbox").prop("checked", false)
                  this.selectionList = [];
                })
              }) 
            }
          })   
        } else {
          Swal.fire(
          'Atenção!',
          'Não há cadernos selecionados.',
          'warning'
          )
        }
      },
      changeAllStatus(){
        const inputOptions = {
          0: 'Elaborando',
          1: 'Análise de Itens',
          3: 'Revisão Gráfica',
          4: 'Revisão de Texto',
          2: 'Fechada',
          5: 'Pronto para impressão',
        };
        if (this.canAddRevisionAfterClosingExam){
          inputOptions[6] = 'Revisão de PDF';
        }
        if (this.selectionList.length > 0) {
          Swal.fire({
            title: 'Selecione uma situação',
            input: 'select',
            inputOptions: inputOptions,
            confirmButtonText: 'Alterar situação',
            cancelButtonText: 'Cancelar',
            showCancelButton: true,
          }).then((result) => {
            if(result.isConfirmed && result.value) {
              Swal.fire({
                icon: 'info',
                title: 'Aguarde um instante',
                text: 'Quando as alterações foram concluídas vamos atualizar sua página!',
                timer: 10000,
                timerProgressBar: true,
              })
              axios.patch("{% url 'exams:api-exam-change-status' %}", {
                ids: this.selectionList,
                status: result.value,
              }).then((response) => {
                this.activeCancelSelection()
                window.location.reload()
              })
            }
          })  
        }
      }, 
      searchProof: _.debounce(function() {
        self = this
        let text = self.$refs.searchProofInput
        if(text.value.length > 0) {
          axios.get(`{% url 'answers:api-proof-answers-list' %}?code=${text.value}`).then((response) => self.proofs = response.data)
        }
      }, 800), 
      getUrl(url, id) {
        return url.replace("00000000-0000-0000-0000-000000000000", id)
      },
      selectPrintDefault() {
        const id = $(this.$refs['inputPrintDefault']).children(":selected").attr("id")
        const printDefault = this.printDefaults.find(_default => _default.id == id)
        
        if(printDefault) {
          this.getConfig(printDefault).then((response) => {
            this.examPrintConfig = response.data
            this.selectedPrintDefault = response.data
          })
        } else { 
          this.selectedPrintDefault = null
          this.examPrintConfig = Object.assign({}, this.examPrintConfigObject)
        }
        this.printConfigControl = true

      },
      getConfig(printDefault) {
        return axios.get(printDefault.urls.getConfig)
      },
      getParamsSerialized() {
        let params = new URL(document.location).searchParams;
        return '?' + params.toString()
      },
      saveFilter(filter) {
        Swal.fire({
          title: this.filters.createNewFilter ? 'Nome para o filtro':'Nome do filtro',
          text: 'Digite um nome para facilitar a localização do filtro personalizado',
          input: 'text',
          inputValue: this.filters.selected ? this.filters.selected.name:'',
          focusConfirm: false,
          confirmButtonText: this.filters.createNewFilter ? "Criar filtro":"Atualizar filtro",
        }).then((result) => {
          if(result.isConfirmed && result.value) {
            if(filter) {
              window.history.pushState({}, '', `?${this.filters.selectedParams}&selected_filter=${filter.id}`)
              axios.patch(filter.urls.apiDetail, { name: result.value, params: this.filters.selectedParams}).then((response) => {
                this.alertTop('O filtro foi atualizado, e será aplicado')
                window.location.reload()
              }).catch((e) => {
                this.alertTop('Ocorreu um erro ao tentar atualizar o filtro, tente novamente, caso o erro persista entre em contato com o suporte', 'error')
              })
              return
            }
            const newFilter = {
              user: '{{user.id}}',
              name: result.value,
              url: '{{request.resolver_match.app_name}}:{{request.resolver_match.url_name}}',
              params: this.filters.selectedParams,
            }

            axios.post("{% url 'api:clients:custom-filters-list' %}", newFilter).then((response) => {
              window.history.pushState({}, '', `?${this.filters.selectedParams}&selected_filter=${response.data.id}`)
              this.alertTop('O filtro personalizado foi criado com sucesso.')
              window.location.reload()
            }).catch((e) => {
              this.alertTop('Ocorreu um erro ao tentar atualizar o filtro, tente novamente, caso o erro persista entre em contato com o suporte', 'error')
            })
          }
        })
      },
      alertTop(text) {
        Swal.fire({
          position: 'top-end',
          text: text,
          icon: 'success',
          showConfirmButton: false,
          timer: 1500,
          toast: true,
          timerProgressBar: true,
        })
      },
      showToast(html, time = 1500) {
        const wrapper = document.createElement('div');
        wrapper.setAttribute('aria-live', 'assertive');
        wrapper.classList.add('tw-pointer-events-none', 'tw-fixed', 'tw-inset-0', 'tw-flex', 'tw-items-end', 'tw-px-4', 'tw-py-6', 'sm:tw-items-start', 'sm:tw-p-6');
        wrapper.innerHTML = `<div class="tw-flex tw-w-full tw-flex-col tw-items-center tw-space-y-4 sm:tw-items-end">${html}</div>`;
        document.body.appendChild(wrapper);

        const progressBar = document.getElementById('toast-progressbar');
        progressBar.style.display = 'flex';
        progressBar.style.transition = `width ${time/1000}s linear 0s`;
        setTimeout(function() { progressBar.style.width = '0%'; }, 1);
        setTimeout(function() { wrapper.remove(); }, time);
      },
      getStatusClass(status) {
        switch(status) {
          case 'Em análise':
            return 'bg-warning'
          case 'Aberta':
            return 'bg-warning'
          case 'Fechada':
            return 'bg-success'
          case 'Revisão Gráfica':
            return 'bg-primary'
        }
        return 'bg-info'
      },
      removeDefaultFilter(filter) {
        Swal.fire({
          title: "Confirmação",
          icon: "info",
          text: "Você tem certeza que deseja remover este filtro? a operação não poderá ser disfeita.",
          showCancelButton: true,
          confirmButtonText: 'Sim, confirmo!',
          cancelButtonText: 'Cancelar',
        }).then((result) => {
          if(result.isConfirmed) {
            axios.delete(filter.urls.apiDetail).then((response) => {
              this.filters.list.splice(this.filters.list.indexOf(filter), 1)
              if(this.filters.selected == filter) {
                this.filters.selected = null
              }
              this.alertTop('Filtro padrão removido com sucesso.')
            }).catch((e) => {
              this.alertTop('Ocorreu um erro ao tentar remover o filtro, tente novamente, caso o erro persista entre em contato com o suporte.')
            })
          }
        })
      },
      changeIsPrinted(url) {
        axios.patch(url).then((response) => {
          this.alertTop('O caderno foi marcado como impresso.')
          window.location.reload()
        }).catch((e) => {
          this.alertTop('Ocorreu um erro ao tentar alterar o caderno, tente novamente, caso o erro persista entre em contato com o suporte.')
        })
      },
      showConfirmationRePrintExam() {
        Swal.fire({
          title: "Confirmação",
          icon: "info",
          text: `O caderno foi marcado como "Já impresso" você deseja imprimir novamente?`,
          showCancelButton: true,
          confirmButtonText: 'Sim!',
          cancelButtonText: 'Cancelar',
        }).then((result) => {
          if(result.isConfirmed) {
            $('#configurePrintModal').modal('show')
          }
        })
      },
      onClickOutsideFilters(event) {
        const target = event.target
        const button = document.getElementById('headlessui-slider-over-button-1')

        const select2DropdownAbove = document.getElementsByClassName('select2-dropdown--above')[0]
        const select2DropdownBelow = document.getElementsByClassName('select2-dropdown--below')[0]
        if (select2DropdownAbove || select2DropdownBelow) {
          return
        }

        if (!(target === button || button.contains(target))) {
          const rightOffCanvasContent = document.getElementById('right-off-canvas')
          if (rightOffCanvasContent.classList.contains('tw-show')) {
            rightOffCanvasContent.classList.remove('tw-show')
          }
        }
      },
      getPrintDefaults() {
        axios.get("{% url 'api:clients:print-configs-list' %}").then((response) => {
          this.printDefaults = response.data
        }).finally(() => {
          this.loadedPrintDefaults = true
        })
      }
    },
    updated() {
      tippy('.tooltips', {
        placement: 'bottom',
        allowHTML: true,
        maxWidth: 'none',
      })
    },
    mounted() {

      self = this

      for (let exam of this.exams) {
          if(exam.questionStatusWithAi == "pendente"){
            this.fetchStatus(exam); 
          }
      }

      {% include 'help/includes/tour_guide.js' with group_guide_name='default-exam-list' %}

      $("#headlessui-slider-over-button-1").click()

      $('#filterForm').find('input,select').change(this.filterFormChanged)
      
      this.examPrintConfig = Object.assign({}, this.examPrintConfigObject)
      
      const pendingExports = this.exams.filter(
        exam => exam.copyExamWithIaStatus == 1
      )
      
      if(pendingExports) {
        pendingExports.map(function(exam){
          self.fetchExamCopyStatus(exam)
        })
      } 

      this.activeCancelSelection()

      $("[data-selectall=true]").change((e) => {
        if ($(e.target).prop("checked")) {
          $(".selectbox").prop("checked", true)
          setTimeout(() => {
            $('.selectbox:checked').each((index, element) => { 
              let id = $(element).attr('id')
              if(id) {
                this.selectionList.push(id)
              }
            })
          }, 200)
        } else {
          $('.selectbox').prop('checked', false)
          this.selectionList = []
        }
      });

      $('#status_id').select2({
        placeholder: "Selecione uma opção",
        closeOnSelect: false,
      });
    
      $('#subject_id').select2({
        placeholder: "Selecione uma opção",
        closeOnSelect: false,
        templateResult: function (data, container) {
          let subject_name = data.text.split('>')[0]
          let knowledge_area_name = data.text.split('>')[1]
          return $(
            `<strong class="select2-results__custom_option">${subject_name}</strong> <br> <span class="select2-results__custom_option">${knowledge_area_name}</span>`
          );
        },
      }).on('select2:selecting', function(e) {
        let cur = e.params.args.data.id;
        let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
        $(e.target).val(old).trigger('change');
        $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
        return false;
      });
    
      $('#grade_id').select2({
        placeholder: "Selecione uma opção",
        closeOnSelect: false,
      }).on('select2:selecting', function(e) {
        let cur = e.params.args.data.id;
        let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
        $(e.target).val(old).trigger('change');
        $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
        return false;
      });
      $('#segment_id').select2({
        placeholder: "Selecione uma opção",
        closeOnSelect: false,
      }).on('select2:selecting', function(e) {
        let cur = e.params.args.data.id;
        let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
        $(e.target).val(old).trigger('change');
        $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
        return false;
      });
      $('#unit_id').select2({
        placeholder: "Selecione uma opção",
        closeOnSelect: false,
      }).on('select2:selecting', function(e) {
        let cur = e.params.args.data.id;
        let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
        $(e.target).val(old).trigger('change');
        $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
        return false;
      });
      
      $('#teaching_stage_id').select2({
        placeholder: "Selecione uma opção",
        closeOnSelect: false,
      }).on('select2:selecting', function(e) {
        let cur = e.params.args.data.id;
        let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
        $(e.target).val(old).trigger('change');
        $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
        return false;
      });

      $('#education_system_id').select2({
        placeholder: "Selecione uma opção",
        closeOnSelect: false,
      }).on('select2:selecting', function(e) {
        let cur = e.params.args.data.id;
        let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
        $(e.target).val(old).trigger('change');
        $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
        return false;
      });
    
      $('.table-responsive').on('show.bs.dropdown', function () {
        $('.table-responsive').css( "overflow", "inherit" );
      });
      
      $('.table-responsive').on('hide.bs.dropdown', function () {
        $('.table-responsive').css( "overflow", "auto" );
      })

      $('.tw-off-canvas-menu').on('click', function (e) {
        e.preventDefault();
        var target = $(this).attr('data-toggle-off-canvas');
        $(target).addClass('tw-show');
      });
  
      $('.tw-off-canvas .tw-off-canvas-close').on('click', function (e) {
        e.preventDefault();
        $(this).closest('.tw-off-canvas').removeClass('tw-show');
      })
    
      $(document).on('click touchstart', function (e) {
        if($(e.target).hasClass('select2-results__option') || $(e.target).hasClass('select2-results__custom_option')) {
          return
        }
        e.stopPropagation();
        if (!$(e.target).closest('.tw-off-canvas-menu').length) {
          var offCanvas = $(e.target).closest('.tw-off-canvas').length;
          if (!offCanvas) {
            $('.tw-off-canvas.tw-show').removeClass('tw-show');
          }
        }
      });
      
      $('.export-attachments').on('click', function(e) {
        let examId = $(this).data('exam-id')
        let examName = $(this).data('exam-name')
  
        {% with task_id='1234567890'|random %}
        let exportAttachmentsUrl = "{% url 'exams:exam_export_attachments' pk='00000000-0000-0000-0000-000000000000' task_id=task_id %}"
        let exportAttachmentsStatusUrl = "{% url 'exams:exam_export_attachments_status' pk='00000000-0000-0000-0000-000000000000' task_id=task_id %}"
        {% endwith %}
  
        $('#exportAttachmentsModal').modal('show');
        $('#modal-exam-export-title').html(examName)
  
        $('#exporting-info').removeClass('d-none')
        $('#exported-info').addClass('d-none')
        $('#exported-error').addClass('d-none')
  
        axios.get(exportAttachmentsUrl.replace('00000000-0000-0000-0000-000000000000', examId))
        .then(function (response) {})
  
        let interval = setInterval(function(){
          axios.get(exportAttachmentsStatusUrl.replace('00000000-0000-0000-0000-000000000000', examId))
          .then(function (response) {
            if (response.data.details) {
              $('#download-attachments-url').attr('href', response.data.details)
              $('#exported-info').removeClass('d-none')
              $('#exporting-info').addClass('d-none')
              clearInterval(interval)
            }
          })
          .catch(function(response) {
            $('#exported-error').removeClass('d-none')
            $('#exporting-info').addClass('d-none')
            clearInterval(interval)
          })
        }, 1000)
      });

      axios.get("{% url 'api:clients:custom-filters-list' %}?url={{request.resolver_match.app_name}}:{{request.resolver_match.url_name}}").then((response) => {
        this.filters.list = response.data
      }).finally(() => {
        {% if selected_filter %}
          this.filters.selected = this.filters.list.find(filter => filter.id == '{{selected_filter}}')
        {% endif %}
        if(this.filters.list.length) {
          $('#datatableFilters').DataTable({
            language: {
                url: "//cdn.datatables.net/plug-ins/1.10.22/i18n/Portuguese-Brasil.json"
            },
          });
        }
      }) 
      

      tippy('.tooltips', {
        placement: 'bottom',
        allowHTML: true,
        maxWidth: 'none',
      })

    },
    computed: {
      isButtonDisabled() {
        return this.duplicateMode === 'ia-copy-questions' && 
              !this.reducedEnunciation && 
              !this.reducedQuantityAlternatives && 
              !this.reducedTextAlternatives;
      },
      filteredList() {
        return this.filters.list.filter(item =>
          item.name.toLowerCase().includes(this.searchFilter.toLowerCase())
        );
      },
      isIndeterminate() {
        return this.selectionList.length > 0 && this.selectionList.length < this.exams.length
      },
    },
    directives: {
      'click-outside': {
        bind: function(el, binding, vNode) {
          // Provided expression must evaluate to a function.
          if (typeof binding.value !== 'function') {
            const compName = vNode.context.name
            let warn = `[Vue-click-outside:] provided expression '${binding.expression}' is not a function, but has to be`
            if (compName) { warn += `Found in component '${compName}'` }

            console.warn(warn)
          }
          // Define Handler and cache it on the element
          const bubble = binding.modifiers.bubble
          const handler = (e) => {
            if (bubble || (!el.contains(e.target) && el !== e.target)) {
              binding.value(e)
            }
          }
          el.__vueClickOutside__ = handler

          // add Event Listeners
          document.addEventListener('click', handler)
        },

        unbind: function(el, binding) {
          // Remove Event Listeners
          document.removeEventListener('click', el.__vueClickOutside__)
          el.__vueClickOutside__ = null
        }
      }
    },
  })


</script>
{% endblock %}
