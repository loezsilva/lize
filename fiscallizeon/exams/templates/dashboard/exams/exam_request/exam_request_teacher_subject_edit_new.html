{% extends 'redesign/base_exam_elaboration.html' %}
{% load exams_tags %}
{% block title %}Modificar caderno de prova - Lize{% endblock title %}

{% load static %}

{% block css-additional %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/styles/choices.min.css"
/>
<style>
  .modal-fullscreen {
    width: 100vw;
    max-width: none;
    height: 100%;
    margin: 0
  }

  .modal-fullscreen .modal-content {
    height: 100%;
    border: 0;
    border-radius: 0
  }

  .modal-fullscreen .modal-footer, .modal-fullscreen .modal-header {
    border-radius: 0
  }

  .modal-fullscreen .modal-body {
    overflow-y: auto
  }

  .switch-questions {
    position: relative;
    display: inline-block;
    width: 270px;
    height: 34px;
  }
  
  /* Hide default checkbox */
  .switch-questions input {
    display: none;
  }
  
  /* Slider styling */
  .slider-questions {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #FF8F3D;
    border-radius: 34px;
    transition: 0.4s;
  }
  
  .slider-questions:before {
    position: absolute;
    content: "";
    height: 30px;
    width: 135px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    border-radius: 34px;
    transition: 0.4s;
  }
  
  input:checked + .slider-questions:before {
    transform: translateX(131px);
  }
  .switch-questions label {
    display: flex;
    justify-content: space-between;
    position: absolute;
    width: 100%;
    height: 100%;
    color: white;
    font-size: 14px;
    font-weight: bold;
    align-items: center;
    padding: 0 15px;
    transition: color 0.4s;
  }
  /* Text styling inside slider */
  .question-bank, .author-questions {
    color: white;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    font-size: 12px;
    text-align: center;
    transition: opacity 0.4s;
    font-weight: bold;
  }
  .question-bank, .author-questions {
    color: black;
    transition: color 0.4s;
  }
  .question-bank {
    color: #FF8F3D;  

    left: 6%;
  }
  
  .author-questions {
    color: white;
    right: 6%;
  }
  
  /* Change text color when checked */
  input:checked + .slider-questions .question-bank {
    color: white;

  }

  input:checked + .slider-questions .author-questions {
    color: #FF8F3D;  
  }
  
  .hidden-text {
      display: none;
  }
  .show-more {
      cursor: pointer;
      color: #009ede;
  }
  .more-text {
      display: none;
  }
  .remove-focus:focus {
    -webkit-box-shadow: none !important;
    box-shadow: none !important;
  }
  .questions-text {
    font-size: 16px !important;
    margin: 5px 0 !important;
    font-weight: 400 !important;
    line-height: 1.4 !important;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif !important;
  }
  .question-selector {
    background: white; 
    width: 56px; 
    height: 36px; 
    border-radius: 8px; 
    border: 1px solid #F5F5F7;
  }

  .question-selector-selected {
    background: #FF8F3D20; 
    border: 1px solid #FF8F3D40;
  }

  .question-selector-selected-invalid {
    background: #D92D2098;
    border: 1px solid #D92D2040;
    color: white !important;
  }

  .tippy-box {
    background-color: white;
    box-shadow: 0px 4px 6px -2px #10182808;
    box-shadow: 0px 12px 16px -4px #10182814;
  }
  
  .tippy-content {
    padding: 0 !important;
    margin: 0 !important;
    border-radius: 8px;
    color: #6C727F;
    background-color: white;
  }
  .icon-hover:hover {
    color: #FF8F3D !important;
  }
  .tippy-arrow {
    background-color: white !important;
    color: white !important;
  }

  .dropdown-menu {
    box-shadow: 0px 2px 4px -2px #1018280F;
    box-shadow: 0px 4px 8px -2px #1018281A;
  }
  #floatMenu {
    position: fixed;
    z-index: 1;
  }
  .custom-toolbar {
    box-shadow: 0px 4px 6px -2px #10182808;
    box-shadow: 0px 12px 16px -4px #10182814;
  }
  .custom-toolbar span {
    color: #667085 !important;
    cursor: pointer;
  }
  .custom-toolbar span:hover {
    color: #FF8F3D !important;
  }
  .hovable:hover * {
    color: #FF8F3D !important;
  }
  .custom-toolbar .toolbar-divider {
    border-color: #F7F8F8;
    margin: 10px 0;
  }
  
  .tox .tox-edit-area__iframe {
    background-color: transparent !important;
  }
  .tox-tinymce {
    border: none !important;
  }
  .row-bncc {
    font-family: Inter;
    font-size: 14px;
    font-weight: 400;
    line-height: 20px;
    letter-spacing: 0em;
    text-align: left;
    cursor: pointer;
  }
  
  .row-bncc svg {
    color: #D3D6DB;
  }

  .row-bncc-selected {
    background-color: #41C5881A;
    color: #384250;
    font-family: Inter;
    font-size: 14px;
    line-height: 20px;
    font-weight: 600;
  }

  .custom-check {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    border: 2px;
    gap: 10px;
    border: 2px solid #D0D3D9;
    cursor: pointer;
  }
  
  .row-bncc-selected .custom-check {
    background-color: #41C588;
    border-color: #41C588;
  }

  .row-bncc-selected svg:nth-child(1) {
    color: #41C588;
  }
  .link {
    font-family: Inter;
    font-size: 14px;
    font-weight: 400;
    line-height: 16px;
    letter-spacing: 0em;
    cursor: pointer;
  }
  .link:hover {
    color: #58c2ec !important;
  }
  .lize-form-control {
    border: 1px solid #D2D6DB; 
    border-radius: 8px;
    height: 44px;
  }
  .scroll-invisible::-webkit-scrollbar {
    width: 0px;
  }
  .text {
    font-family: Inter;
    font-weight: 500;
    line-height: 32px;
    letter-spacing: 0em;
    text-align: left;
  }
  .text-5 {
    font-family: Inter;
    font-size: 18px;
    font-weight: 500;
    line-height: 24px;
    letter-spacing: 0em;
    text-align: left;
  }
  .custom-editor {
    font-family: Inter;
    font-size: 18px;
    font-weight: 500;
    line-height: 24px;
    letter-spacing: 0em;
    text-align: left;
    color: #374151;
    border: 1px solid #E5E7EA;
    background-color: #F9FAFA;
    min-height: 210px;
    padding: 20px;
    border-radius: 12px;
  }

  .tox-tbtn:first-child:focus {
    background-color: inherit !important;
  }
  .tox-tbtn:first-child:focus svg {
    fill: #667085 !important;
  }
  .tox-tbtn:first-child:hover {
    background-color: #e8eaed !important;
  }
  .tox-tbtn:first-child:hover svg {
    fill: #ff8f3d !important;
  }
  
  [contenteditable="true"]:focus {
    outline: none;
    border: none;
  }

  /* custom scrollbar */
  ::-webkit-scrollbar {
    width: 20px;
  }

  ::-webkit-scrollbar-track {
    background-color: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background-color: #d6dee1;
    border-radius: 20px;
    border: 6px solid transparent;
    background-clip: content-box;
  }

  ::-webkit-scrollbar-thumb:hover {
    background-color: #a8bbbf;
  }
  #prompt {
    line-height: 2rem;
  }
  .cardSelectionType:hover {
    box-shadow: 0px 4px 6px -2px #10182808;
    box-shadow: 0px 12px 16px -4px #10182814;
  }
  #myUL, #myUL ul {
    list-style-type: none;
    padding-inline-start: 1.4rem;
  }
  
  /* Remove margins and padding from the parent ul */
  #myUL {
    margin: 0;
    padding: 0;
  }
  .tree-nested {
    display: none;
  }
  .tree-active {
    display: block;
    margin-left: 10px;
    /* border-left: 1px solid #CBD5DD; */
    margin-bottom: 8px;
  }
  .custom-control-input:checked ~ .custom-control-label::before {
    background-color: #FF8F3D;
    border-color: #FF8F3D;
    color: white;
  }
  .custom-switch .custom-control-label::after {
    background-color: white;
  }
  .custom-switch .custom-control-label::before {
    border-color: #D2D6DB;
    background-color: #D2D6DB;
  }
  .custom-select-1 {
    padding: 7px 12px 7px 12px;
    border-radius: 8px;
    border-color: #FF8F3D;
    font-family: Inter;
    font-size: 14px;
    font-weight: 400;
    line-height: 20px;
    letter-spacing: 0em;
    background-color: #FFFFFF;
    border: 1px solid #E5E7EA;
  }
  .custom-select-2 {
    cursor: pointer;
    min-height: 34px;
    padding: 7px 12px 7px 12px;
    border-radius: 8px;
    gap: 8px;
    font-family: Inter;
    font-size: 14px;
    font-weight: 400;
    line-height: 20px;
    letter-spacing: 0em;
  }
  .custom-loader {
    width: 50px;
    height: 50px;
    display: grid;
    border:4px solid #0000;
    border-radius: 50%;
    border-color:#E4E4ED #0000;
    animation: s6 1s infinite linear;
  }
  .custom-loader::before,
  .custom-loader::after {    
    content:"";
    grid-area: 1/1;
    margin:2px;
    border:inherit;
    border-radius: 50%;
  }
  .custom-loader::before {
    border-color:#ff8f3d #0000;
    animation:inherit; 
    animation-duration: .5s;
    animation-direction: reverse;
  }
  .custom-loader::after {
    margin:8px;
  }

  @keyframes s6 { 
    100%{transform: rotate(1turn)}
  }
  .dropzone {
    height: 180px;
    text-align: center;
    padding: 20px;
    border: 1px solid #E5E7EA;
    border-radius: 8px;
    cursor: pointer;
  }

  .dropzone.dragover {
    background-color: #ecf0f1;
  }
  
  .modal-body-topics {
    position: relative;
    flex: 1 1 auto;
    padding: 1rem;
    max-height: 70vh;
    overflow: auto;
  }

  .fixed-dropdown-item {
    width: 285px;
    white-space: nowrap;
    overflow: hidden;
  }
</style>

<style id="wikEdDiffStyles">
  .wikEdDiffInsert {
    font-weight: bold;
    background-color: #bbddff;
    color: #222;
    border-radius: 0.25em;
    padding: 0.2em 1px;
  }
  .wikEdDiffInsertBlank {
      background-color: #66bbff;
  }
  .wikEdDiffFragment:hover .wikEdDiffInsertBlank {
      background-color: #bbddff;
  }

  /* Delete */
  .wikEdDiffDelete {
      font-weight: bold;
      background-color: #FFBABA;
      color: #222;
      border-radius: 0.25em;
      padding: 0.2em 1px;
  }
  .wikEdDiffDeleteBlank {
      background-color: #ffd064;
  }
  
  /* Block */
  .wikEdDiffBlock {
      font-weight: bold;
      background-color: #e8e8e8;
      border-radius: 0.25em;
      padding: 0.2em 1px;
      margin: 0 1px;
  }
  .wikEdDiffBlock {
  }
  .wikEdDiffBlock0 {
      background-color: #ffff80;
  }
  .wikEdDiffBlock1 {
      background-color: #d0ff80;
  }
  .wikEdDiffBlock2 {
      background-color: #ffd8f0;
  }
  .wikEdDiffBlock3 {
      background-color: #c0ffff;
  }
  .wikEdDiffBlock4 {
      background-color: #fff888;
  }
  .wikEdDiffBlock5 {
      background-color: #bbccff;
  }
  .wikEdDiffBlock6 {
      background-color: #e8c8ff;
  }
  .wikEdDiffBlock7 {
      background-color: #ffbbbb;
  }
  .wikEdDiffBlock8 {
      background-color: #a0e8a0;
  }
  .wikEdDiffBlockHighlight {
      background-color: #777;
      color: #fff;
      border: solid #777;
      border-width: 1px 0;
  }
  
  /* Mark */
  .wikEdDiffMarkLeft, .wikEdDiffMarkRight {
      font-weight: bold;
      background-color: #ff3838;
      color: #666;
      border-radius: 0.25em;
      padding: 0.2em;
      margin: 0 1px;
  }
  .wikEdDiffMarkLeft:before {
      content: "{
        cssMarkLeft
    }
    ";
  }
  .wikEdDiffMarkRight:before {
      content: "{
        cssMarkRight
    }
    ";
  }
  .wikEdDiffMarkLeft.wikEdDiffNoUnicode:before {
      content: "<";
  }
  .wikEdDiffMarkRight.wikEdDiffNoUnicode:before {
      content: ">";
  }
  .wikEdDiffMark {
      background-color: #e8e8e8;
      color: #666;
  }
  .wikEdDiffMark0 {
      background-color: #ffff60;
  }
  .wikEdDiffMark1 {
      background-color: #c8f880;
  }
  .wikEdDiffMark2 {
      background-color: #ffd0f0;
  }
  .wikEdDiffMark3 {
      background-color: #a0ffff;
  }
  .wikEdDiffMark4 {
      background-color: #fff860;
  }
  .wikEdDiffMark5 {
      background-color: #b0c0ff;
  }
  .wikEdDiffMark6 {
      background-color: #e0c0ff;
  }
  .wikEdDiffMark7 {
      background-color: #ffa8a8;
  }
  .wikEdDiffMark8 {
      background-color: #98e898;
  }
  .wikEdDiffMarkHighlight {
      background-color: #777;
      color: #fff;
  }
  
  /* Wrappers */
  .wikEdDiffContainer {
  }
  .wikEdDiffFragment {
      font-family: sans-serif;
      font-size: 14px;
      line-height: 1.6;
      padding: 1em;
      margin: 0;
  }
  .wikEdDiffNoChange {
      background: #f0f0f0;
      border: 1px #bbb solid;
      border-radius: 0.5em;
      line-height: 1.6;
      box-shadow: 2px 2px 2px #ddd;
      padding: 0.5em;
      margin: 1em 0;
      text-align: center;
  }
  .wikEdDiffSeparator {
      margin-bottom: 1em;
  }
  .wikEdDiffOmittedChars {
  }
  
  /* NewLine */
  .wikEdDiffNewline:before {
      content: "¶";
      color: transparent;
  }
  .wikEdDiffBlock:hover .wikEdDiffNewline:before {
      color: #aaa;
  }
  .wikEdDiffBlockHighlight .wikEdDiffNewline:before {
      color: transparent;
  }
  .wikEdDiffBlockHighlight:hover .wikEdDiffNewline:before {
      color: #ccc;
  }
  .wikEdDiffBlockHighlight:hover .wikEdDiffInsert .wikEdDiffNewline:before, .wikEdDiffInsert:hover .wikEdDiffNewline:before {
      color: #999;
  }
  .wikEdDiffBlockHighlight:hover .wikEdDiffDelete .wikEdDiffNewline:before, .wikEdDiffDelete:hover .wikEdDiffNewline:before {
      color: #aaa;
  }
  
  /* Tab */
  .wikEdDiffTab {
      position: relative;
  }
  .wikEdDiffTabSymbol {
      position: absolute;
      top: -0.2em;
  }
  .wikEdDiffTabSymbol:before {
      content: "→";
      font-size: smaller;
      color: #ccc;
  }
  .wikEdDiffBlock .wikEdDiffTabSymbol:before {
      color: #aaa;
  }
  .wikEdDiffBlockHighlight .wikEdDiffTabSymbol:before {
      color: #aaa;
  }
  .wikEdDiffInsert .wikEdDiffTabSymbol:before {
      color: #aaa;
  }
  .wikEdDiffDelete .wikEdDiffTabSymbol:before {
      color: #bbb;
  }
  
  /* Space */
  .wikEdDiffSpace {
      position: relative;
  }
  .wikEdDiffSpaceSymbol {
      position: absolute;
      top: -0.2em;
      left: -0.05em;
  }
  .wikEdDiffSpaceSymbol:before {
      content: "·";
      color: transparent;
  }
  .wikEdDiffBlock:hover .wikEdDiffSpaceSymbol:before {
      color: #999;
  }
  .wikEdDiffBlockHighlight .wikEdDiffSpaceSymbol:before {
      color: transparent;
  }
  .wikEdDiffBlockHighlight:hover .wikEdDiffSpaceSymbol:before {
      color: #ddd;
  }
  .wikEdDiffBlockHighlight:hover .wikEdDiffInsert .wikEdDiffSpaceSymbol:before, .wikEdDiffInsert:hover .wikEdDiffSpaceSymbol:before {
      color: #888;
  }
  .wikEdDiffBlockHighlight:hover .wikEdDiffDelete .wikEdDiffSpaceSymbol:before, .wikEdDiffDelete:hover .wikEdDiffSpaceSymbol:before {
      color: #999;
  }
  /* Error */
  .wikEdDiffError .wikEdDiffFragment, .wikEdDiffError .wikEdDiffNoChange {
      background: #faa;
  }
  .col-1\2 {
    padding-left: 10px;
  }
  #checked-by {
    padding-top: 0.5rem;
    cursor: pointer;
  }

  .transition {
    transition: transform 0.2s ease;
  }

  details[open] > summary .rotate-icon {
    transform: rotate(90deg);
  }

  .custom-choices__inner {
    min-height: unset;
    padding: 0.391rem 0.5rem;
    border-radius: 8px;
  }

  .custom-choices__list--single {
    padding: 0
  }
</style>

{% endblock css-additional %}

{% block header %}
  
{% endblock header %}

{% block content-fixed %}

<div
  style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; transition: opacity 0.3s ease;"
  :style="{
    opacity: internalStatus === 'busy' ? 1 : 0,
    pointerEvents: internalStatus === 'busy' ? 'all' : 'none',
  }"
>
  <div style="display: flex; align-items: center; justify-content: center; height: 100%;">
    <div>
      <img src="{% static 'assets/img/svg/intro.svg' %}" width="400" height="300" class="img-fluid" alt="">
      <h2 class="text-center text-muted my-3">Aguarde...</h2>
      <p class="text-center text-muted">Adicionando questão no seu caderno...</p>
    </div>
  </div>
</div>

  <div :class="controls.width < 992 ? 'd-flex align-items-center':''" style="background-color: #fff; border-bottom: 1px solid #E5E7EA; height: 60px; top:0; position: fixed; width: 100%; z-index: 2;">
    <div class="row d-flex align-items-center px-4 py-1 w-100" :style="{ zoom: controls.width < 1200 ? controls.width / 1200 : 1 }">
      <div class="col">
        {% if elaborated_by_me %}
          <a href="{% url 'exams:exam_teacher_update' object.exam.id %}?v=2" class="text-muted"><i class="fas fa-arrow-left"></i> 
            Configuração de lista
          </a>
        {% else %}
          <a href="{% url 'core:redirect_dashboard' %}" class="text-muted"><i class="fas fa-arrow-left"></i>
            {% if user.is_freemium %}
              Meu painel
            {% else %}
              Painel de solicitações
            {% endif %}
          </a>
        {% endif %}
      </div>
      {% if DEBUG %}
        <div class="col">
          <div class="tw-rounded-lg d-flex" style="background-color: #FEF0C7;">
            <p class="mb-0 px-3 py-2 d-flex tw-text-sm tw-leading-6 tw-font-semibold align-items-center" style="color: #D67B05;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#ffc107" stroke="#ffc107" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                <path stroke-width="0.8" d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
                <path stroke-width="0.8" d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
              </svg>
              <span class="mx-2 align-self-end">Você está no ambiente de testes</span>
            </p>
          </div>
        </div>
      {% else %}
        <div class="col">
          <div class="tw-rounded-lg d-flex">
            <h5 style="max-width: 40rem;" class="text-muted text-truncate mb-0 px-3 py-2 tw-font-semibold align-items-center">
              {{object.exam.name}}
            </h5>
          </div>
        </div>
      {% endif %}
      <div class="col d-flex justify-content-end align-items-center">
        <template v-if="!controls.show">
          {% if user.is_freemium %}
            <span class="mx-2">
              <credits-component :availables="credits.availables"></credits-component>
            </span>
          {% endif %}
          {% comment %} <div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" style="color: #667085 !important;" class="cp hovable mx-2 bi bi-magic" viewBox="0 0 16 16">
              <path d="M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0v1.829Zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707L14 2.707ZM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707L7.293 4Zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1h1.829Zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1h1.829ZM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707L13.293 10ZM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0v1.829Zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0L8.354 9.06Z"/>
            </svg>
          </div>
          {% endcomment %}
          <div class="d-flex aling-items-center justify-content-center">
            <div id="vueNotifications">
              <notifications-component :custom-html="true" ref="notifications">
                <button  class="fo aqm axk bkr">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="nx rz cp hovable mx-2" :style="controls.examViewer ? 'color: #FF8F3D !important;':'color: #667085 !important;'" style="width: 1.5rem; height: 1.5rem;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"></path>
                  </svg>
                  <span v-if="$refs.notifications && $refs.notifications.notifications.length" class="badge badge-primary rounded-circle lize-bg-warning" style="position: absolute; top:6px; margin-left: -5px; font-size: 8px;">${$refs.notifications.notifications.length}</span>
                </button>
              </notifications-component>
            </div>
          </div>
          <div>
            <svg @click="controls.examViewer = !controls.examViewer" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" :style="controls.examViewer ? 'color: #FF8F3D !important;':'color: #667085 !important;'" class="cp hovable mx-2 bi bi-eye" viewBox="0 0 16 16">
              <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
              <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
            </svg>
          </div>
          {% if user.is_freemium %}
            <div v-if="!controls.downloading">
              <svg  @click="printExam('{{object.exam.urls.print_exam_with_print_service}}', '{{object.exam.id}}', '{{object.exam.name}}')" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" style="color: #667085 !important;" class="cp hovable mx-2 bi bi-printer" viewBox="0 0 16 16">
                <path d="M2.5 8a.5.5 0 1 0 0-1 .5.5 0 0 0 0 1z"/>
                <path d="M5 1a2 2 0 0 0-2 2v2H2a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h1v1a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-1h1a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H5zM4 3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v2H4V3zm1 5a2 2 0 0 0-2 2v1H2a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v-1a2 2 0 0 0-2-2H5zm7 2v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1z"/>
              </svg>
            </div> 
          {% endif %}
          <div>
            <button type="button" :style="{ borderColor: controls.examViewer ? '#E5E7EA !important':'', color: controls.examViewer ? '#E5E7EA !important':'' }" class="btn lz-btn-outline-warning mx-2" @click="finishElaboration()">Salvar Rascunho</button>
          </div>
          <div>
            <button class="btn lize-btn-primary" :style="{ backgroundColor: controls.examViewer ? '#E5E7EA !important':'' }" @click="finishElaboration()">Concluir</button>
          </div>
        </template>
        <template v-else>
          <div>
            <button type="button" class="btn lize-btn-primary" v-if="!controls.loadingQuestionCreate" :disabled="controls.saving || totalBlockedWeightQuestions > subjectNote" @click="save()">Salvar alterações</button>
          </div>
        </template>
      </div>
    </div>
  </div>
  <div id="floatMenu" :style="{ left: floatMenu.left + 'px', top: floatMenu.top + 'px', zoom: controls.width < 1200 ? controls.width / 1200 : 1 }">
    <div class="custom-toolbar" style="width: 40px;">
      <div class="lize-card" v-show="controls.height >= 678 && controls.show && selectedExamQuestion.currentMenu == 'enunciation'">
        <div class="card-body p-0 d-flex flex-column text-center">
          <!-- Arrows -->
          <span class="tx-20 px-2 pb-1 pt-3 custom-toolbar-undo">
            <svg width="20" height="20" fill="currentColor"><path d="M6.4 8H12c3.7 0 6.2 2 6.8 5.1.6 2.7-.4 5.6-2.3 6.8a1 1 0 01-1-1.8c1.1-.6 1.8-2.7 1.4-4.6-.5-2.1-2.1-3.5-4.9-3.5H6.4l3.3 3.3a1 1 0 11-1.4 1.4l-5-5a1 1 0 010-1.4l5-5a1 1 0 011.4 1.4L6.4 8z" fill-rule="nonzero"></path></svg>
          </span>
          <span class="tx-20 px-2 py-1 custom-toolbar-redo">
            <svg width="24" height="20" fill="currentColor"><path d="M17.6 10H12c-2.8 0-4.4 1.4-4.9 3.5-.4 2 .3 4 1.4 4.6a1 1 0 11-1 1.8c-2-1.2-2.9-4.1-2.3-6.8.6-3 3-5.1 6.8-5.1h5.6l-3.3-3.3a1 1 0 111.4-1.4l5 5a1 1 0 010 1.4l-5 5a1 1 0 01-1.4-1.4l3.3-3.3z" fill-rule="nonzero"></path></svg>
          </span>
          <hr class="toolbar-divider">
          <span class="tx-20 px-2 py-1 custom-toolbar-tiny_mce_wiris">
            <svg width="20" height="20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 300 261.7" fill="currentColor" xml:space="preserve">
              <g id=icon-wirisformula stroke="none" stroke-width="0.2" fill-rule="evenodd"><g>
                <path class="st1" d="M90.2,257.7c-11.4,0-21.9-6.4-27-16.7l-60-119.9c-7.5-14.9-1.4-33.1,13.5-40.5c14.9-7.5,33.1-1.4,40.5,13.5l27.3,54.7L121.1,39c5.3-15.8,22.4-24.4,38.2-19.1c15.8,5.3,24.4,22.4,19.1,38.2l-59.6,179c-3.9,11.6-14.3,19.7-26.5,20.6C91.6,257.7,90.9,257.7,90.2,257.7"/></g></g><g><g><path class="st2" d="M300,32.8c0-16.4-13.4-29.7-29.9-29.7c-2.9,0-7.2,0.8-7.2,0.8c-37.9,9.1-71.3,14-112,14c-0.3,0-0.6,0-1,0c-16.5,0-29.9,13.3-29.9,29.7c0,16.4,13.4,29.7,29.9,29.7l0,0c45.3,0,83.1-5.3,125.3-15.3h0C289.3,59.5,300,47.4,300,32.8"/></g></g>
            </svg>
          </span>
          <span class="tx-20 px-2 py-1 custom-toolbar-clearformat" title="Remover formatação">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="remove-formatting"><path d="M4 7V4h16v3"/><path d="M5 20h6"/><path d="M13 4 8 20"/><path d="m15 15 5 5"/><path d="m20 15-5 5"/></svg>
          </span>
          <hr class="toolbar-divider">
          <!-- Image and video -->
          <span class="tx-20 px-2 py-1 custom-toolbar-image">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
              <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
              <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
            </svg>
          </span>
          <span class="tx-20 px-2 py-1 custom-toolbar-media">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-film" viewBox="0 0 16 16">
              <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zm4 0v6h8V1H4zm8 8H4v6h8V9zM1 1v2h2V1H1zm2 3H1v2h2V4zM1 7v2h2V7H1zm2 3H1v2h2v-2zm-2 3v2h2v-2H1zM15 1h-2v2h2V1zm-2 3v2h2V4h-2zm2 3h-2v2h2V7zm-2 3v2h2v-2h-2zm2 3h-2v2h2v-2z"/>
            </svg>
          </span>
          <span class="tx-20 px-2 py-1 custom-toolbar-mceInsertTable">
            <svg width="30" height="32" fill="currentColor" viewBox="2 0 26 26">
              <path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 14v4h6v-4H5zm14 0h-6v4h6v-4zm0-6h-6v4h6V8zM5 12h6V8H5v4z"></path>
            </svg>
          </span>
          <span class="tx-20 px-2 custom-toolbar-insertHorizontalRule">
            <svg width="24" height="24" fill="currentColor">
              <path d="M4 11h16v2H4z" fill-rule="evenodd"></path>
            </svg>
          </span>
          <!-- Lists  -->
          <hr class="toolbar-divider">
          <span class="tx-20 px-2 py-1 custom-toolbar-numlist">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
            </svg>
          </span>
          <span class="tx-20 px-2 py-1 custom-toolbar-bullist">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-list-ol" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/>
              <path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338v.041zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635V5z"/>
            </svg>
          </span>
          <!-- Sub -->
          <hr class="toolbar-divider">
          <span class="tx-20 px-2 py-1 custom-toolbar-superscript">
            <svg width="24" height="20" fill="currentColor"><path d="M15 9.4L10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11z" fill-rule="nonzero"></path></svg>
          </span>
          <span class="tx-20 px-2 py-1 custom-toolbar-subscript">
            <svg width="24" height="20" fill="currentColor"><path d="M10.4 10l4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10zM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 00-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 01-1.3 1.3l-.6.6h2.6V19z" fill-rule="nonzero"></path></svg>
          </span>
          <!-- Ident -->
          <hr class="toolbar-divider">
          <span class="tx-20 px-2 py-1 custom-toolbar-outdent" title="Diminuir recuo">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-text-indent-right" viewBox="0 0 16 16">
              <path d="M2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm10.646 2.146a.5.5 0 0 1 .708.708L11.707 8l1.647 1.646a.5.5 0 0 1-.708.708l-2-2a.5.5 0 0 1 0-.708l2-2zM2 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
            </svg>
          </span>
          <span class="tx-20 px-2 py-1 custom-toolbar-indent" title="Aumentar recuo">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-text-indent-left" viewBox="0 0 16 16">
              <path d="M2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm.646 2.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L4.293 8 2.646 6.354a.5.5 0 0 1 0-.708zM7 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm-5 3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
            </svg>
          </span>
          {% comment %} 
            <span class="tx-20 px-2 py-1 pb-3">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-floppy" viewBox="0 0 16 16">
                <path d="M11 2H9v3h2V2Z"/>
                <path d="M1.5 0h11.586a1.5 1.5 0 0 1 1.06.44l1.415 1.414A1.5 1.5 0 0 1 16 2.914V14.5a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-13A1.5 1.5 0 0 1 1.5 0ZM1 1.5v13a.5.5 0 0 0 .5.5H2v-4.5A1.5 1.5 0 0 1 3.5 9h9a1.5 1.5 0 0 1 1.5 1.5V15h.5a.5.5 0 0 0 .5-.5V2.914a.5.5 0 0 0-.146-.353l-1.415-1.415A.5.5 0 0 0 13.086 1H13v4.5A1.5 1.5 0 0 1 11.5 7h-7A1.5 1.5 0 0 1 3 5.5V1H1.5a.5.5 0 0 0-.5.5Zm3 4a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5V1H4v4.5ZM3 15h10v-4.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5V15Z"/>
              </svg>
            </span> 
          {% endcomment %}
        </div>
      </div>
    </div>
  </div>
  <div class="ard cer dcv" style="min-height: calc(100vh - 60px); overflow-x: hidden;">
    <div class="ls">
      <template v-if="controls.examViewer">
        {% include 'exams/includes/exam_viewer.html' %}
      </template>
      <div :class="{'d-lg-block': !controls.examViewer, 'd-none': controls.examViewer}" v-show="!controls.examViewer">
        <template v-if="controls.loading">
          <div class="row">
            <div class="col-12 d-flex flex-column align-items-center justify-content-center" style="min-height: calc(100vh - 80px);">
              <img src="{% static 'assets/img/svg/intro.svg' %}" width="400" height="300" class="img-fluid" alt="">
              <h2 class="text text-muted my-3">Aguarde enquanto carregamos o ambiente...</h2>
              <p class="text text-muted">Em breve você poderá adicionar questões a esta solicitação.</p>
            </div>
          </div>
        </template>
        <template v-else-if="controls.removingQuestion">
          <div class="row">
            <div class="col-12 d-flex flex-column align-items-center justify-content-center" style="min-height: calc(100vh - 80px);">
              <img src="{% static 'assets/img/svg/intro.svg' %}" width="400" height="300" class="img-fluid" alt="">
              <h2 class="text text-muted my-3">Aguarde enquanto removemos o questão...</h2>
              <p class="text text-muted">O processo é necessário para que tudo funcione corretamente.</p>
            </div>
          </div>
        </template>
        <template v-else>
          <div class="row m-0">
            <div :class="controls.width >= 1200 ? 'col-1':'col-1\2'" :style="{ zoom: controls.width < 1200 ? controls.width / 1200 : 1 }" class="py-5 d-flex flex-column justify-content-center" style="max-height: calc(100vh - 60px); background-color: #cccccc1c;" v-if="examTeacherSubject">
              <div class="cp d-flex align-items-center justify-content-center my-1 text-center question-selector" :style="{ color: controls.scrollBar.hasUp ? '':'#E5E7EA' }" @click="scrollBarMoviment(-40)">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-up" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M7.776 5.553a.5.5 0 0 1 .448 0l6 3a.5.5 0 1 1-.448.894L8 6.56 2.224 9.447a.5.5 0 1 1-.448-.894l6-3z"/>
                </svg>
              </div>
              <div :style="{ maxHeight: controls.scrollBar.maxHeight,  overflowY: 'scroll' }" id="questionsScrollBar" class="scroll-invisible">
                <draggable v-model="examTeacherSubject.examQuestions" ghost-class="question-selector-selected" handle=".movable" @change="changeExamQuestionsEvent" @start="controls.dragging = true" @end="controls.dragging = false" :disabled="controls.swaping">
                  <template v-for="(examQuestion, index) in examTeacherSubject.examQuestions">
                    <template v-if="controls.show">
                      <div :key="examQuestion.id" @click="save()" class="d-flex align-center my-1 movable question-selector" style="cursor: move;" :class="{ 'question-selector-selected': selectedExamQuestion == examQuestion, 'question-selector-selected-invalid': selectedExamQuestion == examQuestion && examQuestion.errors && examQuestion.errors['invalid'] || examQuestion.lastStatus.statusDisplay == 'Rascunho' }">
                        <span v-html="examQuestion.errors && examQuestion.errors['invalid'] ? getExamQuestionStatus({ lastStatus: { statusDisplay: 'Incompleta' } }, 12).icon : getExamQuestionStatus(examQuestion, 12).icon" class="mr-1 mb-1"></span><span>${String(index + 1).padStart(2, '0')}</span>
                      </div>
                    </template>
                    <template v-else>
                      <div :key="examQuestion.id" @click="goToExamQuestion(examQuestion)" style="cursor: move;" class="d-flex my-1 align-center movable question-selector" :class="{ 'question-selector-selected': selectedExamQuestion == examQuestion, 'question-selector-selected-invalid': selectedExamQuestion == examQuestion && examQuestion.errors && examQuestion.errors['invalid'] || examQuestion.lastStatus.statusDisplay == 'Rascunho' }">
                        <span v-html="examQuestion.errors && examQuestion.errors['invalid'] ? getExamQuestionStatus({ lastStatus: { statusDisplay: 'Incompleta' } }, 12).icon : getExamQuestionStatus(examQuestion, 12).icon" class="mr-1 mb-1"></span><span>${String(index + 1).padStart(2, '0')}</span>
                      </div>
                    </template>
                  </template>
                <draggable>
              </div>
              <template v-if="examTeacherSubject.examQuestions.length > 7 && controls.scrollBar.hasDown">
                <div class="cp d-flex align-center my-1 text-center question-selector">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#D3D6DB" class="bi bi-three-dots" viewBox="0 0 16 16">
                    <path d="M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/>
                  </svg>
                </div>
                <div @click="selectedExamQuestion = examTeacherSubject.examQuestions[examTeacherSubject.examQuestions.length - 1], goToExamQuestion(examTeacherSubject.examQuestions[examTeacherSubject.examQuestions.length - 1])" class="cp d-flex align-center my-1 text-center question-selector" :class="{ 'question-selector-selected': selectedExamQuestion == examTeacherSubject.examQuestions[examTeacherSubject.examQuestions.length - 1] }">
                  <span v-html="getExamQuestionStatus(examTeacherSubject.examQuestions[examTeacherSubject.examQuestions.length - 1], 12).icon" class="mr-2"></span>${String(examTeacherSubject.examQuestions.length).padStart(2, '0')}
                </div>
              </template>
              <div class="cp d-flex align-items-center justify-content-center my-1 text-center question-selector" :style="{ color: controls.scrollBar.hasDown ? '':'#E5E7EA' }" @click="scrollBarMoviment(40)">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-compact-down" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M1.553 6.776a.5.5 0 0 1 .67-.223L8 9.44l5.776-2.888a.5.5 0 1 1 .448.894l-6 3a.5.5 0 0 1-.448 0l-6-3a.5.5 0 0 1-.223-.67z"/>
                </svg>
              </div>
              <div class="cp d-flex align-items-center justify-content-center my-1 text-center question-selector questionCreation" v-if="canAddExamQuestion && !controls.createQuestion" data-toggle="modal" data-target="#modalAddQuestion">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                </svg>
              </div>
            </div>
            <div class="col" :class="{ 'py-3': !controls.show }" style="height: calc(100vh - 60px); overflow-y: scroll; background-color: #cccccc1c;" v-if="examTeacherSubject">
              <template v-if="!controls.swaping">
                <div v-for="(examQuestion, index) in examTeacherSubject.examQuestions" :style="{ zoom: controls.width < 1200 ? controls.width / 1200 * 1.1 : 1 }">
                  <div class="d-flex justify-content-center">
                    <div v-show="controls.show && selectedExamQuestion == examQuestion || !controls.show">
                      <div class="d-flex justify-content-center align-items-center">
                        <!-- Question -->
                        <div class="d-flex justify-content-center" :id="'examQuestion-'+examQuestion.id">

                          <div class="card lize-card shadow-sm" style="width: 720px;" @click="selectedExamQuestion = examQuestion">
                            <div class="card-header d-flex justify-content-between" style="border: 1px solid #E5E7EA !important;">
                              <div class="d-flex justify-content-between align-items-center">
                                <span class="mr-4">Questão ${String(index + 1).padStart(2, '0')}</span>
                                {% if not user.is_freemium %}
                                  <template v-if="examQuestion.errors['invalid']">
                                    <span class="badge rounded-pill d-flex align-items-center mx-2 px-2 text-white cp" :style="{ border: '1px solid #E5E7EA', backgroundColor: getExamQuestionStatus({ lastStatus: { statusDisplay: 'Incompleta' } }).bgColor }">
                                      <span v-html="getExamQuestionStatus({ lastStatus: { statusDisplay: 'Incompleta' } }, 12).icon" class="mx-1"></span>
                                      <span v-html="getExamQuestionStatus({ lastStatus: { statusDisplay: 'Incompleta' } }).label" class="mx-1"></span>
                                    </span>
                                  </template>
                                  <template v-else>
                                    <span class="badge rounded-pill d-flex align-items-center mx-2 px-2 cp" data-toggle="modal" :data-target="selectedExamQuestion && selectedExamQuestion.lastStatus && selectedExamQuestion.lastStatus.note.length ? '#modalViewStatusNote':''" :style="{ border: '1px solid #E5E7EA', backgroundColor: getExamQuestionStatus(examQuestion).bgColor, color: getExamQuestionStatus(examQuestion).color || '#7987a1' }"> 
                                      <span v-html="getExamQuestionStatus(examQuestion, 12).icon" class="mx-1"></span> ${getExamQuestionStatus(examQuestion).label}
                                    </span>
                                  </template>
                                {% endif %}
                              </div>
                              <div class="d-flex justify-content-end align-items-center" v-if="examQuestion.canUpdate()">
                                {% if not user.is_freemium %}
                                  <small class="text-muted">${examQuestion.question.uses.length ? 'Utilizada ' + examQuestion.question.uses.length + ' vezes' : 'Nova questão'}</small>
                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-clock-history mx-2 hovable cp" viewBox="0 0 16 16" style="color: #D2D6DB;" @click="showUses()">
                                    <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"/>
                                    <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"/>
                                    <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"/>
                                  </svg>
                                {% endif %}
                                <!-- Options -->
                                <svg v-if="examQuestion.canBeRemove" @click="deleteExamQuestionConfirmation(index)" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: 20px; color: #667085;" fill="currentColor" class="bi bi-x-lg hovable cp" viewBox="0 0 16 16">
                                  <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                </svg>
                              </div>
                            </div>
                            <!-- Nova barra, só deve aparece quando a tela for muito pequena na altura -->
                            <div id="header-menu" style="z-index: 1;" v-show="controls.height < 678 && controls.show && selectedExamQuestion.currentMenu == 'enunciation'">
                              <div class="custom-toolbar d-flex align-items-center">
                                <span class="tx-20 px-2 py-1 custom-toolbar-undo">
                                  <svg width="20" height="20" fill="currentColor"><path d="M6.4 8H12c3.7 0 6.2 2 6.8 5.1.6 2.7-.4 5.6-2.3 6.8a1 1 0 01-1-1.8c1.1-.6 1.8-2.7 1.4-4.6-.5-2.1-2.1-3.5-4.9-3.5H6.4l3.3 3.3a1 1 0 11-1.4 1.4l-5-5a1 1 0 010-1.4l5-5a1 1 0 011.4 1.4L6.4 8z" fill-rule="nonzero"></path></svg>
                                </span>
                                <span class="tx-20 px-2 py-1 custom-toolbar-redo">
                                  <svg width="24" height="20" fill="currentColor"><path d="M17.6 10H12c-2.8 0-4.4 1.4-4.9 3.5-.4 2 .3 4 1.4 4.6a1 1 0 11-1 1.8c-2-1.2-2.9-4.1-2.3-6.8.6-3 3-5.1 6.8-5.1h5.6l-3.3-3.3a1 1 0 111.4-1.4l5 5a1 1 0 010 1.4l-5 5a1 1 0 01-1.4-1.4l3.3-3.3z" fill-rule="nonzero"></path></svg>
                                </span>
                                <hr class="toolbar-divider">
                                <span class="tx-20 px-2 py-1 custom-toolbar-tiny_mce_wiris">
                                  <svg width="20" height="20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"viewBox="0 0 300 261.7" fill="currentColor" xml:space="preserve">
                                    <g id=icon-wirisformula stroke="none" stroke-width="0.2" fill-rule="evenodd"><g>
                                      <path class="st1" d="M90.2,257.7c-11.4,0-21.9-6.4-27-16.7l-60-119.9c-7.5-14.9-1.4-33.1,13.5-40.5c14.9-7.5,33.1-1.4,40.5,13.5l27.3,54.7L121.1,39c5.3-15.8,22.4-24.4,38.2-19.1c15.8,5.3,24.4,22.4,19.1,38.2l-59.6,179c-3.9,11.6-14.3,19.7-26.5,20.6C91.6,257.7,90.9,257.7,90.2,257.7"/></g></g><g><g><path class="st2" d="M300,32.8c0-16.4-13.4-29.7-29.9-29.7c-2.9,0-7.2,0.8-7.2,0.8c-37.9,9.1-71.3,14-112,14c-0.3,0-0.6,0-1,0c-16.5,0-29.9,13.3-29.9,29.7c0,16.4,13.4,29.7,29.9,29.7l0,0c45.3,0,83.1-5.3,125.3-15.3h0C289.3,59.5,300,47.4,300,32.8"/></g></g>
                                  </svg>
                                </span>
                                <span class="tx-20 px-2 py-1 custom-toolbar-clearformat" title="Remover formatação">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="remove-formatting"><path d="M4 7V4h16v3"/><path d="M5 20h6"/><path d="M13 4 8 20"/><path d="m15 15 5 5"/><path d="m20 15-5 5"/></svg>
                                </span>
                                <hr class="toolbar-divider">
                                <!-- Image and video -->
                                <span class="tx-20 px-2 py-1 custom-toolbar-image">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-image" viewBox="0 0 16 16">
                                    <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                                    <path d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2h-12zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1h12z"/>
                                  </svg>
                                </span>
                                <span class="tx-20 px-2 py-1 custom-toolbar-media">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-film" viewBox="0 0 16 16">
                                    <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zm4 0v6h8V1H4zm8 8H4v6h8V9zM1 1v2h2V1H1zm2 3H1v2h2V4zM1 7v2h2V7H1zm2 3H1v2h2v-2zm-2 3v2h2v-2H1zM15 1h-2v2h2V1zm-2 3v2h2V4h-2zm2 3h-2v2h2V7zm-2 3v2h2v-2h-2zm2 3h-2v2h2v-2z"/>
                                  </svg>
                                </span>
                                <span class="tx-20 px-2 py-1 custom-toolbar-mceInsertTable">
                                  <svg width="30" height="32" fill="currentColor" viewBox="2 0 26 26">
                                    <path fill-rule="nonzero" d="M19 4a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V6c0-1.1.9-2 2-2h14zM5 14v4h6v-4H5zm14 0h-6v4h6v-4zm0-6h-6v4h6V8zM5 12h6V8H5v4z"></path>
                                  </svg>
                                </span>
                                <span class="tx-20 px-2 custom-toolbar-insertHorizontalRule">
                                  <svg width="24" height="24" fill="currentColor">
                                    <path d="M4 11h16v2H4z" fill-rule="evenodd"></path>
                                  </svg>
                                </span>
                                <!-- Lists  -->
                                <hr class="toolbar-divider">
                                <span class="tx-20 px-2 py-1 custom-toolbar-numlist">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-list-ul" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
                                  </svg>
                                </span>
                                <span class="tx-20 px-2 py-1 custom-toolbar-bullist">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-list-ol" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5z"/>
                                    <path d="M1.713 11.865v-.474H2c.217 0 .363-.137.363-.317 0-.185-.158-.31-.361-.31-.223 0-.367.152-.373.31h-.59c.016-.467.373-.787.986-.787.588-.002.954.291.957.703a.595.595 0 0 1-.492.594v.033a.615.615 0 0 1 .569.631c.003.533-.502.8-1.051.8-.656 0-1-.37-1.008-.794h.582c.008.178.186.306.422.309.254 0 .424-.145.422-.35-.002-.195-.155-.348-.414-.348h-.3zm-.004-4.699h-.604v-.035c0-.408.295-.844.958-.844.583 0 .96.326.96.756 0 .389-.257.617-.476.848l-.537.572v.03h1.054V9H1.143v-.395l.957-.99c.138-.142.293-.304.293-.508 0-.18-.147-.32-.342-.32a.33.33 0 0 0-.342.338v.041zM2.564 5h-.635V2.924h-.031l-.598.42v-.567l.629-.443h.635V5z"/>
                                  </svg>
                                </span>
                                <!-- Sub -->
                                <hr class="toolbar-divider">
                                <span class="tx-20 px-2 py-1 custom-toolbar-superscript">
                                  <svg width="24" height="20" fill="currentColor"><path d="M15 9.4L10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11z" fill-rule="nonzero"></path></svg>
                                </span>
                                <span class="tx-20 px-2 py-1 custom-toolbar-subscript">
                                  <svg width="24" height="20" fill="currentColor"><path d="M10.4 10l4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10zM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 00-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 01-1.3 1.3l-.6.6h2.6V19z" fill-rule="nonzero"></path></svg>
                                </span>
                                <!-- Ident -->
                                <hr class="toolbar-divider">
                                <span class="tx-20 px-2 py-1 custom-toolbar-outdent" title="Diminuir recuo">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-text-indent-right" viewBox="0 0 16 16">
                                    <path d="M2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm10.646 2.146a.5.5 0 0 1 .708.708L11.707 8l1.647 1.646a.5.5 0 0 1-.708.708l-2-2a.5.5 0 0 1 0-.708l2-2zM2 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                                  </svg>
                                </span>
                                <span class="tx-20 px-2 py-1 custom-toolbar-indent" title="Aumentar recuo">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-text-indent-left" viewBox="0 0 16 16">
                                    <path d="M2 3.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm.646 2.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L4.293 8 2.646 6.354a.5.5 0 0 1 0-.708zM7 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm0 3a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5zm-5 3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                                  </svg>
                                </span>
                              </div>
                            </div>
                            <div class="card-body" style="overflow-y: auto;" :data-question="examQuestion.id">
                              <!-- Nav -->
                              <div class="row mb-0">
                                <div class="col-12 d-flex">
                                  <div class="d-flex align-items-center p-2 cp" :class="examQuestion.currentMenu == 'enunciation' ? 'lize-text-primary':''" @click="examQuestion.currentMenu = 'enunciation'" :style="examQuestion.currentMenu == 'enunciation' ? 'border-bottom: 2px solid #0C7BDB;': examQuestion.errors.alternatives || examQuestion.errors.enunciation ? 'background-color: #D92D2098; color: white; border-right: 3px solid white; border-top-left-radius: 8px; border-top-right-radius: 8px;':''">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                                      <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                                      <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                                    </svg>
                                    <span class="mx-2">
                                      Enunciado
                                    </span>
                                  </div>
                                  <button type="button" class="d-flex align-items-center p-2 cp" :class="examQuestion.currentMenu == 'feedback' ? 'lize-text-primary':''" @click="examQuestion.currentMenu = 'feedback', startTINYMCE(selectedExamQuestion, true)" :style="examQuestion.currentMenu == 'feedback' ? 'border-bottom: 2px solid #0C7BDB; ': examQuestion.errors.commentedAwnser || examQuestion.errors.answerVideo ? 'background-color: #D92D2098; color: white; border-right: 3px solid white; border-top-left-radius: 8px; border-top-right-radius: 8px;':''">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chat-text" viewBox="0 0 16 16">
                                      <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                                      <path d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8zm0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
                                    </svg>
                                    <span class="mx-2">
                                      Feedbacks
                                    </span>
                                  </button>
                                  <button type="button" class="d-flex align-items-center p-2 cp" :class="examQuestion.currentMenu == 'bncc' ? 'lize-text-primary':''" @click="examQuestion.currentMenu = 'bncc', getBNCC()" :style="examQuestion.currentMenu == 'bncc' ? 'border-bottom: 2px solid #0C7BDB; ': examQuestion.errors.topics || examQuestion.errors.competences || examQuestion.errors.abilities ? 'background-color: #D92D2098; color: white; border-right: 3px solid white; border-top-left-radius: 8px; border-top-right-radius: 8px;':''">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-book" viewBox="0 0 16 16">
                                      <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
                                    </svg>
                                    <span class="mx-2">
                                      Assuntos e BNCC
                                    </span>
                                  </button>
                                  <button type="button" class="d-flex align-items-center p-2 cp" :class="examQuestion.currentMenu == 'pedagogical' ? 'lize-text-primary':''" @click="examQuestion.currentMenu = 'pedagogical'" :style="examQuestion.currentMenu == 'pedagogical' ? 'border-bottom: 2px solid #0C7BDB; ' : examQuestion.errors.subject || examQuestion.errors.level ? 'background-color: #D92D2098; color: white; border-right: 3px solid white; border-top-left-radius: 8px; border-top-right-radius: 8px;':''">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                      <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                                    </svg>
                                    <span class="mx-2">
                                      Dados Pedagógicos
                                    </span>
                                  </button>
                                </div>
                                <div class="col-12 m-0">
                                  <hr class="my-0">
                                </div>
                              </div>
                              <div class="py-3" :style="{ 'overflow-y:scroll; overflow-x: hidden;': controls.show, height: getQuestionContentHeight(examQuestion) }">
                                <div v-show="examQuestion.currentMenu == 'enunciation'">
                                  <!-- Question Type -->
                                  <div class="row mb-1 pt-3 ">
                                    <div class="col-12 d-flex justify-content-between align-items-center">
                                      <label for="" class="text-muted cp" data-toggle="dropdown">
                                        ${examQuestion.question.categoryDisplay == 'Objetiva' ? 'Múltipla escolha':examQuestion.question.categoryDisplay}
                                        <i class="fas fa-chevron-down"></i>
                                      </label>
                                      <div class="dropdown-menu border-0 lize-text-warning" style="padding: 16px; border-radius: 8px;">
                                        <a class="dropdown-item d-flex align-items-center" href="javascript:;" @click="changeQuestionCategory(1)">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" stroke-width=".5" :stroke="examQuestion.question.categoryDisplay == 'Objetiva' ? '#FF8F3D':'#D0D3D9'" :fill="examQuestion.question.categoryDisplay == 'Objetiva' ? '#FF8F3D':'#D0D3D9'" class="bi bi-check2-square"  viewBox="0 0 16 16">
                                            <path d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5H3z"/>
                                            <path d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0z"/>
                                          </svg>
                                          <span class="mx-2">
                                            Múltipla escolha
                                          </span>
                                        </a>
                                        <a class="dropdown-item d-flex align-items-center" href="javascript:;" @click="changeQuestionCategory(0)">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" stroke-width=".5" :stroke="examQuestion.question.categoryDisplay == 'Discursiva' ? '#FF8F3D':'#D0D3D9'" :fill="examQuestion.question.categoryDisplay == 'Discursiva' ? '#FF8F3D':'#D0D3D9'" class="bi bi-pencil-fill" viewBox="0 0 16 16">
                                            <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                                          </svg>
                                          <span class="mx-2">
                                            Discursiva
                                          </span>
                                        </a>
                                        <a class="dropdown-item d-flex align-items-center" href="javascript:;" @click="changeQuestionCategory(2)">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" stroke-width=".5" :stroke="examQuestion.question.categoryDisplay == 'Arquivo anexado' ? '#FF8F3D':'#D0D3D9'" :fill="examQuestion.question.categoryDisplay == 'Arquivo anexado' ? '#FF8F3D':'#D0D3D9'" class="bi bi-paperclip" viewBox="0 0 16 16">
                                            <path d="M4.5 3a2.5 2.5 0 0 1 5 0v9a1.5 1.5 0 0 1-3 0V5a.5.5 0 0 1 1 0v7a.5.5 0 0 0 1 0V3a1.5 1.5 0 1 0-3 0v9a2.5 2.5 0 0 0 5 0V5a.5.5 0 0 1 1 0v7a3.5 3.5 0 1 1-7 0V3z"/>
                                          </svg>
                                          <span class="mx-2">
                                            Arquivo anexado
                                          </span>
                                        </a>
                                        {% if user.client_has_sum_questions %}
                                          <a class="dropdown-item d-flex align-items-center" href="javascript:;" @click="changeQuestionCategory(3)">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-patch-plus" viewBox="0 0 18 18">
                                              <path fill-rule="evenodd" :stroke="examQuestion.question.categoryDisplay == 'Somatório' ? '#FF8F3D':'#D0D3D9'" :fill="examQuestion.question.categoryDisplay == 'Somatório' ? '#FF8F3D':'#D0D3D9'" d="M8 5.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V10a.5.5 0 0 1-1 0V8.5H6a.5.5 0 0 1 0-1h1.5V6a.5.5 0 0 1 .5-.5"/>
                                              <path :stroke="examQuestion.question.categoryDisplay == 'Somatório' ? '#FF8F3D':'#D0D3D9'" :fill="examQuestion.question.categoryDisplay == 'Somatório' ? '#FF8F3D':'#D0D3D9'" d="m10.273 2.513-.921-.944.715-.698.622.637.89-.011a2.89 2.89 0 0 1 2.924 2.924l-.01.89.636.622a2.89 2.89 0 0 1 0 4.134l-.637.622.011.89a2.89 2.89 0 0 1-2.924 2.924l-.89-.01-.622.636a2.89 2.89 0 0 1-4.134 0l-.622-.637-.89.011a2.89 2.89 0 0 1-2.924-2.924l.01-.89-.636-.622a2.89 2.89 0 0 1 0-4.134l.637-.622-.011-.89a2.89 2.89 0 0 1 2.924-2.924l.89.01.622-.636a2.89 2.89 0 0 1 4.134 0l-.715.698a1.89 1.89 0 0 0-2.704 0l-.92.944-1.32-.016a1.89 1.89 0 0 0-1.911 1.912l.016 1.318-.944.921a1.89 1.89 0 0 0 0 2.704l.944.92-.016 1.32a1.89 1.89 0 0 0 1.912 1.911l1.318-.016.921.944a1.89 1.89 0 0 0 2.704 0l.92-.944 1.32.016a1.89 1.89 0 0 0 1.911-1.912l-.016-1.318.944-.921a1.89 1.89 0 0 0 0-2.704l-.944-.92.016-1.32a1.89 1.89 0 0 0-1.912-1.911z"/>
                                            </svg>
                                            <span class="mx-2">
                                              Somatório
                                            </span>
                                          </a>
                                        {% endif %}
                                        {% if user.client_has_cloze_questions %}
                                          <a class="dropdown-item d-flex align-items-center" href="javascript:;" @click="changeQuestionCategory(4)">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-patch-plus" viewBox="0 0 22 22">
                                              <path :stroke="examQuestion.question.categoryDisplay == 'Preencher lacunas' ? '#FF8F3D':'#D0D3D9'" :fill="examQuestion.question.categoryDisplay == 'Preencher lacunas' ? '#FF8F3D':'#D0D3D9'" d="M21 21V3M3 21V3M9 8V16C9 16.9319 9 17.3978 9.15224 17.7654C9.35523 18.2554 9.74458 18.6448 10.2346 18.8478C10.6022 19 11.0681 19 12 19C12.9319 19 13.3978 19 13.7654 18.8478C14.2554 18.6448 14.6448 18.2554 14.8478 17.7654C15 17.3978 15 16.9319 15 16V8C15 7.06812 15 6.60218 14.8478 6.23463C14.6448 5.74458 14.2554 5.35523 13.7654 5.15224C13.3978 5 12.9319 5 12 5C11.0681 5 10.6022 5 10.2346 5.15224C9.74458 5.35523 9.35523 5.74458 9.15224 6.23463C9 6.60218 9 7.06812 9 8Z"/>
                                            </svg>
                                            <span class="mx-2">
                                              Preencher lacunas
                                            </span>
                                          </a>
                                        {% endif %}
                                      </div>
                                      <template v-if="examQuestion.question.categoryDisplay == 'Discursiva'">
                                        <div @click="controls.show = true" class="d-flex flex-column">
                                          <div class="d-flex justify-content-between">
                                            <div class="d-flex align-items-center">
                                              <input type="checkbox" v-model="examQuestion.question.isEssay" @click="updateQuantityLines()" :id="'idIsEssay-' + examQuestion.id" style="height: 17px; max-width: 17px; border-radius: 8px;color: #d67b05;" class="form-control weight-input mx-2 text-center">
                                              <label for="examQuestion.question.isEssay" :for="'idIsEssay-' + examQuestion.id" class="mt-0 tx-14" style="color: #667085; min-width: 90px;">
                                                É redação 
                                                {% comment %}<i class="far fa-question-circle" id="essay_info" data-toggle="tooltip" data-placement="top" title="Uma página de redação será adicionada ao malote de prova para cada aluno"></i>{% endcomment %}
                                              </label>
                                            </div>
                                          </div>                                            
                                        </div>
                                      </template>
                                    </div>
                                  </div>
                                  <!-- Enunciation -->
                                  <div class="row">
                                    <div class="col-12">
                                      <div @click="editExamQuestion()">
                                        <strong v-if="examQuestion.question.board" class="mb-0" style="text-transform: uppercase">
                                          (${examQuestion.question.board ? examQuestion.question.board: ""}${examQuestion.question.elaborationYear  ? - examQuestion.question.elaborationYear : ''})
                                        </strong>
                                        <div v-show="examQuestion.tinyMCE.enunciation">
                                          <textarea class="questionEnunciation border-0" :id="'questionEnunciation-'+examQuestion.id">${examQuestion.question.enunciation}</textarea>
                                        </div>
                                        <div class="my-2 questions-text">
                                          <div v-if="!examQuestion.tinyMCE.enunciation" v-html="examQuestion.question.enunciation"></div>
                                        </div>
                                      </div>
                                    </div>
                                    <template v-if="examQuestion.errors.enunciation">
                                      <div class="col-12">
                                        <div class="alert alert-danger p-2">
                                          <p v-for="error in examQuestion.errors.enunciation" class="mb-0">${error}</p>
                                        </div>
                                      </div>
                                    </template>
                                  </div>
                                  <!-- Alternatives -->
                                  <div v-show="['Objetiva', 'Somatório'].includes(examQuestion.question.categoryDisplay)">
                                    <div class="row">
                                      <div class="col-12">
                                        <hr style="border-color: #E5E7EA40;">
                                      </div>
                                    </div>
                                    <div class="row mx-1">
                                      <template v-if="examQuestion.errors.alternatives">
                                        <div class="col-12 px-0">
                                          <div class="alert alert-danger p-2">
                                            <p v-for="error in examQuestion.errors.alternatives" class="mb-0">${error}</p>
                                          </div>
                                        </div>
                                      </template>
                                      <template v-if="controls.removingAlternative">
                                        <h6 class="text-center text-muted">Aguarde enquanto removemos a alternativa <i class="fas fa-spin fa-spinner"></i></h6>
                                      </template>
                                      <div v-show="!controls.removingAlternative" class="col-12">
                                        <div class="row">
                                          <template v-for="(alternative, alternativeIndex) in examQuestion.question.alternatives">
                                            <div class="col-12 my-1 d-flex align-items-center justify-content-between" :style="{ backgroundColor: alternative.isCorrect ? '#41C5881A':'#F9FAFA', borderRadius: '4px' }">
                                              <div class="d-flex align-items-center w-100">
                                                <span @click.prevent="setAlternativeIsCorrect(alternative)" class="rounded-circle cp d-flex align-items-center justify-content-center" :style="{ backgroundColor: alternative.isCorrect ? '#41C588':'', border: !alternative.isCorrect ? '1px solid #D2D6DB':'', width: '20px', height: '20px' }">
                                                  <template v-if="alternative.isCorrect">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-check2" viewBox="0 0 16 16">
                                                      <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                                                    </svg>
                                                  </template>
                                                  <template v-else><span style="width: 20px; height: 20px;">&nbsp;</span></template>
                                                </span>
                                                <span class="px-2 border-right" v-if="examQuestion.question.categoryDisplay == 'Somatório'">
                                                  ${generateAlternativeSum(alternativeIndex)}
                                                </span>
                                                <div class="alternativeContent mx-2 w-100" @click="editExamQuestion()">
                                                  <div v-show="alternative.tinyMCE">
                                                    <textarea :data-section="examQuestion.question.id" :id="'alternative-' + alternative.id" class="w-100" rows="2">${alternative.text}</textarea>
                                                  </div>
                                                  <template v-if="!alternative.tinyMCE">
                                                    <div class="py-3 questions-text">
                                                      <div v-html="alternative.text"></div>
                                                    </div>
                                                  </template>
                                                </div>
                                              </div>
                                              <svg xmlns="http://www.w3.org/2000/svg" style="width: 16px; height: 16px; color: #D0D3D9;" fill="currentColor" class="bi bi-x-lg cp hovable" viewBox="0 0 16 16" @click="deleteAlternative(alternative, alternativeIndex)">
                                                <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                              </svg>
                                            </div>
                                          </template>
                                        </div>
                                      </div>
                                      <div class="col-12 d-flex align-items-center mt-3 px-1 cp hovable mb-3" @click="addAlternative()">
                                        <svg xmlns="http://www.w3.org/2000/svg" color="#667085" width="16" height="16" stroke-width=".6" stroke="currentColor" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                                          <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2Z"/>
                                        </svg>
                                        <span style="color: #667085" class="mx-2 tx-14">
                                          Adicionar nova
                                        </span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <!-- Commented Answer -->
                                <div v-show="examQuestion.currentMenu == 'feedback'">
                                  <div class="lize-card" style="background-color: rgb(249, 250, 250)">
                                    <div class="card-body p-5">
                                      <div class="row">
                                        <div class="col-12">
                                          <label :for="'commentedAwnser-'+ examQuestion.id">Resposta comentada</label>
                                          <div class="bg-white border" style="border-radius: 8px;">
                                            <textarea :id="'commentedAwnser-'+ examQuestion.id" class="form-control">${examQuestion.question.commentedAwnser}</textarea>
                                          </div>
                                        </div>
                                        <div class="col-12 mt-2">
                                          <template v-if="examQuestion.errors.commentedAwnser">
                                            <div class="alert alert-danger p-2">
                                              <p v-for="error in examQuestion.errors.commentedAwnser" class="mb-0">${error}</p>
                                            </div>
                                          </template>
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col-12">
                                          <label :for="'feedback-'+ examQuestion.id">Feedback do Professor</label>
                                          <div class="bg-white border" style="border-radius: 8px;">
                                            <textarea :id="'feedback-'+ examQuestion.id" rows="5">${examQuestion.question.feedback}</textarea>
                                          </div>
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col-12">
                                          <label for="">Resposta comentada em vídeo</label>
                                          <div class="d-flex">
                                            <select class="form-control" @focus="controls.show = true" v-model="examQuestion.question.answerVideoType" style="max-width: 160px;" placeholder="Fonte do Vídeo">
                                              <option value="0">Youtube</option>
                                              <option value="1" selected>Panda</option>
                                            </select>
                                            <input class="form-control ml-3" @focus="controls.show = true" v-model="examQuestion.question.answerVideo" placeholder="Link da resposta em vídeo">
                                          </div>
                                          <template v-if="examQuestion.errors.answerVideo">
                                            <div class="alert alert-danger p-2 mt-1">
                                              <p v-for="error in examQuestion.errors.answerVideo" class="mb-0">${error}</p> 
                                            </div>
                                          </template>
                                        </div>
                                      </div>
                                      <div v-if="canAddSupportContentDiscursiveQuestions" class="row">
                                        <div class="col-12">
                                            <label :for="'supportContentQuestion-'+ examQuestion.id">Conteúdo de apoio à resposta discursiva</label>
                                            <div class="bg-white border" style="border-radius: 8px;">
                                              <textarea :id="'supportContentQuestion-'+ examQuestion.id" class="form-control">${examQuestion.question.supportContentQuestion}</textarea>
                                            </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <!-- BNCCs -->
                                <div v-show="examQuestion.currentMenu == 'bncc'">
                                  <div class="lize-card" style="background-color: rgb(249, 250, 250)">
                                    <div class="card-body">
                                      <div class="row">
                                        <div class="col p-4">
                                          <p class="tx-16">
                                            Vincular assuntos, habilidades e competências eleva o nível da questão e qualifica ainda mais o aprendizado. Clique nas opções abaixo para inserir.
                                          </p>
                                        </div>
                                        <div class="col" v-if="selectedExamQuestion">
                                          <div class="row">
                                            <div class="col-12 my-1">
                                              <div class="lize-card">
                                                <div class="card-body">
                                                  <h6 class="tx-16 tx-medium">Assuntos (${selectedExamQuestion.question.topics.length})</h6>
                                                  <p class="tx-12 tx-normal">Quais os assuntos pedagógicos estão vinculados a esta questão?</p>
                                                  <button href="javascript:;" class="lize-text-warning" data-toggle="modal" data-target="#modalTopics" :disabled="!enablesCreate">
                                                    <span v-if="enablesCreate">Selecionar</span>
                                                    <span v-else style="color: red;">Defina os dados pedagogicos</span>
                                                  </button>
                                                </div>
                                              </div>
                                            </div>
                                            <template v-if="examQuestion.errors.topics">
                                              <div class="col-12">
                                                <div class="alert alert-danger p-2 mt-1">
                                                  <p v-for="error in examQuestion.errors.topics" class="mb-0">${error}</p>
                                                </div>
                                              </div>
                                            </template>
                                            <div class="col-12 my-1">
                                              <div class="lize-card">
                                                <div class="card-body">
                                                  <h6 class="tx-16 tx-medium">Habilidades (${selectedExamQuestion.question.abilities.length})</h6>
                                                  <p class="tx-12 tx-normal">Quais habilidades são necessárias para realizar esta questão?</p>
                                                  <button href="javascript:;" class="lize-text-warning" data-toggle="modal" data-target="#modalAbilities" :disabled="!enablesCreate">
                                                    <span v-if="enablesCreate">Selecionar</span>
                                                    <span v-else style="color: red;">Defina os dados pedagogicos</span>
                                                  </button>
                                                </div>
                                              </div>
                                            </div>
                                            <template v-if="examQuestion.errors.abilities">
                                              <div class="col-12">
                                                <div class="alert alert-danger p-2 mt-1">
                                                  <p v-for="error in examQuestion.errors.abilities" class="mb-0">${error}</p>
                                                </div>
                                              </div>
                                            </template>
                                            <div class="col-12 my-1">
                                              <div class="lize-card">
                                                <div class="card-body">
                                                  <h6 class="tx-16 tx-medium">Competências (${selectedExamQuestion.question.competences.length})</h6>
                                                  <p class="tx-12 tx-normal">Quais habilidades são necessárias para realizar esta questão?</p>
                                                  <button href="javascript:;" class="lize-text-warning" data-toggle="modal" data-target="#modalCompetences" :disabled="!enablesCreate">
                                                    <span v-if="enablesCreate">Selecionar</span>
                                                    <span v-else style="color: red;">Defina os dados pedagogicos</span>
                                                  </button>
                                                </div>
                                              </div>
                                            </div>
                                            <template v-if="examQuestion.errors.competences">
                                              <div class="col-12">
                                                <div class="alert alert-danger p-2 mt-1">
                                                  <p v-for="error in examQuestion.errors.competences" class="mb-0">${error}</p>
                                                </div>
                                              </div>
                                            </template>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <!-- Pedagogical -->
                                <div v-if="examQuestion.currentMenu == 'pedagogical'">
                                  <div class="lize-card" style="background-color: rgb(249, 250, 250)">
                                    <div class="card-body p-5">
                                      <div class="row">
                                        <div class="col d-flex align-items-center">
                                          <label for="" class="mb-0">Segmento</label>
                                        </div>
                                        <div class="col">
                                          <select class="form-control" @focus="controls.show = true"  id="selectedSeguiment" style="border: 1px solid #D2D6DB; border-radius: 8px;" v-model="examQuestion.question.pedagogicalData.segment" @change="fetchGrades($event.target.value, true)">
                                            <option value="0">Ensino médio</option>
                                            <option value="1">Ensino fundamental 1</option>
                                            <option value="2">Ensino fundamental 2</option>
                                          </select>
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col d-flex align-items-center">
                                          <label for="" class="mb-0">Ano/Série</label>
                                        </div>
                                        <div class="col">
                                          <select class="form-control" @focus="controls.show = true" v-model="examQuestion.question.grade" style="border: 1px solid #D2D6DB; border-radius: 8px;" @change="fetchKnowledgeArea($event.target.value, true)">
                                            <option :value="grade.id" v-for="grade in examQuestion.question.pedagogicalData.grades" >${grade.full_name}</option>
                                          </select>
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col d-flex align-items-center">
                                          <label for="" class="mb-0">Área de Conhecimento</label>
                                        </div>
                                        <div class="col">
                                          <select class="form-control" @focus="controls.show = true" id="selectedknowledgeArea" style="border: 1px solid #D2D6DB; border-radius: 8px;" v-model="examQuestion.question.pedagogicalData.knowledgeArea" @change="fetchSubject($event.target.value)">
                                            <option :value="knowledgeArea.id" v-for="knowledgeArea in examQuestion.question.pedagogicalData.knowledgeAreas">${knowledgeArea.name}</option>
                                          </select>
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col d-flex align-items-center">
                                          <label for="" class="mb-0">Disciplina</label>
                                        </div>
                                        <div class="col">
                                          <select class="form-control" @focus="controls.show = true" id="selectedSubject" v-model="examQuestion.question.subject" style="border: 1px solid #D2D6DB; border-radius: 8px;">
                                            <option :value="subject.id" v-for="subject in examQuestion.question.pedagogicalData.subjects">${subject.name}</option>
                                          </select>
                                          <template v-if="examQuestion.errors.subject">
                                            <div class="alert alert-danger p-2 mt-1">
                                              <p v-for="error in examQuestion.errors.subject" class="mb-0">${error}</p>
                                            </div>
                                          </template>
                                        </div>
                                      </div>
                                      <div class="row">
                                        <div class="col d-flex align-items-center">
                                          <label for="" class="mb-0">Nível de Dificuldade</label>
                                        </div>
                                        <div class="col">
                                          <select class="form-control" @focus="controls.show = true" style="border: 1px solid #D2D6DB; border-radius: 8px;" v-model.number="examQuestion.question.level">
                                            <option value="3">Indefinido</option>
                                            <option value="0">Fácil</option>
                                            <option value="1">Médio</option>
                                            <option value="2">Difícil</option>
                                          </select>
                                          <template v-if="examQuestion.errors.level">
                                            <div class="alert alert-danger p-2 mt-1">
                                              <p v-for="error in examQuestion.errors.level" class="mb-0">${error}</p>
                                            </div>
                                          </template>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="m-3 p-3 rounded" style="background-color: #F9FBFA;" v-if="examQuestion.currentMenu == 'enunciation' && examQuestion.question.categoryDisplay == 'Preencher lacunas'">
                              <div class="row">
                                <div class="col-12 d-flex aling-items-center">
                                  <label class="d-flex align-items-center" :for="'clozeContent-' + examQuestion.id"><strong>Texto para preenchimento de lacunas</strong></label>
                                </div>
                                <div class="col-12">
                                  <div @click="controls.show = true" class="w-100">
                                    <div class="tw-relative tw-rounded-md tw-shadow-sm tw-items-center tw-inline-flex w-100"  data-toggle="tooltip" data-placement="top" title="Adicione o texto com as lacunas no formato [[texto]]">
                                      <textarea 
                                        :id="'clozeContent-' + examQuestion.id"
                                        name="quantity_lines"  
                                        v-model="examQuestion.question.clozeContent" 
                                        class="tw-block tooltips tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-7 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6"
                                        style="min-width: 100%; max-width: fit-content;"
                                        rows="5"
                                      ></textarea>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row">
                                <div class="col-12 d-flex aling-items-center">
                                  <label class="d-flex align-items-center" :for="'incorrectClozeAlternatives-' + examQuestion.id"><strong>Alternativas incorretas</strong></label>
                                </div>
                                <div class="col-12">
                                  <div @click="controls.show = true" class="w-100">
                                    <div class="tw-relative tw-rounded-md tw-shadow-sm tw-items-center tw-inline-flex w-100"  data-toggle="tooltip" data-placement="top" title="Definir alternativas incorretas opcionais, separando-as por vírgulas">
                                      <input 
                                        :id="'incorrectClozeAlternatives-' + examQuestion.id"
                                        name="quantity_lines"  
                                        v-model="examQuestion.question.incorrectClozeAlternatives" 
                                        class="tw-block tooltips tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-7 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6"
                                        style="min-width: 100%; max-width: fit-content;"
                                      />
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="m-3 p-3 rounded" style="background-color: #F9FBFA;" v-if="examQuestion.currentMenu == 'enunciation' && examQuestion.question.categoryDisplay == 'Discursiva'">
                              <div class="row">
                                <div class="col d-flex aling-items-center">
                                  <label class="d-flex align-items-center" :for="'quantityLines-' + examQuestion.id"><strong>Quantidade de linhas</strong></label>
                                </div>
                                <div class="col">
                                  <div @click="controls.show = true" class="d-flex justify-content-between align-items-center">
                                    <div class="tw-relative tw-rounded-md tw-shadow-sm tw-items-center tw-inline-flex w-100"  data-toggle="tooltip" data-placement="top" title="Definir quantidade de linhas e tipo de impressão de linhas">
                                      <input 
                                        :id="'quantityLines-' + examQuestion.id"
                                        name="quantity_lines"  
                                        v-model="examQuestion.question.quantityLines" 
                                        class="tw-block tooltips tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-7 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6"
                                        style="min-width: 100%; max-width: fit-content;"
                                      />
                                      <div class="tw-absolute tw-inset-y-0 tw-right-0 tw-flex tw-items-center">
                                        <label class="tw-sr-only">Formato da Questão</label>
                                        <select 
                                          v-model="examQuestion.question.textQuestionFormat" 
                                          class="tw-h-full tw-rounded-md tw-border-0 tw-bg-transparent tw-pl-2 tw-pr-7 tw-text-gray-500 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm"
                                          style="width: 100%;"
                                        >
                                          <option value="0">Espaço em branco</option>
                                          <option value="1">Imprimir linhas</option>
                                        </select>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="row mb-0">
                                <div class="col-6 d-flex align-items-center">
                                  <div class="custom-control custom-switch">
                                    <input type="checkbox" v-model="examQuestion.question.correctionWithCompetencies" id="idcorrectionWithCompetencies" name="correctionWithCompetencies" class="custom-control-input" />
                                    <label class="custom-control-label" for="idcorrectionWithCompetencies"><strong>Correção com competências</strong><label>
                                  </div>
                                </div>
                                <div class="col-6">
                                  <select class="form-control form-control-sm" style="border-radius: 8px;" v-model="examQuestion.question.textCorrection">
                                    <option value="" v-if="!examQuestion.question.correctionWithCompetencies">------------------</option>
                                    <option :value="textCorrection.id" v-for="textCorrection in textCorrections">${textCorrection.name}</option>
                                  </select>
                                </div>
                              </div>
                            </div>
                            <div class="card-footer py-3 d-flex align-items-center justify-content-between">
                              <div class="d-flex align-items-center cp hovable" data-toggle="modal" data-target="#modalBaseText" @click="startTINYMCEBaseTexts()">
                                <svg xmlns="http://www.w3.org/2000/svg" color="#D0D3D9" width="16" height="16" fill="currentColor" class="bi bi-journal-richtext" viewBox="0 0 16 16">
                                  <path d="M7.5 3.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0zm-.861 1.542 1.33.886 1.854-1.855a.25.25 0 0 1 .289-.047L11 4.75V7a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 7v-.5s1.54-1.274 1.639-1.208zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                                  <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>
                                  <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0v.5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>
                                </svg>
                                <span class="tx-14 mx-2" style="color: #667085;">${examQuestion.question.baseTexts.length ? examQuestion.question.baseTexts.length + 'Adicionar texto base selecionado(s)':'Adicionar texto base'}</span>
                              </div>

                              <div class="d-flex justify-content-between align-items-center">
                                {% if not user.is_freemium %}
                                  {% if not object.distribute_scores_freely %}
                                    <div class="d-flex align-items-center ">
                                      <template v-if="!['Reprovada', 'Usar depois'].includes(examQuestion.lastStatus.statusDisplay)">
                                        <label for="" class="mb-0 tx-14 tw-p-1" style="color: #667085;">Nota</label>
                                        {% if object.subject_note or object.exam.total_grade %}
                                          <input v-if="!['Reprovada', 'Usar depois'].includes(examQuestion.lastStatus.statusDisplay)" v-model="examQuestion.weight" maxlength="6" class="form-control weight-input mx-2" style="height: 32px; max-width: 80px; border-radius: 8px;" disabled>     
                                        {% else %}
                                          <input v-show="!['Reprovada', 'Usar depois'].includes(examQuestion.lastStatus.statusDisplay)" v-model="examQuestion.weight" @change="distributeWeightsExamQuestion()" placeholder="Nota" type="number" style="height: 32px; max-width: 120px; border-radius: 8px; margin-right: 2px;" step="any" class="form-control weight-input mx-2tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pr-10 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6"  required>     
                                        {% endif %}
                                      </template>
                                    </div>
                                    {% else %}
                                    <div class="tw-flex tw-items-center tw-gap-2.5">
                                      <label class="tw-text-sm tw-leading-7 tw-text-gray-900 tw-mb-0">Nota</label>
                                      <div class="tw-relative tw-flex tw-items-center">
                                          {% if object.exam.total_grade %}
                                            <input v-if="!['Reprovada', 'Usar depois'].includes(examQuestion.lastStatus.statusDisplay)"  @click="controls.show = true" v-model="examQuestion.weight" maxlength="6" class="form-control weight-input mx-2" style="height: 32px; max-width: 80px; border-radius: 8px;" disabled>     
                                          {% else %}
                                            <input :disabled="!examQuestion.blockWeight"  v-show="!['Reprovada', 'Usar depois'].includes(examQuestion.lastStatus.statusDisplay)" @click="controls.show = true" v-model="examQuestion.weight" min="0" placeholder="Nota" type="number" style="height: 32px; max-width: 120px; border-radius: 8px; margin-right: 2px;" step="any" class="form-control weight-input mx-2tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pr-10 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" required>     
                                            <div class="tw-absolute tw-inset-y-0 tw-right-0 tw-flex tw-py-1 tw-pr-1.5">
                                              <div class="tw-flex tw-space-x-1 tw-rounded-lg tw-bg-slate-200 tw-p-0.5">
                                                <button
                                                  type="button"
                                                  id="block_weight_button"
                                                  class="tw-flex tw-items-center tw-rounded-md tw-p-1 tw-text-sm tw-font-semibold"
                                                  :class="[examQuestion.question.blockWeight ? 'tw-bg-white tw-shadow' : '']"
                                                  @click="updateBlockWeight(examQuestion), controls.show = true"
                                                  :disabled="isBlockButtonDisabled(examTeacherSubject.examQuestions, examQuestion)"
                                                  data-toggle="tooltip"         
                                                  :title="getTooltipMessage(examQuestion)"
                                                  >
                                                  <template v-if="examQuestion.blockWeight" >
                                                    <span class="tw-text-red-600">
                                                      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-w-4 tw-h-4">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                                                      </svg>
                                                    </span>
                                                  </template>
                                                  <template v-else >
                                                    <span class="tw-text-green-600">
                                                      <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="tw-w-4 tw-h-4"  data-toggle="tooltip">
                                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 10.5V6.75a4.5 4.5 0 1 1 9 0v3.75M3.75 21.75h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H3.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z" />
                                                      </svg>
                                                    </span>
                                                  </template>
                                                </button>
                                              </div>
                                            </div>
                                        {% endif %}   
                                      </div>
                                    </div>
                                    <div class="tw-ml-1" :class="[totalBlockedWeightQuestions > subjectNote ? 'visible' : 'invisible']">
                                      <svg class="tw-h-5 tw-w-5 tw-text-red-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-toggle="tooltip" title="A soma das notas das questões ultrapassa o valor total permitido.">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
                                      </svg>
                                    </div> 
                                  {% endif %}
                                {% endif %}
                                
                                {% if user.inspector.has_ia_creation or user.client_has_ia_creation %}
                                  <template v-if="selectedExamQuestion == examQuestion && !controls.loadingQuestionCreate && !examQuestion.canUpdate()">
                                    <div>
                                      <button style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" @click="createWithIA()">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#FF8F3D" class="my-2 bi bi-stars" viewBox="0 0 16 16">
                                          <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                                        </svg>
                                        Criar com IA
                                      </button>
                                    </div>
                                  </template>
                                {% endif %}
                                <div v-if="(!examQuestion.canUpdate() || controls.show) && !controls.improving.getImproving()" class="d-flex">
                                  <button style="height: 32px; border-radius: 8px;" id="edit-question-cancel" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" v-if="examTeacherSubject.examQuestions.length > 1" @click="cancel()">Cancelar</button>
                                  <button type="button" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lize-btn-primary" :disabled="controls.saving || totalBlockedWeightQuestions > subjectNote" @click="save()">${controls.saving ? 'Salvando...':'Salvar'}</button>
                                </div>
                                {% if user.inspector.has_ia_creation or user.client_has_ia_creation %}
                                  <template v-if="!Boolean(`{{user.is_freemium|default:''}}`) || credits.canCreateAiQuestion">
                                    <template v-if="examQuestion.canUpdate() && !controls.loadingQuestionCreate && !examQuestion.question.createdWithAi ">
                                      <div>
                                        <button type="button" @click="controls.show = true, improveQuestion(examQuestion)" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" :disabled="controls.improving.getImproving()">
                                          <template v-if="controls.improving.getImproving()">
                                            Aprimorando
                                            <i class="fas fa-spin fa-spinner mx-2"></i>
                                          </template>
                                          <template v-else>
                                            Aprimorar questão
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="cp hovable mx-2 bi bi-magic" viewBox="0 0 16 16">
                                              <path d="M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0v1.829Zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707L14 2.707ZM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707L7.293 4Zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1h1.829Zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1h1.829ZM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707L13.293 10ZM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0v1.829Zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0L8.354 9.06Z"/>
                                            </svg>
                                          </template>
                                        </button>
                                      </div>
                                    </template> 
                                  </template> 
                                {% endif %}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!-- Separator -->
                      <div class="w-100 d-flex justify-content-center align-items-center my-3" v-if="!controls.show">
                        <div style="width: 330px; border-bottom: 1px solid #E5E7EA"></div>
                        <div class="dropdown dropup" v-if="canAddExamQuestion">
                          <svg xmlns="http://www.w3.org/2000/svg" data-toggle="dropdown" @mouseenter="examQuestion.showOptions = true, $forceUpdate()" width="20" height="20" fill="#D0D3D9" class="cp bi bi-plus-circle mx-1 questionCreation" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                          </svg>
                          <div class="border-0 dropdown-menu shadow mb-0" :class="{ 'show': examQuestion.showOptions }" style="width: 300px; height: 92px; left: calc(50% - 152px);" @mouseleave="examQuestion.showOptions = false, $forceUpdate()">
                            <div class="row m-0">
                              <div class="col-3 px-1">
                                <div class="d-flex flex-column align-items-center text-center m-2 cp" @click="addNewQuestion()">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" stroke-width=".5" stroke="#FF8F3D" fill="#FF8F3D" class="my-2 bi bi-file-earmark-plus" viewBox="0 0 16 16">
                                    <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5z"/>
                                    <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                                  </svg>
                                  <small>Nova <br>questão</small>
                                </div>
                              </div>
                              <div class="col-3 px-1">
                                <div class="d-flex flex-column align-items-center text-center m-2 cp" @click="createWithQuestionsBank()">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" stroke-width=".5" stroke="#FF8F3D" fill="#FF8F3D" class="my-2 bi bi-folder2" viewBox="0 0 16 16">
                                    <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v7a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 12.5v-9zM2.5 3a.5.5 0 0 0-.5.5V6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5zM14 7H2v5.5a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V7z"/>
                                  </svg>
                                  <small>Banco <br>questão</small>
                                </div>
                              </div>
                              
                              {% if not user.is_freemium %}
                                <div class="col-3 px-1">
                                  <div class="d-flex flex-column align-items-center text-center m-2 cp" @click="createWithFile()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" stroke-width=".5" stroke="#FF8F3D" fill="#FF8F3D" class="my-2 bi bi-cloud-upload" viewBox="0 0 16 16">
                                      <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
                                      <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z"/>
                                    </svg>
                                    <small>Importar <br>.docx</small>
                                  </div>
                                </div>
                              {% endif %}
                              
                              {% if user.inspector.has_ia_creation or user.client_has_ia_creation %}
                                <div class="col-3 px-1">
                                  <div class="d-flex flex-column align-items-center text-center m-2 cp" @click="createWithIA()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" stroke-width=".5" stroke="#FF8F3D" fill="#FF8F3D" class="my-2 bi bi-stars" viewBox="0 0 16 16">
                                      <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                                    </svg>
                                    <small>Crie <br> com IA</small>
                                  </div>
                                </div>
                              {% endif %}
                            </div>
                            <div class="bg-white rounded" style="width: 24px; height: 24px; position: relative; bottom: 16px; left: calc(50% - 10px); transform:rotate(45deg);"></div>
                          </div>
                        </div>
                        <div style="width: 330px; border-bottom: 1px solid #E5E7EA"></div>
                      </div>
                    </div>
                    <template v-if="selectedExamQuestion">
                      <div class="px-4 py-2" style="max-width: 300px;" v-if="!selectedExamQuestion.question.createdWithAi && canShowSuggestions(examQuestion) || selectedExamQuestion == examQuestion && controls.improving.getImproving()">
                        <div class="row m-0">
                          <div class="col-12 px-1">
                            <span class="lize-bg-warning-light rounded-circle d-flex align-center" style="width: 64px; height: 64px;">
                              <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="#FF8F3D" style="color: #667085 !important;" class="cp hovable mx-2 bi bi-magic" viewBox="0 0 16 16">
                                <path d="M9.5 2.672a.5.5 0 1 0 1 0V.843a.5.5 0 0 0-1 0v1.829Zm4.5.035A.5.5 0 0 0 13.293 2L12 3.293a.5.5 0 1 0 .707.707L14 2.707ZM7.293 4A.5.5 0 1 0 8 3.293L6.707 2A.5.5 0 0 0 6 2.707L7.293 4Zm-.621 2.5a.5.5 0 1 0 0-1H4.843a.5.5 0 1 0 0 1h1.829Zm8.485 0a.5.5 0 1 0 0-1h-1.829a.5.5 0 0 0 0 1h1.829ZM13.293 10A.5.5 0 1 0 14 9.293L12.707 8a.5.5 0 1 0-.707.707L13.293 10ZM9.5 11.157a.5.5 0 0 0 1 0V9.328a.5.5 0 0 0-1 0v1.829Zm1.854-5.097a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L8.646 5.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0l1.293-1.293Zm-3 3a.5.5 0 0 0 0-.706l-.708-.708a.5.5 0 0 0-.707 0L.646 13.94a.5.5 0 0 0 0 .707l.708.708a.5.5 0 0 0 .707 0L8.354 9.06Z"/>
                              </svg>
                            </span>
                          </div>
                          <div class="col-12 px-1">
                            <template v-if="controls.improving.getImproving()">
                              <h6 class="text tx-14 fw-500">Buscando aprimoramentos...</h6>
                              <p class="text-muted tx-12">Estamos analisando a questão para oferecer sugestões úteis. Aguarde um momento.</p>
                            </template>
                            <template v-else>
                              <h6 class="text tx-14 fw-500">Nossa IA sugeriu essas mudanças</h6>
                              <p class="text-muted tx-12">Selecione as que você considera adequadas e clique em aplicar.</p>
                            </template>
                          </div>
                          <div class="col-12" style="max-height: calc(100vh - 300px); overflow-y: auto;">
                            <div class="row">
                              <!-- Enunciation -->
                              <template v-if="controls.improving.enunciation">
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;">
                                  <h6>
                                    Aprimorando Enunciado 
                                    <i class="fas fa-spin fa-spinner mx-1"></i>
                                  </h6>
                                  <p class="tx-12" style="max-height: 140px; overflow-y: auto;">
                                    Analisando estrutura gramatical e semântica para melhorar compreensão.
                                  </p>
                                </div>
                              </template>
                              <template v-else>
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" @click="selectedSuggestion.type = 'enunciation', selectedSuggestion.text = examQuestion.question.improve.enunciation, selectedSuggestion.alternatives = examQuestion.question.improve.alternatives" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;" v-if="examQuestion.question.improve.enunciationStatusDisplay != 'Ignorado' && examQuestion.question.improve.enunciationCorrectionDetail">
                                  <h6>Enunciado e alternativas</h6>
                                  <p class="tx-12">
                                    Encontramos sugestões para aprimorar o enunciado e alternativas da questão!
                                  </p>
                                  <div v-if="examQuestion.question.improve.enunciationStatusDisplay != 'Aplicado'" class="d-flex align-items-center justify-content-center mb-2">
                                    <a href="javascript:;" data-toggle="modal" data-target="#modalPreviewText" style="color: #FF8F3D;" class="mx-2 d-flex align-items-center">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-eye mx-2" viewBox="0 0 16 16">
                                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"></path>
                                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"></path>
                                      </svg>
                                      Ver sugestão
                                    </a>
                                  </div>
                                  <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center" @click="applySuggestion(selectedExamQuestion, 'enunciation')">
                                      <div class="custom-check d-flex align-items-center justify-content-center" :class="examQuestion.question.improve.enunciationStatusDisplay == 'Aplicado' ? 'lize-bg-warning border-0':'bg-white'">
                                        <span>
                                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                                          </svg>
                                        </span>
                                      </div>
                                      <span class="mx-2 cp">Aplicar</span>
                                    </div>
                                    <a href="javascript:;" style="color: #FF8F3D;" v-if="examQuestion.question.improve.enunciationStatusDisplay != 'Aplicado'" class="mx-2" @click="ignoreSuggestion('enunciation')">Ignorar</a>
                                  </div>
                                </div>
                              </template>
                              <!-- End Enunciation -->
      
                              <!-- Commented answer -->
                              <template v-if="controls.improving.commentedAnswer">
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;">
                                  <h6>
                                    Resolvendo Questão 
                                    <i class="fas fa-spin fa-spinner mx-1"></i>
                                  </h6>
                                  <p class="tx-12" style="max-height: 140px; overflow-y: auto;">
                                    Explicando conceitos-chave relacionados à questão.
                                  </p>
                                </div>
                              </template>
                              <template v-else>
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" @click="selectedSuggestion.type = 'commentedAnswer', selectedSuggestion.text = examQuestion.question.improve.commentedAnswer" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;" v-if="examQuestion.question.improve.commentedAnswerStatusDisplay != 'Ignorado' && examQuestion.question.improve.commentedAnswer">
                                  <h6>Resposta comentada</h6>
                                  <p class="tx-12 mb-2">
                                    Analisamos a questão e geramos uma solução passo a passo para auxiliar no entendimento e na resolução.
                                  </p>
                                  <div v-if="examQuestion.question.improve.commentedAnswerStatusDisplay != 'Aplicado'" class="d-flex align-items-center justify-content-center mb-2">
                                    <a href="javascript:;" data-toggle="modal" data-target="#modalPreviewText" style="color: #FF8F3D;" class="mx-2 d-flex align-items-center">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-eye mx-2" viewBox="0 0 16 16">
                                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"></path>
                                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"></path>
                                      </svg>
                                      Ver sugestão
                                    </a>
                                  </div>
                                  <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center" @click="applySuggestion(selectedExamQuestion, 'commentedAnswer')">
                                      <div class="custom-check d-flex align-items-center justify-content-center" :class="examQuestion.question.improve.commentedAnswerStatusDisplay == 'Aplicado' ? 'lize-bg-warning border-0':'bg-white'">
                                        <span>
                                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                                          </svg>
                                        </span>
                                      </div>
                                      <span class="mx-2 cp">Aplicar</span>
                                    </div>
                                    <a href="javascript:;" style="color: #FF8F3D;" v-if="examQuestion.question.improve.commentedAnswerStatusDisplay != 'Aplicado'" class="mx-2" @click="ignoreSuggestion('commentedAnswer')">Ignorar</a>
                                  </div>
                                </div>
                              </template>
                              <!-- End Commented answer -->
      
                              <!-- Topics -->
                              <template v-if="controls.improving.topics">
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;">
                                  <h6>
                                    Buscando Assuntos 
                                    <i class="fas fa-spin fa-spinner mx-1"></i>
                                  </h6>
                                  <p class="tx-12" style="max-height: 140px; overflow-y: auto;">
                                    Sugestões para desenvolver assuntos específicas durante a resolução.
                                  </p>
                                </div>
                              </template>
                              <template v-else>
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" @click="selectedSuggestion.type = 'topics', selectedSuggestion.bnccs = examQuestion.question.improve.topics" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;" v-if="examQuestion.question.improve.topicsStatusDisplay != 'Ignorado' && examQuestion.question.improve.topics.length">
                                  <h6>Assuntos</h6>
                                  <p class="tx-12">Sugerimos para esta questão as seguintes assuntos</p>
                                  <div class="mb-1">
                                    <h6 href="#" class="tx-12 mb-1 text-truncate" v-for="topic in examQuestion.question.improve.topics.slice(0, 3)" :title="topic.name">${topic.name}</h6>
                                  </div>
                                  <div v-if="examQuestion.question.improve.topics != 'Aplicado'" class="d-flex align-items-center justify-content-center mb-2">
                                    <a href="javascript:;" data-toggle="modal" data-target="#modalBNCCPreview" style="color: #FF8F3D;" class="mx-2 d-flex align-items-center">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-eye mx-2" viewBox="0 0 16 16">
                                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"></path>
                                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"></path>
                                      </svg>
                                      Ver sugestão
                                    </a>
                                  </div>
                                  <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center" @click="applySuggestion(selectedExamQuestion, 'topics')">
                                      <div class="custom-check d-flex align-items-center justify-content-center" :class="examQuestion.question.improve.topics == 'Aplicado' ? 'lize-bg-warning border-0':'bg-white'">
                                        <span>
                                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                                          </svg>
                                        </span>
                                      </div>
                                      <span class="mx-2 cp">Aplicar</span>
                                    </div>
                                    <a href="javascript:;" style="color: #FF8F3D;" v-if="examQuestion.question.improve.topics != 'Aplicado'" class="mx-2" @click="ignoreSuggestion('topics')">Ignorar</a>
                                  </div>
                                </div>
                              </template>
                              <!-- End topics -->
      
                              <!-- Abilities -->
                              <template v-if="controls.improving.abilities">
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;">
                                  <h6>
                                    Buscando Habilidades 
                                    <i class="fas fa-spin fa-spinner mx-1"></i>
                                  </h6>
                                  <p class="tx-12" style="max-height: 140px; overflow-y: auto;">
                                    Sugestões para desenvolver habilidades específicas durante a resolução.
                                  </p>
                                </div>
                              </template>
                              <template v-else>
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" @click="selectedSuggestion.type = 'abilities', selectedSuggestion.bnccs = examQuestion.question.improve.abilities" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;" v-if="examQuestion.question.improve.abilitiesStatusDisplay != 'Ignorado' && examQuestion.question.improve.abilities.length">
                                  <h6>Habilidades</h6>
                                  <p class="tx-12">Sugerimos para esta questão as seguintes habilidades</p>
                                  <div class="mb-1">
                                    <h6 href="#" class="tx-12 mb-1 text-truncate" v-for="ability in examQuestion.question.improve.abilities.slice(0, 3)" :title="ability.text"><span v-if="ability.code">${ability.code} -</span> ${ability.text}</h6>
                                  </div>
                                  <div v-if="examQuestion.question.improve.abilitiesStatusDisplay != 'Aplicado'" class="d-flex align-items-center justify-content-center mb-2">
                                    <a href="javascript:;" data-toggle="modal" data-target="#modalBNCCPreview" style="color: #FF8F3D;" class="mx-2 d-flex align-items-center">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-eye mx-2" viewBox="0 0 16 16">
                                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"></path>
                                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"></path>
                                      </svg>
                                      Ver sugestão
                                    </a>
                                  </div>
                                  <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center" @click="applySuggestion(selectedExamQuestion, 'abilities')">
                                      <div class="custom-check d-flex align-items-center justify-content-center" :class="examQuestion.question.improve.abilitiesStatusDisplay == 'Aplicado' ? 'lize-bg-warning border-0':'bg-white'">
                                        <span>
                                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                                          </svg>
                                        </span>
                                      </div>
                                      <span class="mx-2 cp">Aplicar</span>
                                    </div>
                                    <a href="javascript:;" style="color: #FF8F3D;" v-if="examQuestion.question.improve.abilitiesStatusDisplay != 'Aplicado'" class="mx-2" @click="ignoreSuggestion('abilities')">Ignorar</a>
                                  </div>
                                </div>
                              </template>
                              <!-- End Abilities -->
      
                              <!-- Competences -->
                              <template v-if="controls.improving.competences">
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;">
                                  <h6>
                                    Buscando Competências 
                                    <i class="fas fa-spin fa-spinner mx-1"></i>
                                  </h6>
                                  <p class="tx-12" style="max-height: 140px; overflow-y: auto;">
                                    Sugestões para desenvolver competências específicas durante a resolução.
                                  </p>
                                </div>
                              </template>
                              <template v-else>
                                <div class="col-12 my-2 py-3 pl-2 pr-1 fw-400" @click="selectedSuggestion.type = 'competences', selectedSuggestion.bnccs = examQuestion.question.improve.competences" style="border-radius: 8px; background: #FFF4EC; color: #6C727F;" v-if="examQuestion.question.improve.competencesStatusDisplay != 'Ignorado' && examQuestion.question.improve.competences.length">
                                  <h6>Competências</h6>
                                  <p class="tx-12">Sugerimos para esta questão as seguintes competências</p>
                                  <div class="mb-1">
                                    <h6 href="#" class="tx-12 mb-1 text-truncate" v-for="competence in examQuestion.question.improve.competences.slice(0, 3)" :title="competence.text"><span v-if="competence.code">${competence.code} -</span> ${competence.text}</h6>
                                  </div>
                                  <div v-if="examQuestion.question.improve.competencesStatusDisplay != 'Aplicado'" class="d-flex align-items-center justify-content-center mb-2">
                                    <a href="javascript:;" data-toggle="modal" data-target="#modalBNCCPreview" style="color: #FF8F3D;" class="mx-2 d-flex align-items-center">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" class="bi bi-eye mx-2" viewBox="0 0 16 16">
                                        <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"></path>
                                        <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"></path>
                                      </svg>
                                      Ver sugestão
                                    </a>
                                  </div>
                                  <div class="d-flex align-items-center justify-content-between">
                                    <div class="d-flex align-items-center" @click="applySuggestion(selectedExamQuestion, 'competences')">
                                      <div class="custom-check d-flex align-items-center justify-content-center" :class="examQuestion.question.improve.competencesStatusDisplay == 'Aplicado' ? 'lize-bg-warning border-0':'bg-white'">
                                        <span>
                                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                                          </svg>
                                        </span>
                                      </div>
                                      <span class="mx-2 cp">Aplicar</span>
                                    </div>
                                    <a href="javascript:;" style="color: #FF8F3D;" v-if="examQuestion.question.improve.competencesStatusDisplay != 'Aplicado'" class="mx-2" @click="ignoreSuggestion('competences')">Ignorar</a>
                                  </div>
                                </div>
                              </template>
                              <!-- End Competences -->
                            </div>
                          </div>
                        </div>  
                      </div>
                    </template>
                  </div>
                </div>
              </template>
              <template v-else>
                <div class="d-flex justify-content-center align-items-center flex-column h-100">
                  <img src="">
                  <h4 class="text text-muted">Aguarde enquanto alteramos a posição da questão</h4>
                  <p class="text text-muted">Este processo é rápido, breve você poderá alterar as questões</p>
                </div>
              </template>
            </div>
            <div v-if="controls.width < 992" @click="controls.showRightBar = !controls.showRightBar" class="d-flex flex-column justify-content-center" :style="{ zoom: controls.width / 1200 * 1.5 }" style="max-height: calc(100vh - 60px); padding: 2.5px; color: #333333A1; background-color: white;">
              <template v-if="controls.showRightBar">
                <svg width="100%" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </template>
              <template v-else>
                <svg width="100%" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </template>
            </div>
            <div class="col-2 px-0 d-flex flex-column justify-content-between" v-if="controls.width >= 992 || controls.showRightBar" style="max-height: calc(100vh - 60px); border-left: 1px solid #E5E7EA;">
              <div :style="{ zoom: controls.width < 1200 ? controls.width / 1200 : 1 }">
                {% if not user.is_freemium %}
                  <div class="right-body-header">
                    <div class="p-3">
                      <small class="text-muted">Progresso</small>
                      <div class="d-flex mt-2 align-items-center">
                        <div class="progress w-100" style="height: 8px;" v-if="examTeacherSubject">
                          <div class="progress-bar" role="progressbar" :style="{ width: progressPercent() + '%' }" aria-valuenow="progressPercent()" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <div class="d-flex tx-14 mx-2">
                          ${progressPercent()}%
                        </div>
                      </div>
                    </div>
                  </div>
                {% endif %}
                  
                <hr class="my-0" style="border-color: #E5E7EA !important;">
                <div class="p-3">
                  <p class="text-muted d-flex align-items-center mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-book mx-2 lize-text-gray" viewBox="0 0 16 16">
                      <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811V2.828zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492V2.687zM8 1.783C7.015.936 5.587.81 4.287.94c-1.514.153-3.042.672-3.994 1.105A.5.5 0 0 0 0 2.5v11a.5.5 0 0 0 .707.455c.882-.4 2.303-.881 3.68-1.02 1.409-.142 2.59.087 3.223.877a.5.5 0 0 0 .78 0c.633-.79 1.814-1.019 3.222-.877 1.378.139 2.8.62 3.681 1.02A.5.5 0 0 0 16 13.5v-11a.5.5 0 0 0-.293-.455c-.952-.433-2.48-.952-3.994-1.105C10.413.809 8.985.936 8 1.783z"/>
                    </svg>
                    {{object.teacher_subject.subject.name}}
                  </p>
                  <p class="text-muted d-flex align-items-center mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people mx-2 lize-text-gray" viewBox="0 0 16 16">
                      <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8Zm-7.978-1A.261.261 0 0 1 7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002a.274.274 0 0 1-.014.002H7.022ZM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816ZM4.92 10A5.493 5.493 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0Zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4Z"/>
                    </svg>
                    {{object.grade}}
                  </p>
                  
                  {% if not elaborated_by_me %}
                  
                    {% if object.objective_quantity or object.discursive_quantity %}
                      {% if object.objective_quantity %}
                        <p class="text-muted d-flex align-items-center mb-2">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-layers-half mx-2 lize-text-gray" viewBox="0 0 16 16">
                            <path d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z"/>
                          </svg>
                          {{object.objective_quantity}} Objetivas
                        </p>
                      {% endif %}

                      {% if  object.discursive_quantity %}
                      <p class="text-muted d-flex align-items-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-layers-half mx-2 lize-text-gray" viewBox="0 0 16 16">
                          <path d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z"/>
                        </svg>
                        {{object.discursive_quantity}} Discursivas
                      </p>
                      {% endif %}

                    {% else %}
                      <p class="text-muted d-flex align-items-center mb-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-layers-half mx-2 lize-text-gray" viewBox="0 0 16 16">
                          <path d="M8.235 1.559a.5.5 0 0 0-.47 0l-7.5 4a.5.5 0 0 0 0 .882L3.188 8 .264 9.559a.5.5 0 0 0 0 .882l7.5 4a.5.5 0 0 0 .47 0l7.5-4a.5.5 0 0 0 0-.882L12.813 8l2.922-1.559a.5.5 0 0 0 0-.882l-7.5-4zM8 9.433 1.562 6 8 2.567 14.438 6 8 9.433z"/>
                        </svg>
                        {{object.quantity}} questões
                      </p>
                    {% endif %}
                                            
                    <p v-if="subjectNote != 0" class="text-muted d-flex align-items-center mb-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-2 lize-text-gray"><path d="M12 2a10 10 0 0 1 7.38 16.75"/><path d="M12 8v8"/><path d="M16 12H8"/><path d="M2.5 8.875a10 10 0 0 0-.5 3"/><path d="M2.83 16a10 10 0 0 0 2.43 3.4"/><path d="M4.636 5.235a10 10 0 0 1 .891-.857"/><path d="M8.644 21.42a10 10 0 0 0 7.631-.38"/></svg>
                      ${subjectNote}                  
                    </p>
                    <p v-else class="text-muted d-flex align-items-center mb-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-2 lize-text-gray"><path d="M12 2a10 10 0 0 1 7.38 16.75"/><path d="M12 8v8"/><path d="M16 12H8"/><path d="M2.5 8.875a10 10 0 0 0-.5 3"/><path d="M2.83 16a10 10 0 0 0 2.43 3.4"/><path d="M4.636 5.235a10 10 0 0 1 .891-.857"/><path d="M8.644 21.42a10 10 0 0 0 7.631-.38"/></svg>
                      ${Number(totalizer).toFixed(5)} pontos
                    </p>
                  {% else %}
                    <p class="text-muted d-flex align-items-center mb-2">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mx-2 lize-text-gray"><path d="M12 2a10 10 0 0 1 7.38 16.75"/><path d="M12 8v8"/><path d="M16 12H8"/><path d="M2.5 8.875a10 10 0 0 0-.5 3"/><path d="M2.83 16a10 10 0 0 0 2.43 3.4"/><path d="M4.636 5.235a10 10 0 0 1 .891-.857"/><path d="M8.644 21.42a10 10 0 0 0 7.631-.38"/></svg>
                      ${Number(totalizer).toFixed(5)} pontos
                    </p>
                  {% endif %}
                  
                  {% if object.note %}
                    <p class="text-muted align-items-center mb-2">
                      <span class="font-weight-bold">Obs.:</span> {{ object.note|slice:":50" }}
                      {% if object.note|slice:"50:" %}
                        <span id="more-text" class="hidden-text">{{ object.note|slice:"50:" }}</span>
                        <span id="toggle-button" class="show-more" @click="toggleText()">Ver mais</span>
                      {% endif %}
                    </p>
                  {% endif %}
                </div>
                {% if not user.is_freemium %}
                  <hr class="my-0" style="border-color: #E5E7EA !important;">
                  <div class="right-body">
                    <div class="p-3">
                      <div class="d-flex align-items-center justify-content-between">
                        <label class="text-muted mb-0" for="distributeWeightExamTeacherSubjectID">Distribuir nota</label>
                        <div class="d-flex align-items-center" style="max-width: 120px;">
                          {% if object.subject_note or object.exam.total_grade %}
                            <input type="text" class="form-control lize-form-control" id="distributeWeightExamTeacherSubjectID" disabled placeholder="{{object.exam.total_grade|floatformat:4}}">
                          {% else %}
                            <input type="text" class="form-control lize-form-control" v-model.number="weights" :disabled="controls.loadingDistributeWeights" @keyup.enter="distributeWeightsExamTeacherSubject()" @blur="distributeWeightsExamTeacherSubject()" id="distributeWeightExamTeacherSubjectID" placeholder="5.0000">
                          {% endif %}
                          <span style="position: relative; margin-left: -30px; color: #D2D6DB;"><i class="fas fa-random"></i></span>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endif %}

                <hr class="my-0" style="border-color: #E5E7EA !important;">
                
                {% if not user.is_freemium and not elaborated_by_me %}
                <div v-if="selectedExamQuestion && selectedExamQuestion.statusList.length">
                  <div class="lize-text-warning mx-3 mt-3 mb-1">Histórico de revisões</div>
                  <ul class="activity tx-13 pl-3" style="max-height: 315; overflow-y: auto;">
                    <li class="activity-item" v-for="history in selectedExamQuestion.statusList">
                      <div class="activity-icon" style="background-color: #cccccc1c;">
                        <i v-html="getExamQuestionStatus({ lastStatus: { statusDisplay: history.statusDisplay } }).icon"></i>
                      </div>
                      <div class="activity-body">
                        <p class="mg-b-2 mb-0">
                          <strong>${history.statusDisplay}</strong><template v-if="history.userName"><em style="color: #1b2e4b; word-break: break-all;"> - por ${history.userName}.</em></template>
                          <span v-if="history.note"><br>${history.note}</span>

                          <div id="checked-by" class="tw-relative tw-flex tw-items-center tw-gap-2">
                            <label class="tw-flex tw-items-center tw-gap-2 tw-cursor-pointer">
                              
                              <input 
                                :id="'checked-by-input-' + history.id"
                                @click="updateStatusQuestion(history.id, history.isCheckedBy)"                 
                                type="checkbox" 
                                class="tw-rounded tw-border-gray-300 tw-text-blue-600 focus:tw-ring-blue-600"
                                :checked="history.isCheckedBy"
                              >
                              <label v-if="history.isCheckedBy" :for="'checked-by-input-' + history.id">
                                Visto aplicado por {{ history.isCheckedBy }}
                              </label>
                              <label v-else :for="'checked-by-input-' + history.id">
                                Visto aplicado a questão
                              </label>

                            </label>
                          </div>
                          
                          
                          <span class="m-0" v-if="history.questionFragment"><br><b>Fragmento:</b> "${history.questionFragment}"</span>
                        </p>
                        <div class="d-flex align-items-center justify-content-between">
                          <small class="tx-color-03">${moment(history.createdAt).fromNow()}</small>
                          <a href="#" @click="newStatusQuestion.source_status_question=history.id.replace('\'', '')" data-toggle="modal" data-target="#modalCoordinationNote">Responder</a>
                        <div>
                      </div>
                    </li>
                  </ul>
                </div>
                {% endif %}
              </div>
              
              <div class="right-footer" :style="{ zoom: controls.width < 1200 ? controls.width / 1200 : 1 }">
                <div class="p-3">
                    <button type="button" v-if="canAddExamQuestion && !controls.createQuestion" data-toggle="modal" data-target="#modalAddQuestion" class="btn-block btn lz-btn-outline-warning">Adicionar questão</button>
                  </div>
                  <div class="pb-3 px-3 tw-w-full">
                    <a href="{% url 'help:tutoriais' %}">
                      <button class="btn-block btn lz-btn-outline-warning">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                        Central de Ajuda
                      </button>
                    </a>
                  </div>
                  {% if not user.is_freemium %}
                    {% comment %} <hr class="my-0" style="border-color: #E5E7EA !important;">
                    <div class="p-3 text-center d-flex align-items-center justify-content-center cp" data-toggle="modal" data-target="#modalCoordinationNote">
                      <span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#0C7BDB" class="bi bi-plus-circle mx-2" viewBox="0 0 16 16">
                          <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                          <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                      </span>
                      <span style="color: #667085; line-height: 20px;" class="fw-400 tx-14">
                        Nota para coordenação
                      </span>
                    </div> {% endcomment %}
                  {% endif %}
              </div>
            </div>
          </div>
        </template>
      </div>
    </div>
  </div>

  <div class="modal" id="modalUses" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Utilizações</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" v-if="selectedExamQuestion">
          <div class="row m-0">
            <div class="col-12 m-2 p-2" style="background-color: rgb(249, 250, 250); border-radius: 4px;" v-for="use in selectedExamQuestion.question.uses">
              <h6>${use.examName}</h6>
              <p class="text-muted mb-0">${use.applicationDate ? use.applicationDate:'Caderno não aplicado.'}</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalCoordinationNote" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" v-if="examTeacherSubject" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Resposta para coordenação</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row m-0">
            <div class="col-12 m-2 p-2">
              <label>Digite a resposta para a coordenação</label>
              <textarea v-model="examTeacherSubject.teacherNote" class="form-control" rows="5" placeholder="Digite aqui alguma informação importante para sua coordenação"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn lize-btn-primary" @click="submitNewStatus()" v-if="!controls.sendingCoordinationNote">Enviar resposta</button>
          <button type="button" class="btn lize-btn-primary" v-else disabled>
            Enviando <i class="fas fa-spin fa-spinner"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalAddQuestion" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Nota para coordenação</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="row m-0">
            <div class="my-3">
              <h4 style="font-size: 24px;" class="text-center">Escolha uma das opções</h4>
            </div>
          </div>
          <div class="row m-0">
            <div class="col-lg-3 p-2">
              <div class="lize-card cardSelectionType cp" @click="addNewQuestion()" data-dismiss="modal">
                <div class="card-body d-flex justify-content-center align-items-center" style="height: 136px;">
                  <span style="width: 64px; height: 64px; color: #FF8F3D;" class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-folder2" viewBox="0 0 16 16">
                      <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v7a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 1 12.5v-9zM2.5 3a.5.5 0 0 0-.5.5V6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5zM14 7H2v5.5a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 .5-.5V7z"/>
                    </svg>
                  </span>
                </div>
                <div class="card-footer">
                  <h6 style="font-size: 16px;">Nova questão</h6>
                  <small style="font-size: 12px;" class="text-muted">Construa sua questão do zero e construa algo único.</small>
                </div>
              </div>
            </div>
            <div class="col-lg-3 p-2">
              <div class="lize-card cardSelectionType cp" @click="createWithQuestionsBank()" data-dismiss="modal">
                <div class="card-body d-flex justify-content-center align-items-center" style="height: 136px;">
                  <span style="width: 64px; height: 64px; color: #FF8F3D;" class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-file-earmark-plus" viewBox="0 0 16 16">
                      <path d="M8 6.5a.5.5 0 0 1 .5.5v1.5H10a.5.5 0 0 1 0 1H8.5V11a.5.5 0 0 1-1 0V9.5H6a.5.5 0 0 1 0-1h1.5V7a.5.5 0 0 1 .5-.5z"/>
                      <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z"/>
                    </svg>
                  </span>
                </div>
                <div class="card-footer">
                  <h6 style="font-size: 16px;">Banco de questões</h6>
                  <small style="font-size: 12px;" class="text-muted">Escolha uma questão de um banco e personalize.</small>
                </div>
              </div>
            </div>
            
            {% if not user.is_freemium %}
              <div class="col-lg-3 p-2">
                <div class="lize-card cardSelectionType cp" @click="createWithFile()" data-dismiss="modal">
                  <div class="card-body d-flex justify-content-center align-items-center" style="height: 136px;">
                    <span style="width: 64px; height: 64px; color: #FF8F3D;" class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-cloud-upload" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
                        <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z"/>
                      </svg>
                    </span>
                  </div>
                  <div class="card-footer">
                    <h6 style="font-size: 16px;">Importe um .doc</h6>
                    <small style="font-size: 12px;" class="text-muted">Importe questões do Word e otimize seu tempo.</small>
                  </div>
                </div>
              </div>
            {% endif %}
              
            {% if user.inspector.has_ia_creation or user.client_has_ia_creation %}
              <div class="col-lg-3 p-2">
                <div class="lize-card cardSelectionType cp" @click="createWithIA()" data-dismiss="modal">
                  <div class="card-body d-flex justify-content-center align-items-center" style="height: 136px;">
                    <span style="width: 64px; height: 64px; color: #FF8F3D;" class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                        <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                      </svg>
                    </span>
                  </div>
                  <div class="card-footer">
                    <div class="tw-flex tw-flex-col tw-gap-2">
                      <span class="tw-text-xs tw-px-2 tw-w-fit tw-font-bold tw-rounded-full tw-bg-orange-400 tw-text-white">recomendado</span>
                      <h6 style="font-size: 16px;">Criar com IA</h6>
                    </div>
                    <small style="font-size: 12px;" class="text-muted">Economize tempo deixando a IA cuidar do primeiro rascunho.</small>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn lize-btn-primary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalViewStatusNote" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;" v-if="selectedExamQuestion && selectedExamQuestion.lastStatus">
        <div class="modal-header">
          <h5 class="modal-title">${selectedExamQuestion.lastStatus.statusDisplay}<h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <h6>Anotação da coordenação:</h6>
            <p class="text-muted">${selectedExamQuestion.lastStatus.note}</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn lize-btn-primary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalTopics" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Assuntos pedagógicos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body-topics" v-if="selectedExamQuestion">
          <div class="row">
            {% if 'questions.can_add_subject_question' in user.get_all_permissions %}
            <div class="col-lg-9">
                <search-component :where="'topics'" class="w-100"></search-component>
            </div>
            <div class="col-lg-3 d-flex justify-content-center align-items-center">
                <button @click="openModalCreateTopic()" type="button" class="btn lz-btn-outline-warning">
                  <span class="d-flex justify-content-center align-items-center h-100">Cadastrar Assunto</span>
                </button>
            </div>
            {% else %}
            <div class="col-lg-12">
                <search-component :where="'topics'" class="w-100"></search-component>
            </div>
            {% endif %}
          </div>
          <div class="row m-0">
            <div class="col-12">
              <h6 class="p-2 py-3 mb-0">${selectedExamQuestion.question.topics.length} Assuntos selecionados</h6>
            </div>
          </div>

          <hr class="my-1 mx-3">

          <div v-for="stage in topicsRegrouped">
            <!-- <h6>Etapa ${stage.name}</h6> -->
            <details v-for="theme in stage.themes" open>
              <summary class="d-flex align-items-center cursor-pointer" style="padding: 0.5rem 1rem;">
                <span class="mr-2 rotate-icon transition">&#9654;</span>
                <div class="custom-control custom-checkbox font-weight-bold">
                  <input
                    type="checkbox"
                    class="custom-control-input"
                    :id="'stage_' + stage.id + '_theme_' + (theme.id || 'null')"
                    :checked="isThemeChecked(theme)"
                    @change="toggleTheme(theme, $event)"
                  />
                  <label class="custom-control-label" :for="'stage_' + stage.id + '_theme_' + (theme.id || 'null')">
                    ${theme.name}
                  </label>
                </div>
              </summary>
              <details v-for="mainTopic in theme.mainTopics" class="ml-3" open>
                <summary class="d-flex align-items-center cursor-pointer" style="padding: 0.5rem 1rem;">
                  <span class="mr-2 rotate-icon transition">&#9654;</span>
                  <div class="custom-control custom-checkbox">
                    <input
                      type="checkbox"
                      class="custom-control-input"
                      :id="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null')"
                      :checked="isMainTopicChecked(mainTopic)"
                      @change="toggleMainTopic(mainTopic, $event)"
                    />
                    <label class="custom-control-label" :for="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null')">
                      ${mainTopic.name}
                    </label>
                  </div>
                </summary>
                <div v-for="topic in mainTopic.topics" class="ml-4">
                  <div style="padding: 0.5rem 1rem;">
                    <div class="custom-control custom-checkbox">
                      <input
                        type="checkbox"
                        class="custom-control-input"
                        :id="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null') + '_topic_' + topic.id"
                        :value="topic.id"
                        v-model="selectedExamQuestion.question.topics"
                        @change="onTopicToggle"
                      />
                      <label class="custom-control-label" :for="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null') + '_topic_' + topic.id">
                        ${topic.name}
                      </label>
                    </div>
                  </div>
                </div>
              </details>
            </details>
          </div>

          <!-- <div class="d-flex p-2 align-items-center my-2 px-4" :class="selectedExamQuestion.question.topics.includes(topic.id) ? 'row-bncc-selected':'row-bncc'" v-for="topic in foundedTopics">
            <div class="align-self-start">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
              </svg>
            </div>
            <div class="mx-3 w-100" style="color: #6C727F;">
              <span v-if="topic.code" class="tx-bold"></span>${topic.name}
            </div>
            <div>
              <div class="custom-check" @click="addBNCC('topic', topic)" class="d-flex align-items-center justify-content-center">
                <span v-if="selectedExamQuestion.question.topics.includes(topic.id)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                    <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                  </svg>
                </span>
              </div>
            </div>
          </div> -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalCompetences" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Competências necessárias</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" v-if="selectedExamQuestion">
          <div class="row m-0">
            {% if 'questions.can_add_ability_and_competence_question' in user.get_all_permissions %}
            <div class="col-lg-9">
              <search-component :where="'competences'"></search-component>
            </div>
            <div class="col-lg-3 d-flex justify-content-center align-items-center">
              <button @click="openModalCreateCompetence()" type="button" class="btn lz-btn-outline-warning ">
                <span class="d-flex justify-content-center align-items-center h-100">Cadastrar Competência</span>
              </button>
            </div>
            {% else %}
            <div class="col-lg-12">
              <search-component :where="'competences'"></search-component>
            </div>
            {% endif %}
          </div>
          
          <div class="row m-0">
            <div class="col-12">
              <h6 class="p-2 py-3 mb-0">${selectedExamQuestion.question.competences.length} competência selecionada</h6>
            </div>
          </div>

          <hr class="my-1 mx-3">
          
          <div class="d-flex p-2 align-items-center my-2 px-4" :class="selectedExamQuestion.question.competences.includes(competence.id) ? 'row-bncc-selected':'row-bncc'" v-for="competence in foundedCompetences">
            <div class="align-self-start">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
              </svg>
            </div>
            <div class="mx-3 w-100" style="color: #6C727F;">
              <span v-if="competence.code" class="tx-bold">${competence.code} - </span>${competence.text}
            </div>
            <div>
              <div class="custom-check" @click="addBNCC('competence', competence)" class="d-flex align-items-center justify-content-center">
                <span v-if="selectedExamQuestion.question.competences.includes(competence.id)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                    <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                  </svg>
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalAbilities" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Habilidades necessárias</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body" v-if="selectedExamQuestion">
          <div class="row m-0">
            {% if 'questions.can_add_ability_and_competence_question' in user.get_all_permissions %}
            <div class="col-lg-9">
              <search-component :where="'abilities'"></search-component>
            </div>
            <div class="col-lg-3 d-flex justify-content-center align-items-center">
              <button @click="openModalCreateAbility()" type="button" class="btn lz-btn-outline-warning text-center" >
                <span class="d-flex justify-content-center align-items-center h-100">Cadastrar Habilidade</span>
              </button>
            </div>
            {% else %}
            <div class="col-lg-12">
              <search-component :where="'abilities'"></search-component>
            </div>
            {% endif %}
          </div>
          <div class="row m-0">
            <div class="col-12">
              <h6 class="p-2 py-3 mb-0">${selectedExamQuestion.question.abilities.length} habilidades selecionada</h6>
            </div>
          </div>

          <hr class="my-1 mx-3">
          
          <div class="d-flex p-2 align-items-center my-2 px-4" :class="selectedExamQuestion.question.abilities.includes(ability.id) ? 'row-bncc-selected':'row-bncc'" v-for="ability in foundedAbilities">
            <div class="align-self-start">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
              </svg>
            </div>
            <div class="mx-3 w-100" style="color: #6C727F;">
              <span v-if="ability.code" class="tx-bold">${ability.code} - </span>${ability.text}
            </div>
            <div>
              <div class="custom-check" @click="addBNCC('ability', ability)" class="d-flex align-items-center justify-content-center">
                <span v-if="selectedExamQuestion.question.abilities.includes(ability.id)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                    <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                  </svg>
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalBaseText" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Adicionar texto base</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <template v-if="selectedExamQuestion">
            <div class="row m-0">
              <div class="col-12">
                <search-component :where="'baseTexts'"></search-component>
              </div>
            </div>
  
            <div class="row m-0">
              <div class="col-12">
                <h6 class="p-2 py-3 mb-0 d-flex align-items-center justify-content-between"><span>${preSelectedBaseTexts.length} texto base selecionado</span> <span class="tx-14 mx-2 lize-text-primary link" @click="createBaseText()">Criar novo texto base</span></h6>
              </div>
            </div>
          </template>

          <hr class="my-0 mx-3">
          <div v-show="baseText.creating || baseText.updating">
            <div class="row mx-3" style="background-color: #F9FAFA;">
              <div class="col-12 px-4 pt-4">
                <label for="">Título</label>
                <input type="text" class="form-control lize-form-control" placeholder="Digite o título" v-model="baseText.title" required>
                <label for="" class="mt-3">Texto base</label>
                <div class="bg-white border" style="border-radius: 8px;">
                  <textarea id="inputBaseTexts" type="text" class="form-control lize-form-control" required v-model="baseText.text" rows="5"></textarea>
                </div>
              </div>
              <div class="col-12 mt-3 px-4 pb-4 d-flex justify-content-end">
                <button class="btn btn-secondary d-flex justify-content-center align-items-center mx-1" style="height: 32px; border-radius: 8px;" @click="baseText.creating = false, baseText.updating = false, $forceUpdate()">Cancelar</button>
                <button style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lize-btn-primary" :disabled="!baseText.title.length" @click="saveBaseText()">Salvar alterações</button>
              </div>
            </div>
          </div>
          <div v-if="!baseText.creating && !baseText.updating">
            <template v-for="baseText in foundedBaseTexts" v-if="selectedExamQuestion">
              <div class="d-flex p-2 align-items-center py-3 px-4 mx-3" style="border-bottom: 1px solid #E5E7EA;" :class="preSelectedBaseTexts.includes(baseText.id) ? 'row-bncc-selected':'row-bncc'">
                <div class="align-self-start">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                  </svg>
                </div>
                <div class="mx-3 w-100" style="color: #6C727F;" v-html="baseText.title"></div>
                <div class="d-flex align-items-center">
                  <div class="custom-check rounded-circle" @click="selectBaseText(baseText)" class="d-flex align-items-center justify-content-center">
                    <span v-if="preSelectedBaseTexts.includes(baseText.id)">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                        <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                      </svg>
                    </span>
                  </div>
                  <div class="mx-3" @click="baseText.expanded = !baseText.expanded">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-up" viewBox="0 0 16 16" v-if="baseText.expanded">
                      <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"/>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16" v-else>
                      <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="mx-3 p-3 d-flex align-items-center justify-content-between" style="color: #6C727F;" :class="selectedExamQuestion.question.baseTexts.includes(baseText.id) || preSelectedBaseTexts.includes(baseText.id) ? 'row-bncc-selected':'row-bncc'" v-if="baseText.expanded">
                <div class="w-100">
                  <div v-html="baseText.short_text"></div>
                </div>
                <div class="d-flex flex-column mx-2">
                  <button class="btn lize-btn-primary btn-block d-flex justify-content-center align-items-center" style="height: 32px; border-radius: 8px;" @click="selectBaseText(baseText)">Selecionar</button>
                  <button class="btn lize-btn-primary btn-block d-flex justify-content-center align-items-center" style="height: 32px; border-radius: 8px;" @click="editBaseText(baseText)">Editar</button>
                  <button class="btn btn-danger btn-block d-flex justify-content-center align-items-center" style="height: 32px; border-radius: 8px;" :disabled="!baseText.can_delete" @click="deleteBaseText(baseText)">Excluir</button>
                </div>
              </div>
            </template>
          </div>
        </div>
        <div class="modal-footer mx-3">
          <button class="btn lize-btn-primary btn-block" @click="addBaseTexts()">Concluir seleção</button>
        </div>
      </div>
    </div>
  </div>

<div class="modal" tabindex="-1" role="dialog" id="modalQuestionsBank">
  <div class="modal-dialog modal-fullscreen" role="document">
    <div class="modal-content">
      <div class="tw-flex tw-min-h-full tw-bg-white">
        <div class="tw-flex tw-w-full tw-flex-col" v-if="examTeacherSubject">
          <!-- Header -->
          <div class="tw-sticky tw-top-0 tw-z-50 tw-flex tw-flex-none tw-flex-wrap tw-items-center tw-justify-between tw-bg-white tw-border-b tw-border-slate-200 tw-px-4 tw-py-[calc(0.5rem+1.5px)] tw-transition tw-duration-500 sm:tw-px-6 lg:tw-px-4">
            <div class="tw-relative tw-flex tw-items-center tw-grow tw-basis-0">
              <a aria-label="Home page" href="/" class="tw-inline-flex tw-items-center tw-gap-3 tw-text-sm tw-font-semibold tw-text-gray-700">
                <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M19.6665 12H5.6665M5.6665 12L12.6665 19M5.6665 12L12.6665 5" stroke="#9BA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                Banco de questões
              </a>
            </div>
            <div class="tw-relative tw-flex tw-items-center tw-gap-4">
              <span class="tw-flex tw-items-center tw-gap-2">
                <span class="tw-text-sm tw-font-semibold tw-text-slate-700">
                  ${examTeacherSubject.examQuestions.filter(e => e.canUpdate()).length}
                  <template v-if="blockQuantityLimit">de {{object.quantity}}</template>
                </span>
                <span class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                  <template v-if="examTeacherSubject.examQuestions.filter(e => e.canUpdate()).length > 1">
                    questões selecionadas
                  </template>
                  <template v-else>
                    questão selecionada
                  </template>
                </span>
              </span>
              <button type="button" class="tw-flex tw-items-center tw-rounded-lg tw-text-white tw-bg-blue-600 tw-px-4 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-bg-blue-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600" data-dismiss="modal" aria-label="Fechar" @click="cancel()" :disabled="controls.addingQuestion">
                Concluir seleção
              </button>
            </div>
            <div class="tw-relative tw-flex tw-items-center tw-justify-end tw-grow tw-basis-0 tw-gap-4">
              <!-- <div class="custom-control custom-switch">
                <label  for="onlyMyQuestions" class="switch-questions">
                  <input type="checkbox" v-model="controls.onlyMyQuestions" id="onlyMyQuestions">
                  <div class="slider-questions round">
                    <span class="question-bank">Questões públicas</span>
                    <span class="author-questions">Questões da sua escola</span>
                  </div>
                </label> 
              </div> -->
              <span class="tw-isolate tw-inline-flex tw-rounded-lg">
                <button
                  type="button"
                  class="tw-relative tw-inline-flex tw-items-center tw-rounded-l-lg tw-px-4 tw-py-1.5 tw-text-sm tw-ring-inset tw-ring-gray-200 focus:tw-z-10"
                  :class="!controls.onlyMyQuestions ? 'tw-bg-white tw-text-gray-500 tw-ring-1 hover:tw-bg-gray-50' : 'tw-bg-slate-50 tw-text-slate-500 hover:tw-bg-slate-100'"
                  @click="controls.onlyMyQuestions = false"
                >
                  Todas as questões
                </button>
                <button
                  type="button"
                  class="tw-relative tw-inline-flex tw-items-center tw-rounded-r-lg tw-px-4 tw-py-1.5 tw-text-sm tw-ring-inset tw-ring-gray-200 focus:tw-z-10"
                  :class="controls.onlyMyQuestions ? 'tw-bg-white tw-text-gray-500 tw-ring-1 hover:tw-bg-gray-50' : 'tw-bg-slate-50 tw-text-slate-500 hover:tw-bg-slate-100'"
                  @click="controls.onlyMyQuestions = true"
                >
                  Minhas questões
                </button>
              </span>
              <button type="button" class="tw-flex tw-flex-nowrap tw-items-center tw-gap-2 tw-rounded-lg tw-p-2 tw-text-xs/4.5 tw-font-semibold tw-text-gray-500 tw-whitespace-nowrap hover:tw-bg-gray-50" data-dismiss="modal" aria-label="Fechar" @click="cancel()">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-size-6 tw-text-gray-500">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
              </button>
            </div>
          </div>
          <!-- Content -->
          <div class="tw-relative tw-flex tw-w-full tw-flex-auto tw-justify-center tw-max-h-[calc(100vh-3.75rem)]">
            <!-- Left -->
            <div
              class="tw-hidden tw-sticky tw-top-19 -tw-h-[calc(100vh-4.75rem)] tw-border-r tw-border-slate-200 tw-overflow-x-hidden tw-overflow-y-auto tw-p-6 lg:tw-relative lg:tw-block lg:tw-flex-none"
              :class="[filterPanel === 'open' ? 'tw-w-[21.25rem]' : '']"
            >
              <template v-if="filterPanel === 'open'">
                <div class="tw-flex tw-items-center tw-justify-between">
                  <h2
                    class="tw-text-lg tw-font-semibold tw-text-gray-700"
                    :class="[filterPanel === 'open' ? 'tw-block' : 'tw-hidden']"
                  >
                    <template v-if="controls.showAdvancedFilters">
                      Filtros avançados
                    </template>
                    <template v-else>
                      Filtrar questões
                    </template>
                  </h2>
                  <div class="tw-flex tw-items-center">
                    <template v-if="controls.showAdvancedFilters">
                      <button type="button" class="tw-relative tw-rounded tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-ring-offset-2 focus:tw-outline-hidden" @click="controls.showAdvancedFilters = false" v-if="!controls.addingQuestion">
                        <span class="tw-absolute tw--inset-2.5"></span>
                        <span class="tw-sr-only">Fechar filtros avançados</span>
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-size-5 tw-text-slate-400">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                        </svg>
                      </button>
                    </template>
                    <template v-else>
                      <template v-if="filterPanel === 'open'">
                        <button type="button" class="tw-relative tw-rounded tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-ring-offset-2 focus:tw-outline-hidden" @click="toggleFilterPanel">
                          <span class="tw-absolute tw--inset-2.5"></span>
                          <span class="tw-sr-only">Fechar painel</span>
                          <!-- <template v-if="filterPanel === 'open'"> -->
                            <svg class="tw-size-4 tw-text-slate-400" width="17" height="16" viewBox="0 0 17 16" fill="none">
                              <path d="M7.13591 7.46935C7.06599 7.53903 7.01051 7.62182 6.97265 7.71298C6.9348 7.80415 6.91531 7.90189 6.91531 8.0006C6.91531 8.09931 6.9348 8.19705 6.97265 8.28821C7.01051 8.37937 7.06599 8.46217 7.13591 8.53185L12.1359 13.5318C12.2768 13.6727 12.4679 13.7519 12.6672 13.7519C12.8664 13.7519 13.0575 13.6727 13.1984 13.5318C13.3393 13.391 13.4185 13.1999 13.4185 13.0006C13.4185 12.8013 13.3393 12.6102 13.1984 12.4693L8.72903 7.99997L13.1972 3.5306C13.2669 3.46083 13.3223 3.37801 13.36 3.28686C13.3978 3.19571 13.4172 3.09801 13.4172 2.99935C13.4172 2.80009 13.3381 2.60899 13.1972 2.4681C13.0563 2.3272 12.8652 2.24805 12.6659 2.24805C12.5672 2.24805 12.4695 2.26748 12.3784 2.30524C12.2872 2.34299 12.2044 2.39833 12.1347 2.4681L7.13591 7.46935ZM5.16653 2.24997C5.36544 2.24997 5.55621 2.32899 5.69686 2.46964C5.83751 2.61029 5.91653 2.80106 5.91653 2.99997V13C5.91653 13.1989 5.83751 13.3896 5.69686 13.5303C5.55621 13.671 5.36544 13.75 5.16653 13.75C4.96762 13.75 4.77685 13.671 4.6362 13.5303C4.49555 13.3896 4.41653 13.1989 4.41653 13V2.99997C4.41653 2.80106 4.49555 2.61029 4.6362 2.46964C4.77685 2.32899 4.96762 2.24997 5.16653 2.24997Z" fill="currentColor" aria-hidden="true" data-slot="icon" />
                            </svg>
                          <!-- </template> -->
                          <!-- <template v-else>
                            <svg class="tw-size-4 tw-text-slate-400" width="17" height="16" viewBox="0 0 17 16" fill="none">
                              <path d="M10.1971 7.46935C10.2671 7.53903 10.3225 7.62182 10.3604 7.71298C10.3982 7.80415 10.4177 7.90189 10.4177 8.0006C10.4177 8.09931 10.3982 8.19705 10.3604 8.28821C10.3225 8.37937 10.2671 8.46217 10.1971 8.53185L5.19713 13.5318C5.05624 13.6727 4.86514 13.7519 4.66588 13.7519C4.46662 13.7519 4.27553 13.6727 4.13463 13.5318C3.99374 13.391 3.91458 13.1999 3.91458 13.0006C3.91458 12.8013 3.99374 12.6102 4.13463 12.4693L8.60401 7.99997L4.13588 3.5306C4.06612 3.46083 4.01078 3.37801 3.97302 3.28686C3.93526 3.19571 3.91583 3.09801 3.91583 2.99935C3.91583 2.80009 3.99499 2.60899 4.13588 2.4681C4.27678 2.3272 4.46788 2.24805 4.66713 2.24805C4.76579 2.24805 4.86349 2.26748 4.95464 2.30524C5.04579 2.34299 5.12862 2.39833 5.19838 2.4681L10.1971 7.46935ZM12.1665 2.24997C11.9676 2.24997 11.7768 2.32899 11.6362 2.46964C11.4955 2.61029 11.4165 2.80106 11.4165 2.99997V13C11.4165 13.1989 11.4955 13.3896 11.6362 13.5303C11.7768 13.671 11.9676 13.75 12.1665 13.75C12.3654 13.75 12.5562 13.671 12.6968 13.5303C12.8375 13.3896 12.9165 13.1989 12.9165 13V2.99997C12.9165 2.80106 12.8375 2.61029 12.6968 2.46964C12.5562 2.32899 12.3654 2.24997 12.1665 2.24997Z" fill="currentColor" aria-hidden="true" data-slot="icon" />
                            </svg>
                          </template> -->
                        </button>
                      </template>
                    </template>
                  </div>
                </div>
                <div :class="[filterPanel === 'open' ? 'tw-block' : 'tw-hidden']">
                  <template v-if="controls.showAdvancedFilters">
                    <div id="modalAdvancedFilters">
                      <div>
                        <div>
                          <div class="tw-flex tw-flex-col tw-gap-4 tw-mt-4">
                            <!-- <div class="row m-0" style="border-bottom: 1px solid #E5E7EA;">
                              <div class="col-12">
                                <div class="d-flex justify-content-between py-3">
                                    <span style="color: #FF8F3D;" class="mx-2 text  tx-18 ">Filtros avançados</span>
                                  <div class="d-flex align-center">
                                    <div v-if="!controls.addingQuestion">
                                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#D0D3D9" class="bi bi-x-lg ml-3 cp" viewBox="0 0 16 16"  data-dismiss="modal" @click="controls.showAdvancedFilters = false">
                                        <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                                      </svg>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div> -->
                            <div class="tw-flex tw-flex-col tw-gap-3">
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Tipo de questão
                                </label>
                                <div ref="questionsCategory" class="dropdown tw-mt-1 tw-border tw-border-slate-300 tw-rounded-lg">
                                  <div :class="questionsBankControls.advancedFilters.questionsCategory.focus ? 'custom-select-1' : 'custom-select-2'" class="tw-flex tw-items-center tw-px-3.5 tw-py-2.5" @click="openCustomFilterDropdown('questionsCategory')">
                                    <div>
                                      <div v-if="questionsBankControls.advancedFilters.questionsCategory.items.length">
                                        ${questionsCategories.filter(q => questionsBankControls.advancedFilters.questionsCategory.items.includes(q.id)).map(q => q.name).join(', ')}
                                      </div>
                                      <span v-else>Todos</span>
                                    </div>
                                  </div>
                                  <div class="dropdown-menu" style="right: 0px !important; left: auto !important; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.questionsCategory.focus }" aria-labelledby="dropdownQuestionsCategoryButton">
                                    <span v-for="category in questionsCategories" class="dropdown-item" @click="questionsBankControls.advancedFilters.questionsCategory.items.includes(category.id) ? questionsBankControls.advancedFilters.questionsCategory.items.splice(questionsBankControls.advancedFilters.questionsCategory.items.indexOf(category.id), 1):questionsBankControls.advancedFilters.questionsCategory.items.push(category.id)">
                                      <div class="d-flex align-items-center">
                                        <div v-if="questionsBankControls.advancedFilters.questionsCategory.items.includes(category.id)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                                        <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                        <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${category.name}</label>
                                      </div>
                                    </span>
                                  </div>
                                </div>
                              </div>
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Dificuldade
                                </label>
                                <div ref="questionsDifficult" class="dropdown tw-mt-1 tw-border tw-border-slate-300 tw-rounded-lg">
                                  <div :class="questionsBankControls.advancedFilters.questionsDifficult.focus ? 'custom-select-1' : 'custom-select-2'" class="tw-flex tw-items-center tw-px-3.5 tw-py-2.5" @click="openCustomFilterDropdown('questionsDifficult')">
                                    <div>
                                      <div v-if="questionsBankControls.advancedFilters.questionsDifficult.items.length">
                                        ${difficults.filter(d => questionsBankControls.advancedFilters.questionsDifficult.items.includes(d.id)).map(d => d.name).join(', ')}
                                      </div>
                                      <span v-else>Todos</span>
                                    </div>
                                  </div>
                                  <div class="dropdown-menu" style="right: 0px !important; left: auto !important; border-radius: 8px; position: absolute; "  :class="{ 'show': questionsBankControls.advancedFilters.questionsDifficult.focus }" aria-labelledby="dropdownquestionsDifficultButton">
                                    <span v-for="difficult in difficults" class="dropdown-item" @click="questionsBankControls.advancedFilters.questionsDifficult.items.includes(difficult.id) ? questionsBankControls.advancedFilters.questionsDifficult.items.splice(questionsBankControls.advancedFilters.questionsDifficult.items.indexOf(difficult.id), 1):questionsBankControls.advancedFilters.questionsDifficult.items.push(difficult.id)">
                                      <div class="d-flex align-items-center">
                                        <div v-if="questionsBankControls.advancedFilters.questionsDifficult.items.includes(difficult.id)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                                        <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                        <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${difficult.name}</label>
                                      </div>
                                    </span>
                                  </div>
                                </div>
                              </div>
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Série
                                </label>
                                <div ref="grade" class="dropdown tw-mt-1 tw-border tw-border-slate-300 tw-rounded-lg">
                                  <div :class="questionsBankControls.advancedFilters.grade.focus ? 'custom-select-1' : 'custom-select-2'" class="tw-flex tw-items-center tw-px-3.5 tw-py-2.5" @click="openCustomFilterDropdown('grade')">
                                    <div>
                                      <div v-if="questionsBankControls.advancedFilters.grade.items.length">
                                        ${grades.filter(g => questionsBankControls.advancedFilters.grade.items.includes(g.id)).map(g => g.name).join(', ')}
                                      </div>
                                      <span v-else>Todos</span>
                                    </div>
                                  </div>
                                  <div class="dropdown-menu" style="right: 0px !important; left: auto !important; max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.grade.focus }" aria-labelledby="dropdowngradeButton">
                                    <span v-for="grade in grades" class="dropdown-item" @click="questionsBankControls.advancedFilters.grade.items.includes(grade.id) ? questionsBankControls.advancedFilters.grade.items.splice(questionsBankControls.advancedFilters.grade.items.indexOf(grade.id), 1):questionsBankControls.advancedFilters.grade.items.push(grade.id)">
                                      <div class="d-flex align-items-center">
                                        <div v-if="questionsBankControls.advancedFilters.grade.items.includes(grade.id)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                                        <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                        <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${grade.name}</label>
                                      </div>
                                    </span>
                                  </div>
                                </div>
                              </div>
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Bancas
                                </label>
                                <div ref="board" class="dropdown tw-mt-1 tw-border tw-border-slate-300 tw-rounded-lg">
                                  <div :class="questionsBankControls.advancedFilters.board.focus ? 'custom-select-1' : 'custom-select-2'" class="tw-flex tw-items-center tw-px-3.5 tw-py-2.5" @click="openCustomFilterDropdown('board')">
                                    <div>
                                      <div v-if="questionsBankControls.advancedFilters.board.items.length">
                                        ${boards.filter(b => questionsBankControls.advancedFilters.board.items.includes(b)).join(', ')}
                                      </div>
                                      <span v-show="!questionsBankControls.advancedFilters.board.items.length">Todos</span>
                                    </div>
                                  </div>
                                  <div class="dropdown-menu fixed-dropdown-item" style="right: 0px !important; left: auto !important;  max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.board.focus }" aria-labelledby="dropdownboardButton">
                                    <input  ref="boardInput" class="tw-rounded-lg tw-p-1 tw-w-full" v-model="searchTerm" placeholder="Pesquisar bancas" style="position: sticky; top: 0; background-color: #FFF; z-index: 1;"></input>
                                    <span   @click="toggleBoardSelection(board)" v-for="board in boards.filter(e => (e.length) && (e.toLowerCase().includes(searchTerm.toLowerCase())))" class="dropdown-item" @click="questionsBankControls.advancedFilters.board.items.includes(board) ? questionsBankControls.advancedFilters.board.items.splice(questionsBankControls.advancedFilters.board.items.indexOf(board), 1):questionsBankControls.advancedFilters.board.items.push(board)">
                                      <div class="d-flex align-items-center">
                                        <div v-if="questionsBankControls.advancedFilters.board.items.includes(board)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                                        <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                        <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${board}</label>
                                      </div>
                                    </span>
                                  </div>
                                </div>
                              </div>
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Ano de elaboracão
                                </label>
                                <div class="tw-flex tw-items-center tw-gap-2 tw-mt-1">
                                  <div ref="elaborationStartYear" class="dropdown tw-flex-1 tw-border tw-border-slate-300 tw-rounded-lg">
                                    <button 
                                      :class="questionsBankControls.advancedFilters.elaborationStartYear.focus ? 'custom-select-1' : 'custom-select-2'" 
                                      class="tw-flex tw-items-center tw-w-full tw-px-3.5 tw-py-2.5" 
                                      @click="openCustomFilterDropdown('elaborationStartYear')"
                                    >
                                      ${questionsBankControls.advancedFilters.elaborationStartYear.items.length > 0 ? questionsBankControls.advancedFilters.elaborationStartYear.items[0] : rangeInitial.startYear}
                                    </button>
                                    <div class="dropdown-menu" style="right: 0px !important; left: auto !important; max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.elaborationStartYear.focus }" aria-labelledby="dropdownelaborationStartYear">
                                      <span v-for="year in years" :key="year" class="dropdown-item" @click="selectYear(year, 'elaborationStartYear')">
                                        <div class="d-flex align-items-center">
                                          <div v-if="questionsBankControls.advancedFilters.elaborationStartYear.items.includes(year)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1">
                                            <i class="fas fa-check text-white"></i>
                                          </div>
                                          <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                          <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${year}</label>
                                        </div>
                                      </span>
                                    </div>
                                  </div>
                                  <!-- <span>até</span> -->
                                  <div ref="elaborationEndYear" class="dropdown tw-flex-1 tw-border tw-border-slate-300 tw-rounded-lg">
                                    <button 
                                      :class="questionsBankControls.advancedFilters.elaborationEndYear.focus ? 'custom-select-1' : 'custom-select-2'" 
                                      class="tw-flex tw-items-center tw-w-full tw-px-3.5 tw-py-2.5" 
                                      @click="openCustomFilterDropdown('elaborationEndYear')"
                                    >
                                      ${questionsBankControls.advancedFilters.elaborationEndYear.items.length > 0 ? questionsBankControls.advancedFilters.elaborationEndYear.items[0] : rangeInitial.endYear}
                                    </button>
                                    <div class="dropdown-menu" style="right: 0px !important; left: auto !important; max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.elaborationEndYear.focus }" aria-labelledby="dropdownelaborationEndYear">
                                      <span v-for="year in years" :key="year" class="dropdown-item"@click="selectYear(year, 'elaborationEndYear')">
                                        <div class="d-flex align-items-center">
                                          <div v-if="questionsBankControls.advancedFilters.elaborationEndYear.items.includes(year)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1">
                                            <i class="fas fa-check text-white"></i>
                                          </div>
                                          <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                          <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${year}</label>
                                        </div>
                                      </span>
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Áreas de conhecimento
                                </label>
                                <div ref="knowledgeArea" class="dropdown tw-mt-1 tw-border tw-border-slate-300 tw-rounded-lg">
                                  <div :class="questionsBankControls.advancedFilters.knowledgeArea.focus ? 'custom-select-1' : 'custom-select-2'" class="tw-flex tw-items-center tw-px-3.5 tw-py-2.5" @click="openCustomFilterDropdown('knowledgeArea')">
                                    <div>
                                      <div v-if="questionsBankControls.advancedFilters.knowledgeArea.items.length">
                                        ${knowledgeAreas.filter(b => questionsBankControls.advancedFilters.knowledgeArea.items.includes(b)).map(b => b.knowledgeAreaName).join(', ')}
                                      </div>
                                      <span v-else>Todas</span>
                                    </div>
                                  </div>
                                  <div class="dropdown-menu" style="max-width: 100%; max-height: 200px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.knowledgeArea.focus }" aria-labelledby="dropdownknowledgeAreaButton">
                                    <span v-for="knowledgeArea in knowledgeAreas" class="dropdown-item" @click="questionsBankControls.advancedFilters.knowledgeArea.items.includes(knowledgeArea) ? questionsBankControls.advancedFilters.knowledgeArea.items.splice(questionsBankControls.advancedFilters.knowledgeArea.items.indexOf(knowledgeArea), 1):questionsBankControls.advancedFilters.knowledgeArea.items.push(knowledgeArea)">
                                      <div class="tw-flex tw-gap-3">
                                        <div class="tw-flex tw-h-6 tw-shrink-0 tw-items-center">
                                          <div v-if="questionsBankControls.advancedFilters.knowledgeArea.items.includes(knowledgeArea)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                                          <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                        </div>
                                        <div class="text-sm/6">
                                          <label class="tw-font-medium tw-text-gray-900">
                                            ${knowledgeArea.knowledgeAreaName}
                                          </label>
                                        </div>
                                      </div>
                                      <!-- <div class="d-flex align-items-center">
                                        <div v-if="questionsBankControls.advancedFilters.knowledgeArea.items.includes(knowledgeArea)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                                        <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                                        <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${knowledgeArea.knowledgeAreaName}</label>
                                      </div> -->
                                    </span>
                                  </div>
                                </div>
                              </div>
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Texto no enunciado
                                </label>
                                <div ref="enunciation" class="dropdown tw-mt-1">
                                  <div :class="questionsBankControls.advancedFilters.enunciation.focus ? 'custom-select-1' : 'custom-select-2'" class="tw-p-0" @click="focusInput('enunciationInput'), openCustomFilterDropdown('enunciation')">
                                    <input type="text" ref="enunciationInput" class="tw-block tw-w-full tw-rounded-md tw-bg-white tw-px-3 tw-py-1.5 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600" v-model="questionsBankControls.advancedFilters.enunciation.search" placeholder="Ex.: Cubismo" />
                                  </div>
                                </div>
                              </div>
                              <div>
                                <label class="tw-block tw-text-xs/4.5 tw-font-medium tw-text-slate-700">
                                  Texto nas alternativas
                                </label>
                                <div ref="alternatives" class="dropdown tw-mt-1">
                                  <div :class="questionsBankControls.advancedFilters.alternatives.focus ? 'custom-select-1' : 'custom-select-2'" class="tw-p-0" @click="focusInput('alternativesInput'), openCustomFilterDropdown('alternatives')">
                                    <input type="text" ref="alternativesInput" class="tw-block tw-w-full tw-rounded-md tw-bg-white tw-px-3 tw-py-1.5 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600" v-model="questionsBankControls.advancedFilters.alternatives.search" placeholder="Ex.: Cubismo" />
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="tw-flex tw-flex-col tw-gap-3">
                              <button type="button" class="tw-flex tw-items-center tw-justify-center tw-w-full tw-rounded-lg tw-text-white tw-bg-primary-600 tw-px-4 tw-py-3 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-bg-primary-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-bg-slate-200 disabled:tw-text-slate-400" @click="getAndShowQuestionsAdvencedFilter()" :disabled="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
                                Aplicar filtros
                              </button>
                              <button type="button" class="tw-flex tw-items-center tw-justify-center tw-w-full tw-rounded-lg tw-text-primary-600 tw-border tw-border-primary-600 tw-px-4 tw-py-3 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-bg-slate-200 disabled:tw-text-slate-400" @click="clearAdvancedFilters()">
                                Limpar filtros
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>
                  <template v-else>
                    <div>
                      <!-- <div>
                        <div class="d-flex flex-column m-2 w-100" style="overflow-y: scroll; max-height: 370px;">
                          <div @click="openAdvancedFilters" class="d-flex align-items-center justify-content-between cp my-2 ml-1">
                            <div class="d-flex">
                              <span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#D0D3D9" class="bi bi-filter mr-2" viewBox="0 0 16 16">
                                  <path d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5m-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5m-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5"/>
                                </svg>
                              </span>
                              <span style="color: #FF8F3D;" class="mx-2">Filtros avançados</span>
                              <span class="tw-inline-flex tw-items-center tw-justify-center tw-w-6 tw-h-6 tw-text-xs tw-font-bold tw-text-white tw-bg-orange-400 tw-border-2 tw-border-white tw-rounded-full -top-2 -end-2">
                                ${countAdvancedFilters()}
                              </span>
                            </div>
                          </div>
                        </div>
                        <div class="d-flex justify-content-between">
                          <button class="btn lize-btn-warning btn-block d-flex align-center my-2 ml-3 mr-3" style="height: 32px; border-radius: 8px; padding: 8px 14px 8px 14px;" @click="getAndShowQuestions(), controls.showAdvancedFilters = false" :disabled="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
                            <template v-if="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
                              Aguarde <span> <i class="fas fa-spinner fa-spin"></i> </span>
                            </template>
                            <template v-else>Mostrar questões</template>
                          </button>
                        </div>
                      </div> -->
                      <div>
                        <div class="tw-mt-4">
                          <template v-if="controls.questionsBankViewer == 'selection'">
                            <div class="row m-0" style="border-top: 1px solid #E5E7EA; border-bottom: 1px solid #E5E7EA;">
                              <template v-if="questionsBankControls.onlySelectedItems.length">
                                <div class="col-12" v-for="item in questionsBankControls.onlySelectedItems">
                                  <div class="d-flex align-items-center justify-content-between mg-b-10">
                                    <div v-if="item" class="text tx-12" style="color: #6C727F;">
                                      <p class="mb-0 tx-normal text-truncate" style="max-width: 14rem;" v-if="item.model == 'Subject'">Todos os assuntos da disciplina: ${ item.text }</p>
                                      <p class="mb-0 tx-normal text-truncate" style="max-width: 14rem;" v-if="item.model == 'Theme'">Todos os assuntos do tema: ${ item.text } <span class="tx-12 tx-color-04 mg-l-10">${ item.subjectName }</span></p>
                                      <p class="mb-0 tx-normal text-truncate" style="max-width: 14rem;" v-if="item.model == 'MainTopic'">Todos os assuntos do tópico principal: ${ item.text } <span class="tx-12 tx-color-04 mg-l-10">${ item.subjectName }</span></p>
                                      <p class="mb-0 tx-normal text-truncate" style="max-width: 14rem;" v-if="item.model == 'Topic'">${ item.text } <span class="tx-12 tx-color-04 mg-l-10">${ item.subjectName }</span></p>
                                    </div>
                                    <div class="d-flex">
                                      <div>
                                        <span class="rounded-circle bg-danger d-flex aling-items-center justify-content-center cp" @click="unselectItem(item)"><i class="fa fa-minus text-white tx-12 p-1"></i></span>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </template>
                              <template v-else>
                                <div class="col-12 p-3">
                                  <p class="mb-0 tx-normal tx-color-03">Nenhum assunto selecionado</p>
                                </div>
                              </template>
                            </div>
                          </template>
                          <!-- <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
                            <button type="button" @click="changeSegment(1)" :class="selectedSegment == 1 ? 'lize-btn-primary': 'btn-light'" class="btn btn-sm">Anos Iniciais</button>
                            <button type="button" @click="changeSegment(2)" :class="selectedSegment == 2 ? 'lize-btn-primary': 'btn-light'" class="btn btn-sm">Anos Finais</button>
                            <button type="button" @click="changeSegment(0)" :class="selectedSegment == 0 ? 'lize-btn-primary': 'btn-light'" class="btn btn-sm">Ensino Médio</button>
                          </div> -->
                          <div>
                            <label for="segment" class="tw-sr-only">Segmento</label>
                            <div class="tw-grid tw-grid-cols-1">
                              <select id="segment" name="segment" class="tw-col-start-1 tw-row-start-1 tw-w-full tw-appearance-none tw-rounded-md tw-bg-white tw-py-1.5 tw-pl-3 tw-pr-8 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600 sm:tw-text-sm/6" v-model="selectedSegment">
                                <option value="1">Anos iniciais</option>
                                <option value="2" selected>Anos finais</option>
                                <option value="0">Ensino médio</option>
                              </select>
                            </div>
                          </div>
                          <!-- <template v-if="questionsBankControls.status === 'success'">
                            <div class="tw-flex tw-items-center tw-gap-3 tw-mt-3">
                              <input type="checkbox" id="moreSubjectsBank" v-model="controls.moreSubjectsBank" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white checked:tw-border-primary-600 checked:tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                              <label for="moreSubjectsBank" class="tw-w-full tw-mb-0">Mostrar todas as disciplinas</label>
                            </div>
                          </template> -->
                        </div>
                        <div class="tw-mt-4">
                          <div class="tw-flex tw-items-center tw-justify-between tw-py-2">
                            <div class="tw-flex tw-items-center tw-gap-2">
                              <!-- <label for="organize" class="tw-block tw-text-xs/4.5 tw-text-slate-500">Organizar por</label>
                              <div class="tw-grid tw-grid-cols-1">
                                <select id="organize" name="organize" class="tw-col-start-1 tw-row-start-1 tw-w-full tw-appearance-none tw-rounded-md tw-py-0 tw-pl-0 tw-pr-8 tw-text-sm tw-font-semibold tw-text-slate-700 tw-border-0 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600">
                                  <option selected>Disciplina</option>
                                  <option>Assunto</option>
                                </select>
                              </div> -->
                            </div>
                            <button type="button" class="tw-flex tw-items-center tw-gap-2" @click="openAdvancedFilters">
                              <span class="tw-text-sm tw-font-semibold tw-text-slate-500">Filtrar</span>
                              <span class="tw-text-primary-600 tw-size-5">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                  <path d="M5 10H15M2.5 5H17.5M7.5 15H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                              </span>
                            </button>
                          </div>
                          <div>
                            <label for="search" class="tw-sr-only">Pesquisar</label>
                            <div class="tw-grid tw-grid-cols-1">
                              <input type="text" name="search" id="search" class="tw-col-start-1 tw-row-start-1 tw-block tw-w-full tw-rounded-md tw-bg-white tw-py-1.5 tw-pl-10 tw-pr-3 tw-text-base tw-text-gray-900 tw-outline tw-outline-1 tw--outline-offset-1 tw-outline-gray-300 placeholder:tw-text-gray-400 focus:tw-outline focus:tw-outline-2 focus:tw--outline-offset-2 focus:tw-outline-blue-600" placeholder="Localizar disciplina..." v-model="searchSubjects" />
                              <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-pointer-events-none tw-col-start-1 tw-row-start-1 tw-ml-3 tw-size-5 tw-self-center tw-text-gray-400" aria-hidden="true" data-slot="icon">
                                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                              </svg>
                            </div>
                          </div>
                        </div>
                        <div class="tw-mt-4">
                          <template v-if="controls.questionsBankViewer == 'categories'">
                            <div>
                              <template v-if="questionsBankControls.status == 'loading'">
                                <div>
                                  <p class="p-3 text-muted">Buscando disciplinas
                                    <span>
                                      <i class="fas fa-spinner fa-spin mx-1"></i>
                                    </span>
                                  </p> 
                                </div>
                              </template>
                              <template v-else>
                                <div>
                                  <div>
                                    <template v-if="!questionsBankControls.subjects.length">
                                      <div class="tw-flex tw-items-center tw-justify-center tw-mt-2">
                                        <span class="text-muted">Não há disciplinas com o filtro aplicado</span>
                                      </div>
                                    </template>
                                    <ul v-if="questionsBankControls.status === 'success'" id="myUL">
                                      <li v-for="(subject,index) in filteredRequestSubjectList">
                                        <div class="tw-flex tw-items-center tw-justify-between tw-rounded-lg tw-p-3" :class="[subject.checked ? 'tw-bg-slate-50' : '']">
                                          <div class="tw-flex-1 tw-flex tw-items-center tw-gap-3">
                                            <input type="checkbox" :id="`check-${subject.id}`" v-model="subject.checked" @change="getChecked(subject)" :indeterminate.prop="subject.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                            <p class="tw-w-full tw-mb-0" v-on:click.stop="handleTree(subject)">${subject.text}</p>
                                          </div>
                                          <div v-on:click.stop="handleTree(subject)">
                                            <template v-if="subject.expanded">
                                              <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-text-slate-300 tw-size-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                                              </svg>
                                            </template>
                                            <template v-else>
                                              <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-text-slate-300 tw-size-5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                              </svg>
                                            </template>
                                          </div>
                                        </div>
                                        <ul class="tree-nested pl-2" :class="{ 'tree-active': subject.expanded }">
                                          <li v-if="subject.status === 'loading'">
                                            <i class="fas fa-spinner fa-spin" style="color: #ccccccc1;"></i>
                                          </li>
                                          <li v-if="subject.status === 'success'" v-for="theme in subject.children">
                                            <div class="d-flex justify-content-between align-items-center py-0 hover">
                                              <div class="d-flex align-items-center">
                                                <div class="px-1" v-on:click.stop="theme.leaf ? () => {} : handleTree(theme)">
                                                  <template v-if="theme.expanded">
                                                    <i class="fas fa-chevron-down cp" style="color: #E5E7EA;"></i>
                                                  </template>
                                                  <template v-else>
                                                    <i class="fas fa-chevron-right cp" style="color: #E5E7EA;"></i>
                                                  </template>
                                                </div>
                                                <div class="d-flex align-items-center">
                                                  <input type="checkbox" :id="`check-${theme.id}`" v-model="theme.checked" @change="getCheckedLevelTwo(theme, subject)" :indeterminate.prop="theme.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                                  <label class="mb-0 px-2 text-truncate py-1 text cp" style="max-width: 11rem;" v-on:click.stop="theme.leaf ? () => {} : handleTree(theme)">${theme.text}</label>
                                                </div>
                                              </div>
                                            </div>
                                            <ul class="tree-nested pl-2" :class="{ 'tree-active': theme.expanded }">
                                              <li v-if="theme.status === 'loading'">
                                                <i class="fas fa-spinner fa-spin" style="color: #ccccccc1;"></i>
                                              </li>
                                              <li v-if="theme.status === 'success'" v-for="mainTopic in theme.children">
                                                <div class="d-flex justify-content-between align-items-center py-0 hover">
                                                  <div class="d-flex align-items-center">
                                                    <div class="px-1" v-on:click.stop="mainTopic.leaf ? () => {} : handleTree(mainTopic)">
                                                      <template v-if="mainTopic.leaf">
                                                        <i class="fa fa-minus tx-10 cp" style="color: #E5E7EA;"></i>
                                                      </template>
                                                      <template v-else>
                                                        <template v-if="mainTopic.expanded">
                                                          <i class="fas fa-chevron-down cp" style="color: #E5E7EA;"></i>
                                                        </template>
                                                        <template v-else>
                                                          <i class="fas fa-chevron-right cp" style="color: #E5E7EA;"></i>
                                                        </template>
                                                      </template>
                                                    </div>
                                                    <div class="d-flex align-items-center">
                                                      <input type="checkbox" :id="`check-${mainTopic.id}`" v-model="mainTopic.checked" @change="getCheckedLevelThree(mainTopic, theme, subject)" :indeterminate.prop="mainTopic.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                                      <label class="mb-0 px-2 text-truncate py-1 text cp" v-on:click.stop="mainTopic.leaf ? () => {} : handleTree(mainTopic)" style="color: #6C727F; max-width: 10rem;">${mainTopic.text}</label>
                                                    </div>
                                                  </div>
                                                </div>
                                                <ul class="tree-nested pl-4" :class="{ 'tree-active': mainTopic.expanded }">
                                                  <li v-if="mainTopic.status === 'loading'">
                                                    <i class="fas fa-spinner fa-spin" style="color: #ccccccc1;"></i>
                                                  </li>
                                                  <li v-for="topic in mainTopic.children" v-on:click.stop="() => {}">
                                                    <div class="d-flex justify-content-between align-items-center hover">
                                                      <div class="d-flex align-items-center">
                                                        <input type="checkbox" :id="`check-${topic.id}`" v-model="topic.checked" @change="getCheckedLevelFour(topic, mainTopic, theme, subject)" :indeterminate.prop="topic.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                                        <label class="mb-0 px-2 text-truncate py-1 text cp" style="color: #6C727F; max-width: 13rem;" :for="`check-${topic.id}`">${topic.text}</label>
                                                      </div>
                                                    </div>
                                                  </li>
                                                </ul>
                                              </li>
                                            </ul>
                                          </li>
                                        </ul>
                                      </li>
                                    </ul>
                                    <template v-if="questionsBankControls.status === 'success' && filteredSubjectList.length > 0">
                                      <p class="tw-text-xs/4.5 tw-text-slate-500 tw-mt-6 tw-mb-0">
                                        Demais disciplinas
                                      </p>
                                      <ul id="myUL">
                                        <li v-for="(subject,index) in filteredSubjectList">
                                          <div class="tw-flex tw-items-center tw-justify-between tw-rounded-lg tw-p-3" :class="[subject.checked ? 'tw-bg-slate-50' : '']">
                                            <div class="tw-flex-1 tw-flex tw-items-center tw-gap-3">
                                              <input type="checkbox" :id="`check-${subject.id}`" v-model="subject.checked" @change="getChecked(subject)" :indeterminate.prop="subject.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                              <p class="tw-w-full tw-mb-0" v-on:click.stop="handleTree(subject)">${subject.text}</p>
                                            </div>
                                            <div v-on:click.stop="handleTree(subject)">
                                              <template v-if="subject.expanded">
                                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="#E5E7EA" class="bi bi-folder2-open" viewBox="0 0 16 16">
                                                  <path d="M1 3.5A1.5 1.5 0 0 1 2.5 2h2.764c.958 0 1.76.56 2.311 1.184C7.985 3.648 8.48 4 9 4h4.5A1.5 1.5 0 0 1 15 5.5v.64c.57.265.94.876.856 1.546l-.64 5.124A2.5 2.5 0 0 1 12.733 15H3.266a2.5 2.5 0 0 1-2.481-2.19l-.64-5.124A1.5 1.5 0 0 1 1 6.14zM2 6h12v-.5a.5.5 0 0 0-.5-.5H9c-.964 0-1.71-.629-2.174-1.154C6.374 3.334 5.82 3 5.264 3H2.5a.5.5 0 0 0-.5.5zm-.367 1a.5.5 0 0 0-.496.562l.64 5.124A1.5 1.5 0 0 0 3.266 14h9.468a1.5 1.5 0 0 0 1.489-1.314l.64-5.124A.5.5 0 0 0 14.367 7H1.633z"/>
                                                </svg> -->
                                                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-text-slate-300 tw-size-5">
                                                  <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 15.75 7.5-7.5 7.5 7.5" />
                                                </svg>
                                              </template>
                                              <template v-else>
                                                <!-- <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="#E5E7EA" class="bi bi-folder" viewBox="0 0 16 16">
                                                  <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l.828.828A2 2 0 0 0 9.828 3h3.982a2 2 0 0 1 1.992 2.181l-.637 7A2 2 0 0 1 13.174 14H2.826a2 2 0 0 1-1.991-1.819l-.637-7a1.99 1.99 0 0 1 .342-1.31zM2.19 4a1 1 0 0 0-.996 1.09l.637 7a1 1 0 0 0 .995.91h10.348a1 1 0 0 0 .995-.91l.637-7A1 1 0 0 0 13.81 4H2.19zm4.69-1.707A1 1 0 0 0 6.172 2H2.5a1 1 0 0 0-1 .981l.006.139C1.72 3.042 1.95 3 2.19 3h5.396l-.707-.707z"/>
                                                </svg> -->
                                                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-text-slate-300 tw-size-5">
                                                  <path stroke-linecap="round" stroke-linejoin="round" d="m19.5 8.25-7.5 7.5-7.5-7.5" />
                                                </svg>
                                              </template>
                                            </div>
                                            <!-- <div class="d-flex align-items-center pr-1">
                                              <label :for="`check-${subject.id}`" class="m-0">
                                                <i class="fas fa-minus-circle tx-18 cp" style="color: #FF0000;" v-if="subject.checked"></i>
                                                <i class="fas fa-plus-circle tx-18 cp" style="color: #0C7BDB;" v-else></i>
                                              </label>
                                            </div> -->
                                          </div>
                                          <ul class="tree-nested pl-2" :class="{ 'tree-active': subject.expanded }">
                                            <li v-if="subject.status === 'loading'">
                                              <i class="fas fa-spinner fa-spin" style="color: #ccccccc1;"></i>
                                            </li>
                                            <li
                                              v-if="subject.status === 'success'"
                                              v-for="theme in subject.children"
                                            >
                                              <div class="d-flex justify-content-between align-items-center py-0 hover">
                                                <div class="d-flex align-items-center">
                                                  <div class="px-1" v-on:click.stop="theme.leaf ? () => {} : handleTree(theme)">
                                                    <template v-if="theme.expanded">
                                                      <i class="fas fa-chevron-down cp" style="color: #E5E7EA;"></i>
                                                    </template>
                                                    <template v-else>
                                                      <i class="fas fa-chevron-right cp" style="color: #E5E7EA;"></i>
                                                    </template>
                                                  </div>
                                                  <div class="d-flex align-items-center">
                                                    <input type="checkbox" :id="`check-${theme.id}`" v-model="theme.checked" @change="getCheckedLevelTwo(theme, subject)" :indeterminate.prop="theme.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                                    <label class="mb-0 px-2 text-truncate py-1 text cp" style="max-width: 11rem;" v-on:click.stop="theme.leaf ? () => {} : handleTree(theme)">${ theme.text }</label>
                                                  </div>
                                                </div>
                                                <!-- <div class="d-flex align-items-center pr-1">
                                                  <label :for="`check-${theme.id}`" class="m-0">
                                                    <i class="fas fa-minus-circle tx-18 cp" style="color: #FF0000;" v-if="theme.checked"></i>
                                                    <i class="fas fa-plus-circle tx-18 cp" style="color: #0C7BDB;" v-else></i>
                                                  </label>
                                                </div> -->
                                              </div>
                                              <ul class="tree-nested pl-2" :class="{ 'tree-active': theme.expanded }">
                                                <li v-if="theme.status === 'loading'">
                                                  <i class="fas fa-spinner fa-spin" style="color: #ccccccc1;"></i>
                                                </li>
                                                <li
                                                  v-if="theme.status === 'success'"
                                                  v-for="mainTopic in theme.children"
                                                >
                                                  <div class="d-flex justify-content-between align-items-center py-0 hover">
                                                    <div class="d-flex align-items-center">
                                                      <div class="px-1" v-on:click.stop="mainTopic.leaf ? () => {} : handleTree(mainTopic)">
                                                        <template v-if="mainTopic.leaf">
                                                          <i class="fa fa-minus tx-10 cp" style="color: #E5E7EA;"></i>
                                                        </template>
                                                        <template v-else>
                                                          <template v-if="mainTopic.expanded">
                                                            <i class="fas fa-chevron-down cp" style="color: #E5E7EA;"></i>
                                                          </template>
                                                          <template v-else>
                                                            <i class="fas fa-chevron-right cp" style="color: #E5E7EA;"></i>
                                                          </template>
                                                        </template>
                                                      </div>
                                                      <div class="d-flex align-items-center">
                                                        <input type="checkbox" :id="`check-${mainTopic.id}`" v-model="mainTopic.checked" @change="getCheckedLevelThree(mainTopic, theme, subject)" :indeterminate.prop="mainTopic.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                                        <label class="mb-0 px-2 text-truncate py-1 text cp" v-on:click.stop="mainTopic.leaf ? () => {} : handleTree(mainTopic)" style="color: #6C727F; max-width: 10rem;">${ mainTopic.text }</label>
                                                      </div>
                                                    </div>
                                                    <!-- <div class="d-flex align-items-center pr-1">
                                                      <label :for="`check-${mainTopic.id}`" class="m-0">
                                                        <i class="fas fa-minus-circle tx-18 cp" style="color: #FF0000;" v-if="mainTopic.checked"></i>
                                                        <i class="fas fa-plus-circle tx-18 cp" style="color: #0C7BDB;" v-else></i>
                                                      </label>
                                                    </div> -->
                                                  </div>
                                                  <ul class="tree-nested pl-4" :class="{ 'tree-active': mainTopic.expanded }">
                                                    <li v-if="mainTopic.status === 'loading'">
                                                      <i class="fas fa-spinner fa-spin" style="color: #ccccccc1;"></i>
                                                    </li>
                                                    <li
                                                      v-for="topic in mainTopic.children"
                                                      v-on:click.stop="() => {}"
                                                    >
                                                      <div class="d-flex justify-content-between align-items-center hover">
                                                        <div class="d-flex align-items-center">
                                                          <input type="checkbox" :id="`check-${topic.id}`" v-model="topic.checked" @change="getCheckedLevelFour(topic, mainTopic, theme, subject)" :indeterminate.prop="topic.indeterminate" class="tw-w-5 tw-h-5 tw-col-start-1 tw-row-start-1 tw-appearance-none tw-rounded tw-border tw-border-gray-300 tw-bg-white !tw-ring-primary-600 checked:!tw-border-primary-600 checked:!tw-bg-primary-600 indeterminate:tw-border-primary-600 indeterminate:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-border-gray-300 disabled:tw-bg-gray-100 disabled:checked:tw-bg-gray-100 forced-colors:tw-appearance-auto" />
                                                          <label class="mb-0 px-2 text-truncate py-1 text cp" style="color: #6C727F; max-width: 13rem;" :for="`check-${topic.id}`">${ topic.text }</label>
                                                        </div>
                                                        <!-- <div class="d-flex align-items-center pr-1">
                                                          <label :for="`check-${topic.id}`" class="m-0">
                                                            <i class="fas fa-minus-circle tx-18 cp" style="color: #FF0000;" v-if="topic.checked"></i>
                                                            <i class="fas fa-plus-circle tx-18 cp" style="color: #0C7BDB;" v-else></i>
                                                          </label>
                                                        </div> -->
                                                      </div>
                                                    </li>
                                                  </ul>
                                                </li>
                                              </ul>
                                            </li>
                                          </ul>
                                        </li>
                                      </ul>
                                    </template>
                                  </div>
                                </div>
                              </template>
                            </div>
                          </template>
                        </div>
                        <!-- <div class="tw-mt-4">
                          <button type="button" class="tw-flex tw-items-center tw-justify-center tw-w-full tw-rounded-lg tw-text-white tw-bg-primary-600 tw-px-4 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-bg-primary-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-bg-slate-200 disabled:tw-text-slate-400" @click="getAndShowQuestions(), controls.showAdvancedFilters = false" :disabled="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
                            <template v-if="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
                              Aguarde
                              <svg class="tw-animate-spin tw--mr-1 tw-ml-3 tw-h-5 tw-w-5 tw-text-slate-400" fill="none" viewBox="0 0 24 24">
                                <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                              </svg>
                            </template>
                            <template v-else>
                              Mostrar questões
                            </template>
                          </button>
                        </div> -->
                      </div>
                    </div>
                  </template>
                </div>
              </template>
              <template v-else>
                <div class="tw-flex tw-items-center tw-gap-3 tw-cursor-pointer [writing-mode:sideways-lr]" @click="toggleFilterPanel">
                  <p class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-500 tw-mb-0">Filtrar questões</p>
                  <button type="button" class="tw-relative tw-rounded tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-ring-offset-2 focus:tw-outline-hidden">
                    <span class="tw-absolute tw--inset-2.5"></span>
                    <span class="tw-sr-only">Abrir painel</span>
                    <svg class="tw-size-4 tw-text-slate-400" width="17" height="16" viewBox="0 0 17 16" fill="none">
                      <path d="M9.90856 7.46935C9.97848 7.53903 10.034 7.62182 10.0718 7.71298C10.1097 7.80415 10.1291 7.90189 10.1291 8.0006C10.1291 8.09931 10.1097 8.19705 10.0718 8.28821C10.034 8.37937 9.97848 8.46217 9.90856 8.53185L4.90856 13.5318C4.76766 13.6727 4.57657 13.7519 4.37731 13.7519C4.17805 13.7519 3.98695 13.6727 3.84606 13.5318C3.70516 13.391 3.62601 13.1999 3.62601 13.0006C3.62601 12.8013 3.70516 12.6102 3.84606 12.4693L8.31543 7.99997L3.84731 3.5306C3.77754 3.46083 3.7222 3.37801 3.68445 3.28686C3.64669 3.19571 3.62726 3.09801 3.62726 2.99935C3.62726 2.80009 3.70641 2.60899 3.84731 2.4681C3.9882 2.3272 4.1793 2.24805 4.37856 2.24805C4.47722 2.24805 4.57492 2.26748 4.66607 2.30524C4.75722 2.34299 4.84004 2.39833 4.90981 2.4681L9.90856 7.46935ZM11.8779 2.24997C11.679 2.24997 11.4883 2.32899 11.3476 2.46964C11.207 2.61029 11.1279 2.80106 11.1279 2.99997V13C11.1279 13.1989 11.207 13.3896 11.3476 13.5303C11.4883 13.671 11.679 13.75 11.8779 13.75C12.0768 13.75 12.2676 13.671 12.4083 13.5303C12.5489 13.3896 12.6279 13.1989 12.6279 13V2.99997C12.6279 2.80106 12.5489 2.61029 12.4083 2.46964C12.2676 2.32899 12.0768 2.24997 11.8779 2.24997Z" fill="currentColor" aria-hidden="true" data-slot="icon" />
                    </svg>
                  </button>
                </div>
              </template>
            </div>
            <!-- Center -->
            <div class="tw-flex tw-justify-center tw-min-w-0 tw-flex-auto tw-bg-slate-50 tw-p-6">
              <div class="tw-max-w-5xl tw-w-full">
                <!-- questionsBankControls.questions.results && questionsBankControls.questions.results.length -->
                <template v-if="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
                  <div class="tw-flex tw-flex-col tw-gap-4">
                    <div data-slot="skeleton" class="tw-bg-slate-200 tw-animate-pulse tw-rounded-md tw-h-8"></div>
                    <div class="tw-flex tw-justify-between">
                      <div data-slot="skeleton" class="tw-bg-slate-200 tw-animate-pulse tw-rounded-md tw-h-11 tw-w-[120px]"></div>
                      <div data-slot="skeleton" class="tw-bg-slate-200 tw-animate-pulse tw-rounded-md tw-h-11 tw-w-[212px]"></div>
                    </div>
                    <div data-slot="skeleton" class="tw-bg-slate-200 tw-animate-pulse tw-rounded-md tw-h-8"></div>
                    <div data-slot="skeleton" class="tw-bg-slate-200 tw-animate-pulse tw-rounded-md tw-h-[36px]"></div>
                    <div data-slot="skeleton" class="tw-bg-slate-200 tw-animate-pulse tw-rounded-md tw-h-32"></div>
                    <div class="tw-w-full tw-border-t tw-border-slate-200"></div>
                    <div data-slot="skeleton" class="tw-bg-slate-200 tw-animate-pulse tw-rounded-md tw-h-32"></div>
                  </div>
                </template>
                <template v-else>
                  <div class="tw-h-full tw-flex tw-flex-col tw-justify-between tw-gap-4">
                    <!-- <div class="tw-isolate tw-inline-flex tw-rounded-lg">
                      <button
                        type="button"
                        class="tw-relative tw-flex-1 tw-inline-flex tw-items-center tw-justify-center tw-rounded-lg tw-px-4 tw-py-1.5 tw-text-sm tw-ring-inset tw-ring-gray-200 focus:tw-z-10"
                        :class="true ? 'tw-bg-white tw-font-semibold tw-text-slate-950 tw-ring-1' : 'tw-bg-slate-50 tw-text-slate-500 hover:tw-bg-slate-100'"
                        @click=""
                      >
                        Disponíveis
                      </button>
                      <button
                        type="button"
                        class="tw-relative tw-flex-1 tw-inline-flex tw-items-center tw-justify-center tw-px-4 tw-py-1.5 tw-text-sm tw-ring-inset tw-ring-gray-200 focus:tw-z-10"
                        :class="false ? 'tw-bg-white tw-font-semibold tw-text-slate-950 tw-ring-1 hover:tw-bg-gray-50' : 'tw-bg-slate-50 tw-text-slate-500 hover:tw-bg-slate-100'"
                        @click=""
                      >
                        Selecionadas
                      </button>
                      <button
                        type="button"
                        class="tw-relative tw-flex-1 tw-inline-flex tw-items-center tw-justify-center tw-rounded-lg tw-px-4 tw-py-1.5 tw-text-sm tw-ring-inset tw-ring-gray-200 focus:tw-z-10"
                        :class="false ? 'tw-bg-white tw-font-semibold tw-text-slate-950 tw-ring-1 hover:tw-bg-gray-50' : 'tw-bg-slate-50 tw-text-slate-500 hover:tw-bg-slate-100'"
                        @click=""
                      >
                        Sugeridas
                      </button>
                    </div> -->
                    <div class="tw-flex tw-items-center tw-justify-between">
                      <div>
                        <p class="tw-text-lg tw-font-semibold tw-text-gray-700 tw-mb-0">
                          <template v-if="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
                            Buscando questões
                          </template>
                          <template v-else-if="questionsBankControls.questions.results && questionsBankControls.questions.results.length">
                            ${questionsBankControls.quantityOfQuestions} questões
                          </template>
                        </p>
                      </div>
                      <div>
                        <!-- <div class="custom-control custom-switch">
                          <label  for="onlyMyQuestions" class="switch-questions">
                            <input type="checkbox" v-model="controls.onlyMyQuestions" id="onlyMyQuestions">
                            <div class="slider-questions round">
                              <span class="question-bank">Questões públicas</span>
                              <span class="author-questions">Questões da sua escola</span>
                            </div>
                          </label> 
                        </div> -->
                        <!-- <div v-if="!controls.addingQuestion">
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#D0D3D9" class="bi bi-x-lg ml-3 cp" viewBox="0 0 16 16"  data-dismiss="modal" @click="cancel()">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                          </svg>
                        </div> -->
                      </div>
                    </div>
                    <div id="infinity-scroll" class="tw-flex-1 tw-overflow-auto">
                      <div class="tw-flex tw-flex-col tw-gap-6">
                        <!-- Question -->
                        <template v-if="questionsBankControls.questions.results && questionsBankControls.questions.results.length">
                          <template v-for="(question, index) in questionsBankControls.questions.results">
                            <div class="tw-relative">
                              <div class="tw-bg-white tw-rounded-lg tw-p-8">
                                <!-- <div>
                                  <div class="tw-flex tw-items-center tw-justify-between">
                                    <span>Questão ${String(index + 1).padStart(2, '0')}</span>
                                  </div>
                                </div> -->
                                <div class="tw-mb-4">
                                  <button type="button" class="tw-flex tw-items-center tw-justify-center tw-gap-2 tw-w-full tw-rounded-lg tw-text-primary-600 tw-border tw-border-primary-600 tw-px-4 tw-py-2.5 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-bg-slate-200 disabled:tw-text-slate-400" @click="checkQuestionSelection(question) ? removeExamQuestionFromQuestionsBank(question) : addQuestionFromQuestionsBank(question)">
                                    <template v-if="checkQuestionSelection(question)">
                                      <span>
                                        <svg class="tw-size-5" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                          <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
                                        </svg>
                                      </span>
                                      <span>Remover questão</span>
                                    </template>
                                    <template v-else>
                                      <span>
                                        <svg class="tw-size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                                          <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                        </svg>
                                      </span>
                                      <span>Adicionar questão</span>
                                    </template>
                                  </button>
                                </div>
                                <div>
                                  <div>
                                    <div class="tw-flex tw-items-center tw-justify-between tw-border-b tw-border-gray-200">
                                      <div class="tw-flex tw-items-center tw-gap-5">
                                        <div class="tw-flex tw-items-center tw-gap-2 tw-pb-4 tw-cursor-pointer" :class="question.currentMenu === 'enunciation' ? 'tw-border-b-2 tw-border-blue-600' : ''" @click="question.currentMenu = 'enunciation'">
                                          <span :class="question.currentMenu === 'enunciation' ? 'tw-text-blue-600' : 'tw-text-gray-300'">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                              <path d="M11.6663 9.16699H6.66634M8.33301 12.5003H6.66634M13.333 5.83366H6.66634M16.6663 5.66699V14.3337C16.6663 15.7338 16.6663 16.4339 16.3939 16.9686C16.1542 17.439 15.7717 17.8215 15.3013 18.0612C14.7665 18.3337 14.0665 18.3337 12.6663 18.3337H7.33301C5.93288 18.3337 5.23281 18.3337 4.69803 18.0612C4.22763 17.8215 3.84517 17.439 3.60549 16.9686C3.33301 16.4339 3.33301 15.7338 3.33301 14.3337V5.66699C3.33301 4.26686 3.33301 3.5668 3.60549 3.03202C3.84517 2.56161 4.22763 2.17916 4.69803 1.93948C5.23281 1.66699 5.93288 1.66699 7.33301 1.66699H12.6663C14.0665 1.66699 14.7665 1.66699 15.3013 1.93948C15.7717 2.17916 16.1542 2.56161 16.3939 3.03202C16.6663 3.5668 16.6663 4.26686 16.6663 5.66699Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                          </span>
                                          <span class="tw-text-sm tw-font-medium tw-text-gray-700">
                                            Enunciado
                                          </span>
                                        </div>
                                        <div v-if="question.commentedAwnser || question.feedback || question.answerVideo || question.supportContentQuestion" class="tw-flex tw-items-center tw-gap-2 tw-pb-4 tw-cursor-pointer" :class="question.currentMenu === 'feedback' ? 'tw-border-b-2 tw-border-blue-600' : ''" @click="question.currentMenu = 'feedback'">
                                          <span :class="question.currentMenu === 'feedback' ? 'tw-text-blue-600' : 'tw-text-gray-300'">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                              <path d="M10.0003 17.5L9.91695 17.3749C9.33808 16.5066 9.04864 16.0725 8.66624 15.7582C8.32771 15.4799 7.93763 15.2712 7.51833 15.1438C7.0447 15 6.52292 15 5.47935 15H4.33366C3.40024 15 2.93353 15 2.57701 14.8183C2.2634 14.6586 2.00844 14.4036 1.84865 14.09C1.66699 13.7335 1.66699 13.2668 1.66699 12.3333V5.16667C1.66699 4.23325 1.66699 3.76654 1.84865 3.41002C2.00844 3.09641 2.2634 2.84144 2.57701 2.68166C2.93353 2.5 3.40024 2.5 4.33366 2.5H4.66699C6.53383 2.5 7.46725 2.5 8.18029 2.86331C8.8075 3.18289 9.31744 3.69282 9.63701 4.32003C10.0003 5.03307 10.0003 5.96649 10.0003 7.83333M10.0003 17.5V7.83333M10.0003 17.5L10.0837 17.3749C10.6626 16.5066 10.952 16.0725 11.3344 15.7582C11.6729 15.4799 12.063 15.2712 12.4823 15.1438C12.956 15 13.4777 15 14.5213 15H15.667C16.6004 15 17.0671 15 17.4236 14.8183C17.7372 14.6586 17.9922 14.4036 18.152 14.09C18.3337 13.7335 18.3337 13.2668 18.3337 12.3333V5.16667C18.3337 4.23325 18.3337 3.76654 18.152 3.41002C17.9922 3.09641 17.7372 2.84144 17.4236 2.68166C17.0671 2.5 16.6004 2.5 15.667 2.5H15.3337C13.4668 2.5 12.5334 2.5 11.8204 2.86331C11.1932 3.18289 10.6832 3.69282 10.3636 4.32003C10.0003 5.03307 10.0003 5.96649 10.0003 7.83333" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                          </span>
                                          <span class="tw-text-sm tw-font-medium tw-text-gray-700">
                                            Feedbacks
                                          </span>
                                        </div>
                                        <div v-if="question.pedagogicalData" class="tw-flex tw-items-center tw-gap-2 tw-pb-4 tw-cursor-pointer" :class="question.currentMenu === 'pedagogical_data' ? 'tw-border-b-2 tw-border-blue-600' : ''" @click="question.currentMenu = 'pedagogical_data'">
                                          <span :class="question.currentMenu === 'pedagogical_data' ? 'tw-text-blue-600' : 'tw-text-gray-300'">
                                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                              <path d="M10.0003 17.5L9.91695 17.3749C9.33808 16.5066 9.04864 16.0725 8.66624 15.7582C8.32771 15.4799 7.93763 15.2712 7.51833 15.1438C7.0447 15 6.52292 15 5.47935 15H4.33366C3.40024 15 2.93353 15 2.57701 14.8183C2.2634 14.6586 2.00844 14.4036 1.84865 14.09C1.66699 13.7335 1.66699 13.2668 1.66699 12.3333V5.16667C1.66699 4.23325 1.66699 3.76654 1.84865 3.41002C2.00844 3.09641 2.2634 2.84144 2.57701 2.68166C2.93353 2.5 3.40024 2.5 4.33366 2.5H4.66699C6.53383 2.5 7.46725 2.5 8.18029 2.86331C8.8075 3.18289 9.31744 3.69282 9.63701 4.32003C10.0003 5.03307 10.0003 5.96649 10.0003 7.83333M10.0003 17.5V7.83333M10.0003 17.5L10.0837 17.3749C10.6626 16.5066 10.952 16.0725 11.3344 15.7582C11.6729 15.4799 12.063 15.2712 12.4823 15.1438C12.956 15 13.4777 15 14.5213 15H15.667C16.6004 15 17.0671 15 17.4236 14.8183C17.7372 14.6586 17.9922 14.4036 18.152 14.09C18.3337 13.7335 18.3337 13.2668 18.3337 12.3333V5.16667C18.3337 4.23325 18.3337 3.76654 18.152 3.41002C17.9922 3.09641 17.7372 2.84144 17.4236 2.68166C17.0671 2.5 16.6004 2.5 15.667 2.5H15.3337C13.4668 2.5 12.5334 2.5 11.8204 2.86331C11.1932 3.18289 10.6832 3.69282 10.3636 4.32003C10.0003 5.03307 10.0003 5.96649 10.0003 7.83333" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                            </svg>
                                          </span>
                                          <span class="tw-text-sm tw-font-medium tw-text-gray-700">
                                            Dados pedagógicos
                                          </span>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="tw-py-4">
                                    <div v-show="question.currentMenu === 'enunciation'">
                                      <div class="tw-flex tw-items-center tw-justify-between">
                                        <div>
                                          <div class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400 tw-cursor-pointer" @click="showUsesQuestion(question.uses)">
                                            ${question.uses && question.uses.length === 1 ? 'Utilizada 1 vez' : (question.uses && question.uses.length > 1 ? 'Utilizada ' + question.uses.length + ' vezes' : 'Nova questão')}
                                          </div>
                                        </div>
                                        <div class="tw-flex tw-items-center tw-gap-2">
                                          <p class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                                            ${question.level === 0 ? 'Fácil' : question.level === 1 ? 'Médio' : question.level === 2 ? 'Difícil' : 'Indefinido'}
                                          </p>
                                          <div class="tw-min-w-50" aria-hidden="true">
                                            <div class="tw-flex tw-items-center tw-gap-1">
                                              <div
                                                v-for="(bar, index) in 4"
                                                class="tw-flex-1 tw-overflow-hidden tw-rounded-full tw-bg-slate-200"
                                              >
                                                <div class="tw-h-1.5 tw-rounded-full tw-bg-mint-600" :style="{ width: getBarWidth(index, question.level === 0 ? 25 : question.level === 1 ? 50 : question.level === 2 ? 100 : 0) }"></div>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                      <!-- Question Type -->
                                      <div class="tw-pt-2.5">
                                        <p class="tw-text-sm tw-font-medium tw-text-slate-500 tw-mb-0">
                                          ${question.categoryDisplay == 'Objetiva' ? 'Múltipla escolha' : question.categoryDisplay}
                                        </p>
                                      </div>
                                      <!-- board and elaborationYear -->
                                      <div class="tw-pt-2.5" v-if="question.board">
                                        <p class="tw-text-sm tw-font-bold tw-text-slate-600 tw-uppercase tw-mb-0">
                                          (${question.board ? question.board : ''}${question.elaborationYear  ? - question.elaborationYear : ''})
                                        </p>
                                      </div>
                                      <!-- Enunciation -->
                                      <div class="tw-pt-2.5">
                                        <div class="tw-text-lg/6 tw-font-medium tw-text-gray-700 tw-list-inside" v-html="question.enunciation"></div>
                                      </div>
                                      <!-- Alternatives -->
                                      <div v-show="['Objetiva', 'Somatório'].includes(question.categoryDisplay)">
                                        <div class="tw-relative tw-py-6">
                                          <div class="tw-absolute tw-inset-0 tw-flex tw-items-center" aria-hidden="true">
                                            <div class="tw-w-full tw-border-t tw-border-gray-200"></div>
                                          </div>
                                        </div>
                                        <div class="tw-flex tw-flex-col tw-gap-2">
                                          <div
                                            v-for="(alternative, alternativeIndex) in question.alternatives"
                                            class="tw-flex tw-items-center tw-gap-3 tw-rounded tw-p-3"
                                            :class="alternative.isCorrect ? 'tw-bg-mint-100' : 'tw-bg-gray-50'"
                                          >
                                            <div>
                                              <template v-if="alternative.isCorrect">
                                                <svg width="21" height="20" viewBox="0 0 21 20" fill="none">
                                                  <rect x="0.666504" width="20" height="20" rx="10" fill="#41C588" />
                                                  <path d="M15.3332 6.5L8.91654 12.9167L5.99988 10" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                                </svg>
                                              </template>
                                              <template v-else>
                                                <div class="tw-size-5">&nbsp;</div>
                                              </template>
                                            </div>
                                            <div class="tw-text-sm" :class="alternative.isCorrect ? 'tw-font-semibold tw-text-gray-700' : 'tw-text-gray-500'" v-html="alternative.text"></div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <!-- Commented Answer -->
                                    <div v-show="question.currentMenu == 'feedback'">
                                      <div class="lize-card">
                                        <div class="card-body p-5">
                                          <div class="row" v-if="question.commentedAwnser">
                                            <div class="col-12">
                                              <h5>Resposta comentada:</h5>
                                              <div class="text" v-html="question.commentedAwnser"></div>
                                            </div>
                                          </div>
                                          <div class="row" v-if="question.feedback">
                                            <div class="col-12">
                                              <h5>Feedback do Professor:</h5>
                                              <div class="text" v-html="question.feedback"></div>
                                            </div>
                                          </div>
                                          <div class="row" v-if="question.answerVideo">
                                            <div class="col-12">
                                              <h5>Resposta comentada em vídeo:</h5>
                                              <a :href="question.answerVideo">Clique aqui para assistir o vídeo</a>
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                    <div v-show="question.currentMenu == 'pedagogical_data'">
                                      <div class="lize-card">
                                        <div class="card-body  pt-5 pl-5">
                                          <div class="row" v-if="question.pedagogicalData">
                                            <p><strong>Segmento:</strong> ${ getSegmentName(question.pedagogicalData.segment) }</p>
                                          </div>
                                          <div class="row" v-if="question.pedagogicalData.gradeName">
                                            <p><strong>Ano/Série:</strong> ${ question.pedagogicalData.gradeName }</p>
                                          </div>
                                          <div class="row" v-if="question.pedagogicalData.knowledgeAreaName">
                                            <p><strong>Área de Conhecimento:</strong> ${ question.pedagogicalData.knowledgeAreaName }</p>
                                          </div>
                                          <div class="row" v-if="question.pedagogicalData.subject">
                                            <p><strong>Disciplina:</strong> ${ question.pedagogicalData.subject.name }</p>
                                          </div>
                                          <div class="row" v-if="question.pedagogicalData.levelDisplay">
                                            <p><strong>Nível de Dificuldade:</strong> ${ question.pedagogicalData.levelDisplay }</p>
                                          </div>
                                          
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div>
                                  <div class="tw-mt-4">
                                    <button type="button" class="tw-flex tw-items-center tw-justify-center tw-gap-2 tw-w-full tw-rounded-lg tw-text-primary-600 tw-border tw-border-primary-600 tw-px-4 tw-py-2.5 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 disabled:tw-bg-slate-200 disabled:tw-text-slate-400" @click="checkQuestionSelection(question) ? removeExamQuestionFromQuestionsBank(question) : addQuestionFromQuestionsBank(question)">
                                      <template v-if="checkQuestionSelection(question)">
                                        <span>
                                          <svg class="tw-size-5" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
                                          </svg>
                                        </span>
                                        <span>Remover questão</span>
                                      </template>
                                      <template v-else>
                                        <span>
                                          <svg class="tw-size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                                            <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                          </svg>
                                        </span>
                                        <span>Adicionar questão</span>
                                      </template>
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </template>
                          <template v-if="questionsBankControls.waitForQuestions">
                            <div class="col-12 p-3">
                              <h6 class="text-muted text-center">Buscando mais questões <i class="fas fa-spinner fa-spin"></i></h6>
                            </div>
                          </template>
                        </template>
                        <template v-else>
                          <div class="tw-flex tw-flex-col tw-items-center tw-justify-center tw-text-center">
                            <svg class="tw-mx-auto" width="200" height="200" viewBox="0 0 200 200" fill="none">
                              <path d="M130.219 101.811C129.434 102.649 129.313 102.36 129.628 101.347C130.261 99.3106 130.919 97.2826 128.869 96.7076C127.99 96.5401 127.086 96.5544 126.212 96.7496C124.846 96.9574 123.55 97.4888 122.431 98.2994C121.312 99.1101 120.403 100.176 119.78 101.41C119.339 102.244 119.08 102.21 119.08 101.11C119.37 97.4886 123.555 94.5816 127.537 94.7206C129.329 94.7826 131.275 95.4206 131.712 97.3776C131.784 98.1796 131.688 98.9878 131.431 99.7509C131.174 100.514 130.761 101.215 130.219 101.811Z" fill="#191919" />
                              <path d="M129.143 92.8058C129.363 93.3058 129.354 93.6058 129.249 93.6488C129.122 93.6698 128.868 93.4808 128.489 93.1638C124.141 89.5198 120.154 90.3068 118.431 92.9318C117.612 94.3536 116.988 95.8784 116.575 97.4658C116.236 98.3858 115.988 98.3088 115.858 97.2758C115.708 95.5407 116.036 93.7976 116.807 92.2358C117.157 91.4647 117.677 90.782 118.326 90.2382C118.976 89.6944 119.739 89.3033 120.56 89.0938C122.198 88.5778 123.967 88.669 125.543 89.3507C127.119 90.0324 128.397 91.2589 129.143 92.8058Z" fill="#191919" />
                              <path d="M158.476 76.6948V58.8748C158.476 58.75 158.452 58.6264 158.405 58.511C158.357 58.3956 158.287 58.2908 158.199 58.2026C158.111 58.1143 158.006 58.0445 157.891 57.997C157.775 57.9494 157.652 57.9253 157.527 57.9258H145.381C145.256 57.9253 145.133 57.9494 145.017 57.997C144.902 58.0445 144.797 58.1143 144.709 58.2026C144.62 58.2908 144.551 58.3956 144.503 58.511C144.456 58.6264 144.431 58.75 144.432 58.8748V76.6948C144.432 76.8195 144.408 76.9431 144.361 77.0584C144.313 77.1738 144.243 77.2785 144.155 77.3667C144.067 77.4548 143.962 77.5246 143.847 77.572C143.731 77.6194 143.608 77.6434 143.483 77.6428H138.783C138.611 77.6424 138.442 77.689 138.295 77.7776C138.147 77.8661 138.027 77.9932 137.946 78.1452C137.865 78.2971 137.828 78.4682 137.837 78.64C137.847 78.8117 137.903 78.9776 138 79.1198L149.788 96.8538C149.871 96.9806 149.983 97.0856 150.115 97.1596C150.247 97.2336 150.395 97.2744 150.547 97.2786C150.698 97.2829 150.848 97.2503 150.984 97.1838C151.12 97.1173 151.238 97.0188 151.328 96.8968L164.739 79.1618C164.844 79.0207 164.909 78.8531 164.924 78.6776C164.94 78.5021 164.907 78.3257 164.828 78.1682C164.749 78.0106 164.628 77.878 164.478 77.7852C164.329 77.6924 164.156 77.6431 163.98 77.6428H159.425C159.3 77.6434 159.177 77.6194 159.061 77.572C158.946 77.5246 158.841 77.4548 158.753 77.3667C158.665 77.2785 158.595 77.1738 158.547 77.0584C158.5 76.9431 158.475 76.8195 158.476 76.6948Z" fill="#FD853A" />
                              <path d="M155.187 152.99L139.181 161.531C139.031 161.608 138.866 161.651 138.698 161.656C138.529 161.66 138.362 161.627 138.208 161.558C138.054 161.489 137.918 161.387 137.809 161.258C137.701 161.129 137.623 160.977 137.581 160.814L134.921 150C134.861 149.761 134.882 149.509 134.982 149.283C135.081 149.058 135.253 148.872 135.47 148.755L151.47 140.215C151.62 140.137 151.785 140.094 151.953 140.089C152.122 140.084 152.289 140.118 152.443 140.187C152.597 140.256 152.733 140.358 152.842 140.487C152.95 140.616 153.028 140.768 153.07 140.932L155.727 151.75C155.785 151.987 155.763 152.237 155.666 152.461C155.568 152.684 155.4 152.87 155.187 152.99Z" fill="#FD853A" />
                              <path d="M154.533 142.447C154.495 142.172 154.282 140.737 154.833 141.435C155.517 142.308 158.896 152.771 158.755 153.877C158.605 155.057 157.407 155.566 156.499 156.07C152.918 158.055 145.285 162.307 141.442 163.77C136.095 165.801 149.032 157.927 154.707 154.87C155.188 154.61 155.661 154.352 156.119 154.09C156.333 153.967 156.819 153.837 156.9 153.562C156.93 153.421 155.239 147.566 154.533 142.447Z" fill="#191919" />
                              <path d="M161.576 154.276C161.97 155.156 162.165 156.112 162.146 157.076C161.973 158.067 161.068 158.506 160.269 158.953C137.08 171.913 139.369 168.225 159.531 157.182C159.953 156.95 160.331 156.865 160.269 156.338C160.189 155.705 159.913 154.988 159.763 154.356C156.41 140.248 158 141.653 161.576 154.276Z" fill="#191919" />
                              <path d="M150.843 127.664L139.012 113.914C138.904 113.787 138.826 113.636 138.784 113.474C138.742 113.312 138.737 113.143 138.769 112.979C138.802 112.814 138.871 112.66 138.971 112.526C139.072 112.392 139.202 112.283 139.35 112.206L149.324 107.251C149.544 107.141 149.795 107.108 150.036 107.157C150.278 107.207 150.495 107.337 150.653 107.525L162.483 121.274C162.592 121.402 162.67 121.552 162.712 121.714C162.754 121.876 162.759 122.045 162.727 122.21C162.695 122.374 162.626 122.528 162.525 122.662C162.424 122.796 162.295 122.905 162.146 122.982L152.171 127.938C151.95 128.042 151.701 128.071 151.462 128.021C151.223 127.972 151.006 127.847 150.843 127.664Z" fill="#FD853A" />
                              <path d="M162 124.8C160.875 125.781 159.627 126.61 158.288 127.267C156.411 128.404 154.505 129.494 152.574 130.536C152.026 130.912 151.41 131.177 150.76 131.316C150.376 131.327 149.996 131.243 149.653 131.07C149.311 130.897 149.017 130.641 148.799 130.325C144.728 125.947 140.892 121.357 137.306 116.575C135.385 113.688 138.606 116.414 144.476 122.712C150.628 129.312 149.785 128.748 150.276 129.144C150.812 129.577 151.1 129.188 151.626 128.933C153.734 127.906 163.59 123.1 162 124.8Z" fill="#191919" />
                              <path d="M159.952 129.14C160.362 129.004 160.787 128.919 161.218 128.887C161.009 129.27 160.694 129.585 160.311 129.794C156.904 132.058 154.511 133.334 152.192 134.602C151.438 135.163 150.577 135.565 149.662 135.782C148.776 135.845 148.144 135.149 147.574 134.559C143.573 130.247 139.801 125.728 136.274 121.021C134.352 118.134 137.552 120.881 143.444 127.158C145.465 129.311 147.431 131.521 149.39 133.737C149.707 134.095 150.59 133.396 150.89 133.231C151.917 132.659 158.293 129.645 159.952 129.14Z" fill="#191919" />
                              <path d="M191.395 34.4142C187.846 31.3432 183.015 30.8142 178.363 31.5672C175.074 32.0962 171.763 33.3172 169.548 35.8052C174.715 33.4432 180.658 32.0442 186.081 33.6972C190.332 34.9922 192.55 37.6472 193.124 41.7522C193.42 44.0122 193.192 46.3102 192.457 48.4679C191.722 50.6256 190.5 52.585 188.886 54.1942C188.955 52.5709 188.642 50.9541 187.972 49.4741C187.302 47.9941 186.293 46.6924 185.027 45.6742C186.248 47.697 186.973 49.9806 187.141 52.3376C187.31 54.6946 186.918 57.058 185.997 59.2342C182.337 67.9012 171.531 71.8732 162.02 67.3532C162.52 66.8962 164.464 65.4112 164.698 64.0632C163.025 64.0122 163.249 66.9862 155.272 67.7112C150.841 68.1559 146.365 67.7043 142.113 66.3832C139.066 65.3503 136.251 63.7312 133.826 61.6172C133.655 61.4722 133.509 61.3432 133.383 61.2372C136.813 59.9622 139.483 57.9762 139.414 57.5682C139.255 57.0922 135.356 59.5582 129.65 60.4782C122.464 61.6362 117.404 60.3392 116.028 53.3082C115.416 50.1832 116.658 48.6662 116.449 48.3532C117.372 49.4188 118.546 50.2375 119.866 50.7352C120.226 50.8802 122.053 51.7002 122.396 51.3472C122.659 51.0762 119.555 49.8352 117.925 47.9312C116.755 46.3427 116.087 44.4404 116.007 42.4692C115.809 40.0367 116.356 37.6016 117.577 35.4882C118.797 33.3748 120.633 31.6833 122.839 30.6392C125.027 29.7402 127.373 29.2883 129.739 29.3102C133.559 29.2422 134.631 29.8102 135.306 29.3952C134.903 29.0694 134.424 28.8515 133.914 28.7622C132.437 28.3264 130.916 28.058 129.38 27.9622C114.499 26.9962 111.28 42.1182 116.432 48.3322C116.207 48.0322 112.798 51.4592 115.821 57.6532C118.754 63.6642 126.553 63.5932 132.839 61.4072C133.697 62.7306 134.765 63.9053 136.001 64.8852C139.444 67.5291 143.569 69.1385 147.894 69.5252C151.794 69.9532 157.441 69.6632 160.994 67.7952C162.083 67.2222 161.752 68.1102 164.958 69.4612C167.211 70.3975 169.638 70.8442 172.078 70.7716C174.517 70.699 176.913 70.1088 179.108 69.0402C181.814 67.6318 184.128 65.572 185.84 63.0464C187.551 60.5208 188.608 57.6089 188.914 54.5732C192.562 52.6122 194.577 48.4382 194.945 44.3042C195.357 39.6002 193.901 36.5842 191.395 34.4142Z" fill="#191919" />
                              <path d="M133.129 33.7396C132.969 34.5806 133.044 35.0466 133.15 35.1096C133.276 35.1736 133.444 34.8356 133.804 34.1186C137.391 26.9796 148.446 22.6136 159.552 27.0966C159.615 27.1176 159.657 27.1386 159.72 27.1596C156.033 28.7909 152.814 31.3216 150.358 34.5196C149.236 36.1196 149.32 36.4126 150.779 35.1526C155.265 31.2796 159.515 28.6016 165.579 27.1386C170.464 25.9606 177.444 25.1966 181.606 27.8386C181.942 28.0516 183.187 29.3996 183.506 29.3386C183.817 29.3386 182.913 26.7386 179.247 25.3746C174.89 23.7576 167.547 23.7316 160.415 26.8506C157.778 24.9383 154.663 23.7925 151.415 23.5396C141.644 22.6176 134.1 28.6346 133.129 33.7396Z" fill="#191919" />
                              <path d="M164.887 48.6906C165.722 47.1793 166.898 45.8836 168.322 44.9063C169.745 43.9289 171.377 43.297 173.087 43.0606C176.054 42.5436 181.272 42.8716 178.76 41.8796C176.883 41.1774 174.865 40.9373 172.875 41.1794C170.886 41.4215 168.984 42.1387 167.33 43.2706C166.353 43.9221 165.532 44.782 164.927 45.7885C164.322 46.795 163.947 47.923 163.83 49.0916C164.114 50.5006 164.343 49.7816 164.887 48.6906Z" fill="#191919" />
                              <path d="M141.481 55.5222C140.97 57.0912 142.315 55.9552 143.252 54.7632C146.366 50.8002 144.416 43.9142 142.092 42.2792C141.398 41.7912 141.187 41.9622 141.459 42.6592C142.659 45.7282 143.435 50.2122 142.472 53.0762C142.195 53.9002 141.753 54.6852 141.481 55.5222Z" fill="#191919" />
                              <path d="M123.618 110.076C122.976 112.764 119.579 118.734 118.178 121.105C114.475 127.357 110.044 133.147 104.978 138.355C101.034 142.214 96.886 146.408 92.22 149.363C89.808 150.89 87.559 152.632 85.05 153.897C79.694 156.597 74.15 160.14 68.179 161.235C67.358 161.386 60.229 162.943 60.272 163.112C58.639 155.712 58.838 147.282 58.838 142.299C58.838 139.241 58.62 138.857 58.121 141.982C57.4444 146.709 57.2464 151.492 57.53 156.259C57.885 162.886 59.077 169.804 63.625 174.352C57.34 175.452 50.859 174.581 44.835 172.897C41.886 172.073 41.444 172.153 44.329 173.487C51.0263 176.44 58.4706 177.257 65.649 175.828C66.5308 176.263 67.531 176.397 68.496 176.208C71.196 175.475 71.528 171.823 71.406 169.017C74.806 168.677 77.981 166.507 80.832 164.652C80.507 166.971 80.959 174.16 82.097 172.285C82.984 170.826 82.904 165.979 81.823 163.998C87.451 160.198 88.288 158.437 80.832 162.522C76.881 164.686 74.51 166.613 71.322 167.751C71.1721 166.165 70.8969 164.594 70.499 163.051C70.456 162.882 70.183 162.251 70.246 162.123C84.3237 157.775 97.0081 149.797 107.023 138.99C113.246 132.38 118.296 124.756 121.953 116.447C122.76 114.67 123.396 112.82 123.853 110.922C123.88 110.773 123.873 110.619 123.832 110.472C123.792 110.326 123.718 110.19 123.618 110.076Z" fill="#191919" />
                              <path d="M78.4273 130.911C91.7343 125.957 101.642 114.851 107.634 102.295C109.634 98.031 111.415 93.6673 112.969 89.2213C114.983 83.5783 118.959 70.9773 119.211 70.0943C119.638 68.5943 119.852 66.8323 120.811 65.5603C121.556 64.5743 122.444 65.2893 122.687 66.2143C123.555 69.5143 122.387 73.4893 121.696 76.7373C120.937 80.2793 120.452 82.2373 120.515 82.4513C120.647 82.8903 122.861 76.4243 123.805 70.8513C124.137 68.8893 124.62 62.5653 120.811 63.9133C119.226 64.4743 118.841 66.8283 118.343 68.2133C111.251 88.0013 106.149 110.069 88.0193 123.505C81.8227 128.116 74.5341 131.038 66.8683 131.983C49.7183 134.248 37.0253 125.509 35.9113 125.509C35.3303 125.513 54.4683 139.83 78.4273 130.911Z" fill="#191919" />
                              <path d="M51.7503 92.7212C53.3923 93.5422 54.8503 93.6952 56.0943 92.3422C56.3053 92.0672 56.2633 91.9202 55.9253 92.0042C55.432 92.1817 54.9241 92.3156 54.4073 92.4042C53.0983 92.4912 51.2963 91.4972 50.4853 91.3492C49.4823 91.1682 50.8193 92.2562 51.7503 92.7212Z" fill="#191919" />
                              <path d="M47.217 82.0087C47.407 82.8727 48.08 83.4537 48.736 83.3157C49.0861 83.1824 49.3713 82.9193 49.5323 82.581C49.6932 82.2427 49.7175 81.8554 49.6 81.4997C49.6114 81.3057 49.5778 81.1117 49.5018 80.9328C49.4259 80.7539 49.3098 80.5949 49.1624 80.4682C49.015 80.3416 48.8404 80.2506 48.6521 80.2025C48.4638 80.1543 48.2669 80.1503 48.0768 80.1906C47.8867 80.231 47.7085 80.3147 47.556 80.4352C47.4036 80.5557 47.281 80.7098 47.1978 80.8854C47.1146 81.061 47.073 81.2535 47.0764 81.4478C47.0797 81.6421 47.1278 81.833 47.217 82.0057V82.0087Z" fill="#191919" />
                              <path d="M34.9648 112.923C37.1888 114.099 43.6928 120.246 51.4138 121.211C52.4048 121.335 59.3658 120.978 58.8368 119.587C58.2149 117.601 57.7425 115.571 57.4238 113.514C56.8298 110.823 54.8308 103.244 53.4378 100.882C59.1028 100.024 60.2378 98.2634 60.3758 94.6404C60.3978 94.0714 59.7428 88.5464 59.7638 88.5464C61.3218 87.8134 62.3548 87.0334 61.4508 85.5464C60.607 84.4756 59.5875 83.5558 58.4358 82.8264C58.2588 82.8264 57.8358 79.9864 55.0828 72.8524C55.9264 72.4196 56.7247 71.9037 57.4658 71.3124C64.9658 65.3294 59.7428 49.6764 49.4528 55.7494C43.6676 59.0856 38.2282 62.9885 33.2148 67.4004C33.2148 67.4004 21.4588 66.2784 24.5688 74.6754C25.7171 78.0813 27.6454 81.1718 30.1998 83.7004C28.3848 84.7894 28.0428 88.0644 29.0408 90.0474C29.521 90.8091 30.1664 91.453 30.9293 91.9313C31.6922 92.4096 32.553 92.71 33.4478 92.8104C34.6088 93.0164 34.2348 94.5804 34.2908 95.5304C34.3908 97.1534 35.0288 107.676 35.3458 111.33C35.3038 110.887 33.8248 111.961 33.7218 112.13C33.3328 112.771 33.4648 113.19 34.1218 116.263C33.2988 116.432 32.4558 116.579 31.6328 116.727C28.0161 117.529 24.5257 118.821 21.2578 120.565C14.0998 124.665 9.66479 129.356 6.77079 137.309C3.40279 146.564 5.25179 158.795 8.98479 167.865C11.1548 173.138 11.6048 173.578 9.84979 168.076C7.93072 162.364 6.84391 156.405 6.62279 150.383C6.34979 137.615 11.9378 128.05 21.7638 122.421C26.8148 119.527 30.2058 119.011 34.4378 118.098C34.471 118.414 34.485 118.73 34.4798 119.047C34.5008 120.08 34.2688 120.67 34.3798 120.776C34.4428 120.881 34.8878 120.502 35.2018 119.342C35.7548 117.298 35.2018 115.293 35.0758 113.248C34.9996 113.158 34.9601 113.042 34.9648 112.923ZM48.7358 59.1074C50.6758 57.6284 52.8998 56.6074 55.2358 57.3364C56.1053 57.5556 56.8731 58.0669 57.4105 58.7848C57.9479 59.5026 58.2223 60.3833 58.1878 61.2794C58.1338 62.1664 57.8548 62.0994 57.4288 61.3644C57.1857 60.8708 56.8809 60.4101 56.5218 59.9934C55.9917 59.468 55.3017 59.1341 54.5608 59.0444C51.4878 58.5734 48.4158 61.9534 45.8938 62.8824C43.7568 63.6674 46.9308 60.4834 48.7358 59.1074ZM34.4358 91.6464C33.8398 91.5755 33.2484 91.4696 32.6648 91.3294C31.9374 91.1393 31.2708 90.7663 30.7282 90.246C30.1856 89.7256 29.7851 89.0751 29.5648 88.3564C29.1648 87.0484 29.2908 84.8564 30.6648 84.1174C31.1499 84.5496 31.6875 84.9192 32.2648 85.2174C32.2648 85.2174 34.9048 85.9514 35.5968 86.7774C36.2118 87.5124 37.7388 84.9674 36.3138 80.4514C36.0613 79.5642 36.0272 78.6291 36.2144 77.7259C36.4016 76.8227 36.8045 75.9781 37.3888 75.2644C36.9035 75.2591 36.4211 75.1881 35.9548 75.0534C34.0078 74.4004 34.3308 73.8924 36.2548 74.1884C37.4548 74.3734 38.7428 74.3574 39.2908 74.5254C41.8428 74.7364 47.7678 75.6854 53.2508 73.6194C54.2418 76.0864 55.1508 78.6384 55.9508 81.2104C55.6578 81.0534 54.8138 80.6384 54.5798 80.8734C54.1378 81.6104 59.1318 85.8994 59.7888 86.4614C58.3248 87.7914 55.4738 89.2494 57.2998 89.2244C57.5572 89.2151 57.8124 89.1724 58.0588 89.0974C58.499 90.9779 58.7254 92.9021 58.7338 94.8334C58.7275 95.6168 58.5923 96.3938 58.3338 97.1334C58.1818 97.3074 57.8718 98.2454 55.4878 99.0334C50.0678 100.819 43.2568 99.9404 43.0038 100.193C42.6418 100.434 47.5738 101.531 52.8088 100.931C52.8088 104.467 55.4418 113.331 56.7528 116.768C56.8998 117.443 57.1108 118.202 57.3218 119.068C50.5088 120.805 44.6418 117.268 38.4068 113.121C37.2148 112.328 37.2068 112.351 37.2068 112.256C36.8268 108.65 35.8888 97.7894 35.7298 95.9564C35.6258 94.8084 35.9768 92.0254 34.4378 91.6464H34.4358Z" fill="#191919" />
                              <path d="M44.7926 79.1624C45.0323 78.8958 45.2931 78.649 45.5726 78.4244C46.0266 78.1734 46.5315 78.0285 47.0496 78.0004C49.2196 77.7194 48.9026 77.1904 47.1126 77.0934C45.7256 77.0184 44.5826 77.5934 44.4766 78.9704C44.4766 79.2457 44.5819 79.3097 44.7926 79.1624Z" fill="#191919" />
                              <path d="M64.3621 118.976C65.7951 119.723 67.0364 120.791 67.9891 122.097C68.8381 123.397 69.8191 125.97 70.7301 127.011C71.9561 128.411 71.3581 125.39 70.7931 123.611C70.3696 121.93 69.3977 120.438 68.0311 119.372C67.0607 118.608 65.8487 118.218 64.6151 118.272C63.9191 118.368 63.8591 118.634 64.3621 118.976Z" fill="#191919" />
                            </svg>
                            <h3 class="tw-mt-4 tw-text-2xl tw-font-semibold tw-text-slate-700">
                              Sem questões encontradas
                            </h3>
                            <p class="tw-mt-2 tw-text-base tw-text-slate-500 tw-max-w-md">
                              Não localizamos questões com os critérios definidos. Tente alterar os filtros ao lado.
                            </p>
                            <!-- <div class="tw-mt-6">
                              <button type="button" class="tw-inline-flex tw-items-center tw-rounded-md tw-bg-indigo-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-indigo-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-indigo-600">
                                <svg class="tw--ml-0.5 tw-mr-1.5 tw-size-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" data-slot="icon">
                                  <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                </svg>
                                Limpar filtros
                              </button>
                            </div> -->
                          </div>
                        </template>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>
            <!-- Right -->
            <div
              class="tw-hidden tw-sticky tw-top-19 -tw-h-[calc(100vh-4.75rem)] tw-border-l tw-border-slate-200 tw-overflow-y-auto tw-p-6 lg:tw-block lg:tw-flex-none"
              :class="[criteriaPanel === 'open' ? 'tw-w-[21.25rem]' : '']"
            >
              <template v-if="criteriaPanel === 'open'">
                <div class="tw-flex tw-items-center tw-justify-between">
                  <h2
                    class="tw-text-xs/4.5 tw-font-semibold tw-text-gray-700"
                    :class="[criteriaPanel === 'open' ? 'tw-block' : 'tw-hidden']"
                  >
                    Detalhes da solicitação
                  </h2>
                  <div class="tw-flex tw-items-center">
                    <button type="button" class="tw-relative tw-rounded tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-ring-offset-2 focus:tw-outline-hidden" @click="toggleCriteriaPanel">
                      <span class="tw-absolute tw--inset-2.5"></span>
                      <span class="tw-sr-only">Fechar painel</span>
                      <svg class="tw-size-4 tw-text-slate-400" width="17" height="16" viewBox="0 0 17 16" fill="none">
                        <path d="M10.1971 7.46935C10.2671 7.53903 10.3225 7.62182 10.3604 7.71298C10.3982 7.80415 10.4177 7.90189 10.4177 8.0006C10.4177 8.09931 10.3982 8.19705 10.3604 8.28821C10.3225 8.37937 10.2671 8.46217 10.1971 8.53185L5.19713 13.5318C5.05624 13.6727 4.86514 13.7519 4.66588 13.7519C4.46662 13.7519 4.27553 13.6727 4.13463 13.5318C3.99374 13.391 3.91458 13.1999 3.91458 13.0006C3.91458 12.8013 3.99374 12.6102 4.13463 12.4693L8.60401 7.99997L4.13588 3.5306C4.06612 3.46083 4.01078 3.37801 3.97302 3.28686C3.93526 3.19571 3.91583 3.09801 3.91583 2.99935C3.91583 2.80009 3.99499 2.60899 4.13588 2.4681C4.27678 2.3272 4.46788 2.24805 4.66713 2.24805C4.76579 2.24805 4.86349 2.26748 4.95464 2.30524C5.04579 2.34299 5.12862 2.39833 5.19838 2.4681L10.1971 7.46935ZM12.1665 2.24997C11.9676 2.24997 11.7768 2.32899 11.6362 2.46964C11.4955 2.61029 11.4165 2.80106 11.4165 2.99997V13C11.4165 13.1989 11.4955 13.3896 11.6362 13.5303C11.7768 13.671 11.9676 13.75 12.1665 13.75C12.3654 13.75 12.5562 13.671 12.6968 13.5303C12.8375 13.3896 12.9165 13.1989 12.9165 13V2.99997C12.9165 2.80106 12.8375 2.61029 12.6968 2.46964C12.5562 2.32899 12.3654 2.24997 12.1665 2.24997Z" fill="currentColor" aria-hidden="true" data-slot="icon" />
                      </svg>
                    </button>
                  </div>
                </div>
                <div :class="[criteriaPanel === 'open' ? 'tw-block' : 'tw-hidden']">
                  <div class="mt-4">
                    <dl class="tw-flex tw-flex-col tw-gap-4 tw-mb-0">
                      {% if object.objective_quantity > 0 %}
                        <div class="tw-flex tw-items-center tw-justify-between tw-gap-4">
                          <dt class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                            Questões objetivas
                          </dt>
                          <dd class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-700 tw-mb-0">
                            {{ object.objective_quantity }} questões
                          </dd>
                        </div>
                      {% endif %}
                      {% if object.discursive_quantity > 0 %}
                        <div class="tw-flex tw-items-center tw-justify-between tw-gap-4">
                          <dt class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                            Questões discursivas
                          </dt>
                          <dd class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-700 tw-mb-0">
                            {{ object.discursive_quantity }} questões
                          </dd>
                        </div>
                      {% endif %}
                      <div class="tw-flex tw-items-center tw-justify-between tw-gap-4">
                        <dt class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                          Disciplina
                        </dt>
                        <dd class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-700 tw-mb-0">
                          {{ object.teacher_subject.subject.name }}
                        </dd>
                      </div>
                      <div class="tw-flex tw-items-center tw-justify-between tw-gap-4">
                        <dt class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                          Série
                        </dt>
                        <dd class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-700 tw-mb-0">
                          {{ object.grade.formatted_name }}
                        </dd>
                      </div>
                      <div class="tw-flex tw-items-center tw-justify-between tw-gap-4">
                        <dt class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                          Prazo
                        </dt>
                        <dd class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-700 tw-mb-0">
                          {{ object.exam.elaboration_deadline|date:'SHORT_DATE_FORMAT' }}
                        </dd>
                      </div>
                      {% if object.note %}
                        <div class="tw-flex tw-items-center tw-justify-between tw-gap-4">
                          <dt class="tw-text-xs/4.5 tw-font-medium tw-text-slate-400">
                            Observações
                          </dt>
                          <dd class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-700 tw-mb-0">
                            {{ object.note }}
                          </dd>
                        </div>
                      {% endif %}
                    </dl>
                  </div>
                </div>
              </template>
              <template v-else>
                <div class="tw-flex tw-items-center tw-gap-3 tw-cursor-pointer [writing-mode:sideways-lr]" @click="toggleCriteriaPanel">
                  <p class="tw-text-xs/4.5 tw-font-semibold tw-text-slate-500 tw-mb-0">Detalhes da solicitação</p>
                  <button type="button" class="tw-relative tw-rounded tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-ring-2 focus:tw-ring-blue-500 focus:tw-ring-offset-2 focus:tw-outline-hidden">
                    <span class="tw-absolute tw--inset-2.5"></span>
                    <span class="tw-sr-only">Abrir painel</span>
                    <svg class="tw-size-4 tw-text-slate-400" width="17" height="16" viewBox="0 0 17 16" fill="none">
                      <path d="M7.13591 7.46935C7.06599 7.53903 7.01051 7.62182 6.97265 7.71298C6.9348 7.80415 6.91531 7.90189 6.91531 8.0006C6.91531 8.09931 6.9348 8.19705 6.97265 8.28821C7.01051 8.37937 7.06599 8.46217 7.13591 8.53185L12.1359 13.5318C12.2768 13.6727 12.4679 13.7519 12.6672 13.7519C12.8664 13.7519 13.0575 13.6727 13.1984 13.5318C13.3393 13.391 13.4185 13.1999 13.4185 13.0006C13.4185 12.8013 13.3393 12.6102 13.1984 12.4693L8.72903 7.99997L13.1972 3.5306C13.2669 3.46083 13.3223 3.37801 13.36 3.28686C13.3978 3.19571 13.4172 3.09801 13.4172 2.99935C13.4172 2.80009 13.3381 2.60899 13.1972 2.4681C13.0563 2.3272 12.8652 2.24805 12.6659 2.24805C12.5672 2.24805 12.4695 2.26748 12.3784 2.30524C12.2872 2.34299 12.2044 2.39833 12.1347 2.4681L7.13591 7.46935ZM5.16653 2.24997C5.36544 2.24997 5.55621 2.32899 5.69686 2.46964C5.83751 2.61029 5.91653 2.80106 5.91653 2.99997V13C5.91653 13.1989 5.83751 13.3896 5.69686 13.5303C5.55621 13.671 5.36544 13.75 5.16653 13.75C4.96762 13.75 4.77685 13.671 4.6362 13.5303C4.49555 13.3896 4.41653 13.1989 4.41653 13V2.99997C4.41653 2.80106 4.49555 2.61029 4.6362 2.46964C4.77685 2.32899 4.96762 2.24997 5.16653 2.24997Z" fill="currentColor" aria-hidden="true" data-slot="icon" />
                    </svg>
                  </button>
                </div>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  {% if user.inspector.has_ia_creation or user.client_has_ia_creation %}
    <div class="modal fade" id="modalIAQuestion" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content tx-14" style="border-radius: 12px; z-index: 1;">
          <div class="modal-body p-3">
            <div v-show="!generatedQuestion || promptControls.editing">
              <div class="row m-0" v-if="!controls.generatingQuestion">
                <div class="col-12 d-flex justify-content-between mb-3">
                  <span class="lize-bg-warning-light rounded-circle d-flex align-center" style="width: 64px; height: 64px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" fill="#FF8F3D" class="bi bi-stars" viewBox="0 0 16 16">
                      <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                    </svg>
                  </span>
                  <div class="d-flex align-items-center justify-content-between">
                    {% if user.is_freemium %}
                      <div class="mx-2">
                        <credits-component :availables="credits.availables"></credits-component>
                      </div>
                    {% endif %}
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#D0D3D9" class="bi bi-x-lg cp" viewBox="0 0 16 16"  data-dismiss="modal" @click="cancel()">
                      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div v-if="controls.showTutorial">
                <div class="row m-0">
                  <div class="col-12">
                    <h4 class="text tx-24">Crie com ajuda da nossa inteligência artificial.</h4>
                    <p class="text-muted">Experimente nossa IA para criação de questão. 
                    </p>
                  </div>
                </div>
                <div class="row m-0 d-flex align-items-center">
                  <div class="col">
                    <div class="d-flex my-3">
                      <span style="width: 24px; height: 24px; border: 1px solid #9BA3AF" class="d-flex align-center rounded-circle text-muted">1</span>
                      <span class="text-muted mx-3">Descreva como deseja sua questão.</span>
                    </div>
                    <div class="d-flex my-3">
                      <span style="width: 24px; height: 24px; border: 1px solid #9BA3AF" class="d-flex align-center rounded-circle text-muted">2</span>
                      <span class="text-muted mx-3">Utilize nossos recursos e parâmetros pré-definidos.</span>
                    </div>
                    <div class="d-flex my-3">
                      <span style="width: 24px; height: 24px; border: 1px solid #9BA3AF" class="d-flex align-center rounded-circle text-muted">3</span>
                      <span class="text-muted mx-3">A IA vai gerar sua questão e você irá editar como quiser.</span>
                    </div>
                  </div>
                </div>
              </div>
              <div v-show="!controls.showTutorial">
                <template v-if="controls.generatingQuestion">
                  <div class="row m-0">
                    <div class="col-12 d-flex align-items-center justify-content-center" style="min-height: 360px;">
                      <div>
                        <p class="d-flex justify-content-center">
                          <img src="{% static 'assets/img/gifs/stars.gif' %}" style="max-height: 120px;" class="img-fluid">
                        </p>
                        <h5 class="text text-muted text-center">${controls.currentMessage.message}</h4>
                        <p class="text text-muted text-center">${controls.currentMessage.description}</p>
                      </div>
                    </div>
                  </div>
                </template>
                <div v-show="!controls.generatingQuestion">
                  <div class="row m-0">
                    <div class="col-12">
                      <h4 class="text tx-24">Como você gostaria que fosse a sua questão?</h4>
                      <p class="text-muted">
                        Experimente nossa IA para criação de questão. 
                        {% comment %}
                        Veja alguns <a class="link" href="javascript:;">exemplos</a> ou <a class="link" href="javascript:;">assista nosso tutorial</a>.
                        {% endcomment %}
                      </p>
                    </div>
                  </div>
                  <div class="row m-0">
                    <div class="col-12">
                      <label for="" class="text-muted">Descreva sua questão...</label>
                      <div class="custom-editor">
                        <div v-if="!promptControls.editing && !promptControls.text.length" @click="editPrompt()" class="py-1" style="color: #D0D3D9;">Por exemplo, uma questão para trabalhar tal conhecimento e tal...</div>
                        <div v-if="promptControls.editing || promptControls.text.length" :contenteditable="!controls.addingQuestion && !controls.generatingQuestion" @input="updatePromptText()" class="py-1 align-items-center" id="prompt"></div>
                        <div v-if="promptControls.selection.sel && promptControls.text.length">
                          <svg xmlns="http://www.w3.org/2000/svg" @click="promptControls.showOptions = true, promptControls.editing = true" data-toggle="dropdown" style="color: #0C7BDB;" width="24" height="24" fill="currentColor" class="bi bi-plus-circle my-2 cp" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                          </svg>
                          <div class="dropdown-menu py-3" style="border-radius: 8px; color: #667085; box-shadow: 0px 2px 4px -2px #1018280F; box-shadow: 0px 4px 8px -2px #1018281A;">
                            <div class="row m-0 hovable cp" @click="addComponent('questionCategory')">
                              <div class="col-12 d-flex align-items-center">
                                <i class="fas fa-layer-group" style="font-size: 20px; color: #D2D6DB;"></i>
                                <span class="mx-2">Tipo de questão</span>
                              </div>
                            </div>
                            <div class="row m-0 hovable cp my-2" @click="addComponent('subject')">
                              <div class="col-12 d-flex align-items-center">
                                <i class="fas fa-book-open" style="font-size: 20px; color: #D2D6DB;"></i>
                                <span class="mx-2">Disciplina</span>
                              </div>
                            </div>
                            <div class="row m-0 hovable cp my-2" @click="addComponent('level')">
                              <div class="col-12 d-flex align-items-center">
                                <i class="fas fa-signal" style="font-size: 20px; color: #D2D6DB;"></i>
                                <span class="mx-2">Dificuldade</span>
                              </div>
                            </div>
                            <div class="row m-0 hovable cp my-2" @click="addComponent('segment')">
                              <div class="col-12 d-flex align-items-center">
                                <i class="fas fa-users" style="font-size: 20px; color: #D2D6DB;"></i>
                                <span class="mx-2">Nível de Ensino</span>
                              </div>
                            </div>
                            <div class="row m-0 hovable cp my-2" @click="addComponent('language')">
                              <div class="col-12 d-flex align-items-center">
                                <i class="fas fa-pen-nib" style="font-size: 20px; color: #D2D6DB;"></i>
                                <span class="mx-2">Linguagem</span>
                              </div>
                            </div>
                            <div class="row m-0 hovable cp my-2" @click="addComponent('competences', true, 'Competências')">
                              <div class="col-12 d-flex align-items-center">
                                <i class="fas fa-star" style="font-size: 20px; color: #D2D6DB;"></i>
                                <span class="mx-2">Competência</span>
                              </div>
                            </div>
                            <div class="row m-0 hovable cp my-2" @click="addComponent('abilities', true, 'Habilidades')">
                              <div class="col-12 d-flex align-items-center">
                                <i class="fas fa-book-reader" style="font-size: 20px; color: #D2D6DB;"></i>
                                <span class="mx-2">Habilidades</span>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row m-0 mt-2" style="z-index: 1;">
                    <div class="col-12" v-if="promptControls.hasError">
                      <p class="text-danger mt-1 mb-3">Não conseguimos gerar a questão, você pode tentar novamente clicando no botão "Gerar Questão"</p>
                    </div>
                    <div class="col-12">
                      <div class="d-flex align-items-center">
                        <label for="baseImageID" class="cp">
                          <template v-if="promptControls.image && promptControls.image.name">
                            <span class="text-muted d-flex align-items-center tx-14 fw-400">
                              <span style="color: #6C727F;">Imagem base selecionada: </span>
                              <span style="color: #384250;" class="mx-2">${promptControls.image.name}</span>
                            </span>
                          </template>
                          <template v-else>
                            <span style="color: #FF8F3D;"><b>Clique para adicionar</b> </span> <span style="color: #6C727F;">uma imagem caso queira usá-la como base.</span>
                          </template>
                        </label>
                        <template v-if="promptControls.image && promptControls.image.name">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#FF8F3D" class="bi bi-trash mx-2 cp" viewBox="0 0 16 16" @click="removePromptImage()">
                            <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                            <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
                          </svg>
                        </template>
                      </div>
                      <input type="file" class="d-none" @change="promptControls.image = $event.target.files[0]" id="baseImageID">
                    </div>
                    <div class="col-12" v-if="promptControls.errors && promptControls.errors.baseImage">
                        <span class="text-danger" v-for="error in promptControls.errors.baseImage">${error}</span>
                    </div>
                  </div>
                  <div class="row m-0">
                    <div class="col-12">
                      <hr style="border-color: #E5E7EA40;">
                    </div>
                  </div>
                  <div class="row m-0 mb-3" v-if="sugestionTags.length">
                    <div class="col-12">
                      <p class="text-muted mb-0">Sugestões para sua questão. Clique para adicionar!</p>
                    </div>
                  </div>
                  <div class="row m-0">
                    <div class="col">
                      <div class="d-flex flex-wrap">
                        <div class="m-1 px-0 d-flex" style="color: #384250; font-size: 14px; font-weight: 400;" v-for="sugestion in sugestionTags" @click="addSugestionTag(sugestion)">
                          <div class="d-flex align-items-center cp px-2" style="background-color: #F9FAFA; border-radius: 8px; height: 34px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16">
                              <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                            </svg>
                            <span class="mx-2">${sugestion.label}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-3 text-right align-self-end">
                      <button class="btn" :class="promptControls.hasError ? 'btn-danger':'lize-btn-primary'" :disabled="!promptControls.text.length || controls.generatingQuestion" @click="generateQuestion()">
                        <template>
                          Gerar questão 
                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-stars mx-1" viewBox="0 0 16 16">
                            <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                          </svg>
                        </template>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div v-if="generatedQuestion && !promptControls.editing">
              <div class="row m-0">
                <div class="col-12 d-flex justify-content-between mb-3">
                  <h4 class="text tx-20">Questão gerada por IA</h4>
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#D0D3D9" class="bi bi-x-lg mt-2 cp" viewBox="0 0 16 16"  data-dismiss="modal">
                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                  </svg>
                </div>
              </div>
              <div class="lize-card" style="max-height: 400px; overflow-y: scroll;">
                <div class="card-body">
                  <div class="row m-0">
                    <div class="col-12 mt-2 text-center" v-if="generatedQuestion.baseImage">
                      <img :src="generatedQuestion.baseImage" class="img-fluid">
                    </div>
                    <div class="col-12 my-4" v-if="generatedQuestion.baseText">
                      <h6 class="text-5" v-html="generatedQuestion.baseText"></h6>
                    </div>
                    <div class="col-12">
                      <h6 class="text-5" v-html="generatedQuestion.enunciation"></h6>
                    </div>
                    <div class="col-12">
                      <hr style="border-color: #E5E7EA40;">
                    </div>
                    <div class="col-12">
                      <div class="row m-0" v-for="alternative in generatedQuestion.alternatives">
                        <div class="col-12 px-0 d-flex align-items-center justify-content-between">
                          <div class="d-flex align-items-center w-100">
                            <span class="rounded-circle cp d-flex align-items-center justify-content-center" :style="{ backgroundColor: alternative.isCorrect ? '#41C588':'', border: !alternative.isCorrect ? '1px solid #D2D6DB':'', width: '20px', height: '20px' }">
                              <template v-if="alternative.isCorrect">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-check2" viewBox="0 0 16 16">
                                  <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                                </svg>
                              </template>
                              <template v-else><span style="width: 20px; height: 20px;">&nbsp;</span></template>
                            </span>
                            <div class="alternativeContent mx-2 w-100">
                              <div class="py-1" :class="alternative.isCorrect ? 'tx-semibold':'tx-normal'" style="line-height: 1.4;">
                                <div v-html="alternative.text"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer px-4 pb-4" :class="{ 'd-flex justify-content-start border-0': controls.showTutorial, 'd-flex justify-content-between': generatedQuestion }" v-if="controls.showTutorial || generatedQuestion && !promptControls.editing">
            <template v-if="controls.showTutorial">
              <div class="d-flex align-items-center">
                <button class="btn lize-btn-primary" @click="controls.showTutorial = false">Quero começar!</button>
                <div class="custom-control custom-checkbox mx-3">
                  <input type="checkbox" class="custom-control-input" id="dontShowTutorial">
                  <label class="custom-control-label text-muted" for="dontShowTutorial">Não exibir tutorial novamente</label>
                </div>
              </div>
            </template>
            <template v-if="generatedQuestion && !controls.saving">
              <button class="btn btn-block lz-btn-outline-warning m-1" @click="editPrompt()" :disabled="controls.addingQuestion">
                Editar prompt 
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                  <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                </svg>
              </button>
              <button class="btn btn-block lz-btn-outline-warning m-1" @click="generateQuestion()" :disabled="controls.addingQuestion">
                Gerar novamente
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z"/>
                  <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z"/>
                </svg>
              </button>
              <button class="btn btn-block lize-btn-primary m-1" @click="addGeneratedQuestion()" :disabled="controls.addingQuestion">
                Adicionar à prova 
                <svg xmlns="http://www.w3.org/2000/svg" style="font-size: 2rem !important;" width="24" height="24" fill="currentColor" class="bi bi-check2" viewBox="0 0 16 16">
                  <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
                </svg>
              </button>
            </template>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <div class="modal fade" @click.self="closeModalAdvancedFilters()" v-show="controls.showAdvancedFilters" id="modalAdvancedFilters" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered 0" role="document" style= "min-width: 500px;">
      <div class="modal-content tx-14"  style="border-radius: 12px; z-index: 2;  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);">        
        <div class="modal-body px-0 py-0">
          <div class="row m-0" style="border-bottom: 1px solid #E5E7EA;">
            <div class="col-12">
              <div class="d-flex justify-content-between py-3">
                  <span style="color: #FF8F3D;" class="mx-2 text  tx-18 ">Filtros avançados</span>
                <div class="d-flex align-center">
                  <div v-if="!controls.addingQuestion">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#D0D3D9" class="bi bi-x-lg ml-3 cp" viewBox="0 0 16 16"  data-dismiss="modal" @click="cancel()">
                      <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row m-0">
            <div class="col-12">
              <div  ref="questionsCategory" class="dropdown">
                <div :class="questionsBankControls.advancedFilters.questionsCategory.focus ? 'custom-select-1':'custom-select-2'" class="my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" @click="openCustomFilterDropdown('questionsCategory')">
                  <div>
                    Tipo de questão: 
                    <div v-if="questionsBankControls.advancedFilters.questionsCategory.items.length">
                      ${questionsCategories.filter(q => questionsBankControls.advancedFilters.questionsCategory.items.includes(q.id)).map(q => q.name).join(', ')}
                    </div>
                    <span v-else>Todos</span>
                  </div>
                </div>
                <div class="dropdown-menu" style="right: 0px !important; left: auto !important; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.questionsCategory.focus }" aria-labelledby="dropdownQuestionsCategoryButton">
                  <span v-for="category in questionsCategories" class="dropdown-item" @click="questionsBankControls.advancedFilters.questionsCategory.items.includes(category.id) ? questionsBankControls.advancedFilters.questionsCategory.items.splice(questionsBankControls.advancedFilters.questionsCategory.items.indexOf(category.id), 1):questionsBankControls.advancedFilters.questionsCategory.items.push(category.id)">
                    <div class="d-flex align-items-center">
                      <div v-if="questionsBankControls.advancedFilters.questionsCategory.items.includes(category.id)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                      <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                      <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${category.name}</label>
                    </div>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div  ref="questionsDifficult" class="dropdown">
                <div :class="questionsBankControls.advancedFilters.questionsDifficult.focus ? 'custom-select-1':'custom-select-2'" class="my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" @click="openCustomFilterDropdown('questionsDifficult')">
                  <div>
                    Dificuldade: 
                    <div v-if="questionsBankControls.advancedFilters.questionsDifficult.items.length">
                      ${difficults.filter(d => questionsBankControls.advancedFilters.questionsDifficult.items.includes(d.id)).map(d => d.name).join(', ')}
                    </div>
                    <span v-else>Todos</span>
                  </div>
                </div>
                <div class="dropdown-menu" style="right: 0px !important; left: auto !important; border-radius: 8px; position: absolute; "  :class="{ 'show': questionsBankControls.advancedFilters.questionsDifficult.focus }" aria-labelledby="dropdownquestionsDifficultButton">
                  <span v-for="difficult in difficults" class="dropdown-item" @click="questionsBankControls.advancedFilters.questionsDifficult.items.includes(difficult.id) ? questionsBankControls.advancedFilters.questionsDifficult.items.splice(questionsBankControls.advancedFilters.questionsDifficult.items.indexOf(difficult.id), 1):questionsBankControls.advancedFilters.questionsDifficult.items.push(difficult.id)">
                    <div class="d-flex align-items-center">
                      <div v-if="questionsBankControls.advancedFilters.questionsDifficult.items.includes(difficult.id)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                      <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                      <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${difficult.name}</label>
                    </div>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div ref="grade"  class="dropdown">
                <div :class="questionsBankControls.advancedFilters.grade.focus ? 'custom-select-1':'custom-select-2'" class="my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" @click="openCustomFilterDropdown('grade')">
                  <div>
                    Série: 
                    <div v-if="questionsBankControls.advancedFilters.grade.items.length">
                      ${grades.filter(g => questionsBankControls.advancedFilters.grade.items.includes(g.id)).map(g => g.name).join(', ')}
                    </div>
                    <span v-else>Todos</span>
                  </div>
                </div>
                <div class="dropdown-menu" style="right: 0px !important; left: auto !important; max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.grade.focus }" aria-labelledby="dropdowngradeButton">
                  <span v-for="grade in grades" class="dropdown-item" @click="questionsBankControls.advancedFilters.grade.items.includes(grade.id) ? questionsBankControls.advancedFilters.grade.items.splice(questionsBankControls.advancedFilters.grade.items.indexOf(grade.id), 1):questionsBankControls.advancedFilters.grade.items.push(grade.id)">
                    <div class="d-flex align-items-center">
                      <div v-if="questionsBankControls.advancedFilters.grade.items.includes(grade.id)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                      <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                      <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${grade.name}</label>
                    </div>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div ref="board" class="dropdown">
                <div :class="questionsBankControls.advancedFilters.board.focus ? 'custom-select-1':'custom-select-2'" class="my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" @click="openCustomFilterDropdown('board')">
                  <div >
                    Bancas: 
                    <div v-if="questionsBankControls.advancedFilters.board.items.length">
                      ${boards.filter(b => questionsBankControls.advancedFilters.board.items.includes(b)).join(', ')}
                    </div>
                    <span v-show="!questionsBankControls.advancedFilters.board.items.length">Todos</span>
                  </div>
                </div>
                <div class="dropdown-menu fixed-dropdown-item" style="right: 0px !important; left: auto !important;  max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.board.focus }" aria-labelledby="dropdownboardButton">
                  <input  ref="boardInput" class="tw-rounded-lg tw-p-1 tw-w-full" v-model="searchTerm" placeholder="Pesquisar bancas" style="position: sticky; top: 0; background-color: #FFF; z-index: 1;"></input>
                  <span   @click="toggleBoardSelection(board)" v-for="board in boards.filter(e => (e.length) && (e.toLowerCase().includes(searchTerm.toLowerCase())))" class="dropdown-item" @click="questionsBankControls.advancedFilters.board.items.includes(board) ? questionsBankControls.advancedFilters.board.items.splice(questionsBankControls.advancedFilters.board.items.indexOf(board), 1):questionsBankControls.advancedFilters.board.items.push(board)">
                    <div class="d-flex align-items-center">
                      <div v-if="questionsBankControls.advancedFilters.board.items.includes(board)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                      <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                      <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${board}</label>
                    </div>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div >
                <div class="custom-select-2 my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" >
                  <div >
                    <div class="tw-flex tw-items-center tw-gap-2">  
                      <span>Ano de elaboracão</span>
                      <div ref="elaborationStartYear" class="dropdown">                      
                        <button 
                          :class="questionsBankControls.advancedFilters.elaborationStartYear.focus ? 'custom-select-1':'custom-select-2'" 
                          class="tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" 
                          @click="openCustomFilterDropdown('elaborationStartYear')"
                        >
                        ${ questionsBankControls.advancedFilters.elaborationStartYear.items.length > 0 
                          ? questionsBankControls.advancedFilters.elaborationStartYear.items[0] 
                          : rangeInitial.startYear}
                        </button>
                        <div class="dropdown-menu" style="right: 0px !important; left: auto !important; max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.elaborationStartYear.focus }" aria-labelledby="dropdownelaborationStartYear">
                          <span v-for="year in years" :key="year" class="dropdown-item" @click="selectYear(year, 'elaborationStartYear')">
                            <div class="d-flex align-items-center">
                              <div v-if="questionsBankControls.advancedFilters.elaborationStartYear.items.includes(year)" 
                                    style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" 
                                    class="d-flex align-center mb-1">
                                <i class="fas fa-check text-white"></i>
                              </div>
                              <div v-else 
                                    style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" 
                                    class="d-flex align-center mb-1"></div>
                              <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${ year }</label>
                            </div>
                          </span>
                        </div> 
                      </div>
                      <span>até</span>
                      <div ref="elaborationEndYear" class="dropdown">
                        <button 
                          :class="questionsBankControls.advancedFilters.elaborationEndYear.focus ? 'custom-select-1':'custom-select-2'" 
                          class="tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" 
                          @click="openCustomFilterDropdown('elaborationEndYear')"
                        >
                        ${ questionsBankControls.advancedFilters.elaborationEndYear.items.length > 0 
                          ? questionsBankControls.advancedFilters.elaborationEndYear.items[0] 
                          : rangeInitial.endYear }
                        </button>
                        <div class="dropdown-menu" style="right: 0px !important; left: auto !important; max-height: 250px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.elaborationEndYear.focus }" aria-labelledby="dropdownelaborationEndYear">
                          <span v-for="year in years" :key="year" class="dropdown-item"@click="selectYear(year, 'elaborationEndYear')">
                            <div class="d-flex align-items-center">
                              <div v-if="questionsBankControls.advancedFilters.elaborationEndYear.items.includes(year)" 
                                  style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" 
                                  class="d-flex align-center mb-1">
                                <i class="fas fa-check text-white"></i>
                              </div>
                              <div v-else 
                                style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" 
                                class="d-flex align-center mb-1"></div>
                              <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${ year }</label>
                            </div>
                          </span>
                        </div> 
                      </div>
                    </div> 
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div ref="knowledgeArea" class="dropdown">
                <div :class="questionsBankControls.advancedFilters.knowledgeArea.focus ? 'custom-select-1':'custom-select-2'" class="my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" @click="openCustomFilterDropdown('knowledgeArea')">
                  <div>
                    Áreas de conhecimento: 
                    <div v-if="questionsBankControls.advancedFilters.knowledgeArea.items.length">
                      ${knowledgeAreas.filter(b => questionsBankControls.advancedFilters.knowledgeArea.items.includes(b)).map(b => b.knowledgeAreaName).join(', ')}
                    </div>
                    <span v-else>Todas</span>
                  </div>
                </div>
                <div class="dropdown-menu" style="right: 0px !important; left: auto !important; max-height: 200px; overflow-y: scroll; border-radius: 8px;" :class="{ 'show': questionsBankControls.advancedFilters.knowledgeArea.focus }" aria-labelledby="dropdownknowledgeAreaButton">
                  <span v-for="knowledgeArea in knowledgeAreas" class="dropdown-item" @click="questionsBankControls.advancedFilters.knowledgeArea.items.includes(knowledgeArea) ? questionsBankControls.advancedFilters.knowledgeArea.items.splice(questionsBankControls.advancedFilters.knowledgeArea.items.indexOf(knowledgeArea), 1):questionsBankControls.advancedFilters.knowledgeArea.items.push(knowledgeArea)">
                    <div class="d-flex align-items-center">
                      <div v-if="questionsBankControls.advancedFilters.knowledgeArea.items.includes(knowledgeArea)" style="width: 16px; height: 16px; border-radius: 4px; background-color: #FF8F3D;" class="d-flex align-center mb-1"><i class="fas fa-check text-white"></i></div>
                      <div v-else style="width: 16px; height: 16px; border: 1px solid #FF8F3D; border-radius: 4px;" class="d-flex align-center mb-1"></div>
                      <label class="m-0 mx-2 lize-text-warning tx-normal d-flex align-items-center">${knowledgeArea.knowledgeAreaName}</label>
                    </div>
                  </span>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div  ref="enunciation" class="dropdown">
                <div :class="questionsBankControls.advancedFilters.enunciation.focus ? 'custom-select-1':'custom-select-2'" class="my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" @click="focusInput('enunciationInput'), openCustomFilterDropdown('enunciation')">
                  <div class="tw-flex tw-flex-col tw-gap-2" style= "width: 100%">
                    Texto no enunciado:
                    <input type="text" ref="enunciationInput" class="tw-rounded-lg tw-p-1 tw-w-full" style="border: 1px solid rgb(229, 231, 234); border-radius: 12px; width: 100%;" v-model="questionsBankControls.advancedFilters.enunciation.search" placeholder="Pesquisar">
                  </div>
                </div>
              </div>
            </div>
            <div ref="alternatives" class="col-12">
              <div class="dropdown">
                <div :class="questionsBankControls.advancedFilters.alternatives.focus ? 'custom-select-1':'custom-select-2'" class="my-1 d-flex align-items-center justify-content-between" style="background-color: #F9FAFA;" @click="focusInput('alternativesInput'), openCustomFilterDropdown('alternatives')">
                  <div class="tw-flex tw-flex-col tw-gap-2"  style= "width: 100%">
                    Texto nas alternativas:
                    <input type="text" ref="alternativesInput" class="tw-rounded-lg tw-p-1 tw-w-full" style="border: 1px solid rgb(229, 231, 234); border-radius: 12px; width: 100%;" v-model="questionsBankControls.advancedFilters.alternatives.search" placeholder="Pesquisar">
                  </div>
                </div>
              </div>
            </div>
        </div>
        <div class="d-flex justify-content-end" style="border-top: 1px solid #E5E7EA;">
            <button class="btn lize-btn-primary d-flex align-center my-2 mx-1 mr-3" style="height: 32px; border-radius: 8px; padding: 8px 14px 8px 14px;" @click="getAndShowQuestionsAdvencedFilter()" :disabled="questionsBankControls.statusQuantityOfQuestions == 'loading' || questionsBankControls.loadQuestions">
              Aplicar Filtros Avançados
            </button>
        </div>
      </div>
    </div>
  </div>
</div>

  <div aria-hidden="true" class="modal fade" id="modalImportQuestionWithFile" data-backdrop="static" data-keyboard="false" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content" style="border-radius: 12px; z-index: 1;">
          <div class="modal-header align-items-center">
              <h5 class="modal-title tx-18">Importação de questões com arquivo</h5>
              <div class="d-flex">
                <select class="form-control" style="max-width: 320px;" v-model="controlsImportQuestion.type">
                  <option value="simple">Importar questões do Word (Simplificado)</option>
                  {% if user.client_has_superpro_integration or user.superprofintegration_set.exists or user.inspector.enable_integration_superpro_via_file %}
                    <option value="super">Importar modelo do Super Professor</option>
                  {% endif %}
                </select>
                <button type="button" class="close tx-20 hovable ml-3" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
              </div>
          </div>
          <div class="modal-body" style="max-height: 800px; height: fit-content; overflow-y: auto; max-height: 480px;">
            <template v-if="controlsImportQuestion.type == 'simple'">
              <h6 class="text-center mg-b-20">
                <a href="javascript:;" v-if="controlsImportQuestion.acceptTerms" @click="controlsImportQuestion.showOrientations = !controlsImportQuestion.showOrientations">Ver orientações novamente <i class="fas" :class="controlsImportQuestion.showOrientations ? 'fa-chevron-up':'fa-chevron-down'"></i></a>
              </h6>
              <div v-show="!controlsImportQuestion.acceptTerms || controlsImportQuestion.showOrientations">
                <div class="row">
                  <div class="col-12">
                    <div class="custom-control custom-checkbox mb-3" v-if="!controlsImportQuestion.acceptTerms">
                      <h6>
                      <input type="checkbox" v-model="controlsImportQuestion.acceptTerms" class="custom-control-input" id="checkAcceptTerms">
                      <label class="custom-control-label cp font-weight-bold" for="checkAcceptTerms">Eu assisti o vídeo, li as orientações e entendi como funciona a importação de questões.</label>
                      </h6>
                    </div>
                    <hr class="style-eight">
                    <h5 class="font-weight-bold">Informações importantes:</h5>
                    <ul class="mx-4">
                        <li>
                          1. Os trechos destacados em <span class="badge badge-warning tx-14">amarelo</span> são os identicadores que a plataforma detecta para ler a questão. Não remova-os.
                        </li>
                        <li>
                          2. Questões diferentes PODEM estar na mesma página, desde que obdeçam a estrutura correta de cada modelo de questão. 
                        </li>
                    </ul>
                    <hr>
                  </div>
                </div>  
                <div class="row">
                  <div class="col-12">
                    <video width="920" height="540" class="img-thumbnail" controls>
                        <source src="{% static 'importacao_questao.mp4' %}" type="video/mp4">
                        Seu browser não suporta o conteúdo do vídeo
                    </video>
                  </div>
                </div>
              </div>
              <p class="text-center" v-if="controlsImportQuestion.acceptTerms">
                <a download href="{% static 'importacao_questoes_lize.docx' %}" class="btn btn-secondary mb-3">
                  <i class="fas fa-download"></i> 
                  Baixe o modelo para importação
                </a>
              </p>              
            </template>
            <template v-else>
              <div class="d-sm-flex align-items-center justify-content-between">
                <div>
                  <p class="mg-b-0 tx-color-03">Adicione o arquivo de um caderno criado anteriormente na plataforma do Super Professor</p>
                </div>
              </div>
            </template>
            <label for="superProViaFileInputFile" class="w-100 my-3" v-if="controlsImportQuestion.type == 'super' || controlsImportQuestion.acceptTerms">
              <div class="dropzone d-flex align-items-center justify-content-center" id="dropzone">
                <div class="text-center d-flex flex-column">
                  <div class="rounded-circle d-flex align-items-center justify-content-center align-self-center mb-2" style="width: 48px; height: 48px; background-color: #F9FAFA;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#6C727F" class="bi bi-cloud-upload" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
                      <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708z"/>
                    </svg>
                  </div>
                  <template v-if="controlsImportQuestion.formIntegrationSuperProViaFile.file">
                    <p class="text-muted">Você selecionou o arquivo:<span class="lize-text-warning"> ${controlsImportQuestion.formIntegrationSuperProViaFile.file.name}</span></p>
                  </template>
                  <template v-else>
                    <p class="mb-1 text-muted"><span class="lize-text-warning">Clique para adicionar</span> ou arraste e solte</p>
                    <p class="mb-0 text-muted">PNG, JPG, JPEG, ou GIF (max. 20MB)</p>
                  </template>
                </div>
              </div>
            </label>
          </div>
          <div class="card-footer">
            <form @submit.prevent="submitFormIntegrationSuperProViaFile" method="post" v-if="controlsImportQuestion.type != 'simple' || (controlsImportQuestion.type == 'simple' && controlsImportQuestion.acceptTerms)">
              <template v-if="controlsImportQuestion.formIntegrationSuperProViaFile.status !== 'submitting'">
                <div class="form-group d-none">
                  <input type="file" id="superProViaFileInputFile" @change="onChangeFormIntegrationSuperProViaFileFile" required />
                </div>
                <button type="submit" class="btn lize-btn-primary btn-block" :disabled="controlsImportQuestion.formIntegrationSuperProViaFile.status === 'submitting'">
                  ${ controlsImportQuestion.formIntegrationSuperProViaFile.status === 'submitting' ? 'Enviando...' : 'Enviar arquivo' }
                </button>
              </template>
              <template v-else-if="controlsImportQuestion.formIntegrationSuperProViaFile.status === 'submitting'">
                <div class="mg-t-40">
                  <div class="alert alert-outline alert-warning d-flex align-items-center" role="alert">
                    <i class="fas fa-exclamation-triangle mg-r-10"></i> Esse processo pode demorar um pouco, aguarde enquanto convertemos o caderno do ${ controlsImportQuestion.type == 'simple' ? 'word':'Super Professor' } para o nosso sistema.
                  </div>
                  <div class="text-center">
                    <p class="tx-13 tx-lg-12 tx-xl-13 tx-color-03 mg-b-2">
                      Importando o caderno:
                    </p>
                  </div>
                  <div class="text-center">
                    <div class="spinner-border text-primary" role="status">
                      <span class="sr-only">Carregando...</span>
                    </div>
                  </div>
                </div>
              </template>
              <template v-if="controlsImportQuestion.formIntegrationSuperProViaFile.status === 'error-uploading'">
                <p class="tx-danger tx-12 mt-2">Ocorreu um erro ao tentar enviar o arquivo para nossos servidores. Por favor, tente novamente em alguns instantes.</p>
              </template>
              <template v-if="controlsImportQuestion.formIntegrationSuperProViaFile.status === 'error-converting'">
                <p class="tx-danger tx-12 mt-2">Ocorreu um erro ao tentar converter o arquivo. Por favor, tente novamente em alguns instantes.</p>
              </template>
              <template v-if="controlsImportQuestion.formIntegrationSuperProViaFile.status === 'error-importing'">
                <p class="tx-danger tx-12 mt-2">Ocorreu um erro ao tentar importar o arquivo. Por favor, tente novamente em alguns instantes.</p>
              </template>
            </form>
          </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalBNCCPreview" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;" v-if="selectedExamQuestion && selectedExamQuestion.question.improve && selectedSuggestion.bnccs.length">
        <div class="modal-header">
          <h5 class="modal-title">Sugestões</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="alert alert-warning">
            <div class="tw-rounded-lg d-flex" style="background-color: rgb(254, 240, 199);">
              <p class="mb-0 p-2 d-flex tw-text-sm tw-leading-6 tw-font-semibold align-items-center" style="color: rgb(214, 123, 5);">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#ffc107" stroke="#ffc107" viewBox="0 0 16 16" class="bi bi-exclamation-triangle">
                  <path stroke-width="0.8" d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"></path> 
                  <path stroke-width="0.8" d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"></path>
                </svg> 
                <span class="mx-2 align-self-end">Esta é uma sugestão criada por uma inteligência artificial ainda na fase de melhorias, analise o conteúdo gerado e corrija-o se necessário.</span>
              </p>
            </div>
          </div>
          <div class="d-flex p-2 align-items-center my-2 px-4" :class="selectedExamQuestion.question.improve['applied' + selectedSuggestion.type[0].toUpperCase() + selectedSuggestion.type.slice(1, selectedSuggestion.type.length)] && selectedExamQuestion.question.improve['applied' + selectedSuggestion.type[0].toUpperCase() + selectedSuggestion.type.slice(1, selectedSuggestion.type.length)].includes(bncc.id) ? 'row-bncc-selected':'row-bncc'" v-for="(bncc, index) in selectedSuggestion.bnccs">
            <div class="align-self-start">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
              </svg>
            </div>
            <div class="mx-3 w-100" style="color: #6C727F;">
              <span v-if="bncc.code" class="tx-bold">${bncc.code} - </span>${bncc.text || bncc.name}
            </div>
            <div>
              <div class="custom-check" class="d-flex align-items-center justify-content-center" @click="applySuggestionBNCC(selectedSuggestion.type, bncc.id)">
                <span v-if="selectedExamQuestion.question.improve['applied' + selectedSuggestion.type[0].toUpperCase() + selectedSuggestion.type.slice(1, selectedSuggestion.type.length)] && selectedExamQuestion.question.improve['applied' + selectedSuggestion.type[0].toUpperCase() + selectedSuggestion.type.slice(1, selectedSuggestion.type.length)].includes(bncc.id)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                    <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                  </svg>
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="d-flex justify-content-between align-items-center w-100">
            <div>
              <i class="fas fa-thumbs-up tx-20 mx-2 cp" style="color: #333333A1;" @click="likedSuggestion(true, selectedSuggestion.type)" :class="{ 'text-success': selectedSuggestion.type == 'topics' ? selectedExamQuestion.question.improve.likedTopicsDisplay == 'Gostou' : selectedSuggestion.type == 'abilities' ? selectedExamQuestion.question.improve.likedAbilitiesDisplay == 'Gostou' : selectedExamQuestion.question.improve.likedCompetencesDisplay == 'Gostou' }" title="Gostei da sugestão"></i>
              <i class="fas fa-thumbs-down tx-20 mx-2 cp" style="color: #333333A1;" @click="likedSuggestion(false, selectedSuggestion.type)" :class="{ 'text-danger': selectedSuggestion.type == 'topics' ? selectedExamQuestion.question.improve.likedTopicsDisplay == 'Não gostou' : selectedSuggestion.type == 'abilities' ? selectedExamQuestion.question.improve.likedAbilitiesDisplay == 'Não gostou' : selectedExamQuestion.question.improve.likedCompetencesDisplay == 'Não gostou' }" title="Não gostei da sugestão"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalPreviewText" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;" v-if="selectedExamQuestion && selectedExamQuestion.question.improve && selectedSuggestion.text">
        <div class="modal-header">
          <h5 class="modal-title">Sugestões</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="alert alert-warning">
            <div class="tw-rounded-lg d-flex" style="background-color: rgb(254, 240, 199);">
              <p class="mb-0 p-2 d-flex tw-text-sm tw-leading-6 tw-font-semibold align-items-center" style="color: rgb(214, 123, 5);">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="#ffc107" stroke="#ffc107" viewBox="0 0 16 16" class="bi bi-exclamation-triangle"><path stroke-width="0.8" d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"></path> <path stroke-width="0.8" d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"></path></svg> <span class="mx-2 align-self-end">Esta é uma sugestão criada por uma inteligência artificial ainda na fase de melhorias, analise o conteúdo gerado e corrija-o se necessário.</span>
              </p>
            </div>
          </div>
          
          <div class="d-flex tw-flex-col p-2 align-items-center my-2 px-4">
            <div class="row mb-0">
              <div class="tw-flex tw-border-b tw-border-gray-400">
                <button class="d-flex align-items-center p-2 cp" :class="selectedExamQuestion.currentAiMenu == 'before' ? 'lize-text-primary':''" @click="selectedExamQuestion.currentAiMenu = 'before'" :style="selectedExamQuestion.currentAiMenu == 'before' ? 'border-bottom: 2px solid #0C7BDB;' : ''">
                  <span class="mx-2">
                    Atual
                  </span>
                </button>
                <button type="button" class="d-flex align-items-center p-2 cp" :class="selectedExamQuestion.currentAiMenu == 'after' ? 'lize-text-primary':''" @click="selectedExamQuestion.currentAiMenu = 'after'" :style="selectedExamQuestion.currentAiMenu == 'after' ? 'border-bottom: 2px solid #0C7BDB;' : ''">
                  <span class="mx-2">
                    Sugerido por IA
                  </span>
                </button>
              </div>
            </div>
            <div class="mx-3 w-100 tw-pt-3" style="color: #6C727F;">
              <!-- atual -->
              <template v-if="selectedSuggestion.type == 'enunciation' && selectedExamQuestion.currentAiMenu == 'before'">
                <h5>Enunciado atual</h5>
                <div v-html="selectedExamQuestion.question.enunciation"></div>
                <div class="row" v-for="(alternative, alternativeIndex) in selectedExamQuestion.question.alternatives">
                  <div class="col-12">
                    <div class="d-flex p-2 align-items-center" :style="{ backgroundColor: alternative.isCorrect ? '#41C58814':'' }">
                        <div>
                            <span class="rounded-circle d-flex align-items-center justify-content-center" :style="{ color: alternative.isCorrect ? '#41C588':'#E6E8EC' }">
                                <template v-if="alternative.isCorrect">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                        <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
                                    </svg>
                                </template>
                                <template v-else>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                    </svg>
                                </template>
                            </span>
                        </div>
                        <div class="mx-3">
                            <span class="mr-2 text-uppercase">${generateAlternativeLetter(alternativeIndex)}</span> 
                        </div>
                        <div>
                            <span v-html="alternative.text"></span>
                        </div>
                    </div>
                  </div>
                </div>
                <hr>
              </template>
              <template v-if="selectedSuggestion.type == 'commentedAnswer' && selectedExamQuestion.currentAiMenu == 'before'">
                <h5>Resposta comentada atual</h5>
                <div v-html="selectedExamQuestion.question.commentedAnswer"></div>
              </template>
              <!-- gerado por IA -->
              <template v-if="selectedSuggestion.type == 'enunciation' && selectedExamQuestion.currentAiMenu == 'after'">
                <h5>Enunciado sugerido por IA</h5>
                <div v-html="selectedSuggestion.text"></div>
                <div class="row" v-for="(alternative, alternativeIndex) in selectedSuggestion.alternatives">
                  <div class="col-12">
                    <div class="d-flex p-2 align-items-center" :style="{ backgroundColor: alternative.isCorrect ? '#41C58814':'' }">
                        <div>
                            <span class="rounded-circle d-flex align-items-center justify-content-center" :style="{ color: alternative.isCorrect ? '#41C588':'#E6E8EC' }">
                                <template v-if="alternative.isCorrect">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                        <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
                                    </svg>
                                </template>
                                <template v-else>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                    </svg>
                                </template>
                            </span>
                        </div>
                        <div class="mx-3">
                            <span class="mr-2 text-uppercase">${generateAlternativeLetter(alternativeIndex)}</span> 
                        </div>
                        <div>
                            <span v-html="alternative.text"></span>
                        </div>
                    </div>
                  </div>
                </div>
              </template>
              <template v-if="selectedSuggestion.type == 'commentedAnswer' && selectedExamQuestion.currentAiMenu == 'after'">
                <h5>Resposta comentada sugerida por IA</h5>
                <div v-html="selectedSuggestion.text"></div>
              </template>
              <div v-if="selectedSuggestion.type == 'enunciation' && selectedExamQuestion.currentAiMenu == 'after'">
                <button class="btn lize-btn-primary" @click="() => improvementDiff.show = !improvementDiff.show">Mostrar diferenças</button>
                <div v-show="improvementDiff.show" v-html="improvementDiff.content"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <div class="d-flex justify-content-between align-items-center w-100">
            <div>
              <i class="fas fa-thumbs-up tx-20 mx-2 cp" style="color: #333333A1;" @click="likedSuggestion(true, selectedSuggestion.type)" :class="{ 'text-success': selectedSuggestion.type == 'enunciation' ? selectedExamQuestion.question.improve.likedEnunciationDisplay == 'Gostou' : selectedExamQuestion.question.improve.likedCommentedAnswerDisplay == 'Gostou' }" title="Gostei da sugestão"></i>
              <i class="fas fa-thumbs-down tx-20 mx-2 cp" style="color: #333333A1;" @click="likedSuggestion(false, selectedSuggestion.type)" :class="{ 'text-danger': selectedSuggestion.type == 'enunciation' ? selectedExamQuestion.question.improve.likedEnunciationDisplay == 'Não gostou' : selectedExamQuestion.question.improve.likedCommentedAnswerDisplay == 'Não gostou' }" title="Não gostei da sugestão"></i>
            </div>
            <div>
              <button type="button" class="btn lize-btn-primary" data-dismiss="modal" @click="applySuggestion(selectedExamQuestion, selectedSuggestion.type)">Aplicar sugestões</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modalCurrentUses" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content" style="border-radius: 8px;">
        <div class="modal-header">
          <h5 class="modal-title">Utilizações</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" v-if="selectedExamQuestion">
          <div class="row m-0">
            <div class="col-12 m-2 p-2" style="background-color: rgb(249, 250, 250); border-radius: 4px;" v-for="use in currentUses">
              <h6>${use.examName}</h6>
              <p class="text-muted mb-0">${use.applicationDate ? use.applicationDate:'Caderno não aplicado.'}</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

{% endblock content-fixed %}

{% block extra-modal %}

<div class="modal fade" id="modalCreateTopic" role="dialog" tabindex="-1">
  <div class=" modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content" style="border-radius: 8px;">
      <div class="modal-header">
        <h5 class='col-12 modal-title text-center'>Cadastrar Assunto</h5>
      </div>
      <div class="modal-body">
      <form id="topicCreateTopic">
        {% csrf_token %}
          <div class="col-12 border-bottom pb-3">
            <div class="d-flex justify-content-between mb-2">
                <div>
                    <h6 class="mb-0 text-muted">Disciplina:</h6>
                    <span class="font-weight-normal subject-value"></span>
                </div>
                <div>
                    <h6 class="mb-0 text-muted">Ano/Série:</h6>
                    <span class="font-weight-normal grade-value" ></span>
                </div>
            </div>
            <div>
                <h6 class="text-muted mb-0">Área de conhecimento:</h6>
                <span class="font-weight-normal area-value" id="valueArea"></span>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="form-group mb-2">
              <label for="topic" class="mb-0 mt-1">Nome do Assunto</label>
              <input type="text" v-model="topicName" id="topic" class="form-control"  style="border: 1px solid #D2D6DB; border-radius: 8px;"  placeholder="Digite aqui">
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="etapa" class="mb-0 mt-1">Etapa</label>
              <select v-model="stage" id="etapa" class="form-control form-control-sm" style="border: 1px solid #D2D6DB; border-radius: 8px;" >
                <option value="" selected>Selecione uma Etapa</option>
                <option value="1">1ª Etapa</option>
                <option value="2">2ª Etapa</option>
                <option value="3">3ª Etapa</option>
                <option value="4">4ª Etapa</option>
                <option value="5">5ª Etapa</option>
                <option value="6">6ª Etapa</option>
                <option value="7">Geral</option>
              </select>
            </div>
          </div>
          <div class="col-12 ">
            <div class="form-group mb-2">
              <label for="selectedTheme" class="mb-0 mt-1">Tema<small class="text-muted mt-0"> (Opcional)</small></label>
              <div v-show="isAddingNewTheme">
                <div class="d-flex align-items-center">
                  <input type="text" class="form-control" style="border: 1px solid #D2D6DB; border-radius: 8px;" v-model="newThemeName" placeholder="Digite o novo tema">
                  <button style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lize-btn-primary ml-2" @click.prevent="saveNewTheme('{{ csrf_token }}')">
                    Salvar
                  </button>
                  <button style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning ml-2" @click.prevent="toggleThemeInput">
                    Cancelar
                  </button>
                </div>
              </div>
              <div v-show="!isAddingNewTheme">
                <div class="d-flex align-items-center">
                  <select class="form-control flex-grow-1" name="theme" id="theme" v-model="selectedTheme" style="border: 1px solid #D2D6DB; border-radius: 8px;">
                    <option value="" selected>Selecione um Tema</option>
                    <!-- <option v-for="theme in themes" :key="theme.id" :value="theme.id">${theme.name}</option> -->
                  </select>
                  <button style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" id="bt_create_theme" title="Cadastrar Tema" @click.prevent="toggleThemeInput">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div> 
          <div class="col-12">
            <div class="form-group mb-2" id="filderMainTopic" data-toggle="tooltip"  :title="titleMainTopic">
              <label for="selectedMainTopic" class="mb-0 mt-1">Tópico<small class="text-muted mt-0"> (Opcional)</small></label>
              <div v-show="isAddingNewMainTopic">
                <div class="d-flex align-items-center">
                  <input type="text" class="form-control"  style="border: 1px solid #D2D6DB; border-radius: 8px;"  v-model="newMainTopicName" placeholder="Digite o novo tópico">
                  <button style="height: 32px; border-radius: 8px;"  class="btn d-flex align-items-center lize-btn-primary ml-2" @click.prevent="saveNewMainTopic('{{ csrf_token }}')">
                    Salvar
                  </button>
                  <button style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning ml-2"  @click.prevent="toggleMainTopicInput">
                    Cancelar
                  </button>
                </div>
              </div>
              <div v-show="!isAddingNewMainTopic">
                <div class="d-flex align-items-center">
                  <select :disabled="!selectedTheme" class="form-control" style="border: 1px solid #D2D6DB; border-radius: 8px;" name="main_topic" id="main_topic" v-model="selectedMainTopic">
                    <option  value="" selected>Selecione um Tópico</option>
                    <!-- <option v-for="mainTopic in mainTopics" :key="mainTopic.id" :value="mainTopic.id" v-html="mainTopic.name"></option> -->
                  </select>
                  <button  style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" data-toggle="tooltip" id="bt_create_main_topic"  :title="tooltipTitleMainTopic" :disabled="!enableMainTopicRegistration"  @click.prevent="toggleMainTopicInput">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div> 

      </form>
 
      </div>
      <div class="modal-footer bg-light text-right">
        <button type="button" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" data-dismiss="modal"   @click="closeModal('#modalCreateTopic', '#modalTopics')">Fechar</button>
        <button type="submit" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lize-btn-primary" @click="submitTopicForm('{{ csrf_token }}')">Salvar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalCreateAbility" role="dialog" tabindex="-1">
  <div class=" modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content " style="border-radius: 8px;" >
      <div class="modal-header">
        <h5 class='col-12 modal-title text-center'>Cadastrar Habilidade</h5>
      </div>
      <div class="modal-body-create-topic mt-3 mb-3">
        <form >
          {% csrf_token %}
          <div class="col-12 border-bottom pb-3">
            <div class="d-flex justify-content-between mb-2">
                <div>
                    <h6 class="mb-0 text-muted">Disciplina:</h6>
                    <span class="font-weight-normal subject-value"></span>
                </div>
                <div>
                    <h6 class="mb-0 text-muted">Ano/Série:</h6>
                    <span class="font-weight-normal grade-value" ></span>
                </div>
            </div>
            <div>
                <h6 class="text-muted mb-0">Área de conhecimento:</h6>
                <span class="font-weight-normal area-value" id="valueArea"></span>
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mt-2">
              <label for="code" class="mb-0 mt-1">Código da Habilidade</label>
              <input type="text"  style="border: 1px solid #D2D6DB; border-radius: 8px;"  v-model="selectedAbilityCode" id="code" class="form-control" placeholder="Digite aqui">
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="text" class="mb-0 mt-1">Habilidade</label>
              <textarea name="text"  style="border: 1px solid #D2D6DB; border-radius: 8px;"  v-model="selectedAbility"  cols="40" rows="2" maxlength="4096"  id="text" class="form-control"></textarea>            
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light text-right">
        <button type="button" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" data-dismiss="modal" @click="closeModal('#modalCreateAbility', '#modalAbilities')">Fechar</button>
        <button type="submit" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lize-btn-primary" @click="submitFormCreateAbility('{{ csrf_token }}')">Salvar</button>
      </div>
    </div>
  </div>
 </div>

<div class="modal fade" id="modalCreateCompetence" role="dialog" tabindex="-1">
  <div class=" modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content" style="border: 1px solid #D2D6DB; border-radius: 8px;" >
      <div class="modal-header">
        <h5 class='col-12 modal-title text-center'>Cadastrar Competência</h5>
      </div>
      <div class="modal-body-create-topic mt-3 mb-3">
        <form >
          {% csrf_token %}
          <div class="col-12 border-bottom pb-3">
            <div class="d-flex justify-content-between mb-2">
                <div>
                    <h6 class="mb-0 text-muted">Disciplina:</h6>
                    <span class="font-weight-normal subject-value"></span>
                </div>
                <div>
                    <h6 class="mb-0 text-muted">Ano/Série:</h6>
                    <span class="font-weight-normal grade-value" ></span>
                </div>
            </div>
            <div >
                <h6 class="text-muted mb-0">Área de conhecimento:</h6>
                <span class="font-weight-normal area-value"></span>
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mt-2">
              <label for="code" class="mb-0 mt-1">Código da competência</label>
              <input type="text" style="border: 1px solid #D2D6DB; border-radius: 8px;" v-model="selectedCompetenceCode" id="code" class="form-control" placeholder="Digite aqui">
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="text" class="mb-0 mt-1">Competência</label>
              <textarea name="text" style="border: 1px solid #D2D6DB; border-radius: 8px;"  v-model="selectedCompetence"  cols="40" rows="2" maxlength="4096"  id="text" class="form-control"></textarea>            
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light text-right">
        <button type="button" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lz-btn-outline-warning mx-2" data-dismiss="modal"   @click="closeModal('#modalCreateCompetence', '#modalCompetences')">Fechar</button>
        <button type="submit" style="height: 32px; border-radius: 8px;" class="btn d-flex align-items-center lize-btn-primary" @click="submitFormCreateCompetence('{{ csrf_token }}')">Salvar</button>
      </div>
    </div>
  </div>

</div> 

{% endblock extra-modal %}

{% block js-additional %}
<script src="//en.wikipedia.org/w/index.php?title=User:Cacycle/diff.js&action=raw&ctype=text/javascript"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

<script src="{% static 'js/tippy/popper.min.js' %}"></script>
<script src="{% static 'js/tippy/tippy.min.js' %}"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment-with-locales.min.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.3.0/tinymce.min.js"></script>
<script type="text/javascript" src="{% static 'django_custom_tinymce/init_tinymce.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/scripts/choices.min.js"></script>

<script type="text/javascript">
    moment.locale('pt-br');

    var app = new Vue({
        delimiters: ['${', '}'],
        components: {
          {% include 'includes/components/vue-notifications.html' %},
          'search-component': Vue.component('search-component', {
            props: ['where'],
            delimiters: ["#{", "}"],
            data: function() {
                return {
                  term: ''
                }
            },
            template: `
              <div class="d-flex align-items-center" style="border: 1px solid #E5E7EA; border-radius: 12px; height: 60px;">
                <div class="d-flex align-items-center w-100">
                  <div>
                    <svg xmlns="http://www.w3.org/2000/svg" style="color: #D2D6DB;" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search ml-3"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                  </div>
                  <div class="w-100">
                    <input type="text" @input="search()" v-model="term" class="form-control border-0 tx-14 remove-focus" placeholder="O que você esta procurando?">
                  </div>
                  <span class="tx-14 mx-3 cp" style="color: #6C727F;" @click="term = '', search()" v-if="term.length">Limpar</span>
                </div>
              </div>
            `,
            methods: {
              search() {
                if(this.where == 'topics') {
                  if(this.term.length) {
                    app.foundedTopics = Object.assign([], app.topics.filter(a => a.name.toLowerCase().includes(this.term.toLowerCase())))
                  } else {
                    app.foundedTopics = Object.assign([], app.topics)
                  }
                }
                if(this.where == 'abilities') {
                  if(this.term.length) {
                    app.foundedAbilities = Object.assign([], app.abilities.filter(a => a.code ? a.code.toLowerCase().includes(this.term.toLowerCase()) || a.text.toLowerCase().includes(this.term.toLowerCase()) : undefined ))
                  } else {
                    app.foundedAbilities = Object.assign([], app.abilities)
                  }
                }
                if(this.where == 'competences') {
                  if(this.term.length) {
                    app.foundedCompetences = Object.assign([], app.competences.filter(a => a.text ? a.text.toLowerCase().includes(this.term.toLowerCase()) || a.code?.toLowerCase().includes(this.term.toLowerCase()) : undefined ))
                  } else {
                    app.foundedCompetences = Object.assign([], app.competences)
                  }
                }
                if(this.where == 'baseTexts') {
                  if(this.term.length) {
                    app.foundedBaseTexts = Object.assign([], app.baseTexts.filter(a => a.text.toLowerCase().includes(this.term.toLowerCase()) || a.title.toLowerCase().includes(this.term.toLowerCase())))
                  } else {
                    app.foundedBaseTexts = Object.assign([], app.baseTexts)
                  }
                }
                app.handleBNCCs()
              },
            },
          }),
          'prompt-component': Vue.component('prompt-component', {
            props: ['type', 'search', 'label'],
            delimiters: ["#{", "}"],
            data: function() {
                return {
                  show: false,
                  value: '',
                  term: '',
                  items: [],
                  shownItems: [],
                  selectedItemsIds: [],
                  selectedItems: [],
                  showSearch: false,
                  icon: {
                    questionCategory: `<i class="fas fa-layer-group" style="color: #0C7BDB;"></i>`,
                    subject: `<i class="fas fa-book-open" style="color: #0C7BDB;"></i>`,
                    level: `<i class="fas fa-signal" style="color: #0C7BDB;"></i>`,
                    segment: `<i class="fas fa-users" style="color: #0C7BDB;"></i>`,
                    language: `<i class="fas fa-pen-nib" style="color: #0C7BDB;"></i>`,
                    competences: `<i class="fas fa-magic" style="color: #0C7BDB;"></i>`,
                    abilities: `<i class="fas fa-magic" style="color: #0C7BDB;"></i>`,
                  },
                  items: {
                    level: ["Fácil", "Médio", "Difícil"],
                    segment: ["Anos iniciais", "Anos finais", "Ensino médio"],
                    questionCategory: ["Objetiva", "Discursiva"],
                    subject: ["{{object.teacher_subject.subject.name}}"],
                    language: ["Formal", "Informal", "Literária", "Técnica/Científica", "Jornalística", "Poética", "Jurídica", "Publicitária", "Coloquial", "Acadêmica"],
                    abilities: [],
                    competences: [],
                  }
                }
            },
            template: `
              <span class="cp" contenteditable="false">
                <template v-if="search">
                  <span data-toggle="dropdown" @click="showSearch = !showSearch" style="background-color: #0C7BDB1A; border-radius: 4px; padding: 4px 8px; height: 28px;">
                    <span class="mx-2 tx-14 fw-500">
                      <span v-html="icon[type]"></span> #{selectedItems.length} #{label} selecionada(s)
                    </span>
                  </span>
                  <template v-if="showSearch">
                    <div class="dropdown shadow bg-white" :class="{ 'show': showSearch }" @click="showSearch = true" style="position:absolute; border-radius: 8px; color: #667085; box-shadow: 0px 2px 4px -2px #1018280F; box-shadow: 0px 4px 8px -2px #1018281A;">
                      <div class="d-flex align-items-center" style="border: 1px solid #E5E7EA; border-radius: 12px;">
                        <div class="d-flex align-items-center w-100">
                          <div>
                            <svg xmlns="http://www.w3.org/2000/svg" style="color: #D2D6DB;" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search ml-3"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                          </div>
                          <div class="w-100">
                            <input type="text" @keyup.enter="searchItems()" v-model="term" class="form-control border-0 tx-14 remove-focus" placeholder="Digite aqui">
                          </div>
                          <span class="tx-14 mx-3 cp" style="color: #6C727F;" @click="term = '', searchItems()" v-if="term.length">Limpar</span>
                        </div>
                      </div>
                      <div style="max-height: 300px; overflow-y: scroll; position: relative; z-index: 2 !important;">
                        <div class="d-flex p-2 align-items-center my-2 px-4" @click="selectSearchItem(item)" :class="selectedItemsIds.includes(item.id) ? 'row-bncc-selected':'row-bncc'" v-for="item in shownItems">
                          <div class="align-self-start">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                              <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
                              <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                            </svg>
                          </div>
                          <div class="mx-3 w-100" style="color: #6C727F;">
                            <h6 style="max-width: 20rem;" class="text-truncate">
                              <span v-if="item.code" class="tx-bold">#{item.code} - </span> #{item.text}
                            </h6>
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>
                </template>
                <template v-else>
                  <template v-if="items[type].length > 1">
                    <span data-toggle="dropdown" @click="show = !show" style="background-color: #0C7BDB1A; border-radius: 4px; padding: 4px 8px; height: 28px;">
                      <span class="mx-2 tx-14 fw-500"><span v-html="icon[type]"></span> #{value} </span>
                    </span>
                    <div class="dropdown-menu shadow" style="border-radius: 8px; color: #667085; box-shadow: 0px 2px 4px -2px #1018280F; box-shadow: 0px 4px 8px -2px #1018281A;">
                      <template v-if="show">
                        <span class="dropdown-item" v-for="item in items[type]" @click="selectItem(item)">#{item}</span>
                      </template>
                    </div>
                  </template>
                  <template v-else>
                    <span class="" style="background-color: #0C7BDB1A; border-radius: 4px; padding: 4px 8px; height: 28px;">
                      <span class="mx-2 tx-14 fw-500"><span v-html="icon[type]"></span> #{value}</span>
                    </span>
                  </template>
                </template>
              </span>
            `,
            methods: {
              getValue() {
                this.value = this.items[this.type][0]
              },
              selectItem(item) {
                app.acumulatedPromptItems[this.type] = item
                this.value = item
                this.show = false
                setTimeout(() => {
                  app.updatePromptText()
                }, 300)
              },
              selectSearchItem(item) {
                if(this.selectedItems.find((i) => i.id == item.id)) {
                  this.selectedItemsIds.splice(this.selectedItems.indexOf(item.id), 1)
                  this.selectedItems.splice(this.selectedItems.indexOf(this.selectedItems.find((i) => i.id == item.id)), 1)
                } else {
                  this.selectedItemsIds.push(item.id)
                  this.selectedItems.push(item)
                }
                setTimeout(() => {
                  app.promptControls.items = Object.assign([], this.selectedItems)
                  app.acumulatedPromptItems[this.type] = this.selectedItems
                  this.handleBNCCs()
                }, 300)
              },
              searchItems() {
                if(this.term.length) {
                  if(this.type == 'abilities') {
                    let url = `{% url 'bncc:ability_list_api' %}?subject_in_or_none={{object.teacher_subject.subject.id}}&grades={{object.grade.id}}&knowledge_area=${app.examTeacherSubjectKnowledgeArea}&search=${this.term}`
                    if(app.parentSubjects.length) {
                      app.parentSubjects.forEach((subject) => {
                        url += `&subject_in_or_none=${subject}`
                      })
                    }
                    axios.get(url).then((response) => {
                      this.items = response.data
                      this.shownItems = Object.assign([], this.items)
                    })
                  }else if(this.type == 'competences') {
                    let url = `{% url 'bncc:competence_list_api' %}?subject_in_or_none={{object.teacher_subject.subject.id}}&grades={{object.grade.id}}&knowledge_area=${app.examTeacherSubjectKnowledgeArea}&search=${this.term}`
                    if(app.parentSubjects.length) {
                      app.parentSubjects.forEach((subject) => {
                        url += `&subject_in_or_none=${subject}`
                      })
                    }
                    axios.get(url).then((response) => {
                      this.items = response.data
                      this.shownItems = Object.assign([], this.items)
                    })
                  }
                } else {
                  this.shownItems = Object.assign([], this.items)
                }
              },
              handleBNCCs() {
                this.shownItems = this.shownItems.sort((a) => false - this.selectedItemsIds.includes(a.id))
              },
            },
            mounted() {
              this.getValue()
            }
          }),
          'credits-component': Vue.component('credits-component', {
            props: ['availables'],
            delimiters: ["#{", "}"],
            data: function() {
                return {

                }
            },
            template: `
              <button type="button" @click="$parent.openWaitingListModal()" class="d-flex align-items-center badge badge-primary rounded pill" style="background-color: #f3b36416;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#FF8F3D" class="bi bi-stars" viewBox="0 0 16 16">
                  <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                </svg>
                <template v-if="availables">
                  <span class="tx-16" style="color: #FF8F3D !important;">
                    <template v-if="availables > 1">
                      Restam <strong>#{availables}</strong> créditos
                    </template>
                    <template v-else>
                      Resta apenas <strong>#{availables}</strong> crédito
                    </template>
                  </span>
                </template>
                <template v-else>
                  <span style="color: #FF8F3D !important;">
                    Sem créditos
                  </span>
                </template>
              </button>
            `,
          }),
        },
        el: '#app',
        data: {
          canNotAddMultipleCorrectQuestion: {{ can_not_add_multiple_correct_options|default:False|lower }},
          selectedSegment: '{{object.grade.level|default:0}}',
          baseText: {
            title: '',
            text: '',
            short_text: '',
            can_delete: true,
            creating: false,
            updating: false,
            urls: {}
          },
          newStatusQuestion:{
              status: 9,
              note: "",
              give_score: false,
              question_fragment:"",
              source_status_question:""
          },
          searchTerm:'',
          clickBoard: false,
          examTeacherSubject: null,
          parentSubjects: [
            {% for subject in parent_subjects %}
              "{{subject}}",
            {% endfor %}
          ],
          examTeacherSubjectParent: "{{ object.teacher_subject.subject.parent_subject.id }}",
          examTeacherSubjectKnowledgeArea: "{{ object.teacher_subject.subject.knowledge_area.id }}",
          selectedExamQuestion: null,
          topics: [],
          themes: [],
          mainTopics:[],
          selectedTheme: "",
          selectedMainTopic: "",
          isAddingNewMainTopic: false,
          isAddingNewTopic: false,
          isMainTopicRequired: false,
          newMainTopicName: '',
          isAddingNewTheme: false,
          newThemeName: '',
          topicName: "",
          stage: 7,
          floatMenu: {
            left: 0,
            bottom: 0,
          },
          controls: {
            swaping: false,
            dragging: false,
            examViewer: false,
            showOptions: false,
            showMoveOptions: false,
            saving: false,
            loadingQuestionCreate: false,
            generatingQuestion: false,
            createQuestion: false,
            show: false,
            loading: true,
            addingQuestion: false,
            scrollBar: {
              hasUp: false,
              hasDown: true,
              maxHeight: '260px',
            },
            showTutorial: true,
            showQuestionsBankTutorial: {{object.teacher_subject.teacher.show_questions_bank_tutorial|lower}},
            showSelectedTopics: false,
            loadingDistributeWeights: false,
            questionsBankViewer: 'categories',
            onlyMyQuestions: false,
            showAdvancedFilters: false,
            sendingCoordinationNote: false, 
            errors: {},
            awaitIAMessageInterval: null,
            currentMessage: '',
            improving: {
              enunciation: false,
              commentedAnswer: false,
              topics: false,
              abilities: false,
              competences: false,
              getImproving() {
                return this.enunciation || this.commentedAnswer || this.topics || this.abilities || this.competences 
              }
            },
            downloading: false,
            removingAlternative: false,
            removingQuestion: false,
            boardsStatus: 'idle',
            knowledgeAreasStatus: 'idle',
            moreSubjectsBank: false,
            width: 0,
            height: 0,
            showRightBar: false,
          },
          promptControls: {
            text: '',
            items: [],
            image: null,
            editing: false,
            showOptions: false,
            errors: {},
            hasError: false,
            selection: {
              text: '',
              start: 0,
              end: 0,
              range: null,
              sel: null,
            }
          },
          dontShowTutorial: null,
          promptControlsDefaults: null,
          questionsBankControls: {
            params: '',
            filters: [],
            status: 'idle',
            subjects: [],
            questions: {},
            themes: [],
            mainTopics: [],
            topics: [],
            selectedItems: [],
            selectedQuestion: null,
            statusQuantityOfQuestions: 'idle',
            quantityOfQuestions: 0,
            onlySelectedItems: [],
            loadingQuestions: [],
            loadQuestions: false,
            infinityScrollConfig: {
              type: 'infinity',
              availablesTypes: ['clickToLoad', 'infinity']
            },
            waitForQuestions: false,
            advancedFilters: {
              questionsCategory: {
                focus: false,
                items: [],
              },
              questionsDifficult: {
                focus: false,
                items: [],
              },
              segment: {
                focus: false,
                items: [],
              },
              grade: {
                focus: false,
                items: [],
              },
              board: {
                focus: false,
                items: [],
              },
              elaborationYear: {
                focus: false,
                items: [],
              },
              elaborationStartYear: {
                focus: false,
                items: [],
              },
              elaborationEndYear:  {
                focus: false,
                items: [],
              },
              knowledgeArea: {
                focus: false,
                items: [],
              },
              enunciation: {
                focus: false,
                search: '',
              },
              alternatives: {
                focus: false,
                search: '',
              },
            },
          },
          controlsImportQuestion: {
            showOrientations: true,
            acceptTerms: {{user.accept_terms_of_question_import|default:False|lower}},
            type: 'simple',
            formIntegrationSuperProViaFile: {
              status: 'idle',
              file: '',
            },
          },
          clientTeacherObligation: {
            {% with user|get_teacher_obligation:object.grade.level as teacher_obligation %}
              
              {% if teacher_obligation %}
              
                {% if elaborated_by_me %}

                  {% if teacher_obligation.apply_on_homework %}
                    template: {{teacher_obligation.template|default:False|lower}},
                    topics: {{teacher_obligation.topics|default:False|lower}},
                    abilities: {{teacher_obligation.abilities|default:False|lower}},
                    competences: {{teacher_obligation.competences|default:False|lower}},
                    difficult: {{teacher_obligation.difficult|default:False|lower}},
                    pedagogicalData: {{teacher_obligation.pedagogical_data|default:False|lower}},
                    commentedResponse: {{teacher_obligation.commented_response|default:False|lower}},
                    applyOnHomework: true,
                  {% else %}
                    template: false,
                    topics: false,
                    abilities: false,
                    competences: false,
                    difficult: false,
                    pedagogicalData: false,
                    commentedResponse: false,
                    applyOnHomework: false,
                  {% endif %}

                {% else %}
                  template: {{teacher_obligation.template|default:False|lower}},
                  topics: {{teacher_obligation.topics|default:False|lower}},
                  abilities: {{teacher_obligation.abilities|default:False|lower}},
                  competences: {{teacher_obligation.competences|default:False|lower}},
                  difficult: {{teacher_obligation.difficult|default:False|lower}},
                  pedagogicalData: {{teacher_obligation.pedagogical_data|default:False|lower}},
                  commentedResponse: {{teacher_obligation.commented_response|default:False|lower}},
                  applyOnHomework: {{teacher_obligation.apply_on_homework|default:False|lower}},
                {% endif %}

              {% else %}
                template: false,
                topics: false,
                abilities: false,
                competences: false,
                difficult: false,
                pedagogicalData: false,
                commentedResponse: false,
                applyOnHomework: false,
              {% endif %}

            {% endwith %}
          },
          canAddSupportContentDiscursiveQuestions: {{ user.questions_configuration.can_add_support_content_discursive_questions|lower|default:"false" }},
          tinyMCEDefaultsSimple: {{TINYMCE_DEFAULTS_SIMPLE|safe}},
          recalculateWeights: false,
          topics: [],
          baseTexts: [],
          abilities: [],
          competences: [],
          foundedTopics: [],
          foundedBaseTexts: [],
          foundedAbilities: [],
          foundedCompetences: [],
          preSelectedBaseTexts: [],
          canAddExamQuestion: false,
          sugestionTags: [],
          generatedQuestion: null,
          weights: null,
          selectedCompetenceCode: "",
          selectedCompetence: "",
          selectedAbility:  "",
          selectedAbilityCode: "",
          grades: [
            {% for grade in grades %}
              {
                id: '{{grade.id}}',
                name: '{{grade}}',
                level: {{grade.level}}
              },
            {% endfor %}
          ],
          boards: [],
          knowledgeAreas: [],
          questionsCategories: [
            {
              id: "0",
              name: "Discursiva",
            },
            {
              id: "1",
              name: "Objetiva",
            },
            {
              id: "2",
              name: "Arquivo anexado",
            },
            {
              id: "3",
              name: "Somatório",
            },
          ],
          difficults: [
            {
              id: "0",
              name: "Fácil"
            },
            {
              id: "1",
              name: "Médio"
            },
            {
              id: "2",
              name: "Difícil"
            },
            {
              id: "3",
              name: "Indefinida"
            },
          ],
          segments: [
            {
              id: "1",
              name: "Anos iniciais",
              levels: "1º ano, 2º ano, 3º ano, 5º ano e 5º ano",
            },
            {
              id: "2",
              name: "Anos Finais",
              levels: "6º ano, 7º ano, 8º ano e 9º ano",
            },
            {
              id: "0",
              name: "Ensino Médio",
              levels: "1ª Série, 2ª Série e 3ª Série",
            },
          ],
          selectedSuggestion: {
            type: 'competence',
            bnccs: [],
            text: '',
            alternatives: []
          },
          credits: {
            canCreateAiQuestion: true,
            availables: 0,
          },
          improvementDiff: {
            content: "",
            show: false,
          },
          currentUses: [],
          cancelDrop: false,
          preservedSubjects: [],
          acumulatedPromptItems: {
            level: "Indefinido",
            segment: "",
            questionCategory: "",
            subject: "",
            language: "",
            abilities: [],
            competences: [],
          },
          textCorrections: [
            {% for text_correction in text_corrections %}
              {
                id: '{{text_correction.id}}',
                name: '{{text_correction.name}}',
              },
            {% endfor %}
          ],
          inputWeights: {}, 
          subjectNote: null,
          dropdownRefs: ['questionsCategory', 'questionsDifficult', 'grade', 'board', 'knowledgeArea', 'enunciation', 'alternatives', 'elaborationStartYear', 'elaborationEndYear'],
          requestSubject: '{{object.teacher_subject.subject.id}}',
          subjectsAfterInit: [],
          currentYear: new Date().getFullYear(),
          years: [], 
          rangeInitial: {
            startYear: 1999,
            endYear: null,
          },
          keyAdvancedFilters:  "",
          choicesRefThemes: null,
          choicesRefMainTopics: null,
          keyAdvancedFilters: '',
          internalStatus: 'idle',
          filterPanel: 'open',
          criteriaPanel: 'closed',
          searchSubjects: '',
          statusLoadSubjects: 'idle',
          debounceTimeout: null,
          blockQuantityLimit: {{object.block_quantity_limit|default:False|lower|safe}},
        },
        directives: {
          'click-outside': {
            bind: function(el, binding, vNode) {
              // Provided expression must evaluate to a function.
              if (typeof binding.value !== 'function') {
                const compName = vNode.context.name
                let warn = `[Vue-click-outside:] provided expression '${binding.expression}' is not a function, but has to be`
                if (compName) { warn += `Found in component '${compName}'` }

                console.warn(warn)
              }
              // Define Handler and cache it on the element
              const bubble = binding.modifiers.bubble
              const handler = (e) => {
                if (bubble || (!el.contains(e.target) && el !== e.target)) {
                  binding.value(e)
                }
              }
              el.__vueClickOutside__ = handler

              // add Event Listeners
              document.addEventListener('click', handler)
            },

            unbind: function(el, binding) {
              // Remove Event Listeners
              document.removeEventListener('click', el.__vueClickOutside__)
              el.__vueClickOutside__ = null
            }
          },
        },
        watch: {
          'questionsBankControls.loadQuestions': function(value) {
            if (this.statusLoadSubjects === 'idle' && !value) {
              this.controls.moreSubjectsBank = true;
              this.statusLoadSubjects = 'loaded';
            }
          },
          selectedSegment: function(value) {
            this.applyFiltersAndGetSubjects()
            this.updateSubjectsVisualList()
          },
          themes: function(value) {
            this.choicesRefThemes.destroy()
            let elementTheme = document.getElementById('theme')
            this.choicesRefThemes = new Choices(elementTheme, {
              placeholderValue: 'Selecione um Tema',
              removeItemButton: true,
              classNames: {
                containerOuter: ['choices', 'w-100', 'mb-0'],
                containerInner: ['choices__inner', 'custom-choices__inner'],
                listSingle: ['choices__list--single', 'custom-choices__list--single'],
              },
            })
            this.choicesRefThemes.clearChoices()
            let choices = value.map(theme => ({ value: theme.id, label: theme.name }))
            this.choicesRefThemes.setChoices(
              choices,
              'value',
              'label',
              false,
            )
            this.choicesRefThemes.setChoiceByValue(this.selectedTheme)
          },
          mainTopics: function(value) {
            this.choicesRefMainTopics.destroy()
            let elementMainTopic = document.getElementById('main_topic')
            this.choicesRefMainTopics = new Choices(elementMainTopic, {
              placeholderValue: 'Selecione um Tópico',
              removeItemButton: true,
              classNames: {
                containerOuter: ['choices', 'w-100', 'mb-0'],
                containerInner: ['choices__inner', 'custom-choices__inner'],
                listSingle: ['choices__list--single', 'custom-choices__list--single'],
              },
            })
            this.choicesRefMainTopics.clearChoices()
            let choices = value.map(theme => ({ value: theme.id, label: theme.name }))
            this.choicesRefMainTopics.setChoices(
              choices,
              'value',
              'label',
              false,
            )
            this.choicesRefMainTopics.setChoiceByValue(this.selectedMainTopic)
          },
          'examQuestion.question.correctWithCompetencies': function(val) {
            if(!val) {
              this.examQuestion.question.textCorrection = null
            }
          },
          'examQuestion.question.textCorrection': function(val) {
            if(val.length) {
              this.examQuestion.question.correctWithCompetencies = true
            }
          },
          selectedTheme: function(value) {
            this.fetchTheme(value)
            this.fetchMainTopic(value)
            this.selectedMainTopic = ''
          },
          'controlsImportQuestion.acceptTerms': function(val) {
            this.controlsImportQuestion.showOrientations = !val
            if(val) {
              this.acceptTermsQuestionImport()
            }
          },
          'controls.onlyMyQuestions': function(val) {
            this.generateUrlParams();
            this.getQuantityOfQuestions();
            this.getAndShowQuestions();
            this.updateSubjectsVisualList();
          },
          'controls.moreSubjectsBank': function(val) {
            this.controls.moreSubjectsBank = val
            this.generateUrlParams();
            this.getInitialSubjects();
            this.getQuantityOfQuestions();
            this.getAndShowQuestions();
            this.updateSubjectsVisualList();
          },
          'questionsBankControls.selectedQuestion': function(val) {
            if (!val.detailLoaded) {
              this.getQuestionDetail(val)
            }
          },
          'controls.show': function() {
            this.handleResize()
          },
          selectedExamQuestion: function(val) {

            if(val) {
              this.$nextTick().then(() => {
                this.startTINYMCE(this.selectedExamQuestion)
  
                this.preSelectedBaseTexts = Object.assign([], this.selectedExamQuestion.question.baseTexts)
                
                this.handlePedagogicalData()
              })
              
              this.handleResize()

            }

          },
          'selectedSuggestion.text': function() {
            if(this.selectedSuggestion.type == 'enunciation'){
              let wikEdDiff = new WikEdDiff();
              let diffHtml = wikEdDiff.diff(this.selectedExamQuestion.question.enunciation, this.selectedSuggestion.text);

              this.improvementDiff.content = diffHtml
              
              setTimeout(() => {
                let container = document.querySelector('#wikEdDiffContainer');
                // Verifica se o container foi encontrado
                if (container) {
                    // Seleciona todas as tags <span> dentro do container
                    let spans = container.querySelectorAll('span');
                    let pre = container.querySelector('pre');
  
                    // Itera sobre cada tag <span>
                    spans.forEach(function(span) {
                        // Obtém o conteúdo interno da tag <span>
                        let content = span.innerHTML;
  
                        // Remove as tags <span> e </span> do conteúdo interno
                        let cleanedContent = content.replace(/&lt;\/?p[^&]*&gt;/gi, '');
  
                        // Atualiza o conteúdo interno da tag <span> com o conteúdo limpo
                        span.innerHTML = cleanedContent;
                    });
  
                    let content = pre.innerHTML
                    let cleanedContent = content.replace(/&lt;\/?p[^&]*&gt;/gi, '');
                    pre.innerHTML = cleanedContent;
  
                } else {
                    console.error('Container não encontrado.');
                }
              }, 100)
            }
          },
        },
        methods: {
          toggleFilterPanel() {
            this.filterPanel = this.filterPanel === 'open' ? 'closed' : 'open'
          },
          toggleCriteriaPanel() {
            this.criteriaPanel = this.criteriaPanel === 'open' ? 'closed' : 'open'
          },
          slugify(text) {
            if (!text) return ''
            return text
              .toString()
              .toLowerCase()
              .trim()
              .replace(/\s+/g, '-')
              .replace(/[^\w\-]+/g, '')
              .replace(/\-\-+/g, '-')
              .replace(/^-+/, '')
              .replace(/-+$/, '')
          },
          getQuestionContentHeight(examQuestion) {
            if (this.controls.show) {
              if (examQuestion.question.categoryDisplay == 'Discursiva' && examQuestion.currentMenu == 'enunciation') {
                if (this.controls.height < 678) {
                  return 'calc(100vh - 460px)'
                } else {
                  return 'calc(100vh - 420px)'
                }
              } else if (examQuestion.question.categoryDisplay == 'Preencher lacunas' && examQuestion.currentMenu == 'enunciation') {
                if (this.controls.height < 678) {
                  return 'calc(100vh - 820px)'
                } else {
                  return 'calc(100vh - 780px)'
                }
              } else {
                if (this.controls.height < 678) {
                  return 'calc(100vh - 300px)'
                } else {
                  return 'calc(100vh - 260px)'
                }
              }
            }
          },
          toCamelCase(obj) {

            // O objeto usado nessa tela está em camelCase, mas a api retorna em snake_case
            // Essa função é usada na hora de passar o retorno da api para o obj exibido

            var newObj = {};
            for (d in obj) {
              if (obj.hasOwnProperty(d)) {
                newObj[d.replace(/(\_\w)/g, function(k) {
                  return k[1].toUpperCase();
                })] = obj[d];
              }
            }
            return newObj;
          },   
          updateStatusQuestion(noteId, isCheckedBy) {

          // Função para atualizar um StatusQuestion
          let url = "{% url 'exams:exams_status_question_api_update'  pk='00000000-0000-0000-0000-000000000000' %}";
          url = url.replace('00000000-0000-0000-0000-000000000000', noteId);

          axios.put(url).then((res) => {
            // Operação bem-sucedida]
            noteAlter = this.selectedExamQuestion.statusList.find((status) => status.id === noteId)
            console.log(noteAlter)
            Vue.set(this.selectedExamQuestion.statusList, this.selectedExamQuestion.statusList.indexOf(noteAlter), this.toCamelCase(res.data))
            this.alertTop("Visto atualizado com sucesso");
          })
          .catch((error) => {
              if (error.response && error.response.status === 403) { 
                  // Um usuário diferente adicionou o visto
                  $('#checked-by-input'+noteId).prop('checked', true); 
                  this.alertTop("A remoção do visto só pode ser realizada pelo usuário que o aplicou",'info');
              } 
              else {
                  // Tratamento para erros inesperados
                  this.alertTop("Erro ao atualizar a aplicação do visto",'error');
              }
          });
          },
          isDefaultFilter(key, items) {
            const defaultValues = {
                'elaborationStartYear': [1999],
                'elaborationEndYear': [this.currentYear],
            };
            return JSON.stringify(items) === JSON.stringify(defaultValues[key]);
          },
          selectYear(year, filterType) {
            if (filterType === 'elaborationStartYear') {
              this.questionsBankControls.advancedFilters.elaborationStartYear.items = [year];
            } else if (filterType === 'elaborationEndYear') {
              this.questionsBankControls.advancedFilters.elaborationEndYear.items = [year];
            }
            this.questionsBankControls.advancedFilters.elaborationStartYear.focus = false;
            this.questionsBankControls.advancedFilters.elaborationEndYear.focus = false;
          },
          generateYears() {
            this.rangeInitial.endYear = this.currentYear;
            this.years = Array.from({ length: this.rangeInitial.endYear -  this.rangeInitial.startYear + 1 }, (_, i) =>  this.rangeInitial.startYear + i);
            this.questionsBankControls.advancedFilters.elaborationStartYear.items = [this.rangeInitial.startYear];
            this.questionsBankControls.advancedFilters.elaborationEndYear.items = [this.rangeInitial.endYear];
          },
          closeModalAdvancedFilters() {
            this.controls.showAdvancedFilters = false;
            $('#modalAdvancedFilters').modal('hide');
          },
          getSegmentName(segment) {
            const segmentNames = {
              0: "Ensino médio",
              1: "Ensino fundamental 1",
              2: "Ensino fundamental 2"
            };
            return segmentNames[segment] || "Segmento desconhecido";
          },
          handleQuestionsBankTutoria() {
            const csrfToken = document.querySelector('[name="csrfmiddlewaretoken"]').value;
            if (this.dontShowTutorial ) {
              axios.post("{% url 'inspectors:teacher_update_questions_bank_tutoria' %}", {
                show_tutorial: false
              }, {
                  headers: {
                      'X-CSRFToken': csrfToken 
                  }
              })
              .then(response => {
                this.controls.showQuestionsBankTutorial  = false

              })
              .catch(error => {
                console.error('Erro ao atualizar tutorial:', error);
              });
            }
            else {
              this.controls.showQuestionsBankTutorial = false
            }
          },
          getTooltipMessage(examQuestion) {
            const totalQuestions =  this.examTeacherSubject.examQuestions.length;
            const blockedQuestionsCount =  this.examTeacherSubject.examQuestions.filter(q => q.blockWeight).length;

            if (!examQuestion.blockWeight && blockedQuestionsCount === totalQuestions - 1) 
              examQuestion.tooltipMessage = 'É necessário ter pelo menos uma questão desbloqueada.';
            else if (!examQuestion.blockWeight )
              examQuestion.tooltipMessage = 'Trave a nota e salve para que não seja redistribuída automaticamente.';
            else
              examQuestion.tooltipMessage = 'Destrave a nota para que seja redistribuída automaticamente.';
     
            return examQuestion.tooltipMessage;
          },
          isBlockButtonDisabled(examQuestions, currentQuestion) {
            const totalQuestions = examQuestions.length;
            const blockedQuestionsCount = examQuestions.filter(q => q.blockWeight).length;
            if (!currentQuestion.blockWeight)
              return blockedQuestionsCount == totalQuestions - 1;
          },
          divideValue(dividend, parts) {
            const DECIMAL_PLACE = 6
            let baseValue = Number((dividend / parts).toFixed(DECIMAL_PLACE))
            let remainder = Number((dividend - (baseValue * parts)).toFixed(DECIMAL_PLACE))
            if (baseValue < 0) {
              baseValue = 0
              remainder = 0
            }
    
            const result = Array.from({ length: parts }, (_, index) => {
              return index === parts - 1 ? Number((baseValue + remainder).toFixed(DECIMAL_PLACE)) : baseValue
            })
    
            return result
          },
          handleQuestionBlockedWeight() { 
            const DECIMAL_PLACE = 6;

            if (this.subjectNote) {
              const totalWeight = this.subjectNote - this.totalWeightQuestions;
              const freeWeightDistribution = this.subjectNote - this.totalBlockedWeightQuestions;

              const unlockedQuestions = this.examTeacherSubject.examQuestions.filter(
                question => !question.blockWeight && 
                            !(question.lastStatus.statusDisplay === 'Anulada' && question.lastStatus.annuledGiveScore === false)
              ).length;
          
              const values = this.divideValue(freeWeightDistribution, unlockedQuestions);
              let globalIndex = 0;

              this.examTeacherSubject.examQuestions.forEach((question, index) => {
                if (question.lastStatus.statusDisplay === 'Anulada' && question.lastStatus.annuledGiveScore === false) {
                  return; 
                }
          
                if (question.blockWeight) {
                  return;
                }
                question.weight = Number(values[globalIndex].toFixed(DECIMAL_PLACE))
                globalIndex++;
              });
            }
          },
          updateBlockWeight(examQuestion) {
            examQuestion.blockWeight = !examQuestion.blockWeight;
            this.$forceUpdate()
          },
          focusInput(inputName) {
            if (this.$refs[inputName]) {
              this.$refs[inputName].focus();
            }
          },
          openAdvancedFilters() {
            this.controls.showAdvancedFilters = true;
            this.closeAllDropdown();
            // $('#modalAdvancedFilters').modal('show');

          },
          toggleText() {
              var moreText = document.getElementById("more-text");
              var toggleButton = document.getElementById("toggle-button");
              if (moreText.style.display === "none" || !moreText.style.display) {
                  moreText.style.display = "inline";
                  toggleButton.textContent = "Ver menos";
              } else {
                  moreText.style.display = "none";
                  toggleButton.textContent = "Ver mais";
              }
          },
          countAdvancedFilters() {
            let filterCounts = 0;

            for (const key in this.questionsBankControls.advancedFilters) {
              if (this.questionsBankControls.advancedFilters.hasOwnProperty(key)) {
                  const filter = this.questionsBankControls.advancedFilters[key];
                  
                  if (filter.items && filter.items.length > 0 && key !== 'elaborationStartYear' && key !== 'elaborationEndYear') {
                    filterCounts++;
                  }
                  
                  if (filter.search && typeof filter.search === 'string' && filter.search.trim() !== '') {
                      filterCounts++;
                  }
                  if (key === 'elaborationStartYear' || key === 'elaborationEndYear') {
                    if (filter.items.length > 0 && !this.isDefaultFilter(key, filter.items)) {
                        filterCounts++;
                    }
                }
              }
            }
        
            return Math.max(0, filterCounts);
          },
          updateSelectedValues() {
            const knowledgeAreaId = this.selectedExamQuestion.question.pedagogicalData.knowledgeArea;
            const knowledgeArea = this.selectedExamQuestion.question.pedagogicalData.knowledgeAreas.find(area => area.id === knowledgeAreaId);
            
            const subjectId = this.selectedExamQuestion.question.subject;
            const subject = this.selectedExamQuestion.question.pedagogicalData.subjects.find(subject => subject.id === subjectId);;
            
            const gradeId = this.selectedExamQuestion.question.grade;
            const grade = this.selectedExamQuestion.question.pedagogicalData.grades.find(grade => grade.id === gradeId);;          

            $('.subject-value').text(subject.name);
            $('.grade-value').text(grade.name);
            $('.area-value').text(knowledgeArea.name);
          },
          showMessageToast(errorMessage, icon) {
            Swal.fire({
                position: 'top-end',
                text: errorMessage,
                icon: icon,
                showConfirmButton: false,
                timer: 5000,
                toast: true,
                timerProgressBar: true,
            });
          },
          openModalCreateCompetence() {
            this.selectedCompetenceCode = '';
            this.selectedCompetence = '';

            this.updateSelectedValues();

            $('#modalCompetences').modal('toggle');
            $('#modalCreateCompetence').modal('show');
          },
          openModalCreateAbility() {
              this.selectedAbilityCode = '';
              this.selectedAbility = '';

              this.updateSelectedValues();

              $('#modalAbilities').modal('toggle');
              $('#modalCreateAbility').modal('show');
          },
          openModalCreateTopic() {
            this.selectedTheme = '';
            this.selectedMainTopic = '';
            this.topicName = '';
            this.stage = '';

            this.updateSelectedValues()
            this.fetchTheme()
            this.fetchMainTopic(this.selectedTheme)

            $('#modalTopics').modal('toggle');
            $('#modalCreateTopic').modal('toggle');
          },
          submitFormCreateAbility(csrf_token) {
            grades = []
            grades.push(this.selectedExamQuestion.question.grade)
            const postData = {
                code: this.selectedAbilityCode,
                text: this.selectedAbility,
                grades: grades,
                subject: this.selectedExamQuestion.question.subject,
                knowledge_area: this.selectedExamQuestion.question.pedagogicalData.knowledgeArea,
            };
            var postUrl = "{% url 'bncc:ability_create_api' %}";

            axios.post(postUrl, postData, {
              headers: {
                'X-CSRFToken': csrf_token 
              }
            })
            .then(response => {
              if (response.status === 201) {
                  const ability = response.data;
                  app.foundedAbilities.unshift(ability);
                  this.abilities.unshift(ability);
                  this.selectedExamQuestion.question.abilities.push(ability.id);
                  this.showMessageToast("Assunto cadastrado com sucesso!", 'success')
                  this.closeModal('#modalCreateAbility', '#modalAbilities')
              }
            })
            .catch(error => {
              if (error.response && error.response.data && error.response.data.non_field_errors) {
                this.showMessageToast(error.response.data.non_field_errors, "error")
              } else {
                this.showMessageToast("Ocorreu algum erro no preenchimento do formulário. Por favor, verifique se preencheu todos os campos e tente novamente.", 'error')
              }
            });
          }, 
          submitFormCreateCompetence(csrf_token) {
            grades = []
            grades.push(this.selectedExamQuestion.question.grade)
            const postData = {
              code: this.selectedCompetenceCode,
              text: this.selectedCompetence,
              grades: grades,
              subject: this.selectedExamQuestion.question.subject,
              knowledge_area: this.selectedExamQuestion.question.pedagogicalData.knowledgeArea,

            };
            var postUrl = "{% url 'bncc:competence_create_api' %}";

            axios.post(postUrl, postData, {
              headers: {
                'X-CSRFToken': csrf_token 
              }
            })
            .then(response => {
              if (response.status === 201) {
                const competence = response.data;
                app.foundedCompetences.unshift(competence);
                this.competences.unshift(competence);
                this.selectedExamQuestion.question.competences.push(competence.id);
                this.showMessageToast("Assunto cadastrado com sucesso!", 'success')
                this.closeModal('#modalCreateCompetence', '#modalCompetences')
              }
            })
            .catch(error => {
              if (error.response && error.response.data && error.response.data.non_field_errors) {
                this.showMessageToast(error.response.data.non_field_errors, "error")
              } else {
                this.showMessageToast("Ocorreu algum erro no preenchimento do formulário. Por favor, verifique se preencheu todos os campos e tente novamente.", 'error')
              }
            });
          },
          submitTopicForm(csrf_token) {
            const postData = {
                grade: this.selectedExamQuestion.question.grade,
                subject: this.selectedExamQuestion.question.subject,
                theme: this.selectedTheme,
                main_topic: this.selectedMainTopic,
                name: this.topicName,
                stage: this.stage || null,
            };
            var postUrl = "{% url 'subjects:topic_create_complete' %}";

            axios.post(postUrl, postData, {
              headers: {
                'X-CSRFToken': csrf_token 
              }
            })
            .then(response => {
              if (response.status === 201) {
                    const topic = response.data;
                    app.foundedTopics.unshift(topic);
                    this.topics.unshift(topic);
                    this.selectedExamQuestion.question.topics.push(topic.id);
                    this.showMessageToast("Assunto cadastrado com sucesso!", 'success')
                    this.closeModal('#modalCreateTopic', '#modalTopics')  
              }
            })
            .catch(error => {
              if (error.response && error.response.data && error.response.data.non_field_errors) {
                this.showMessageToast(error.response.data.non_field_errors[0], 'error');
              } else {
                this.showMessageToast("Ocorreu algum erro no preenchimento do formulário. Por favor, verifique se preencheu todos os campos e tente novamente.", 'error');
              }
            }); 
          },
          closeModal(id_modal_top, id_modal) {
            $(id_modal_top).modal('toggle');
            $(id_modal).modal('toggle');
          },
          toggleThemeInput() {
            this.isAddingNewTheme = !this.isAddingNewTheme;
            this.newThemeName = '';
          },
          saveNewTheme(csrf_token) {
            if (this.newThemeName.trim()) {
              var postData = {
                name: this.newThemeName, 
              };
              var themeUrl = `{% url 'subjects:theme_create_api' %}`; 
              axios.post(themeUrl, postData, {
                headers: {
                  'X-CSRFToken': csrf_token 
                }
              })
              .then(response => {
                if (response.status === 201) {
                  const thema = response.data;
                  this.themes.push(thema);
                  this.themes.sort((a, b) => a.name.localeCompare(b.name));
                  this.selectedTheme = thema.id;
                  this.isAddingNewTheme = false;
                  this.newThemeName = '';
                  this.showMessageToast("Tema criado com sucesso!", 'success')
                }
              })
              .catch(error => {
                if (error.response && error.response.data && error.response.data.non_field_errors) {
                  this.showMessageToast(error.response.data.non_field_errors[0], 'error');
                } else {
                  this.showMessageToast("Ocorreu algum erro no preenchimento do formulário. Por favor, verifique se preencheu todos os campos e tente novamente.", 'error');
                }             
              });
            }
          },
          fetchTheme: function () {
            var self = this
              var themeListUrl = `{% url 'subjects:theme_list_api' %}` 
              axios.get(themeListUrl).then(function(response) {
                self.themes = response.data
            })
          },
          fetchMainTopic: function (theme) {
            var self = this
            if (theme) {
              var mainTopicListUrl = `{% url 'subjects:main_topic_list_api' %}?theme_pk=${theme}` 
              axios.get(mainTopicListUrl).then(function(response) {
                self.mainTopics = response.data
              })
              return
            }
            else {
              var mainTopicListUrl = `{% url 'subjects:main_topic_list_api' %}`
              axios.get(mainTopicListUrl).then(function(response) {
                  self.mainTopics = response.data
              })
            }
          },
          toggleMainTopicInput() {
            this.isAddingNewMainTopic = !this.isAddingNewMainTopic;
            this.newMainTopicName = '';
          },
          saveNewMainTopic(csrf_token) {
            if (this.newMainTopicName.trim()) {
              var postData = {
                name: this.newMainTopicName, 
                theme: this.selectedTheme 
              };
              var mainTopicUrl = `{% url 'subjects:main_topic_create_api' %}`; 
              axios.post(mainTopicUrl, postData, {
                headers: {
                  'X-CSRFToken': csrf_token 
                }
              })
              .then(response => {
                if (response.status === 201) {
                  const mainTopic = response.data;
                  this.mainTopics.push(mainTopic);
                  this.mainTopics.sort((a, b) => a.name.localeCompare(b.name));
                  this.selectedMainTopic = mainTopic.id;
                  this.isAddingNewMainTopic = false;
                  this.newMainTopicName = '';
                  this.showMessageToast("Tópico criado com sucesso!", 'success')

                } else {
                  throw new Error('Network response was not ok ' + response.statusText);
                }
              })
              .catch(error => {
                this.showMessageToast("Para criar um Tópico é necessário selecioanar ou criar um Tema.", 'error')
              });
            }
          },
          getCredits() {
            if(Boolean("{{user.is_freemium|default:''}}")) {
              return axios.get("{% url 'exams:freemium-credits' %}").then((response) => {
                this.credits.availables = response.data.availables
                this.credits.canCreateAiQuestion = response.data.canCreateAiQuestion
              })
            } else {
              return new Promise((resolve) => resolve())
            }
          },
          openWaitingListModal() {
            if(!this.credits.availables) {
              Swal.fire({
                icon: 'warning',
                title: 'Seus créditos acabaram',
                html: `
                  Você pode continuar utilizando o sistema normalmente, as funções de geração e aprimoramento por IA será suspensa até o dia <br/><strong>01 do próximo mês</strong>.
                `,
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Quero mais créditos!",
                cancelButtonText: "Fechar",
              }).then((result) => {
                if (result.isConfirmed) {
                  axios.post("{% url 'exams:freemium-interested-in-more-credits' %}").then((response) => {
                    Swal.fire({
                      title: "Obrigado!",
                      text: "Adicionamos você em nossa lista de espera para novos créditos.",
                      icon: "success"
                    });
                  })
                }
              })
            }
          },
          likedSuggestion(like, where) {
            let payload = {

            }
            if (where == 'enunciation') {
              payload['likedEnunciation'] = like ? 1:2
            }
            else if (where == 'commentedAnswer') {
              payload['likedCommentedAnswer'] = like ? 1:2
            }
            else if (where == 'topics') {
              payload['likedTopics'] = like ? 1:2
            }
            else if (where == 'abilities') {
              payload['likedAbilities'] = like ? 1:2
            }
            else if (where == 'competences') {
              payload['likedCompetences'] = like ? 1:2
            }

            axios.patch(this.selectedExamQuestion.question.urls.apiUpdateImprove, payload).then((response) => {
              this.selectedExamQuestion.question.improve = response.data
            }) 
          },
          moment(date) {
            return moment(date)
          },
          finishElaboration() {
            this.alertTop('Salvo com sucesso.')
              setTimeout(() => {
                {% if elaborated_by_me %}
                  window.location.href = "{% url 'exams:exam_teacher_update' object.exam.id %}?v=2"
                {% else %}
                  window.location.href = "{% url 'core:redirect_dashboard' %}"
                {% endif %}
            }, 500)
          },
          resetNewStatusObject(){
              this.newStatusQuestion = {
                  status: 9,
                  note: "",
                  give_score: false,
                  question_fragment:"",
                  source_status_question:""
              }
          },
          submitNewStatus() {
                this.controls.sendingCoordinationNote = true
                this.newStatusQuestion.note = this.examTeacherSubject.teacherNote

                let url = "{% url 'exams:exams_status_question_api_create'  pk='00000000-0000-0000-0000-000000000000' %}"
                url = url.replace('00000000-0000-0000-0000-000000000000', this.selectedExamQuestion.id)
                axios.post(url, this.newStatusQuestion).then((response) => {
                    this.resetNewStatusObject()
                    this.alertTop('Resposta enviada!')
                }).catch((e) => {
                  this.alertTop('Erro ao tentar responder uma revisão para coordenação', 'error')
                }).finally(() => {
                  this.controls.sendingCoordinationNote = false
                  this.examTeacherSubject.teacherNote = ''
                  this.newStatusQuestion.note = ''
                  $('#modalCoordinationNote').modal('hide')
                })
            },
          sendCoordinationNote() {
            this.controls.sendingCoordinationNote = true
            axios.patch(this.examTeacherSubject.urls.apiUpdate, { teacherNote: this.examTeacherSubject.teacherNote }).then((response) => {
              this.alertTop('Nota para coordenação enviada com sucesso.')
              $('#modalCoordinationNote').modal('hide')
            }).catch((e) => {
              this.alertTop('Erro ao tentar enviar nota para coordenação', 'error')
            }).finally(() => {
              this.controls.sendingCoordinationNote = false
            })
          },
          isPutValid(oldIndex, newIndex) {
            // Verifica se o drop de uma questão em uma nova posição é válido
            // Questões que não estão associadas com a solicitação sendo manipulada NÃO podem ter sua posição alterada
            let foreignIndexes = []
            this.examTeacherSubject.examQuestions.forEach((item) => {
              if(item.sourceExamTeacherSubject && (item.sourceExamTeacherSubject != item.examTeacherSubject)){
                foreignIndexes.push(item.order)
              }
            })

            let validPut = true
            if(foreignIndexes.length){
              foreignIndexes.forEach((item) => {
                if((oldIndex < item && newIndex >= item) || (oldIndex > item && newIndex <= item) || (oldIndex == item)) {
                  validPut = false
                }
              })
            }
            return {validPut, foreignIndexes}
          },
          async changeExamQuestionsEvent(event) {
            if(!this.controls.saving) {
              
              let moved = event.moved
  
              let oldIndex = moved.oldIndex
              let newIndex = moved.newIndex
              
              let { validPut, foreignIndexes } = this.isPutValid(oldIndex, newIndex)
              
              if(!validPut) {
                this.examTeacherSubject.examQuestions.sort((a, b) => a.order - b.order)
                Swal.fire({
                  icon: 'warning', 
                  title: 'AVISO',
                  text: `Essa movimentação não pode ser feita pois afeta a posição da questão ${foreignIndexes[0] + 1}, que está travada por questões de diagramação`
                })
                return
              }
  
              this.controls.swaping = true
              
              this.examTeacherSubject.examQuestions.forEach((e) => {
                if(e.tinyMCE.enunciation && tinymce.get('questionEnunciation-'+ e.id)) {
                  tinymce.get('questionEnunciation-'+ e.id).remove()
                  e.tinyMCE.enunciation = null
                }
                if(e.tinyMCE.commentedAwnser && tinymce.get('commentedAwnser-'+ e.id)) {
                  tinymce.get('commentedAwnser-'+ e.id).remove()
                  e.tinyMCE.commentedAwnser = null
  
                }
                if(e.tinyMCE.feedback && tinymce.get('feedback-'+ e.id)) {
                  tinymce.get('feedback-'+ e.id).remove()
                  e.tinyMCE.feedback = null
  
                }
                if(e.tinyMCE.feedback && tinymce.get('feedback-'+ e.id)) {
                  tinymce.get('feedback-'+ e.id).remove()
                  e.tinyMCE.feedback = null
  
                }
                e.question.alternatives.forEach((a) => {
                  if(a.tinyMCE && tinymce.get('alternative-'+ a.id)) {
                    tinymce.get('alternative-'+ a.id).remove()
                    e.tinyMCE = null
                  }
                })
              })              
  
              setTimeout(() => {
                this.changeExamQuestionsOrder(this.examTeacherSubject.examQuestions).then((response) => {
    
                  for(e of response.data.exam_questions) {
                    let examQuestion = this.examTeacherSubject.examQuestions.find(j => j.id == e.id)
                    examQuestion.order = e.order
                  }
    
                  this.handleExamQuestionFunctions()
                  
                  this.controls.swaping = false, 
                  this.alertTop('A posição da questão foi alterada.')
                  setTimeout(() => {
                    this.goToExamQuestion(this.examTeacherSubject.examQuestions[newIndex])
                  }, 300)
                }).catch((error) => {
                  this.controls.swaping = false
                  this.alertTop('Erro ao tentar modificar a ordem das questões, tente novamente, caso o erro persista entre em contato com o suporte.', 'error')
                }).finally(() => {
                    
                })
                
              }, 500)
            }
          },
          async changeExamQuestionsOrder(examQuestions) {
            return axios.put("{% url 'exams:api-exam-swap-position' %}", { exam_questions: examQuestions })
          },
          async distributeWeightsExamTeacherSubject() {
            {% if not object.subject_note and not object.exam.total_grade %}
              this.controls.loadingDistributeWeights = true
              axios.post(this.examTeacherSubject.urls.apiDistributeWeights, { weights: this.weights }).then((response) => {
                  this.alertTop('Os pesos foram distribuídos igualmente entre as questões do caderno!')
                  this.handleExamQuestionsWeights().finally(() => this.controls.loadingDistributeWeights = false)
              }).catch((error) => {
                  this.alertError('Ocorreu um erro ao tentar distribuir os pontos, tente novamente e se o erro persistir entre em contato com o suporte.')
              })
            {% endif %}
          },
          async distributeWeightsExamQuestion() {
            {% if not object.subject_note and not object.exam.total_grade %}
              if(this.selectedExamQuestion.weight) {
                this.controls.loadingDistributeWeights = true
                axios.post(this.examTeacherSubject.urls.apiDistributeWeights, { question: this.selectedExamQuestion }).then((response) => {
                  this.alertTop('O peso da questão foi alterado!')
                  this.handleExamQuestionsWeights().finally(() => this.controls.loadingDistributeWeights = false)
                }).catch((error) => {
                    this.alertError('Ocorreu um erro ao tentar alterar o peso da questão, tente novamente e se o erro persistir entre em contato com o suporte.')
                })
              }
            {% endif %}
          },
          removePromptImage() {
            this.promptControls.image = null
            $("#baseImageID").val("")
          },
          changeImproveStatus(where, status, statusNumber) {
            if(where == 'enunciation') {
              this.selectedExamQuestion.question.improve.enunciationStatusDisplay = status
              this.selectedExamQuestion.question.improve.enunciationStatus = statusNumber
            }
            else if(where == 'commentedAnswer') {
              this.selectedExamQuestion.question.improve.commentedAnswerStatusDisplay = status
              this.selectedExamQuestion.question.improve.commentedAnswerStatus = statusNumber
            }
            else if(where == 'topics') {
              this.selectedExamQuestion.question.improve.topicsStatusDisplay = status
              this.selectedExamQuestion.question.improve.topicsStatus = statusNumber
            }
            else if(where == 'competences') {
              this.selectedExamQuestion.question.improve.competencesStatusDisplay = status
              this.selectedExamQuestion.question.improve.competencesStatus = statusNumber
            }
            else if(where == 'abilities') {
              this.selectedExamQuestion.question.improve.abilitiesStatusDisplay = status
              this.selectedExamQuestion.question.improve.abilitiesStatus = statusNumber
            }
          },
          canShowSuggestions(examQuestion) {
            return this.controls.show && this.selectedExamQuestion == examQuestion && this.selectedExamQuestion.question.improve && this.selectedExamQuestion.question.improve.availableToShow
          },
          async ignoreSuggestion(suggestion) {
            this.changeImproveStatus(where = suggestion, status = 'Ignorado', statusNumber = 1)
            this.updateQuestionImprove(where = null, saveExamQuestion = false)
            this.alertTop('O aprimoramento foi ignorado')
          },
          async applySuggestionBNCC(suggestion, bnccID) {

            this.changeImproveStatus(where = suggestion, status = 'Aplicado', statusNumber = 2)

            if(suggestion == 'topics') {
              this.selectedExamQuestion.question.improve.appliedTopics.includes(bnccID) ? this.selectedExamQuestion.question.improve.appliedTopics.splice(this.selectedExamQuestion.question.improve.appliedTopics.indexOf(bnccID), 1) : this.selectedExamQuestion.question.improve.appliedTopics.push(bnccID)
              this.selectedExamQuestion.question.topics.includes(bnccID) ? this.selectedExamQuestion.question.topics.splice(bnccID, 1) : this.selectedExamQuestion.question.topics.push(bnccID)
              if(!this.selectedExamQuestion.question.improve.appliedTopics.length) {
                this.selectedExamQuestion.question.improve.topicsStatus = 0
                this.selectedExamQuestion.question.improve.topicsStatusDisplay = 'Aguardando'
              }
              applied = true
            }
            else if(suggestion == 'competences') {
              this.selectedExamQuestion.question.improve.appliedCompetences.includes(bnccID) ? this.selectedExamQuestion.question.improve.appliedCompetences.splice(this.selectedExamQuestion.question.improve.appliedCompetences.indexOf(bnccID), 1) : this.selectedExamQuestion.question.improve.appliedCompetences.push(bnccID)
              this.selectedExamQuestion.question.competences.includes(bnccID) ? this.selectedExamQuestion.question.competences.splice(bnccID, 1) : this.selectedExamQuestion.question.competences.push(bnccID)
              if(!this.selectedExamQuestion.question.improve.appliedCompetences.length) {
                this.selectedExamQuestion.question.improve.competencesStatus = 0
                this.selectedExamQuestion.question.improve.competencesStatusDisplay = 'Aguardando'
              }
              applied = true
            }
            else if(suggestion == 'abilities') {
              this.selectedExamQuestion.question.improve.appliedAbilities.includes(bnccID) ? this.selectedExamQuestion.question.improve.appliedAbilities.splice(this.selectedExamQuestion.question.improve.appliedAbilities.indexOf(bnccID), 1) : this.selectedExamQuestion.question.improve.appliedAbilities.push(bnccID)
              this.selectedExamQuestion.question.abilities.includes(bnccID) ? this.selectedExamQuestion.question.abilities.splice(bnccID, 1) : this.selectedExamQuestion.question.abilities.push(bnccID)
              if(!this.selectedExamQuestion.question.improve.appliedAbilities.length) {
                this.selectedExamQuestion.question.improve.abilitiesStatus = 0
                this.selectedExamQuestion.question.improve.abilitiesStatusDisplay = 'Aguardando'
              }
              applied = true
            }

            this.updateQuestionImprove(where='bnccs')
          },
          async applySuggestion(examQuestion, suggestion, withoutSave = false) {
            if (!examQuestion) {
              examQuestion = this.selectedExamQuestion
            }

            let applied = false
            if(suggestion == 'all') {
              ['enunciation', 'commentedAnswer', 'topics', 'competences', 'abilities'].forEach((s) => this.applySuggestion(examQuestion, s, withoutSave = true))
              setTimeout(() => {
                this.updateQuestionImprove()
              }, 500)
            } else {
              if(suggestion == 'enunciation') {
                if(examQuestion.question.improve.enunciationStatusDisplay != 'Aplicado') {
                  examQuestion.question.enunciation = examQuestion.question.improve.enunciation
                  tinyMCE.get('questionEnunciation-' + examQuestion.id).setContent(examQuestion.question.enunciation)

                  examQuestion.question.alternatives.forEach((alternative, index) => {
                    let newAlternative = examQuestion.question.improve.alternatives[index]
                    let oldAlternative = examQuestion.question.alternatives[index]

                    oldAlternative.isCorrect = newAlternative.isCorrect 
                    oldAlternative.text = newAlternative.text 
                    tinyMCE.get('alternative-' + alternative.id).setContent(newAlternative.text)
                  })
                  applied = true
                }
              }
              else if(suggestion == 'commentedAnswer') {
                if(examQuestion.question.improve.commentedAnswerStatusDisplay != 'Aplicado') {
                  examQuestion.question.commentedAwnser = examQuestion.question.improve.commentedAnswer
                  if(tinyMCE.get('commentedAwnser-' + examQuestion.id)) {
                    tinyMCE.get('commentedAwnser-' + examQuestion.id).setContent(examQuestion.question.commentedAwnser)
                  }
                  applied = true
                }
              }

              this.changeImproveStatus(where = suggestion, status = 'Aplicado', statusNumber = 2)

              if(!withoutSave && applied) {
                setTimeout(() => {
                  this.updateQuestionImprove()
                }, 300)
              }
            }
          },
          async updateQuestionImprove(where, saveExamQuestion = true) {
            return axios.patch(this.selectedExamQuestion.question.urls.apiUpdateImprove, this.selectedExamQuestion.question.improve).then((response) => {
              this.selectedExamQuestion.question.improve = response.data
              if(saveExamQuestion) {
                this.save(where=where, skipControlsShow = true)
              }
            }).finally(() => {
              this.handleResize()
            })
          },
          async getExamPrintConfigs(url) {
            return axios.get(url).then((response) => this.examPrintConfig = response.data)
          },
          async printExam(printUrl, examID, examName) {
            this.controls.downloading = true
            let url = printUrl
            let filename = `${examName}.pdf`
            await this.downloadFile(url, filename)
            this.controls.downloading = false
          },
          async downloadFile(url, filename) {
            return await axios({
              url: url,
              method: 'GET',
              responseType: 'blob'
            }).then(response => {
              const url = window.URL.createObjectURL(new Blob([response.data], { type: 'application/pdf' }));
              const a = document.createElement('a');
              a.href = url;
              a.download = filename;
              document.body.appendChild(a);
              a.click();
              window.URL.revokeObjectURL(url);
            }).catch(error => {
              console.error('Erro ao baixar o arquivo:', error)
              this.alertTop('Erro ao baixar o arquivo', icon='error')
            });
          },
          getExamQuestionStatus(examQuestion, iconSize = 16) {
            let statusObject = {
              "Em aberto": {
                "label": "Em aberto",
                "bgColor": "#0C7BDB10",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="#0C7BDB" class="bi bi-eye" viewBox="0 0 16 16">
                    <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                    <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                  </svg>
                `
              },
              "Aprovada": {
                "label": "Aprovada",
                "bgColor": "#41C58810",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="#41C588" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                    <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
                  </svg>
                `
              },
              "Reprovada": {
                "label": "Reprovada",
                "bgColor": "#FF000010",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="#FF0000" class="bi bi-x-circle" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                  </svg>
                `
              },
              "Usar depois": {
                "label": "Usar depois",
                "bgColor": "#00b8d410",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="#00b8d4" class="bi bi-clock-history" viewBox="0 0 16 16">
                    <path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"/>
                    <path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"/>
                    <path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"/>
                  </svg>
                `
              },
              "Aguardando correção": {
                "label": "Aguardando correção",
                "bgColor": "#FF8F3D10",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="#FF8F3D" class="bi bi-stopwatch" viewBox="0 0 16 16">
                    <path d="M8.5 5.6a.5.5 0 1 0-1 0v2.9h-3a.5.5 0 0 0 0 1H8a.5.5 0 0 0 .5-.5V5.6z"/>
                    <path d="M6.5 1A.5.5 0 0 1 7 .5h2a.5.5 0 0 1 0 1v.57c1.36.196 2.594.78 3.584 1.64a.715.715 0 0 1 .012-.013l.354-.354-.354-.353a.5.5 0 0 1 .707-.708l1.414 1.415a.5.5 0 1 1-.707.707l-.353-.354-.354.354a.512.512 0 0 1-.013.012A7 7 0 1 1 7 2.071V1.5a.5.5 0 0 1-.5-.5zM8 3a6 6 0 1 0 .001 12A6 6 0 0 0 8 3z"/>
                  </svg>
                `
              },
              "Corrigido": {
                "label": "Corrigido",
                "bgColor": "#ffc10710",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="#ffc107" class="bi bi-check" viewBox="0 0 16 16">
                    <path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/>
                  </svg>
                `
              },
              "Rascunho": {
                "label": "Rascunho",
                "bgColor": "#D92D2098",
                "color": "white",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="currentColor" class="bi bi-pencil" viewBox="0 0 16 16">
                    <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                  </svg>
                `
              },
              "Incompleta": {
                "label": "Questão incompleta",
                "bgColor": "#D92D2098",
                "icon": `
                  <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" fill="white" class="bi bi-exclamation-triangle" viewBox="0 0 16 16">
                    <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
                    <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                  </svg>
                `
              },
            }
            
            if(statusObject[examQuestion.lastStatus.statusDisplay]) {
              return statusObject[examQuestion.lastStatus.statusDisplay]
            }

            return statusObject["Em aberto"]
          },
          addGeneratedQuestion() {
            
            this.controls.addingQuestion = true

            if(this.generatedQuestion.alternatives && this.generatedQuestion.alternatives.length) {
              let questionAlternatives = this.selectedExamQuestion['question']['alternatives'].slice(0, this.generatedQuestion.alternatives.length)
              this.generatedQuestion.alternatives.forEach((alternative, index) => {
                questionAlternatives[index].text = alternative.text
                questionAlternatives[index].isCorrect = alternative.isCorrect
              })
            } else {
              this.changeQuestionCategory(0)
            }

            if(this.generatedQuestion.baseImage) {
              this.selectedExamQuestion.question.enunciation += `<img src="${this.generatedQuestion.baseImage}"><br>`
            }
            if(this.generatedQuestion.baseText) {
              this.selectedExamQuestion.question.enunciation += `${this.generatedQuestion.baseText}<br>`
            }

            this.selectedExamQuestion.question.enunciation += this.generatedQuestion.enunciation
            
            this.selectedExamQuestion.question.commentedAwnser = this.generatedQuestion.commentedAnswer

            // adicionar dados pedagógicos
            this.selectedExamQuestion.question.abilities = this.acumulatedPromptItems.abilities.map((item) => item.id)
            this.selectedExamQuestion.question.competences = this.acumulatedPromptItems.competences.map((item) => item.id)
            const levelChoices = ["Fácil", "Médio", "Difícil", "Indefinido"]
            this.selectedExamQuestion.question.level = levelChoices.findIndex((l) => l == this.acumulatedPromptItems.level)

            this.selectedExamQuestion.question.createdWithAi = true
            
            setTimeout(() => {
              this.save(where='ia')
            }, 300)
          },
          cleanGeneratedQuestion(question) {
            question.enunciation = question.enunciation.replaceAll('\\n', '<br>').replaceAll('\n', '<br>') 
            question.baseText = question.baseText.replaceAll('\\n', '<br>').replaceAll('\n', '<br>')
            for (alternative of question.alternatives) {
              alternative.text = alternative.text.replaceAll('\\n', '<br>').replaceAll('\n', '<br>')
            }
            return question
          },
          generateQuestion() {
            if(!Boolean(`{{user.is_freemium|default:''}}`) || this.credits.canCreateAiQuestion) {
              this.awaitIAMessage()
  
              let prompt = this.promptControls.text
              let image = this.promptControls.image
              
              this.promptControls.editing = false
              this.controls.generatingQuestion = true
              this.generatedQuestion = null
  
              const formData = new FormData()
  
              formData.append('user_prompt', prompt)
              formData.append('items', JSON.stringify(this.promptControls.items))
              formData.append('alternatives_quantity', '{{object.exam.quantity_alternatives|default:5}}')
              if(image && image.name) {
                formData.append('base_image', image)
              }
  
              axios.post("{% url 'questions:questions-create-with-ai' %}", formData).then(response => {
                this.generatedQuestion = response.data
                this.generatedQuestion = this.cleanGeneratedQuestion(this.generatedQuestion)
              }).catch(error => {
                console.error('Erro:', error)
                this.promptControls.errors = error.response.data
              }).finally(() => {
                this.controls.generatingQuestion = false
                this.getCredits()
              })
            } else {
              if(!this.credits.canCreateAiQuestion) {
                this.openWaitingListModal()
              }
            }
          },
          moveCursorToEnd(elementId = 'prompt') {
            let contentEditable = document.getElementById(elementId);
            
            // Verifica se o elemento com contenteditable existe
            if (!contentEditable) {
              console.error('Elemento com contenteditable não encontrado.');
              return;
            }
          
            let range = document.createRange();
            range.selectNodeContents(contentEditable);
            range.collapse(false);
          
            let sel = window.getSelection();
            sel.removeAllRanges();
            sel.addRange(range);
          
            // Move o foco de volta para o contenteditable
            contentEditable.focus();

          },
          getCursorPosition() {

            let sel = window.getSelection();
            let range = sel.getRangeAt(0);
            let selectedText = range.toString();

            let startOffset = sel.anchorOffset;
            let endOffset = sel.focusOffset;

            if(sel.focusNode.parentElement.id == 'prompt') {
              this.promptControls.selection.sel = sel
              this.promptControls.selection.range = range
              this.promptControls.selection.start = startOffset
              this.promptControls.selection.end = endOffset
            }
          },
          async addLetter(latter) {
            return await new Promise((resolve) => {
              setTimeout(() => { 
                $("#prompt").html($("#prompt").html() + latter)
                resolve(latter)
              }, 3)
            })
          },
          async addSugestionTag(sugestion) {
            if(!this.promptControls.editing) {
              this.editPrompt()
              $("#prompt").html($("#prompt").html() + "&nbsp;")
              for(let i of sugestion.text) {
                await this.addLetter(i)
                this.moveCursorToEnd()
              }
              this.updatePromptText()
            }
          },
          insertContentAfterCursor(options) {
            if(!this.promptControls.selection.sel) {
              setTimeout(() => {
                
                let contentEditable = document.getElementById('prompt');
                contentEditable.focus()

                this.getCursorPosition()
              }, 100)
            }
            setTimeout(() => {
              let sel = this.promptControls.selection.sel
              let range = this.promptControls.selection.range
            
              if (range.startContainer.nodeType === Node.TEXT_NODE) {
                let startNode = range.startContainer;
                let startOffset = range.startOffset;
  
                let firstPart = startNode.splitText(startOffset);
                
                let wrapper = document.createElement('span')
                wrapper.id = options.id
                
                startNode.parentNode.insertBefore(wrapper, firstPart);
  
                range.setStartAfter(wrapper);
                range.setEndAfter(wrapper);
                sel.removeAllRanges();
                sel.addRange(range);
              }
            }, this.promptControls.selection.sel ? 0:600)

          },
          checkIfFinishWithBlankSpace() {
            if(!$("#prompt").html().endsWith("&nbsp;")) {
              $("#prompt").append("&nbsp;")
            }
          },
          addComponent(type, search = false, label = '') {

            const promptComponentInstance = new Vue({
              render: (h) => h('prompt-component', { props: { type: type, search: search, label: label } })
            });
            
            let id = `prompt-component-${this.uuid()}`

            this.insertContentAfterCursor({ id: id })

            setTimeout(() => {
              promptComponentInstance.$mount(`#${id}`);
              setTimeout(() => {
                this.checkIfFinishWithBlankSpace()
                this.moveCursorToEnd()
                this.updatePromptText()
              }, 300)
            }, 100)
            
            this.promptControls.showOptions = false          
          },
          updatePromptText() {
            let text = $("#prompt").text()
            this.promptControls.text = $("#prompt").text().trim()
          },
          editPrompt() {
            this.promptControls.editing = true
            $("#prompt").click()
            setTimeout(() => {
              $("#prompt").focus()
              $("#prompt").on('keyup click', () => {
                this.getCursorPosition()
              })
            }, 200)
          },
          async checkIfCanAddExamQuestion() {
            return await axios.get(this.examTeacherSubject.urls.canAddExamquestion).then((response) => this.canAddExamQuestion = true).catch(() => this.canAddExamQuestion = false)
          },
          editBaseText(baseText) {
            this.baseText = Object.assign({}, baseText)
            
            tinymce.get('inputBaseTexts').setContent(this.baseText.text)

            this.baseText['updating'] = true
            this.baseText['creating'] = false
            
            this.$forceUpdate()
          },
          saveBaseText() {
            this.baseText.text = tinymce.get('inputBaseTexts').getContent()

            if(this.baseText.title.length && this.baseText.text.length) {
              
              if(this.baseText.urls.api_update) {
                
                axios.patch(this.baseText.urls.api_update, this.baseText).then((response) => {
                  
                  let baseText = this.baseTexts.find((b) => b.id == response.data.id)
                  if(baseText) {
                    baseText.title = response.data.title
                    baseText.text = response.data.text
                    baseText.short_text = response.data.short_text
                  }               

                  this.foundedBaseTexts = Object.assign([], this.baseTexts)
                  
                  this.baseText['creating'] = false
                  this.baseText['updating'] = false

                  this.$forceUpdate()

                }).catch((e) => {
                  
                  this.alertTop('Erro ao tentar atualizar o texto base.', 'error')

                }).finally(() => {
                  
                })

              } else {
                
                axios.post("{% url 'questions:base_text_list_create' %}", this.baseText).then((response) => {
                  this.baseTexts.unshift(response.data)
                  this.handleBaseTextsFunctions()
                  this.foundedBaseTexts = Object.assign([], this.baseTexts)

                  this.baseText['creating'] = false
                  this.baseText['updating'] = false

                }).finally(() => {

                }).catch((e) => {
                  this.alertTop('Erro ao tentar salvar o texto base, certifique-se de que os campos estão preenchidos.', 'error')
                })
              }
            } else {
              this.alertTop('Os campos são obrigatórios.', 'error')
            }
          },
          createBaseText() {
            this.baseText.title = ''
            this.baseText.text = ''
            tinymce.get('inputBaseTexts').setContent('')
            this.baseText.urls = {}
            this.baseText.creating = true
            this.baseText.updating = false
          },
          deleteBaseText(baseText) {
            if(baseText.urls.api_update) {
              Swal.fire({
                title: 'Confirmação?',
                text: "Você confirma que quer remover o texto base selecionado?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sim, Confirmo!',
                cancelButtonText: 'Cancelar'
              }).then((result) => {
                if (result.isConfirmed) {
                  axios.delete(baseText.urls.api_update).then((response) => {
                    this.baseTexts.splice(this.baseTexts.indexOf(this.baseTexts.find(b => b.id == baseText.id)), 1)
                    this.foundedBaseTexts = Object.assign([], this.baseTexts)
                  })
                }
              }) 
            }
          },
          getBaseTexts() {
            return axios.get("{% url 'questions:base_text_list_create' %}").then((response) => {
              this.baseTexts = response.data
              this.handleBaseTextsFunctions()
              this.foundedBaseTexts = Object.assign([], this.baseTexts)
            })
          },
          addBNCC(where, object) {
            if(where == 'competence') {
              this.selectedExamQuestion.question.competences.includes(object.id) ? this.selectedExamQuestion.question.competences.splice(this.selectedExamQuestion.question.competences.indexOf(object.id), 1) : this.selectedExamQuestion.question.competences.push(object.id)
            } else if(where == 'ability') {
              this.selectedExamQuestion.question.abilities.includes(object.id) ? this.selectedExamQuestion.question.abilities.splice(this.selectedExamQuestion.question.abilities.indexOf(object.id), 1) : this.selectedExamQuestion.question.abilities.push(object.id)
            } else {
              this.selectedExamQuestion.question.topics.includes(object.id) ? this.selectedExamQuestion.question.topics.splice(this.selectedExamQuestion.question.topics.indexOf(object.id), 1) : this.selectedExamQuestion.question.topics.push(object.id)
            }
            if(this.selectedExamQuestion.canUpdate()) {
              this.save(where='bnccs')
            }
            this.handleBNCCs()
            this.questionIsValid(this.selectedExamQuestion)
          },
          selectBaseText(baseText) { 
            this.preSelectedBaseTexts.includes(baseText.id) ? this.preSelectedBaseTexts.splice(this.preSelectedBaseTexts.indexOf(baseText.id), 1) : this.preSelectedBaseTexts.push(baseText.id)
          },
          addBaseTexts() {
            if(this.selectedExamQuestion.canUpdate()) {
              axios.patch(this.selectedExamQuestion.question.urls.apiUpdate, { base_texts: this.preSelectedBaseTexts } ).then((response) => {
                this.alertTop("Os textos foram adicionados com sucesso.")
                this.selectedExamQuestion.question.baseTexts = response.data.baseTexts
                this.selectedExamQuestion.question.baseTextsData = response.data.baseTextsData
                $("#modalBaseText").modal("hide")
              }) 
            } else {
              this.selectedExamQuestion.question.baseTexts = this.preSelectedBaseTexts
              $("#modalBaseText").modal("hide")
            }
          },
          searchTopic(term) {
            this.foundedTopics = Object.assign([], this.topics.filter(t => t.name.includes(term)))
          },
          getBNCC() {
            this.getTopics()
            this.getCompetences()
            this.getAbilities()
          },
          getAbilities() {

            let subject = this.selectedExamQuestion.question.subject

            let grade = this.selectedExamQuestion.question.grade

            if(this.selectedExamQuestion.question.pedagogicalData) {
              
              let knowledgeArea = this.selectedExamQuestion.question.pedagogicalData.knowledgeArea
              
              var objectSubject = this.selectedExamQuestion.question.pedagogicalData.subjects.find(function(subject_obj){
                return subject_obj.id == subject
              })
      
              var url = `{% url 'bncc:ability_list_api' %}?`
    
              if(subject) {

                 url += `&subject_in_or_none=${subject}`
              
                 url += `&subject_in_or_none=${subject}`
                 
                 if (objectSubject && objectSubject.parent_subjects){
                   objectSubject.parent_subjects.forEach(function(parent){
                     url += `&subject_in_or_none=${parent}`
                   })
                 }

                if(grade) {
                  url += `&grades=${grade}`
                }
  
                if(knowledgeArea){
                  url += `&knowledge_area=${knowledgeArea}`
                }
  
                axios.get(url).then((response) => {
                  this.abilities = response.data
                  this.foundedAbilities = Object.assign([], this.abilities)
                }).finally(() => {
                  this.handleBNCCs()
                })
              }
            }
          },
          getTopics() {
            if(this.selectedExamQuestion.question.grade && this.selectedExamQuestion.question.subject) {
              let url = `{% url 'subjects:topic_list_api' %}?subject_pk=${this.selectedExamQuestion.question.subject}`
              url += `&subject__in=${this.parentSubjects}`
              url += `&grade=${this.selectedExamQuestion.question.grade}`
              
              axios.get(url).then((response) => {
                this.topics = response.data.map((e) => ({ ...e, expanded: false }))
                this.foundedTopics = Object.assign([], this.topics)
              }).finally(() => {
                this.handleBNCCs()
              })
            }
          },
          getCompetences() {

            let subject = this.selectedExamQuestion.question.subject

            if(this.selectedExamQuestion.question.pedagogicalData) {

              let knowledgeArea = this.selectedExamQuestion.question.pedagogicalData.knowledgeArea
              
              let objectSubject = this.selectedExamQuestion.question.pedagogicalData.subjects.find(function(subject_obj){
                return subject_obj.id == subject
              })  

              var url = `{% url 'bncc:competence_list_api' %}?`
              
              if(subject) {
                
                url += `&subject_in_or_none=${subject}`
                
                if (objectSubject && objectSubject.parent_subjects){
                  objectSubject.parent_subjects.forEach(function(parent){
                    url += `&subject_in_or_none=${parent}`
                  })
                }
                
                if(knowledgeArea) {
                
                  url += `&knowledge_area=${knowledgeArea}`
                
                }
        
                axios.get(url).then((response) => {
  
                    this.competences = response.data.map((e) => ({ ...e, expanded: false }))
                    this.foundedCompetences = Object.assign([], this.competences)
                
                }).finally(() => {
                  this.handleBNCCs()
                })
              }

            }
          },
          goTo(url) {
            window.location.href = url
          },
          goToExamQuestion(examQuestion) {
            if(!this.controls.saving) {
              this.$nextTick().then(() => {
                this.selectedExamQuestion = examQuestion
                setTimeout(() => {
                  this.goTo('#examQuestion-' + this.selectedExamQuestion.id)
                }, 300)
                setTimeout(() => {
                  this.internalStatus = 'idle'
                }, 500)
              })
            }
          },
          showUses() {
            if(this.selectedExamQuestion.question.uses.length) {
              $('#modalUses').modal('show')
            }
          },
          showUsesQuestion(uses) {
            if (uses.length > 0) {
              this.currentUses = uses
              $('#modalCurrentUses').modal('show')
            }
          },
          checkQuestionSelection(question) {
            return this.examTeacherSubject.examQuestions.find((examQuestion) => examQuestion.question.id == question.id || examQuestion.question.sourceQuestion == question.id)
          },
          removeExamQuestionFromQuestionsBank(question) {
            
            this.selectedExamQuestion = this.checkQuestionSelection(question)
            
            let index = this.examTeacherSubject.examQuestions.indexOf(this.selectedExamQuestion)

            this.deleteExamQuestionConfirmation(index)
            
          },
          async addQuestionFromQuestionsBank(question) {
            
            this.controls.addingQuestion = true

            this.selectedExamQuestion.question = question

            this.$forceUpdate()
            
            setTimeout(() => {
              this.save(where='questionsBank')
            }, 300)
          },
          async addNewQuestion() {
            if(this.canAddExamQuestion) {
              this.controls.createQuestion = true
              let newQuestionObject = {
                id: this.uuid(),
                order: this.examTeacherSubject.examQuestions.length,
                createdWithAi: false,
                statusList: [],
                suggestions: {
                  bnccs: {}
                },
                lastStatus: {
                  status: "Rascunho",
                  statusDisplay: "Rascunho",
                  note: ""
                },
                weight: 1,
                canBeRemove: true,
                tinyMCE: {
                  enunciation: null,
                  commentedAwnser: null,
                  feedback: null,
                },
                currentMenu: 'enunciation',
                currentAiMenu: 'before',
                blockWeight: false,
                tooltipMessage: 'É necessário ter pelo menos uma questão desbloqueada.',
                question: {
                    id: this.uuid(),
                    subject: '{{object.teacher_subject.subject.id}}',
                    grade: '{{object.grade.id}}',
                    alternatives: Array.from(
                      { length: this.examTeacherSubject.exam.quantityAlternatives || 5 },
                      (element, index) => {
                        return {
                          id: this.uuid(),
                          text: '',
                          isCorrect: false,
                          tinyMCE: null,
                          urls: {},
                        }
                      }
                    ),
                    pedagogicalData: {
                      segment: '{{object.grade.level}}',
                      grade: '{{object.grade.id}}',
                      knowledgeArea: '{{object.teacher_subject.subject.knowledge_area.id}}',
                      knowledgeAreas: [],
                      subjects: [],
                      grades: [],
                      subject: '',
                    },
                    enunciation: "",
                    commentedAwnser: null,
                    feedback: null,
                    supportContentQuestion: null,
                    category: 1,
                    level: 3,
                    categoryDisplay: "Objetiva",
                    isAbstract: false,
                    baseTexts: [],
                    uses: [],
                    adapted: false,
                    urls: {},
                    topics: [],
                    competences: [],
                    abilities: [],
                    quantityLines: 5,
                    textQuestionFormat: 1,
                    isEssay: false,
                    textCorrection: null,
                    correctionWithCompetencies: false,
                    canBeUpdated: true,
                },
              }

              this.examTeacherSubject.examQuestions.push(newQuestionObject)
      
              this.handleExamQuestionFunctions().then((response) => {
                this.selectedExamQuestion = this.examTeacherSubject.examQuestions[this.examTeacherSubject.examQuestions.length - 1]
                this.editExamQuestion()
              })
            } else {
              this.alertTop('Você atingiu o limite máximo de questões para esta solicitação', 'error')
            }
          },
          questionsBankUrl() {
            {% if user.inspector.skip_introduction_questions_bank %}
              return "{% url 'exams:exam_teacher_subject_add_questions' object.id %}"
            {% else %}
              return "{% url 'exams:teacher-questions-bank-introduction' object.id %}"
            {% endif %}
          },
          handleImprovingControls(improving = true) {
            this.controls.improving.enunciation = improving
            this.controls.improving.commentedAnswer = improving
            this.controls.improving.topics = improving
            this.controls.improving.abilities = improving
            this.controls.improving.competences = improving
          },
          async classifyQuestion(examQuestion) {
            // essa função roda apenas após a criação de uma questão com IA e por isso usa as subjects da solicitação

            await axios.post(examQuestion.question.urls.apiClassifyAbility, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives, grade: this.selectedExamQuestion.question.grade, limit: 5, subjects: [...this.parentSubjects, "{{ object.teacher_subject.subject.id }}"] }).then((response) => {
              const abilities = response.data.abilities
              if(abilities.length){
                abilities.forEach((ability) => {
                  this.addBNCC('ability', ability)
                })
              }
            })
            
            await axios.post(examQuestion.question.urls.apiClassifyCompetence, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives, grade: this.selectedExamQuestion.question.grade, limit: 5, subjects: [...this.parentSubjects, "{{ object.teacher_subject.subject.id }}"] }).then((response) => {
              const competences = response.data.competences
              if(response.data.competences.length){
                
                if(competences.length){
                  competences.forEach((competence) => {
                    this.addBNCC('competence', competence)
                  })
                }
              }
            })
            
            await axios.post(examQuestion.question.urls.apiClassifyTopic, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives, grade: this.selectedExamQuestion.question.grade, limit: 5, subjects: [...this.parentSubjects, "{{ object.teacher_subject.subject.id }}"] }).then((response) => {
              const topics = response.data.topics
              if(response.data.topics.length){
                if(topics.length){
                  topics.forEach((topic) => {
                    this.addBNCC('topics', topic)
                  })
                }
              }
            })
          },
          async improveQuestion(examQuestion) {
            
            this.handleImprovingControls()
            
            let subject = this.selectedExamQuestion.question.subject
            let subjectsList = [subject]
            let objectSubject = this.selectedExamQuestion.question.pedagogicalData.subjects.find((subject_obj) => {
              return subject_obj.id == this.selectedExamQuestion.question.subject
            })
            if (objectSubject && objectSubject.parent_subjects){
              objectSubject.parent_subjects.forEach((parent) => {
                subjectsList.push(parent)
              })
            }

            await axios.post(examQuestion.question.urls.apiClassifyAbility, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives, grade: this.selectedExamQuestion.question.grade, limit: 5, subjects: subjectsList }).then((response) => {
              if(response.data.id) {
                examQuestion.question.improve = response.data
              }
            }).catch(() => {
              this.controls.improving.abilities = false
            }).finally(() => {
              this.controls.improving.abilities = false
            })

            await axios.post(examQuestion.question.urls.apiClassifyCompetence, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives, grade: this.selectedExamQuestion.question.grade, limit: 5, subjects: subjectsList }).then((response) => {
              if(response.data.id) {
                examQuestion.question.improve = response.data
              }
            }).catch(() => {
              this.controls.improving.competences = false
            }).finally(() => {
              this.controls.improving.competences = false
            })
            await axios.post(examQuestion.question.urls.apiClassifyTopic, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives, grade: this.selectedExamQuestion.question.grade, limit: 5, subjects: subjectsList }).then((response) => {
              if(response.data.id) {
                examQuestion.question.improve = response.data
              }
            }).catch(() => {
              this.controls.improving.topics = false
            }).finally(() => {
              this.controls.improving.topics = false
            })
            
            await axios.post(examQuestion.question.urls.apiSolve, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives }).then((response) => {
              if(response.data.id) {
                examQuestion.question.improve = response.data
              }
            }).catch(() => {
              this.controls.improving.commentedAnswer = false
            }).finally(() => {
              this.controls.improving.commentedAnswer = false
            })

            await axios.post(examQuestion.question.urls.apiImprove, { enunciation: examQuestion.question.enunciation, alternatives: examQuestion.question.alternatives }).then((response) => {
              if(response.data.id) {
                examQuestion.question.improve = response.data
              }
            }).catch(() => {
              this.controls.improving.enunciation = false
            }).finally(() => {
              this.getCredits()
              this.controls.improving.enunciation = false
            })

            this.handleImprovingControls(improving = false)
            this.handleResize()
          },
          async getExamTeacherSubjectData() {
            return await axios.get("{{object.urls.api_update}}").then((response) => {

              this.examTeacherSubject = response.data

              this.handleExamQuestionFunctions()

              if(this.examTeacherSubject.examQuestions.length) {
                this.selectedExamQuestion = this.examTeacherSubject.examQuestions[0]
              }
              
            }).finally(() => {
              this.recalculateWeights = false
              this.controls.loading = false
            })
          },
          async changeQuestionCategory(category) {
            
            categories = {
              0: 'Discursiva',
              1: 'Objetiva',
              2: 'Arquivo anexado',
              3: 'Somatório',
              4: 'Preencher lacunas',
            }

            if(this.selectedExamQuestion.canUpdate()) {
              // Chamar API para alterar o tipo da questão
              axios.patch(this.selectedExamQuestion.question.urls.apiUpdate, { category: category }).then((response) => {
                this.selectedExamQuestion.question.category = response.data.category
                this.selectedExamQuestion.question.categoryDisplay = response.data.categoryDisplay
                if(response.data.categoryDisplay == 'Objetiva') {
                  this.selectedExamQuestion.question.alternatives = response.data.alternatives.map((a) => ({ ...a, tinyMCE: null }))
                  setTimeout(() => {

                    this.startTINYMCE(this.selectedExamQuestion)

                  }, 300)
                } 
              })
            } else {
              this.selectedExamQuestion.question.category = category
              this.selectedExamQuestion.question.categoryDisplay = categories[category]
            }
          },
          async startAllTINYMCEInstance() {
            for(examQuestion of this.examTeacherSubject.examQuestions) {
              await this.startTINYMCE(examQuestion)
            }
            this.controls.loading = false
          },
          async duplicateQuestion() {
            let copyQuestionData = {
              examQuestionToCopy: this.selectedExamQuestion.id,
              destinationExam: "{{ object.exam.id }}",
              destinationExamTeacherSubject: "{{ object.id }}",
              duplicateQuestion: true,
              removeOldExamQuestion: true,
            }

            let url = '{% url "exams:exam_question_copy" %}'
            axios.post(url, copyQuestionData).then((res) => {
              this.alertTop('Questão copiada com sucesso!')
              if (document.location.hash.includes("#examQuestion-")) {
                window.location.hash = "#examQuestion-" + res.data
                window.location.reload();
              } else {
                window.location.reload();
              }
            }).catch((e) => {
              this.alertTop(e.response.data, 'error')
              console.error("Erro ao copiar a questão")
            })
          },
          async startTINYMCE(examQuestion, onlyFeedback = false) {
            promises = []
            if(!examQuestion) {
              examQuestion = this.selectedExamQuestion
            }
            let options = {
              ...this.tinyMCEDefaultsSimple,
              inline: false,
              toolbar_location: 'bottom',
              skin_url: "{% static 'tinymce/skins' %}",
    
              {% comment %} paste_preprocess : function ( pl, o) {

                if (o.content.indexOf('<img ') > -1) {
                  const match = o.content.match(/<img[^>]+src="([^">]+)"/);
                  if (match) {
                      const imageUrl = match[1];
                      const allowedDomains = ['fiscallizeremote', 'localhost', 'media/image', 'media/mceu'];

                      if (!allowedDomains.some(domain => imageUrl.includes(domain))) {
                        o.content = o.content.replace(/<img[^>"']*((("[^"]*")|('[^']*'))[^"'>]*)*>/g, "");
                        message = "Atenção, você inseriu uma imagem de um site externo que pode gerar falhas na impressão, baixe a imagem para o seu computador e insira-a como arquivo."
                        Swal.fire({
                          position: 'top-end',
                          text: message,
                          icon: 'error',
                          showConfirmButton: false,
                          timer: 15000,
                          timerProgressBar: true,
                          toast: true,
                      }) 
                      }
                  }
                }
              }, {% endcomment %}
              setup: (editor) => {
                
                editor.on('init', (e) => {
                  editor.settings.resolve()
                })
                editor.on('PastePreProcess', function(e) {
                  if (e.content.indexOf('<img ') > -1) {
                    const match = e.content.match(/<img[^>]+src="([^">]+)"/);
                    if (match) {
                      const imageUrl = match[1];
                      const allowedDomains = ['fiscallizeremote', '.lizeedu.com.br', 'localhost', 'media/image', 'media/mceu', '/../../../media/image-paste-'];
                      if (!allowedDomains.some(domain => imageUrl.includes(domain))) {
                        let formData = new FormData();
                        formData.append('imageUrl', imageUrl);

                        axios.post("{% url 'core:upload_image_paste' %}", formData)
                          .then(response => {
                            let newImageUrl = response.data.location;
                            let node = editor.dom.select('img[src="' + imageUrl + '"]');

                            if (node.length > 0) {
                              editor.selection.select(node[node.length -1]);
                            }              
                            let novoConteudo = `<p><img src="${newImageUrl}"></p>`;

                            editor.selection.setContent(novoConteudo);
                          })
                          .catch(error => {
                            console.error('Erro ao enviar imagem para o backend:', error);
                          });
                        return false;
                      }
                    }
                  }
                });
                // Tab para navegar entre alternativas
                editor.on('keydown', function(event) {
                  if (event.keyCode === 9) {
                    event.preventDefault();
            
                    // Obtém o valor do atributo data-section do editor atual
                    let currentSection = editor.getElement().getAttribute('data-section');
                    
                    // Filtra os editores que pertencem à mesma seção
                    let editors = tinymce.editors.filter(function(ed) {
                      return ed.getElement().getAttribute('data-section') === currentSection;
                    });
            
                    let currentIndex = editors.indexOf(editor); // Index do editor atual
            
                    // Mover para o próximo editor dentro da mesma seção
                    if (currentIndex + 1 < editors.length) {
                      editors[currentIndex + 1].focus();
                    } else {
                      // Se for o último editor na seção, voltar ao primeiro (opcional)
                      editors[0].focus();
                    }
                  }
                });
                  
                editor.on('focus', (e) => {
                  try {
                    if(e.target.settings.examQuestionID) {
                      if(!this.selectedExamQuestion.question.canBeUpdated) {

                        if(this.examTeacherSubject.elaborationExpired) {
                          Swal.fire({
                            title: 'Alerta',
                            html: this.selectedExamQuestion.question.canBeUpdatedReason,
                            icon: 'warning',
                            width: 600,
                            allowOutsideClick: false,
                            confirmButtonText: "Ok",
                            confirmButtonColor: '#FF8E3D',
                            cancelButtonColor: '#3085d6',
                          })

                        } else {

                          Swal.fire({
                            title: 'Alerta',
                            html: this.selectedExamQuestion.question.canBeUpdatedReason,
                            icon: 'warning',
                            width: 600,
                            showCancelButton: true,
                            allowOutsideClick: false,
                            confirmButtonText: 'Duplicar questão',
                            confirmButtonColor: '#FF8E3D',
                            cancelButtonText: 'Cancelar',
                            cancelButtonColor: '#3085d6',
                          }).then((result) => {
                            if (result.isConfirmed) {
                              // Duplicar questão
                              this.duplicateQuestion()
                            } else {
                              return
                            }
                          })
                          
                        }

                      }

                      if(!this.selectedExamQuestion.question.usedAlertData.alertDismissed && this.selectedExamQuestion.question.usedAlertData.isUsed) {
                        Swal.fire({
                          title: 'Alerta',
                          html: `
                          Essa questão está sendo utilizada em outros cadernos, 
                          suas edições serão refletidas em todos eles.<br/><br/> 
                          É possível substituir essa questão por uma cópia única para 
                          realizar edições mais drásticas escolhendo a opção 
                          "Duplicar questão".`,
                          icon: 'warning',
                          width: 600,
                          showCancelButton: true,
                          allowOutsideClick: false,
                          confirmButtonText: 'Continuar mesmo assim',
                          confirmButtonColor: '#3085d6',
                          cancelButtonText: 'Duplicar questão',
                          cancelButtonColor: '#FF8E3D',
                        }).then((result) => {
                          if (result.isConfirmed) {
                            this.selectedExamQuestion.question.usedAlertData.alertDismissed = true
                          } else {
                            this.selectedExamQuestion.question.usedAlertData.alertDismissed = true
                            this.duplicateQuestion()
                          }
                        })
                      }

                      this.selectedExamQuestion = this.examTeacherSubject.examQuestions.find((q) => q.id == e.target.settings.examQuestionID)
                    }
                    this.controls.show = true
                  } catch(e) {
                    //console.error('Não encontrou o examquestion')
                  }
                });
                editor.on('blur change', (e) => {
                  if (e.target.id.includes('questionEnunciation-')) {
                    examQuestion.question.enunciation = tinymce.get(e.target.id).getContent()
                  } else if(e.target.id.includes('alternative-')) {
                    let alternative = examQuestion.question.alternatives.find(a => a.id == e.target.id.split('alternative-')[1])
                    alternative.text = tinymce.get(e.target.id).getContent()                    
                  } else if(e.target.id.includes('commentedAwnser-')) {
                    examQuestion.question.commentedAwnser = tinymce.get('commentedAwnser-' + examQuestion.id).getContent()
                  } else if(e.target.id.includes('feedback-')) {
                    examQuestion.question.feedback = tinymce.get('feedback-' + examQuestion.id).getContent()
                  }  else if(e.target.id.includes('supportContentQuestion-')) {
                    examQuestion.question.supportContentQuestion = tinymce.get('supportContentQuestion-' + examQuestion.id).getContent()
                  }
                  
                }); 
              },
            }
            
            if (onlyFeedback) {
              
              if(!tinymce.get('commentedAwnser-' + examQuestion.id)) {
                
                promises.push(
                  new Promise(resolve => {
                    examQuestion.tinyMCE.commentedAwnser = tinymce.init({
                      ...options, 
                      resolve: resolve,
                      placeholder: "Digite aqui", 
                      toolbar_location: 'bottom', 
                      selector: '#commentedAwnser-' + examQuestion.id, 
                      examQuestionID: examQuestion.id
                    })
                  })
                )
              }
  
              if(!tinymce.get('feedback-' + examQuestion.id)) {
                promises.push(
                  new Promise(resolve => {
                    examQuestion.tinyMCE.commentedAwnser = tinymce.init({
                      ...options, 
                      resolve: resolve,
                      placeholder: "Digite aqui", 
                      toolbar_location: 'bottom', 
                      selector: '#feedback-' + examQuestion.id, 
                      examQuestionID: examQuestion.id
                    })
                  })
                )
              }
              if(!tinymce.get('supportContentQuestion-' + examQuestion.id)) {
                promises.push(
                  new Promise(resolve => {
                    examQuestion.tinyMCE.supportContentQuestion = tinymce.init({
                      ...options, 
                      resolve: resolve,
                      placeholder: "Digite aqui", 
                      toolbar_location: 'bottom', 
                      selector: '#supportContentQuestion-' + examQuestion.id, 
                      examQuestionID: examQuestion.id
                    })
                  })
                )
              }
              
              examQuestion.loading = false

              return examQuestion

            }
            if(!tinymce.get('questionEnunciation-' + examQuestion.id)) {
              promises.push(
                new Promise(resolve => {
                  examQuestion.tinyMCE.enunciation = tinymce.init({ ...options, resolve: resolve, placeholder: "Enunciado...", toolbar: 'custom-toolbar', selector: '#questionEnunciation-' + examQuestion.id, examQuestionID: examQuestion.id })
                })
              )
            }
            
            examQuestion.question.alternatives.forEach((alternative) => {
              if(!tinymce.get('alternative-'+ alternative.id) || !alternative.tinyMCE) {
                promises.push(
                  new Promise(resolve => {
                    alternative.tinyMCE = tinymce.init({ ...options, resolve: resolve, placeholder: "Alternativa...", toolbar: 'custom-toolbar', selector: '#alternative-' + alternative.id, examQuestionID: examQuestion.id })
                  })
                )
              }
            })

            await Promise.all(promises)
            
            examQuestion.loading = false

            return examQuestion

          },
          startTINYMCEBaseTexts() {
            tinymce.init({
              ...this.tinyMCEDefaults,
              skin_url: "{% static 'tinymce/skins' %}",
              placeholder: "Digite o texto base aqui", 
              toolbar_location: 'bottom', 
              selector: '#inputBaseTexts', 
            })
          },
          createStatusQuestion(status) {
            let url = "{% url 'exams:exams_status_question_api_create' pk='00000000-0000-0000-0000-000000000000' %}"
            axios.post(url.replace('00000000-0000-0000-0000-000000000000', this.selectedExamQuestion.id), { status: status, note: '' }).then((response) => {
              
              let object = Object.assign({}, response.data)
              
              object['createdAt'] = response.data.created_at
              object['statusDisplay'] = response.data.status_display
              object['userName'] = response.data.user_name

              this.selectedExamQuestion.statusList.unshift(object)
              this.selectedExamQuestion.lastStatus = object
              
            })
          },
          async updateQuestion(where, skipControlsShow = false) {
            this.handleQuestionBlockedWeight();
            this.controls.saving = true

            if(this.questionIsValid(this.selectedExamQuestion)) {

              let object = this.selectedExamQuestion.question
              object.blockWeight = this.selectedExamQuestion.blockWeight; 
              object.examQuestionId= this.selectedExamQuestion.id; 
              object.weight= this.selectedExamQuestion.weight; 

              if (where == 'bnccs') {
                object = {
                  topics: this.selectedExamQuestion.question.topics,
                  abilities: this.selectedExamQuestion.question.abilities,
                  competences: this.selectedExamQuestion.question.competences,
                }
              }
              
              await axios.patch(this.selectedExamQuestion.question.urls.apiUpdate, object).then((response) => {
                this.alertTop('Questão salva com sucesso')
                this.controls.show = skipControlsShow
                if(this.selectedExamQuestion.lastStatus && this.selectedExamQuestion.lastStatus.statusDisplay == 'Aguardando correção') {
                  this.createStatusQuestion(4) // Chama a API para criar o statusQuestion == CORRECTED
                } else if(this.selectedExamQuestion.lastStatus && this.selectedExamQuestion.lastStatus.statusDisplay == 'Rascunho') {
                  this.createStatusQuestion(2) // Chama a API para criar o statusQuestion == OPENED
                }

              }).catch((error) => {
                this.selectedExamQuestion.errors = {}
                this.selectedExamQuestion.errors = error.response.data
                this.alertTop('Ocorreu um erro ao tentar salvar a questão', 'error')
              }).finally(() => {
                this.controls.saving = false
              })

              if(where != 'bnccs') {
                for(alternative of this.selectedExamQuestion.question.alternatives) {
                  await this.updateAlternative(alternative)
                }
              }
            }

          },
          async updateAlternative(alternative) {
            if(alternative.urls && alternative.urls.apiUpdate) {
              return await axios.patch(alternative.urls.apiUpdate, alternative).then((response) => {
                
              }).catch(() => {
                alternative.isCorrect = !alternative.isCorrect
                this.alertTop('Erro ao tentar salvar a alternativa.', 'error')
              })
            }
          },
          startTippy() {
            const template = document.getElementById('questionCreationTemplate');
            if (template) {
              tippy('.questionCreation', {
                interactive: true,
                animateFill: false,
                content: template.innerHTML,
                allowHTML: true,
              });
            }
          },
          progressPercent() {
            if(this.examTeacherSubject) {
              let unavailableStatus = ['Reprovada']
              let percent = (this.examTeacherSubject.examQuestions.filter(e => !unavailableStatus.includes(e.lastStatus.statusDisplay)).length / Number('{{object.quantity}}') * 100).toFixed(0)
              return percent >= 100 ? 100 : percent
            }
            return 0
          },
          editExamQuestion() {
            this.controls.show = true
            setTimeout(() => {
              this.startTINYMCE(this.selectedExamQuestion)
            }, 300)
          },
          cancel() {
            this.controls.show = false
            if(!this.selectedExamQuestion.canUpdate()) {
              this.examTeacherSubject.examQuestions.pop()
              this.controls.createQuestion = false
              setTimeout(() => {
                this.selectedExamQuestion = this.examTeacherSubject.examQuestions[this.examTeacherSubject.examQuestions.length - 1]
              }, 300)
            }
            setTimeout(() => {
              this.goToExamQuestion(this.selectedExamQuestion)
            }, 200)
          },
          stripHtmlTags(text) {
            text = text.replace(/<[^>]*>/g, '');
            text = text.replace(/[;,]/g, '');
            text = text.replace(/\.\s*$/, '');
            text = text.replace(/\s+$/, '');  
            text = text.replace(/[,\.]/g, ''); 

            return text;
          },
          hasQuestionsDuplicates() {
            const seen = new Set();
            const alternatives = this.selectedExamQuestion.question.alternatives;

            for (let i = 0; i < alternatives.length; i++) {
              const option = alternatives[i];
              const normalizedOption = option.text.toLowerCase();
              const text = this.stripHtmlTags(normalizedOption);text

              if (seen.has(text) && text != "") {
                return true;
              }
              seen.add(text);
              if (i == alternatives.length && seen.has(text)) {
                  return true;
              }
            }
            return false
          },
          hasMoreThanOneCorrectAlternative(){
            let correct = 0;
            const alternatives = this.selectedExamQuestion.question.alternatives;

            if (!(this.selectedExamQuestion.question.categoryDisplay == 'Objetiva')){
              return false
            }

            alternatives.forEach((a) => {
                if(a.isCorrect) {
                  correct += 1
                }
            })

            return correct > 1
          },
          async saveAfterCheckingDuplicateQuestions(where, skipControlsShow = false) {
            if (this.questionIsValid(this.selectedExamQuestion) || ['questionsBank', 'ia'].includes(where)) {
              if (!this.selectedExamQuestion.canUpdate() && this.canAddExamQuestion) {
                this.controls.saving = true;
                this.controls.loadingQuestionCreate = true;
                let examQuestion = this.selectedExamQuestion;
                let question = this.selectedExamQuestion.question;

                if (question.urls.apiUpdate) {
                  question['weight'] = examQuestion['weight'];
                  question['block_weight'] = examQuestion['blockWeight'];
                  this.createExamQuestion(question, where);
                } else {
                  await axios.post("{% url 'questions:questions-list' %}", question).then((response) => {
                    question = response.data;
                    question['block_weight'] = examQuestion['blockWeight'];
                    question['weight'] = examQuestion['weight'];
                    this.createExamQuestion(question, where);
                  }).catch((error) => {
                    this.alertTop('Ocorreu um erro ao tentar adicionar a questão, certifique-se de que você adicionou todas as informações necessárias.', 'error');
                    this.controls.saving = false;
                    this.controls.loadingQuestionCreate = false;
                  })
                }
              
              } else {

                if (where == 'bnccs') {
                  this.updateQuestion(where, skipControlsShow);
                } else {
                  setTimeout(() => {
                    this.goToExamQuestion(this.selectedExamQuestion);
                  }, 200);
                  this.updateQuestion(where = null, skipControlsShow);
                }
                if(where == 'image') {
                  console.log( "")
                }
              }
            }
          },
          async save(where, skipControlsShow = false) {
            if(!this.controls.saving) {
              if (this.canNotAddMultipleCorrectQuestion && this.hasMoreThanOneCorrectAlternative()) {
                 Swal.fire({
                   icon: 'warning',
                   title: 'Mais de uma alternativa correta',
                   text: 'Não é possível cadastrar duas alternativas corretas para uma questão.',
                 })
                 return;
               }
   
               if (this.hasQuestionsDuplicates()) {
                 Swal.fire({
                   icon: 'warning', 
                   title: 'Alternativas iguais',
                   text: 'Atenção! Aparentemente a questão possui 2 ou mais alternativas iguais, certeza que deseja continuar?                ',
                   showCancelButton: true,
                   confirmButtonText: 'Sim, continuar',
                   cancelButtonText: 'Não, corrigir',
                 }).then(async (result) => {
                   if (result.value) {
                     this.saveAfterCheckingDuplicateQuestions(where, skipControlsShow = false);
                   }
                 });
               } else {
                 this.saveAfterCheckingDuplicateQuestions(where, skipControlsShow = false);
               }
            }
          },
          removeQuestion(question) {
            axios.delete(question.urls.apiUpdate).then((response) => {})
          },
          async getExamQuestion(examQuestionID) {
            let url = `{% url 'questions:questions-get-exam-question' pk='00000000-0000-0000-0000-000000000000' %}`.replace('00000000-0000-0000-0000-000000000000', examQuestionID)
            return axios.get(url)
          },
          async createExamQuestion(question, where) {
            this.internalStatus = 'busy'
            url = "{{object.urls.api_create_exam_question}}"
            axios.post(url, question).then((r) => {
              this.getExamQuestion(r.data.id).then((response) => {
                let newExamQuestion = Object.assign({}, this.selectedExamQuestion)
                newExamQuestion.id = response.data.id
                newExamQuestion.lastStatus = response.data.lastStatus
                newExamQuestion.statusList = response.data.statusList
                newExamQuestion['question'] = response.data.question
                newExamQuestion.weight = response.data.weight
                newExamQuestion.blockWeight = response.data.blockWeight

                
                this.handleNewExamQuestion(newExamQuestion).then(() => {
                  if(where == 'ia') {
                    this.classifyQuestion(newExamQuestion)
                    this.resetIAPrompt()
                    $("#modalIAQuestion").modal('hide')
                  } else if(where == 'questionsBank') {
                    this.addNewQuestion()
                  }
                  if (newExamQuestion.blockWeight){
                    this.handleQuestionBlockedWeight();
                  } else {
                    this.handleExamQuestionsWeights()
                  } 

                  this.$nextTick().then(() => {
                    this.goToExamQuestion(this.selectedExamQuestion)
                    this.controls.addingQuestion = false
                    this.controls.createQuestion = false
                  })

                  if(r.data.has_duplicate_enunciation) {
                    Swal.fire({
                      title: 'Questão com enunciado parecido',
                      text: 'Existe outra questão nesse caderno com o enunciado muito parecido.',
                      icon: 'warning',
                      confirmButtonText: 'OK'
                    });
                  }
                  
                }).then(() => {
                  this.examTeacherSubject.examQuestions.forEach((examQuestion) => {
                    this.questionIsValid(examQuestion)
                  })
                })
                this.$refs.notifications.getNotificationAndSet() // Parte importante das notificações.

              }).catch((e) => {

                this.controls.addingQuestion = false
                this.controls.createQuestion = false
                this.internalStatus = 'idle'

              })

            }).catch((error) => {
              
              this.controls.addingQuestion = false
              this.controls.createQuestion = false
              this.internalStatus = 'idle'

              this.removeQuestion(question)

              errorMessage = 'Ocorreu um erro ao adicionar a questão ao caderno, tente novamente e se o erro persistir entre em contato com o suporte.'
              
              if(error.response.status == 401) {
                errorMessage = error.response.data
              }
              
              this.alertTop(errorMessage, 'error', 5000)

            }).finally(() => {
              this.controls.saving = false
              this.controls.show = false
              this.controls.loadingQuestionCreate = false
              this.checkIfCanAddExamQuestion()
            })

          },
          resetIAPrompt() {
            this.generatedQuestion = null
            this.promptControls = Object.assign({}, this.promptControlsDefaults)
            $("#prompt").text('')

          },
          uuid() {
            return "10000000-1000-4000-8000-100000000000".replace(/[018]/g, c =>
              (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
            );
          },
          addAlternative() {
            if(this.selectedExamQuestion.question.alternatives.length < 7) {
              this.selectedExamQuestion.question.alternatives.push({
                  id: this.uuid(),
                  isNew: true,
                  text: "",
                  isCorrect: false,
                  tinyMCE: null,
              })
              setTimeout(() => {
                this.startTINYMCE(this.selectedExamQuestion)
              }, 300)
            } else {
              this.alertTop("Você já adicionou o máximo de alternativas para questões do tipo somatório", 'error')
            }
          },
          async deleteAlternative(alternative, index) {
            
            if(alternative.isCorrect) {
              Swal.fire({
                icon: 'warning', 
                title: 'Informação',
                text: 'Não é possível deletar alternativas marcadas como correta, desmarque a alternativa e tente novamente.'
              })
              return
            }
            
            this.controls.removingAlternative = true

            if (alternative.urls && alternative.urls.apiUpdate) {
              axios.delete(alternative.urls.apiUpdate).then((response) => {
                this.$nextTick().then(() => {
                  for(a of this.selectedExamQuestion.question.alternatives) {
                    if(tinyMCE.get('alternative-'+ a.id)) tinyMCE.get('alternative-'+ a.id).remove();
                  }
                }).then(() => {
                  this.selectedExamQuestion.question.alternatives.splice(index, 1)
                }).then(() => {
                  this.$nextTick().then(() => {
                    for(a of this.selectedExamQuestion.question.alternatives) {
                      $('#alternative-'+ a.id).val(a.text)
                    }
                    this.selectedExamQuestion.question.alternatives.forEach((a) => {
                    })
                  }).then(() => {
                    this.startTINYMCE(this.selectedExamQuestion)
                  })
                })
              }).catch((e) => {
                this.alertTop("Não foi possível remover a alternativa, certifique-se de que não há resposta associada e tente novamente.", "error", 4000)
              }).finally(() => {
                this.controls.removingAlternative = false
              })
            } else {
              this.selectedExamQuestion.question.alternatives.forEach((a) => {
                if(tinyMCE.get('alternative-'+ a.id)) tinyMCE.get('alternative-'+ a.id).remove();
              })
              setTimeout(() => {
                this.selectedExamQuestion.question.alternatives.splice(index, 1)
              }, 100)
              setTimeout(() => {
                this.selectedExamQuestion.question.alternatives.forEach((a) => {
                  $('#alternative-'+ a.id).val(a.text)
                })
              }, 200)
              setTimeout(() => {
                this.startTINYMCE(this.selectedExamQuestion)
                this.controls.removingAlternative = false
              }, 300)
            } 
          },
          setAlternativeIsCorrect(alternative) {
            if(this.selectedExamQuestion.question.categoryDisplay == 'Somatório' && !alternative.isCorrect) {
              let sum = this.selectedExamQuestion.question.alternatives.reduce((total = 0, _alternative, alternativeIndex) => total += (_alternative.isCorrect && _alternative != alternative ? 2 ** alternativeIndex : 0), 0)
              sum += 2 ** this.selectedExamQuestion.question.alternatives.indexOf(this.selectedExamQuestion.question.alternatives.find(_a => _a.id == alternative.id))
              if(sum > 99) {
                this.alertTop('O total das alternativa deve ser menor que 99', 'error')
                return
              }
            }
            alternative.isCorrect = !alternative.isCorrect
            this.updateAlternative(alternative)
          },
          handleOnStartedTinyMCEInputs() {
            for (examQuestion of this.examTeacherSubject.examQuestions.filter((e) => e.tinyMCE.enunciation)) {
              // Remove as instância do tinymce
              if (tinyMCE.get('questionEnunciation-'+ examQuestion.id)) tinyMCE.get('questionEnunciation-'+ examQuestion.id).remove();
              if (tinyMCE.get('commentedAwnser-'+ examQuestion.id)) tinyMCE.get('commentedAwnser-'+ examQuestion.id).remove();
              if (tinyMCE.get('feedback-'+ examQuestion.id)) tinyMCE.get('feedback-'+ examQuestion.id).remove();
              if (tinyMCE.get('supportContentQuestion-'+ examQuestion.id)) tinyMCE.get('supportContentQuestion-'+ examQuestion.id).remove();

              
              // Reseta os atributos
              if(['Objetiva', 'Somatório'].includes(examQuestion.question.categoryDisplay)) {
                for (alternative of examQuestion.question.alternatives) {
                  alternative.tinyMCE = null
                  if(tinyMCE.get('alternative-'+ alternative.id)) tinyMCE.get('alternative-'+ alternative.id).remove();
                }
              }
              examQuestion.tinyMCE = { enunciation: null, commentedAwnser: null, feedback: null, supportContentQuestion: null }
              
              this.$nextTick().then(() => {
                this.startTINYMCE(examQuestion)
              })
            }
          },
          async deleteExamQuestion(examQuestionID) {
            url  = "{% url 'exams:api-exam-delete-exam-question' pk='00000000-0000-0000-0000-000000000000' %}"
            this.recalculateWeights = true
            return axios.post(url.replace('00000000-0000-0000-0000-000000000000', examQuestionID))
          },
          isLastUnlockedQuestion(index) {
            let blockWeightLength = this.examTeacherSubject.examQuestions.filter(q => q.blockWeight).length;
            let totalQuestions = this.examTeacherSubject.examQuestions.length;
            let selectedExamQuestion = this.examTeacherSubject.examQuestions.at(index).blockWeight;
            if (this.examTeacherSubject && blockWeightLength === totalQuestions - 1 && totalQuestions != 1 && !selectedExamQuestion) {
              Swal.fire({
                title: 'Atenção',
                text: "Precisa ter ao menos uma questão com a nota destravada. Caso queira travar a nota desta questão, destrave outra.",
                icon: 'warning',
                confirmButtonColor: '#3085d6',
                confirmButtonText: 'OK'
              });
          
              return true;
            }
            return false; 
          },
          async deleteExamQuestionConfirmation(index) {
            if (!this.isLastUnlockedQuestion(index)) {
              Swal.fire({
                title: 'Confirmação?',
                text: "Você confirma que quer remover esta questão do caderno?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Sim, Confirmo!',
                cancelButtonText: 'Cancelar'
              }).then((result) => {
                if (result.isConfirmed) {
                  this.controls.removingQuestion = true;
          
                  this.deleteExamQuestion(this.selectedExamQuestion.id).then((response) => {
                    this.$nextTick().then((response) => {
                      this.examTeacherSubject.examQuestions.splice(index, 1);
          
                      this.$nextTick().then((response) => {
                        if (this.examTeacherSubject.examQuestions.length) {
                          let nextExamQuestion = this.examTeacherSubject.examQuestions.at(index) ? this.examTeacherSubject.examQuestions.at(index) : this.examTeacherSubject.examQuestions.at(0);
          
                          this.goToExamQuestion(nextExamQuestion);
                          this.handleOnStartedTinyMCEInputs();
                        } else {
                          this.addNewQuestion();
                        }
          
                        this.alertTop('Questão removida do caderno.');
                        this.controls.removingQuestion = false;
          
                        this.handleExamQuestionsWeights();
                      });
                    });
                  }).catch((error) => {
                    if (error.response.status === 401) {
                      this.alertTop(error.response.data, 'error');
                      return;
                    }
                    this.alertTop('Ocorreu um erro ao remover a questão do caderno, tente novamente e se o erro persistir entre em contato com o suporte.', 'error');
                  }).finally(() => {
                    this.$nextTick().then((response) => {
                      this.controls.show = false;
          
                      if (!this.examTeacherSubject.examQuestions.length) {
                        this.addNewQuestion();
                      }
          
                      this.checkIfCanAddExamQuestion();
                    });
                  });
                }
              });
            }
          },
          async fetchGrades(level, reset = false){
            
            if(reset) {
              this.selectedExamQuestion.question.pedagogicalData.knowledgeAreas = []
              this.selectedExamQuestion.question.pedagogicalData.subjects = []
            }

            if(level || level === 0) {
              
              let url = `{% url 'classes:grade_list_api' %}?level=${level}`
              return axios.get(url).then((response) => {
                this.selectedExamQuestion.question.pedagogicalData.grades = response.data
              })
            } else {
              //this.resetpedagogicalData()
            }
          },
          async fetchKnowledgeArea(grade, reset = false) {

            if(reset) {
              this.selectedExamQuestion.question.pedagogicalData.subjects = []
              this.selectedExamQuestion.question.pedagogicalData.knowledgeAreas = []
              this.selectedExamQuestion.question.subject = ''
              this.selectedExamQuestion.question.pedagogicalData.knowledgeArea = ''
            }
            
            if(grade) {
              let url = `{% url 'subjects:knowledge_area_list_api' %}?grades=${grade}`
              return axios.get(url).then((response) => {
                this.selectedExamQuestion.question.pedagogicalData.knowledgeAreas = response.data
              })
            } else {
              //this.resetPedagogicalData()
            }
          },
          async fetchSubject(knowledgeArea) {

            this.selectedExamQuestion.question.pedagogicalData.subjects = []

            if(knowledgeArea) {
              let url = `{% url 'subjects:subject_list_api' %}?knowledge_area=${knowledgeArea}`
              return axios.get(url).then((response) => {
                this.selectedExamQuestion.question.pedagogicalData.subjects = response.data
              })
            }
          },
          questionIsValid(examQuestion) {
            examQuestion.errors = {}
            {% if user.is_freemium %}
              return true
            {% endif %}
            if(tinymce.get("questionEnunciation-" + examQuestion.id) ? !tinymce.get("questionEnunciation-" + examQuestion.id).getContent().length : (!examQuestion.question.enunciation || !examQuestion.question.enunciation.length)) {
              examQuestion.errors['enunciation'] = ['O enunciado da questão é um campo obrigatório']
            }
            const Question = {
                TEXTUAL: 0,
                CHOICE: 1,
                FILE: 2,
                SUM_QUESTION: 3,
            }
            if ([Question.CHOICE, Question.SUM_QUESTION].includes(examQuestion.question.category) && this.examTeacherSubject.exam.quantityAlternatives && this.examTeacherSubject.exam.quantityAlternatives !== examQuestion.question.alternatives.length) {
              examQuestion.errors['alternatives'] = ['A quantidade de alternativas deve ser igual a ' + this.examTeacherSubject.exam.quantityAlternatives + '.']
            }

            if(this.clientTeacherObligation.commentedResponse && (tinymce.get("commentedAwnser-" + examQuestion.id) ? !tinymce.get("commentedAwnser-" + examQuestion.id).getContent().length : (!examQuestion.question.commentedAwnser || !examQuestion.question.commentedAwnser.length))) {
              examQuestion.errors['commentedAwnser'] = ['O campo resposta comentada é obrigatório']
            }

            if(this.clientTeacherObligation.template && examQuestion.question.categoryDisplay == 'Objetiva' && !examQuestion.question.alternatives.some((alternative) => alternative.isCorrect)) {
              examQuestion.errors['alternatives'] = ['Você precisa marcar pelo menos uma das alternativas como correta']
            }

            if(this.clientTeacherObligation.difficult && examQuestion.question.level == 3) { // 3 = é Indefinido
              examQuestion.errors['level'] = ['Você precisa selecionar a dificuldade da questão']
            }

            if(this.clientTeacherObligation.pedagogicalData && !examQuestion.question.subject) {
              examQuestion.errors['subject'] = ['Você precisa selecionar a disciplina da questão.']
            }

            if(this.clientTeacherObligation.topics && !examQuestion.question.topics.length) {
              examQuestion.errors['topics'] = ['Você deve selecionar pelo menos um assunto.']
            }

            if(this.clientTeacherObligation.competences && !examQuestion.question.competences.length) {
              examQuestion.errors['competences'] = ['Você deve selecionar pelo menos uma competência.']
            }

            if(this.clientTeacherObligation.abilities && !examQuestion.question.abilities.length) {
              examQuestion.errors['abilities'] = ['Você deve selecionar pelo menos uma habilidade.']
            }

            if(Object.keys(examQuestion.errors).length === 0) {
              return true
            } else {
              examQuestion.errors['invalid'] = true
              return false
            }
              
          },
          async handleExamQuestionsWeights() {
            return await axios.get(this.examTeacherSubject.urls.apiExamquestionsWeights).then((response) => {
              for(examQuestion of this.examTeacherSubject.examQuestions) {
                let f = response.data.find((e) => e.id == examQuestion.id)
                if(f) {
                  examQuestion.weight = f.weight.toFixed(4)
                }
              }
            })
          },
          async handleNewExamQuestion(newExamQuestion) {
            return await new Promise((resolve) => {
              let oldExamQuestion = this.examTeacherSubject.examQuestions.at(this.examTeacherSubject.examQuestions.length - 1)

              this.$nextTick().then(() => {
                tinymce.get('questionEnunciation-'+ oldExamQuestion.id).remove();
              }).then(() => {
                for(a of oldExamQuestion.question.alternatives) {
                  if(tinyMCE.get('alternative-'+ a.id)) tinyMCE.get('alternative-'+ a.id).remove();
                }
              }).then(() => {
                delete oldExamQuestion
                this.examTeacherSubject.examQuestions.pop()
              }).then(() => {
                this.examTeacherSubject.examQuestions.push(newExamQuestion)
              }).then(() => {
                this.handleExamQuestionFunctions().then((response) => {
                  this.selectedExamQuestion = this.examTeacherSubject.examQuestions.find(examQuestion => examQuestion.id == newExamQuestion.id)
                  resolve()
                })
              })
            })
          },
          handleBNCCs() {
            setTimeout(() => {
              this.foundedTopics = this.foundedTopics.sort((a) => false - this.selectedExamQuestion.question.topics.includes(a.id))
              this.foundedAbilities = this.foundedAbilities.sort((a) => false - this.selectedExamQuestion.question.abilities.includes(a.id))
              this.foundedCompetences = this.foundedCompetences.sort((a) => false - this.selectedExamQuestion.question.competences.includes(a.id))
            }, 300)
          },
          handleBaseTextsFunctions() {
            this.baseTexts = this.baseTexts.map((b) => ({ ...b, expanded: false }))
          },
          handleExamQuestionsOrders() {
            this.examTeacherSubject.examQuestions = this.examTeacherSubject.examQuestions.sort((a, b) => a.order - b.order)
          },
          async handleExamQuestionFunctions() {
            return await new Promise((resolve) => {
              this.examTeacherSubject.examQuestions = this.examTeacherSubject.examQuestions.map((examQuestion) => ({ 
                ...examQuestion, 
                errors: {}, 
                suggestions: { bnccs: {} }, canUpdate: () => examQuestion.question.urls && examQuestion.question.urls.apiUpdate ? true:false,
                showOptions: false, 
                loading: true, 
                tinyMCE: { enunciation: null, commentedAwnser: null, feedback: null, supportContentQuestion: null }, 
                currentMenu: 'enunciation', 
                currentAiMenu: 'before'
              }))
              
              this.examTeacherSubject.examQuestions.forEach((e) => {
                
                e.question['usedAlertData'] = {
                  isUsed: false,
                  alertDismissed: false,
                }

                e.question.uses.forEach((use) => {
                  if(use.examId != "{{ object.exam.id}}") {
                    e.question.usedAlertData.isUsed = true
                  }
                })

                e.question.alternatives.map((a) => ({ ...a, tinyMCE: null }))
              })

              setTimeout(() => {
                resolve(this.examTeacherSubject.examQuestions)
                this.handleTinyMCENotStarted()
              }, 1000)
            })
          },
          handleTinyMCENotStarted() {
            for(e of this.examTeacherSubject.examQuestions) {
              if(e.tinyMCE.enunciation && !tinymce.get('questionEnunciation-'+ e.id)) {
                this.startTINYMCE(e)
                return
              }
              if(e.question.alternatives.length && e.question.alternatives[0].tinyMCE && !tinymce.get('alternative-'+ e.question.alternatives[0].id)) {
                this.startTINYMCE(e)
              }
            }
          },
          async handlePedagogicalData() {
            setTimeout(() => {
              if(this.selectedExamQuestion.question.pedagogicalData) {
                this.fetchGrades(this.selectedExamQuestion.question.pedagogicalData.segment).finally(() => {
                  this.fetchKnowledgeArea(this.selectedExamQuestion.question.grade).finally(() => {
                    this.fetchSubject(this.selectedExamQuestion.question.pedagogicalData.knowledgeArea)
                  }) 
                })
              }
            }, 300)
          },
          handleResize() {
            setTimeout(() => {
              if(this.selectedExamQuestion && this.selectedExamQuestion.id) {
                let firstQuestion = $(`[data-question="${this.selectedExamQuestion.id}"]`).first()
                if(firstQuestion.length) {
                  this.floatMenu.left = $(firstQuestion).offset().left - 50
                  this.floatMenu.top = window.innerHeight / 4
                }
              }
            }, 200)

            $(window).on('resize', () => {
              if(this.selectedExamQuestion && this.selectedExamQuestion.id) {
                let firstQuestion = $(`[data-question="${this.selectedExamQuestion.id}"]`).first()
                if(firstQuestion.length) {
                  this.floatMenu.left = $(firstQuestion).offset().left - 50
                  this.floatMenu.top = window.innerHeight / 4
                }
              }
            })
          },
          handleCustomToolbarEvents() {
            // Adicione funcionalidade aos botões personalizados
            $('.custom-toolbar-undo').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('Undo');
            });
          
            $('.custom-toolbar-redo').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('Redo');
            });
          
            $('.custom-toolbar-image').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('mceImage');
            });

            $('.custom-toolbar-media').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('mceMedia');
            });
            
            $('.custom-toolbar-indent').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('Indent');
            });

            $('.custom-toolbar-outdent').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('Outdent');
            });

            $('.custom-toolbar-superscript').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('Superscript');
            });

            $('.custom-toolbar-subscript').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('Subscript');
            });

            $('.custom-toolbar-numlist').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('InsertOrderedList');
            });

            $('.custom-toolbar-bullist').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('InsertUnorderedList');
            });
            
            $('.custom-toolbar-tiny_mce_wiris').off('click').on('click', () => {
              window.WirisPlugin.currentInstance.openNewFormulaEditor()
            });

            $('.custom-toolbar-clearformat').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('removeformat');
            });
            
            $('.custom-toolbar-mceInsertTable').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('mceInsertTable');
            });

            $('.custom-toolbar-insertHorizontalRule').off('click').on('click', () => {
              tinymce.activeEditor.execCommand('InsertHorizontalRule');
            });
          },
          alertTop(text, icon = 'success', timer = 1500) {
            Swal.fire({
                position: 'top-end',
                text: text,
                icon: icon,
                showConfirmButton: false,
                timer: timer,
                timerProgressBar: true,
                toast: true,
            })
          },
          startScrollBarFunctions() {
            let bar = $("#questionsScrollBar")
            let maxScroll  = bar[0].scrollHeight - bar.outerHeight()
            
            bar.on('scroll', (e) => {
              let currentScroll = bar.scrollTop()
              if(currentScroll > 0) {
                this.controls.scrollBar.hasUp = true
              } else {
                this.controls.scrollBar.hasUp = false
              }
              if(currentScroll >= maxScroll) {
                this.controls.scrollBar.hasDown = false
              } else {
                this.controls.scrollBar.hasDown = true
              }
            })
          },
          scrollBarMoviment(value) {
            let bar = $("#questionsScrollBar")
            bar.scrollTop(bar.scrollTop() + value)
          },
          getSugestionTags() {
            axios.get("{% url 'questions:questions-sugestion-tags' %}").then((response) => {
              this.sugestionTags = response.data
            })
          },
          createWithIA() {
            if(!Boolean(`{{user.is_freemium|default:''}}`) || this.credits.canCreateAiQuestion) {
              if(this.canAddExamQuestion) {
                
                if(!this.selectedExamQuestion || this.selectedExamQuestion.canUpdate()) {
                  this.addNewQuestion()
                }
  
                $("#modalIAQuestion").modal('show')
              }
            } else {
              if(!this.credits.canCreateAiQuestion) {
                this.openWaitingListModal()
              }
            }
          },
          createWithQuestionsBank() {
            this.getBoards()
            this.getKnowledgeAreas()
            this.applyFiltersAndGetSubjects()

            if(this.canAddExamQuestion) {
              if(!this.selectedExamQuestion || this.selectedExamQuestion.canUpdate()) {
                this.addNewQuestion()
              }
              $("#modalQuestionsBank").modal('show')
            }
            setTimeout(() => {
              if (this.questionsBankControls.statusQuantityOfQuestions == 'success'){
                this.questionsBankControls.subjects.forEach(subject => {
                  if (subject.id === this.requestSubject) {
                    subject.checked = true;
                  }
                });
                this.getAndShowQuestions()
              }
            }, 1000);
          },
          createWithFile() {

            $("#modalImportQuestionWithFile").modal('show')

          },
          generateAlternativeLetter(index){
            return "abcdefghij"[index]
          },
          generateAlternativeSum(index){
            return String(2 ** index)
          },
          // QUESTIONS BANK METHODS
          async getInitialSubjects() {
            let selectedSubjects = []
            if (this.questionsBankControls.subjects.length > 0) {
              selectedSubjects = this.questionsBankControls.subjects.filter(subject => subject.checked).map(subject => subject.id);
            }

            this.questionsBankControls.status = 'loading';

            try {
              const res = await fetch(`{% url 'api:subject-tree-list-view' %}?${this.questionsBankControls.params}`);
              const data = await res.json();
              this.questionsBankControls.subjects = data.map((item) => {
                return { ...item, children: [], status: 'idle', subjectName: item.subject_name, isRelatedToUser: item.is_related_to_user, requestSubject: false };
              });
              this.questionsBankControls.subjects.forEach(subject => {
                if (selectedSubjects.includes(subject.id)) {  
                  subject.checked = true;
                }
                if (subject.id === this.requestSubject) {
                  subject.requestSubject = true;
                }
              });
              this.questionsBankControls.status = 'success';
            } catch (err) {
              console.error(err);
              this.questionsBankControls.status = 'error';
            }

          },
          async getMoreSubjects() {

            this.questionsBankControls.status = 'loading';

            try {
              const res = await fetch(`{% url 'api:subject-tree-list-view' %}?${this.questionsBankControls.params}`);
              const data = await res.json();
              this.subjectsAfterInit = data.map((item) => {
                return { ...item, children: [], status: 'idle', subjectName: item.subject_name, isRelatedToUser: item.is_related_to_user };
              });
              this.questionsBankControls.status = 'success';
            } catch (err) {
              console.error(err);
              this.questionsBankControls.status = 'error';
            }

          },
          getSeparatedItems() {
            this.questionsBankControls.subjects.forEach((subject) => {
              subject.children.forEach((theme) => {
                if(theme.model == 'Theme') {
                  this.questionsBankControls.themes.push(theme)
                } else if(theme.model == 'MainTopic') {
                  this.questionsBankControls.mainTopics.push(theme)
                } else if(theme.model == 'Topic') {
                  this.questionsBankControls.topics.push(theme)
                }
                theme.children.forEach((mainTopic) => {
                  if(mainTopic.model == 'MainTopic') {
                    this.questionsBankControls.mainTopics.push(mainTopic)
                  } else if(mainTopic.model == 'Topic') {
                    this.questionsBankControls.topics.push(mainTopic)
                  }
                  mainTopic.children.forEach((topic) => {
                    if(topic.model == 'MainTopic') {
                      this.questionsBankControls.mainTopics.push(topic)
                    } else if(topic.model == 'Topic') {
                      this.questionsBankControls.topics.push(topic)
                    }
                  })
                })
              })
            })
          },
          getSelectedLabels() {
            this.getSeparatedItems()
            this.questionsBankControls.onlySelectedItems = []
    
            items = []
    
            this.questionsBankControls.subjects.forEach((subject) => {
              if(this.checkIfCanIncludeInParams(subject)) {
                if (subject.model == 'Subject') {
                  items.push(this.getItem(subject.id, 'Subject'))
                }
              } else {
                // Themes
                subject.children.forEach((theme) => {
                  if(this.checkIfCanIncludeInParams(theme)) {
                    if(theme.model == 'Theme') {
                      items.push(this.getItem(theme.id, 'Theme'))
                    } else if(theme.model == 'MainTopic') {
                      items.push(this.getItem(theme.id, 'MainTopic'))
                    } else if(theme.model == 'Topic') {
                      items.push(this.getItem(theme.id, 'Topic'))
                    }
                  } else {
                    // MainTopics
                    theme.children.forEach((mainTopic) => {
                      if(this.checkIfCanIncludeInParams(mainTopic)) {
                        if(mainTopic.model == 'MainTopic') {
                          items.push(this.getItem(mainTopic.id, 'MainTopic'))
                        } else if(mainTopic.model == 'Topic') {
                          items.push(this.getItem(mainTopic.id, 'Topic'))
                        }
                      } else {
                        // Topic
                        mainTopic.children.forEach((topic) => {
                          if(this.checkIfCanIncludeInParams(topic)) {
                            items.push(this.getItem(topic.id, 'Topic'))
                          }
                        })
                      }
                    })
                  }
                })
              }
            })
            this.questionsBankControls.onlySelectedItems = items
          },
          generateUrlParams() {
            params = ''
            self = this
            this.questionsBankControls.subjects.forEach((subject) => {
              if(this.checkIfCanIncludeInParams(subject)) {
                if (subject.model == 'Subject') {
                  params += `&subjects=${subject.id}`
                } else if(subject.model == 'Theme') {
                  params += `&themes=${subject.id}`
                } else if(subject.model == 'MainTopic') {
                  params += `&main_topics=${subject.id}`
                } else if(subject.model == 'Topic') {
                  params += `&topics=${subject.id}`
                }
              } else {
                subject.children.forEach((theme) => {
                  if(this.checkIfCanIncludeInParams(theme)) {
                    if(theme.model == 'Theme') {
                      params += `&themes=${theme.id}`
                    } else if(theme.model == 'MainTopic') {
                      params += `&main_topics=${theme.id}`
                    } else if(theme.model == 'Topic') {
                      params += `&topics=${theme.id}`
                    }
                  } else {
                    theme.children.forEach((mainTopic) => {
                      if(this.checkIfCanIncludeInParams(mainTopic)) {
                        if(mainTopic.model == 'MainTopic') {
                          params += `&main_topics=${mainTopic.id}`
                        } else if(mainTopic.model == 'Topic') {
                          params += `&topics=${mainTopic.id}`
                        }
                      } else {
                        mainTopic.children.forEach((topic) => {
                          if(this.checkIfCanIncludeInParams(topic)) {
                            params += `&topics=${topic.id}`
                          }
                        })
                      }
                    })
                  }
                })
              }
            })
            if('{{ request.GET.urlencode|safe }}') {
              params += '&{{ request.GET.urlencode|safe }}' 
            }
    
            params += `&segment=${self.selectedSegment}`

            //params += `&segment=0`
            if (!this.controls.moreSubjectsBank)
              params +=`&request_subject=${self.requestSubject}`
            this.questionsBankControls.params = `${params + this.generateFiltersParams()}`.replace("//", "/").replace("?&", "?").replace("&&", "&")
            
          },
          changeSegment(segment){
            this.selectedSegment = segment
            this.applyFiltersAndGetSubjects()
            this.updateSubjectsVisualList()
          },
          generateFiltersParams() {

            let params = ""
            
            this.questionsBankControls.advancedFilters.questionsCategory.items.forEach(item => params += `&q_category=${item}`)
            this.questionsBankControls.advancedFilters.questionsDifficult.items.forEach(item => params += `&q_level=${item}`)
            this.questionsBankControls.advancedFilters.grade.items.forEach(item => params += `&q_grade=${item}`)
            this.questionsBankControls.advancedFilters.board.items.forEach(item => params += `&q_board=${item}`)
            this.questionsBankControls.advancedFilters.knowledgeArea.items.forEach(item => params += `&q_knowledge_area=${item.knowledgeAreaId}`)
            if(this.questionsBankControls.advancedFilters.enunciation.search) {
              params += `&q_enunciation_search=${this.questionsBankControls.advancedFilters.enunciation.search}`
            }
            if(this.questionsBankControls.advancedFilters.alternatives.search) {
              params += `&q_alternatives_search=${this.questionsBankControls.advancedFilters.alternatives.search}`
            }

            this.questionsBankControls.advancedFilters.elaborationStartYear.items.forEach(item => params += `&start_year=${item}`)

            this.questionsBankControls.advancedFilters.elaborationEndYear.items.forEach(item => params += `&end_year=${item}`)
            
            if (this.controls.onlyMyQuestions) {
              params += `&only_my_questions=true`
            }
            
            return params
          },
          getItem(id, model) {
            if(model == 'Subject') {
              return this.questionsBankControls.subjects.find(subject => subject.id == id)
            } else if(model == 'Theme') {
              return this.questionsBankControls.themes.find(theme => theme.id == id)
            } else if(model == 'MainTopic') {
              return this.questionsBankControls.mainTopics.find(mainTopic => mainTopic.id == id)
            } else {
              return this.questionsBankControls.topics.find((topic) => topic.id == id)
            }
          },
          checkIfCanIncludeInParams(item) {
            if (item) {
              return item.checked && !item.children.some((c) => !c.checked)
            }
            return false
          },
          async getQuantityOfQuestions() {
            this.questionsBankControls.statusQuantityOfQuestions = 'loading';
            try {
              const res = await fetch(`{% url 'api2:count-questions' %}?${this.questionsBankControls.params}`);
              const data = await res.json();
              if (!res.ok) throw data;
              this.questionsBankControls.quantityOfQuestions = data.count;
              this.questionsBankControls.statusQuantityOfQuestions = 'success';
            } catch (err) {
              console.error(err);
              this.questionsBankControls.statusQuantityOfQuestions = 'error';
            }
          },
          checkItems(item, value) {
            item.checked = value;
            if (item.children.length > 0) {
              item.children.forEach((child) => {
                this.checkItems(child, value);
              });
            }
            this.getSelectedLabels();
          },
          getItemChecked() {
            const checkedItems = [];
            this.questionsBankControls.subjects.forEach(child => {
              if (child.leaf && child.checked) {
                checkedItems.push(child);
              } else if (child.children.length) {
                child.children.forEach(child => {
                  if (child.leaf && child.checked) {
                    checkedItems.push(child);
                  } else if (child.children.length) {
                    child.children.forEach(child => {
                      if (child.leaf && child.checked) {
                        checkedItems.push(child);
                      } else if (child.children.length) {
                        child.children.forEach(child => {
                          if (child.leaf && child.checked) {
                            checkedItems.push(child);
                          }
                        })
                      }
                    })
                  }
                })
              }
            });
            this.questionsBankControls.selectedItems = checkedItems;
          },
          async getDataRelated(item) {
            try {
              const res = await fetch(`/api/v1/subjects/tree/${item.id}/?app=subjects&cls=${item.model}`);
              const data = await res.json();
              if (!res.ok) throw data;
              return data.map((item) => {
                return { ...item, children: [], status: 'idle', subjectName: item.subject_name };
              });
            } catch (err) {
              throw err;
            }
          },
          async handleTree(clickedItem) {
            try {
              clickedItem.status = 'loading';
              clickedItem.expanded = !clickedItem.expanded;
              if (clickedItem.children.length === 0) {
                const data = await this.getDataRelated(clickedItem);
                clickedItem.children = data;
    
                this.checkItems(clickedItem, clickedItem.checked);
                this.getItemChecked();
              }
              clickedItem.status = 'success';
            } catch (err) {
              console.error(err);
              clickedItem.status = 'error';
            }
          },
          handleGetQuestions() {
            const DEBOUNCE_DELAY = 1000; // milliseconds
            clearTimeout(this.debounceTimeout);
            this.debounceTimeout = setTimeout(() => {
              this.questionsBankControls.questions = {};
              this.questionsBankControls.loadQuestions = true;
              this.generateUrlParams();
              this.getQuantityOfQuestions();
              this.getQuestions();
              this.controls.showAdvancedFilters = false;
            }, DEBOUNCE_DELAY);
          },
          getChecked(item) {
            this.checkItems(item, item.checked);
            this.getItemChecked();
            // this.generateUrlParams();
            // this.getQuantityOfQuestions();
            this.handleGetQuestions();
          },
          getCheckedLevelTwo(item, parent) {
            this.checkItems(item, item.checked);
    
            if (
              parent.children.some(child => child.checked)
              && !parent.children.every(child => child.checked)
            ) {
              parent.indeterminate = true;
            } else {
              parent.indeterminate = false;
            }
    
            if (parent.children.every(child => child.checked)) {
              parent.checked = true;
            } else if (parent.children.every(child => !child.checked)) {
              parent.checked = false;
            }
    
            this.getItemChecked();
            // this.generateUrlParams();
            // this.getQuantityOfQuestions();
            this.handleGetQuestions();
          },
          getCheckedLevelThree(item, parent, grandParent) {
            this.checkItems(item, item.checked);
    
            if (
              parent.children.some(child => child.checked)
              && !parent.children.every(child => child.checked)
            ) {
              parent.indeterminate = true;
              grandParent.indeterminate = true;
            } else {
              parent.indeterminate = false;
              grandParent.indeterminate = false;
            }
    
            if (parent.children.every(child => child.checked)) {
              parent.checked = true;
            } else if (parent.children.every(child => !child.checked)) {
              parent.checked = false;
            }
    
            if (
              grandParent.children.some(child => child.checked)
              && !grandParent.children.every(child => child.checked && !child.indeterminate)
            ) {
              grandParent.indeterminate = true;
            } else {
              grandParent.indeterminate = false;
            }
    
            this.getItemChecked();
            // this.generateUrlParams();
            // this.getQuantityOfQuestions();
            this.handleGetQuestions();
          },
          getCheckedLevelFour(item, parent, grandParent, greatGrandParent) {
            this.checkItems(item, item.checked);
    
            if (
              parent.children.some(child => child.checked)
              && !parent.children.every(child => child.checked)
            ) {
              parent.indeterminate = true;
              grandParent.indeterminate = true;
              greatGrandParent.indeterminate = true;
            } else {
              parent.indeterminate = false;
              grandParent.indeterminate = false;
              greatGrandParent.indeterminate = false;
            }
    
            if (parent.children.every(child => child.checked)) {
              parent.checked = true;
            } else if (parent.children.every(child => !child.checked)) {
              parent.checked = false;
            }
    
            if (
              grandParent.children.some(child => child.checked)
              && !grandParent.children.every(child => child.checked)
            ) {
              grandParent.indeterminate = true;
              greatGrandParent.indeterminate = true;
            } else {
              grandParent.indeterminate = false;
              greatGrandParent.indeterminate = false;
            }
    
            this.getItemChecked();
            // this.generateUrlParams();
            // this.getQuantityOfQuestions();
            this.handleGetQuestions();
          },
          async callAPI(url, method="GET", body) {
            try {
              const res = await fetch(url, {
                method: method, 
                body: JSON.stringify(body),
                headers: {
                  'Content-Type': 'application/json'
                  // 'Content-Type': 'application/x-www-form-urlencoded',
                },
              });
              const data = await res.json();
              if (!res.ok) throw data;
              return data
            } catch (err) {
              throw err;
            }
          },
          startIntiniteScroll() {
            $('#infinity-scroll').scroll(() => {
              let scrollHeight = document.getElementById('infinity-scroll').scrollHeight - $('#infinity-scroll').height() - 100
              let currentScrollHeight = $('#infinity-scroll').scrollTop()
              if(currentScrollHeight >=  scrollHeight) {
                this.getQuestionsFromNextPage()
              }
            });
          },
          async getQuestionsFromNextPage() {
            try {
              if(this.questionsBankControls.questions.next && !this.questionsBankControls.waitForQuestions) {
                this.questionsBankControls.waitForQuestions = true
    
                let url = this.questionsBankControls.questions.next
                let protocol = window.location.protocol

                url = protocol == 'http:' ? url.replace('https:', 'http:') : url.replace('http:', 'https:')
    
                const res = await fetch(url);
                const data = await res.json();
                if (!res.ok) throw data;
                
                let nextUrl = data.next || ""
                let previousUrl = data.previous || ""
                
                if (nextUrl) {
                  nextUrl = protocol == 'http:' ? nextUrl.replace('https:', 'http:') : nextUrl.replace('http:', 'https:')
                }

                if (previousUrl) {
                  previousUrl = protocol == 'http:' ? previousUrl.replace('https:', 'http:') : previousUrl.replace('http:', 'https:')
                }
                
                this.questionsBankControls.questions.previous = previousUrl
                this.questionsBankControls.questions.next = nextUrl
                this.questionsBankControls.questions.results = this.questionsBankControls.questions.results.concat(data.results.map((question) => ({...question, detailLoaded: false, currentMenu: 'enunciation', currentAiMenu: 'before' })))
                this.questionsBankControls.waitForQuestions = false
              }
            } catch (err) {
              throw err;
            }
          },
          async getQuestions() {
            this.callAPI(`{% url 'api2:select-questions-v2' %}?${this.questionsBankControls.params}&limit=10`).then((data) => {
              this.questionsBankControls.questions = data
              this.questionsBankControls.questions.results = data.results.map((question) => ({...question, detailLoaded: false, currentMenu: 'enunciation', currentAiMenu: 'before' }))
              if(this.questionsBankControls.infinityScrollConfig.type == 'infinity') {
                setTimeout(() => {
                  this.startIntiniteScroll()
                }, 1000)
              }
            }).finally(() => this.questionsBankControls.loadQuestions = false)
          },
          updateSubjectsVisualList() {
            // Exibir apenas as disciplinas que possuem associação com o usuário
            if(this.controls.onlyMyQuestions){
              this.preservedSubjects = this.questionsBankControls.subjects
              this.questionsBankControls.subjects.forEach((subject) => {
                if(!subject.isRelatedToUser){
                  subject.checked = false
                }
              })
              this.questionsBankControls.subjects = this.questionsBankControls.subjects.filter((subject) => subject.isRelatedToUser == true)
              this.questionsBankControls.onlySelectedItems = this.questionsBankControls.onlySelectedItems.filter((subject) => subject.isRelatedToUser == true)
            }else{
              this.questionsBankControls.subjects = this.preservedSubjects
            }
          },
          getAndShowQuestionsAdvencedFilter(){
            this.questionsBankControls.questions = {}
            this.questionsBankControls.loadQuestions = true
            this.generateUrlParams()
            setTimeout(() => {
              this.getQuantityOfQuestions()
              this.getQuestions()
            }, 200)
            this.controls.showAdvancedFilters = false
            $('#modalAdvancedFilters').modal('hide');
          },
          clearAdvancedFilters() {
            this.questionsBankControls.advancedFilters = {
              questionsCategory: {
                focus: false,
                items: [],
              },
              questionsDifficult: {
                focus: false,
                items: [],
              },
              segment: {
                focus: false,
                items: [],
              },
              grade: {
                focus: false,
                items: [],
              },
              board: {
                focus: false,
                items: [],
              },
              elaborationYear: {
                focus: false,
                items: [],
              },
              elaborationStartYear: {
                focus: false,
                items: [],
              },
              elaborationEndYear:  {
                focus: false,
                items: [],
              },
              knowledgeArea: {
                focus: false,
                items: [],
              },
              enunciation: {
                focus: false,
                search: '',
              },
              alternatives: {
                focus: false,
                search: '',
              },
            }
            this.getAndShowQuestionsAdvencedFilter()
          },
          getBarWidth(index, totalProgress) {
            let value = Math.min(Math.max(totalProgress - (index * 25), 0), 25)
            let percent = (value / 25) * 100
            return `${percent}%`
          },
          getAndShowQuestions() {
            this.questionsBankControls.questions = {}
            this.questionsBankControls.loadQuestions = true
            this.generateUrlParams()
            setTimeout(() => {
              this.getQuantityOfQuestions()
              this.getQuestions()
            }, 200)
          },
          unselectItem(item) {
            this.checkItems(item, false)
            this.getItemChecked();
            this.generateUrlParams();
            this.getQuantityOfQuestions();
          },
          unselectAll() {
            this.questionsBankControls.subjects.forEach((item) => {
              this.checkItems(item, false);
            });
            this.getItemChecked();
            this.generateUrlParams();
            this.getQuantityOfQuestions();
          },
          changeQuestion(action) {
            action == 'next' ? this.questionsBankControls.selectedQuestion = this.questionsBankControls.questions.results.at(this.questionsBankControls.questions.results.indexOf(this.questionsBankControls.selectedQuestion) + 1) : this.questionsBankControls.selectedQuestion = this.questionsBankControls.questions.results.at(this.questionsBankControls.questions.results.indexOf(this.questionsBankControls.selectedQuestion) - 1)
          },
          findQuestion(questionID) {
            return this.questionsBankControls.questions.results.find((question) => question.id == questionID)
          },
          async getQuestionDetail(question) {

            this.questionsBankControls.loadingQuestions.push(question.id)
            
            this.callAPI(question.detail_url).then((data) => { 
              _question = this.findQuestion(data.id)
    
              _question['alternatives'] = data.alternatives
              _question['topics'] = data.topics
              _question['abilities'] = data.abilities
              _question['competences'] = data.competences
              _question['detailLoaded'] = true
    
              this.$forceUpdate()
    
            }).finally(() => this.questionsBankControls.loadingQuestions.splice(question.id, 1))
          
          },
          applyFiltersAndGetSubjects() {
            this.questionsBankControls.questions = []
            this.questionsBankControls.subjects = []
            this.getSelectedLabels()
            this.generateUrlParams();
            this.getInitialSubjects();
            this.getQuantityOfQuestions();
          },
          // IMPORT VIA SUPERPROFESSOR
          acceptTermsQuestionImport() {
            axios.patch("{% url 'api2:users-accept-terms-question-import' %}")
          },
          onChangeFormIntegrationSuperProViaFileFile(event) {
            this.controlsImportQuestion.formIntegrationSuperProViaFile.file = event.target.files[0];
          },
          async submitFormIntegrationSuperProViaFile() {
            let examTeacherSubjectFile;
            let questions;

            this.controlsImportQuestion.formIntegrationSuperProViaFile.status = 'submitting';

            try {
              examTeacherSubjectFile = await this.uploadExamTeacherSubjectFile(
                this.controlsImportQuestion.formIntegrationSuperProViaFile.file,
                this.examTeacherSubject.id,
              );
            } catch(error) {
              console.error({ error });
              this.controlsImportQuestion.formIntegrationSuperProViaFile.status = 'error-uploading';
            }

            try {
              questions = await this.convertDocx2Html(examTeacherSubjectFile.file);
            } catch(error) {
              console.error({ error });
              this.controlsImportQuestion.formIntegrationSuperProViaFile.status = 'error-converting';
            }

            try {
              await this.importAllQuestions(questions && questions.length ? questions : []);
              this.controlsImportQuestion.formIntegrationSuperProViaFile.status = 'success';
            } catch(error) {
              console.error({ error });
              this.controlsImportQuestion.formIntegrationSuperProViaFile.status = 'error-importing';
            }
          },
          async uploadExamTeacherSubjectFile(file, examTeacherSubject) {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('exam_teacher_subject', examTeacherSubject);

            const response = await fetch('{% url "api:exam-teacher-subject-file-upload" %}', {
              method: 'POST',
              headers: {
                // 'Content-Type': 'multipart/form-data'
              },
              body: formData,
            });
            if (!response.ok) {
              throw response;
            }
            const data = await response.json();
            return data;
          },
          async convertDocx2Html(url) {
            const response = await fetch(`{{ SUPER_PROFESSOR_URL_DOCX2HTML_SERVICE }}?simple_import=${this.simpleImport}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ url }),
            });
            if (!response.ok) {
              throw response;
            }
            const data = await response.json();
            return data;
          },
          async importAllQuestions(fullQuestions) {
            for (const question of fullQuestions) {
              await this.importQuestion(question);
            }
            if(fullQuestions && fullQuestions.length) {
              this.alertTop("As questões foram adicionadas ao caderno")
              window.location.reload() 
            } else {
              this.alertTop("Erro na leitura das questões, nenhuma questão foi importada", "error", 5000)
            }
          },
          async importQuestion(question) {
            const url = `{% url 'api:superprof-import-questions-and-create-exam-question' %}?simple_import=${this.simpleImport}`;
            try {
              const response = await fetch(url, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                  question: question,
                  exam_teacher_subject_id: this.examTeacherSubject.id,
                }),
              });
              if (!response.ok) {
                throw response;
              }
              const data = await response.json();
        
              //this.examTeacherSubject.examQuestions.push(data);
              //this.alertTop('A questão foi adicionada com sucesso');
              
            } catch (error) {
              console.log({ error });
              if (error.status == 302) {
                this.alertTop('A questão já foi utilizada no caderno', 'info');
              } else {
                this.alertTop('Ocorreu um erro ao tentar adicionar a questão.', 'error');
              }
            }
          },
          awaitIAMessage() {
            let mensagens = [
                { message: "Validando seu pedido", description: "Estamos verificando suas instruções para garantir a melhor resposta possível." },
                { message: "Analisando seu texto", description: "Estamos processando suas palavras para entender completamente o contexto." },
                { message: "Buscando dados relevantes", description: "Estamos pesquisando informações para fornecer uma resposta precisa." },
                { message: "Aguarde um momento enquanto processamos sua solicitação", description: "Estamos trabalhando nos bastidores para garantir uma resposta útil." },
                { message: "Estamos processando a solicitação, isso pode levar alguns segundos", description: "Agradecemos sua paciência enquanto preparamos a resposta." },
                { message: "Analisando o contexto da solicitação", description: "Estamos considerando o histórico da conversa para uma resposta mais coesa." },
                { message: "Preparando uma resposta personalizada para você", description: "Estamos ajustando a resposta para atender melhor às suas necessidades." },
                { message: "Estamos trabalhando para oferecer a melhor resposta possível...", description: "O processo de análise está em andamento para garantir qualidade." },
                { message: "Estamos consultando nossos dados para uma encontrar a melhor resposta.", description: "Aguarde enquanto reunimos as informações necessárias." },
                { message: "Analisando a entrada e adaptando a resposta", description: "Estamos ajustando nossa resposta com base na sua entrada." },
            ]

            this.controls.currentMessage = mensagens.reverse().pop(0)

            this.controls.awaitIAMessageInterval = setInterval(() => {
              if(mensagens.length) {
                this.controls.currentMessage = mensagens.reverse().pop(0)
              }
            }, (Math.random() * 5000) + 5000);
          },
          getBoards() {
            if(this.controls.boardsStatus == 'idle') {
              this.controls.boardsStatus = 'loading'
              axios.get("{% url 'questions:questions-get-boards' %}").then((response) => {
                this.controls.boardsStatus = 'success'
                this.boards = response.data
              }).catch((e) => {
                this.controls.boardsStatus = 'error'
              })
            }
          },
          getKnowledgeAreas() {
            if(this.controls.knowledgeAreasStatus == 'idle') {
              this.controls.knowledgeAreasStatus = 'loading'
              axios.get("{% url 'questions:questions-get-knowledge-areas' %}").then((response) => {
                this.controls.knowledgeAreasStatus = 'success'
                this.knowledgeAreas = response.data
              }).catch(() => {
                this.controls.knowledgeAreasStatus = 'error'
              })
            }
          },
          handleClickOutside(event) {
            clickedInsideAnyDropdown = false
            this.dropdownRefs.forEach(refName => {
              if (this.$refs[refName] && this.$refs[refName].contains(event.target)) {
                clickedInsideAnyDropdown = true;
              }
            });
            if (!clickedInsideAnyDropdown) {
              this.closeAllDropdown();
            }
          },
          closeAllDropdown() {
            if (this.keyAdvancedFilters){
              lastKey = this.keyAdvancedFilters
              for(let key in this.questionsBankControls.advancedFilters) {
                if(key != lastKey)
                this.questionsBankControls.advancedFilters[key].focus = false 
              }
            }
            else {
              for(let key in this.questionsBankControls.advancedFilters) {
                this.questionsBankControls.advancedFilters[key].focus = false 
              }
            }
          },
          openCustomFilterDropdown(key) {
            this.keyAdvancedFilters = key
            this.questionsBankControls.advancedFilters[key].focus = !this.questionsBankControls.advancedFilters[key].focus
      
            if (this.questionsBankControls.advancedFilters.board.items.length === 0) {
                this.clickBoard = false;
            }
            if (key == "board") {
              this.clickBoard = true      
              // Foca o input de busca da banca
              this.$nextTick(() => {
                if (this.$refs.boardInput) {
                  this.$refs.boardInput.focus();
                }
              });
            }
            this.closeAllDropdown();
            this.keyAdvancedFilters =  ""
          },
          toggleBoardSelection(board) {
            const items = this.questionsBankControls.advancedFilters.board.items;
            const index = items.indexOf(board);
            if (index === -1) {
              items.push(board);
            } else {
              items.splice(index, 1);
            }
          },
          removeQueryParam(param) {
            const url = window.location.href;
            const urlObj = new URL(url);
            urlObj.searchParams.delete(param);
            window.history.replaceState(null, '', urlObj.toString());
          },
          updateQuantityLines() {
            if (!!!this.selectedExamQuestion.question.isEssay) {
              this.selectedExamQuestion.question.quantityLines = 30
            }
          },
          getAllTopicIdsFromTheme(theme) {
            return theme.mainTopics.flatMap(mt => mt.topics.map(t => t.id))
          },
          getAllTopicIdsFromMainTopic(mainTopic) {
            return mainTopic.topics.map(t => t.id)
          },
          isThemeChecked(theme) {
            let topicIds = this.getAllTopicIdsFromTheme(theme)
            return topicIds.every(id => this.selectedExamQuestion.question.topics.includes(id))
          },
          isMainTopicChecked(mainTopic) {
            let topicIds = this.getAllTopicIdsFromMainTopic(mainTopic)
            return topicIds.every(id => this.selectedExamQuestion.question.topics.includes(id))
          },
          toggleTheme(theme, event) {
            let topicIds = this.getAllTopicIdsFromTheme(theme)
            if (event.target.checked) {
              this.selectedExamQuestion.question.topics = Array.from(new Set([...this.selectedExamQuestion.question.topics, ...topicIds]))
            } else {
              this.selectedExamQuestion.question.topics = this.selectedExamQuestion.question.topics.filter(id => !topicIds.includes(id))
            }
            this.onTopicToggle()
          },
          toggleMainTopic(mainTopic, event) {
            let topicIds = this.getAllTopicIdsFromMainTopic(mainTopic)
            if (event.target.checked) {
              this.selectedExamQuestion.question.topics = Array.from(new Set([...this.selectedExamQuestion.question.topics, ...topicIds]))
            } else {
              this.selectedExamQuestion.question.topics = this.selectedExamQuestion.question.topics.filter(id => !topicIds.includes(id))
            }
            this.onTopicToggle()
          },
          onTopicToggle() {
            if (this.selectedExamQuestion.canUpdate()) {
              this.save(where='bnccs')
            }
            this.handleBNCCs()
            this.questionIsValid(this.selectedExamQuestion)
          },
        }, 
        computed: {
          filteredRequestSubjectList() {
            return this.questionsBankControls.subjects.filter(item => item.requestSubject);
          },
          filteredSubjectList() {
            return this.questionsBankControls.subjects.filter(item => {
              return !item.requestSubject && item.text.toLowerCase().includes(this.searchSubjects.toLowerCase());
            });
          },
          titleMainTopic(){
            if (this.selectedTheme) {
              $('#filderMainTopic').attr('data-original-title', "");
              $('#filderMainTopic').tooltip('update');
            } else {
              return "Selecione um tema para habilitar este campo."
            }
          },
          totalizer: function() {
            return this.examTeacherSubject.examQuestions.reduce((total, item) => {
              if(!['Reprovada', 'Usar depois'].includes(item.lastStatus.statusDisplay)) {
                
                return total + parseFloat(item.weight)
              }
              return total
            }, 0)
          },
          totalBlockedWeightQuestions: function() {
            let totalWeight = 0;
            this.examTeacherSubject.examQuestions.forEach(question => {
              if (question.blockWeight) {
                totalWeight += parseFloat(question.weight || 0);
              }
            });
            return totalWeight;
          },
          totalWeightQuestions: function() {
            let totalWeight = 0;
            this.examTeacherSubject.examQuestions.forEach(question => {
                totalWeight += parseFloat(question.weight || 0);
            });
            const DECIMAL_PLACE = 6
            const totalWeightFixedDecimalPlace = Number(totalWeight).toFixed(DECIMAL_PLACE)
            return totalWeightFixedDecimalPlace
          },
          enablesCreate(){
            return (this.selectedExamQuestion.question.grade != null && this.selectedExamQuestion.question.grade != "") &&
                    (this.selectedExamQuestion.question.pedagogicalData.knowledgeArea != null && this.selectedExamQuestion.question.pedagogicalData.knowledgeArea != "") &&
                    (this.selectedExamQuestion.question.subject != null && this.selectedExamQuestion.question.subject != "");
          },
          enableMainTopicRegistration (){
            return this.selectedTheme !== ''  ;
          },
          tooltipTitleMainTopic(){
            if (this.enableMainTopicRegistration) {
              $('#bt_create_main_topic').attr('data-original-title', "Cadastrar Tópico");
              $('#bt_create_main_topic').tooltip('update');
            } else {
              return 'Você deve selecionar Tema para poder cadastrar um novo Tópico.';
            }
          },
          advancedFiltersDropdownOpened() {
            for(let key in this.questionsBankControls.advancedFilters) {
              return this.questionsBankControls.advancedFilters[key].focus
            }
          },
          simpleImport: function(val) {
            return this.controlsImportQuestion.type  == 'simple' ? true:false 
          },
          topicsRegrouped: function() {
            let items = this.foundedTopics
            let result = {}

            items.forEach(topic => {
              let stageId = this.slugify(topic.stage) || 'sem-etapa'
              let stageName = topic.stage || 'Sem etapa'

              if (!result[stageId]) {
                result[stageId] = {
                  id: stageId,
                  name: stageName,
                  themes: {}
                }
              }

              let themeId = null
              let themeName = null

              if (topic.theme) {
                themeId = topic.theme.id
                themeName = topic.theme.name
              } else if (topic.main_topic && topic.main_topic.theme) {
                themeId = topic.main_topic.theme.id
                themeName = topic.main_topic.theme.name
              }

              if (themeId) {
                if (!result[stageId].themes[themeId]) {
                  result[stageId].themes[themeId] = {
                    id: themeId,
                    name: themeName,
                    main_topics: {}
                  }
                }
              }

              let mainTopicId = null
              let mainTopicName = null

              if (topic.main_topic) {
                mainTopicId = topic.main_topic.id
                mainTopicName = topic.main_topic.name

                if (!themeId) {
                  themeId = 'without-theme'
                  if (!result[stageId].themes[themeId]) {
                    result[stageId].themes[themeId] = {
                      id: 'without-theme',
                      name: 'Sem tema',
                      main_topics: {}
                    }
                  }
                }

                if (!result[stageId].themes[themeId].main_topics[mainTopicId]) {
                  result[stageId].themes[themeId].main_topics[mainTopicId] = {
                    id: mainTopicId,
                    name: mainTopicName,
                    topics: []
                  }
                }
              } else {
                if (!themeId) {
                  themeId = 'without-theme'
                  if (!result[stageId].themes[themeId]) {
                    result[stageId].themes[themeId] = {
                      id: 'without-theme',
                      name: 'Sem tema',
                      main_topics: {}
                    }
                  }
                }

                mainTopicId = 'without-main-topic'
                if (!result[stageId].themes[themeId].main_topics[mainTopicId]) {
                  result[stageId].themes[themeId].main_topics[mainTopicId] = {
                    id: 'without-main-topic',
                    name: 'Sem tópico principal',
                    topics: []
                  }
                }
              }

              result[stageId].themes[themeId].main_topics[mainTopicId].topics.push({
                id: topic.id,
                name: topic.name
              })
            })

            let formattedResult = Object.values(result)
              .map((stage) => ({
                ...stage,
                themes: Object.values(stage.themes)
                  .map((theme) => ({
                    ...theme,
                    mainTopics: Object.values(theme.main_topics)
                      .map((mainTopic) => ({
                        ...mainTopic,
                        topics: [...mainTopic.topics].sort((a, b) =>
                          a.name.localeCompare(b.name),
                        ),
                      }))
                      .sort((a, b) => a.name.localeCompare(b.name)),
                  }))
                  .sort((a, b) => a.name.localeCompare(b.name)),
              }))
              .sort((a, b) => a.name.localeCompare(b.name))

            return formattedResult
          },
        },
        updated(){
          $('[data-toggle="tooltip"]').tooltip("dispose");
          $('[data-toggle="tooltip"]').tooltip('update')
          this.handleCustomToolbarEvents()
        },
        async mounted() {
          let elementTheme = document.getElementById('theme')
          this.choicesRefThemes = new Choices(elementTheme, {
            removeItemButton: true,
            classNames: {
              containerOuter: ['choices', 'w-100', 'mb-0'],
              containerInner: ['choices__inner', 'custom-choices__inner'],
              listSingle: ['choices__list--single', 'custom-choices__list--single'],
            },
          })
          let elementMainTopic = document.getElementById('main_topic')
          this.choicesRefMainTopics = new Choices(elementMainTopic, {
            removeItemButton: true,
            classNames: {
              containerOuter: ['choices', 'w-100', 'mb-0'],
              containerInner: ['choices__inner', 'custom-choices__inner'],
              listSingle: ['choices__list--single', 'custom-choices__list--single'],
            },
          })

          this.generateYears();

          $('[data-toggle="tooltip"]').tooltip()
          document.addEventListener('click', this.handleClickOutside);

          this.getExamTeacherSubjectData().finally(() => {
            this.getCredits().finally(() => {
              this.checkIfCanAddExamQuestion().finally(() => {
                if("{{creation_type|default:''}}" == 'ia') {
                  this.createWithIA()
                } else if("{{creation_type|default:''}}" == 'bank') {
                  this.createWithQuestionsBank()
                } else if("{{creation_type|default:''}}" == 'file') {
                  this.createWithFile()
                } else {
                  if(!this.examTeacherSubject.examQuestions.length) {
                    this.addNewQuestion()
                  }
                }
                this.removeQueryParam('creation_type')
                setTimeout(() => {
                  this.examTeacherSubject.examQuestions.filter(examQuestion => examQuestion.canUpdate()).forEach((examQuestion) => this.questionIsValid(examQuestion))
                }, 1000)
                
                this.promptControlsDefaults = Object.assign({}, this.promptControls)

                if (this.examTeacherSubject.subjectNote) {
                  this.subjectNote = this.examTeacherSubject.subjectNote
                }
                this.handleResize()
                setTimeout(() => {
                  this.startScrollBarFunctions()
                }, 1000)
              })
            })
            let hash = window.location.hash
            if(hash.includes("#examQuestion-")) {
              let examQuestionId = hash.split("#examQuestion-")[1]
              this.selectedExamQuestion = this.examTeacherSubject.examQuestions.find(item => item.id == examQuestionId)
              this.goToExamQuestion(this.selectedExamQuestion)
            }

          })


          $('#bt_create_theme').tooltip();
          $('#bt_create_main_topic').tooltip(); 
          $('#essay_info').tooltip();

          this.getBaseTexts()
          this.getSugestionTags()
          this.controlsImportQuestion.showOrientations = !this.controlsImportQuestion.acceptTerms
          
          setTimeout(() => {
            document.addEventListener("DOMContentLoaded", ()  => {
              const dropzone = document.getElementById("dropzone");
            
              dropzone.addEventListener("dragover", (e) =>  {
                e.preventDefault();
                dropzone.classList.add("dragover");
              });
            
              dropzone.addEventListener("dragleave", ()  => {
                dropzone.classList.remove("dragover");
              });
            
              dropzone.addEventListener("drop", (e) =>  {
                e.preventDefault();
                dropzone.classList.remove("dragover");
                
                const files = e.dataTransfer.files;
                this.controlsImportQuestion.formIntegrationSuperProViaFile.file = files[0]
              });
            });
          }, 3000)

          $(window).resize(() => {
            this.controls.width = window.innerWidth
            this.controls.height = window.innerHeight
          })
          this.controls.width = window.innerWidth
          this.controls.height = window.innerHeight

        },
        beforeDestroy() {
          // Remove o listener para evitar vazamentos de memória
          document.removeEventListener('click', this.handleClickOutside);
        },
    })


</script>
{% endblock %}
