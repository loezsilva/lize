{% extends 'redesign/base.html' %}
{% comment %} {% extends 'dashboard/base_fixed.html' %} {% endcomment %}

{% load static %}
{% load widget_tweaks %}
{% load insert_field %}
{% load insert_key %}
{% load permissions %}

{% block title %}
  {% if not object %}
    Cadastrar caderno - Lize
  {% else %}
    Editar caderno - Lize
  {% endif %}
{% endblock title %}

{% block css-additional %}
<!-- {{ form.media }} -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.3.0/tinymce.min.js"></script>
<script type="text/javascript" src="{% static 'django_custom_tinymce/init_tinymce.js' %}"></script>
<link href="{% static 'administration/lib/select2/css/select2.min.css' %}" rel="stylesheet" />
<link rel="stylesheet" href="{% static 'administration/lib/quill/quill.snow.css' %}">
<link href="{% static 'administration/lib/bootstrap-tagsinput/bootstrap-tagsinput.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
  integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">

<link href="{% static 'administration/assets/css/boostrap5.css' %}" rel="stylesheet">
<link rel="stylesheet" href="//unpkg.com/focus-overlay@latest/dist/focusoverlay.css" />
<style>
  #myTabContent hr{
      background-color: #000;
      margin-top: 0.8cm !important;
  }
  .list-group-item .btn:hover{
    cursor: pointer;
  }
  .line-through {
    text-decoration: line-through;
  }
  .custom-dropdown {
    top: -285px !important;
  }
  .btn-disabled {
    background-color: #f0f0f0; /* Cor de fundo para o estado desabilitado */
    border-color: #ccc; /* Cor da borda para o estado desabilitado */
    color: #a0a0a0; /* Cor do texto para o estado desabilitado */
    cursor: not-allowed; /* Cursor para indicar que o botão está desabilitado */
  }

  .modal-body{
    padding: 0;
    max-height: 80vh !important;
    height: 80vh !important;
    overflow-x: hidden !important;
    overflow-y: hidden !important;
  }
  .dropdown-menu {
    max-height: 400px;
    overflow-y: auto;
    position: absolute;
  }
  .grid-item { width: 100%; }
  @media (min-width: 992px){
    .modal-lg, .modal-xl {
      max-width: 95%;
    }
    .modal-content.modal-body{
      max-height: 80vh !important;
      height: 80vh !important;
    }
  }
  #question-details img{
    max-width: 90%;
  }
  .selected-row{
    background-color: rgb(224 224 224 / 31%);
  }
  #teacherModal .list-group-item{
    cursor: pointer;
  }
  #question-container .list-group-item {
    cursor: move;
  }
  .row-bncc {
    font-family: Inter;
    font-size: 14px;
    font-weight: 400;
    line-height: 20px;
    letter-spacing: 0em;
    text-align: left;
    cursor: pointer;
    display: flex;
    align-items: center;
  }
  
  .row-bncc-selected {
    background-color: #41C5881A;
    color: #384250;
    font-family: Inter;
    font-size: 14px;
    line-height: 20px;
    font-weight: 600;
  }
  
  
  .row-bncc-selected .custom-check {
    background-color: #41C588;
    border-color: #41C588;
  }
    .row-bncc-selected svg:nth-child(1) {
    color: #41C588;
  }
  .custom-check {
    width: 12px;
    height: 12px;
    border-radius: 4px;
    border: 2px;
    gap: 10px;
    border: 2px solid #D0D3D9;
    cursor: pointer;
  }
  .tox-tinymce {
    border-radius: 0.375rem !important;
    padding-top: 0.375rem !important;
    padding-bottom: 0.375rem !important;
    color: rgb(17 24 39) !important;
    font-size: 0.875rem !important;
    line-height: 1.5rem !important;
  }
  /* .tox-editor-header {
    display: none;
  } */
   
  .select2-container--default .select2-selection--multiple {
    border: 0;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    line-height: 1.5rem;
    color: rgb(17 24 39);
    padding-right: 0.438rem;
    padding-left: 0.438rem;

    box-shadow: inset 0 0 0 0px #fff, inset 0 0 0 calc(1px + 0px ) rgb(209 213 219 / 1 ), 0 1px 2px 0 rgb(0 0 0 / 0.05);
  }
  .select2-container--default.select2-container--focus .select2-selection--multiple {
    border: 0;
    box-shadow: inset 0 0 0 0px #fff, inset 0 0 0 calc(2px + 0px ) rgb(255 143 62 / 1 ), 0 1px 2px 0 rgb(0 0 0 / 0.05);
  }
  .text-5 {
      font-family: Inter;
      font-size: 18px;
      font-weight: 500;
      line-height: 24px;
      letter-spacing: 0em;
      text-align: left;
    }
    .lize-card {
      position: relative;
      display: flex;
      flex-direction: column;
      min-width: 0;
      word-wrap: break-word;
      background-color: #fff;
      background-clip: border-box;
      border: 1px solid #E6E8EC;
      border-radius: 12px; 
  }
  #body-initial-note {
    display: flex;
    flex-direction: column;
  }
  #checked-by {
    display: flex;
  }
</style>
<link rel="stylesheet" href="https://unpkg.com/@sjmc11/tourguidejs/dist/css/tour.min.css">
<style>
  .tg-backdrop{
    z-index: 9999 !important;
  }
</style>
{% endblock css-additional %}

{% block js-header-additional %}
<script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"
  integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
  integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"></script>

<script src="{% static 'js/treeselectjs.umd.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/treeselectjs.css' %}" />
{% endblock js-header-additional %}

{% comment %}
{% block breadcrumb-fixed %}
  <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-10">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb breadcrumb-style1 mg-b-10">
          <li class="breadcrumb-item"><a href="{% url 'exams:exams_list' %}">CADERNO</a></li>
          <li class="breadcrumb-item active" aria-current="page">GERENCIAR</li>
        </ol>
      </nav> 
      <h4>Gerenciar caderno</h4>
    </div>
    {% if is_popup %}
      <button class="btn btn-sm pd-x-15 btn-white btn-uppercase" onclick="window.close();">
        <i class="fas fa-times" class="wd-10 mg-r-5"></i> Fechar
      </button>
    {% else %}
      <div class="d-none d-md-block">
          <a href="#" onclick="history.back()" class="btn btn-sm pd-x-15 btn-white btn-uppercase">
            <i data-feather="arrow-left" class="wd-10 mg-r-5"></i> Voltar
          </a>
      </div>
    {% endif %}
  </div>
{% endblock breadcrumb-fixed %}
{% endcomment %}

{% block content-fixed %}
<div class="tw-flex tw-justify-center">
  <div class="ard cer dcv tw-max-w-[100rem] tw-flex-1 tw-mb-16">
    <div class="ls" style="margin-top: 1.25rem; margin-bottom: 1.5rem; justify-content: space-between;">
      <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-8 sm:tw-flex-nowrap tw-w-full">
        <div class="tw-flex tw-justify-between {% if only_review %}tw-w-full{% endif %}">
          <h1 class="tw-text-xl tw-font-semibold tw-leading-7 tw-text-[#374151] sm:tw-truncate sm:tw-text-2xl sm:tw-tracking-tight tw-mb-0">
            {% if not object %}
              Cadastrar caderno 
            {% else %}
              {% if only_review %}
                Revisar caderno
              {% else %}
                Editar caderno
              {% endif %}
            {% endif %}
          </h1>
          {% if only_review %}
            <span v-if="getParams('is_popup') === null" class="tw-p-4 tw-rounded-md tw-border tw-text-black tw-border-orange-500">
              <span class="tw-rounded-full tw-bg-blue-500 tw-px-2 tw-py-0.5 tw-text-xs tw-mr-2 tw-text-white">Novo</span>
              Experimente revisar as questões na nova tela de visualizar caderno!
              <a href="{% url 'exams:exams_preview' pk=object.pk %}" target="_blank" class="tw-p-2 tw-ml-2 tw-rounded-md tw-bg-orange-400 tw-text-white hover:tw-bg-orange-300 tw-transition-colors">Testar nova experiência de revisão</a>
            </span>
          {% endif %}
        </div>
        {% if not only_review %}
          <div class="tw-order-last tw-flex tw-w-full tw-gap-x-4 tw-text-sm tw-font-semibold tw-leading-6 sm:tw-order-none sm:tw-w-auto sm:tw-leading-7">
            {% if object.history.all.count %}
              <button type="button" class="tw-flex tw-items-center tw-text-[#384250] tw-border tw-border-[#E5E7EA] tw-rounded-lg tw-px-2 tw-py-0.5" data-toggle="modal" data-target="#exampleModalHistory">
                <span class="mr-2">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <g clip-path="url(#clip0_58_2653)">
                      <path d="M15.1333 9L13.8004 7.66667L12.4666 9M14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C10.2013 2 12.1257 3.18542 13.1697 4.95273M8 4.66667V8L10 9.33333" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </g>
                    <defs>
                      <clipPath id="clip0_58_2653">
                        <rect width="16" height="16" fill="white"/>
                      </clipPath>
                    </defs>
                  </svg>
                </span>
                <span>Histórico</span>
              </button>
            {% endif %}
            {% if object and user_type == 'coordination' %}
              <button type="button" class="tw-flex tw-items-center tw-text-[#384250] tw-border tw-border-[#E5E7EA] tw-rounded-lg tw-px-2 tw-py-0.5" data-toggle="modal" data-target="#exampleModalMaterial">
                <span class="mr-2">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M8 11.244C6.64743 9.89078 4.60858 9.64201 3.00325 10.4977C2.54773 10.7405 1.9975 10.441 1.9975 9.9248V3.86094C1.9975 3.43676 2.19358 3.02859 2.53906 2.78249C4.19641 1.60066 6.51271 1.75339 8 3.24068C9.48728 1.75339 11.8036 1.60066 13.4609 2.78249C13.8064 3.02859 14.0025 3.43676 14.0025 3.86094V9.9248C14.0025 10.441 13.4523 10.7411 12.9967 10.4977C11.3914 9.64201 9.35256 9.89078 8 11.244Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M3.00323 13.2562C4.60857 12.4005 6.64742 12.6493 7.99998 14.0025C9.35255 12.6493 11.3914 12.4005 12.9967 13.2562" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M8.00001 11.244V3.24066" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
                <span>Materiais</span>
              </button>
            {% endif %}
          </div>
          <div class="tw-ml-auto tw-flex tw-gap-4">
            <div>
              <button data-tg-title="Situação do Instrumento" data-tg-order="2" data-tg-tour='Escolha aqui em que situação esse instrumento avaliativo está no momento.' data-tg-group="default-exam-create-update" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-[#667085] tw-border tw-border-[#E5E7EA] tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm tw-bg-white hover:tw-bg-gray-50 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" type="button" id="dropdownMenuButton-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="tw-font-medium">Situação</span>
                <span class="tw-font-semibold">
                  <template v-if="exam.status === 0">Elaborando</template>
                  <template v-else-if="exam.status === 1">Em análise</template>
                  <template v-else-if="exam.status === 2">Fechado</template>
                  <template v-else-if="exam.status === 5">Pronto para impressão</template>
                  <template v-else-if="exam.status === 6 && canAddRevisionAfterClosingExam">Revisão de PDF</template>
                  <template v-else-if="exam.status === 3">Revisão gráfica</template>
                  <template v-else-if="exam.status === 4">Revisão textual</template>

                </span>
                <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                  <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                </svg>
              </button>
              <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-w-56 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-1" style="font-size: inherit;">
                <div class="tw-py-1" role="none">
                  <template v-if="exam.status !== 0">
                    <button type="button" class="tw-w-full tw-text-gray-700 tw-flex tw-items-center tw-gap-2 tw-px-4 tw-py-2 tw-text-sm tw-text-left hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0" @click="exam.status = 0">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                          <path d="M2 7.5C2 7.5 2.5 7 4 7C5.5 7 6.5 8 8 8C9.5 8 10 7.5 10 7.5V1.5C10 1.5 9.5 2 8 2C6.5 2 5.5 1 4 1C2.5 1 2 1.5 2 1.5L2 11" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <span>
                        Elaborando
                      </span>
                    </button>
                  </template>
                  <template v-if="exam.status !== 1">
                    <button type="button" class="tw-w-full tw-text-gray-700 tw-flex tw-items-center tw-gap-2 tw-px-4 tw-py-2 tw-text-sm tw-text-left hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1" @click="exam.status = 1">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                          <path d="M1.21006 6.35659C1.14197 6.24877 1.10792 6.19486 1.08886 6.11171C1.07455 6.04925 1.07455 5.95075 1.08886 5.88829C1.10792 5.80514 1.14197 5.75123 1.21006 5.64341C1.77276 4.75242 3.4477 2.5 6.0002 2.5C8.5527 2.5 10.2276 4.75242 10.7903 5.64341C10.8584 5.75123 10.8925 5.80514 10.9115 5.88829C10.9259 5.95075 10.9259 6.04925 10.9115 6.11171C10.8925 6.19486 10.8584 6.24877 10.7903 6.35659C10.2276 7.24758 8.5527 9.5 6.0002 9.5C3.4477 9.5 1.77276 7.24758 1.21006 6.35659Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M6.0002 7.5C6.82863 7.5 7.5002 6.82843 7.5002 6C7.5002 5.17157 6.82863 4.5 6.0002 4.5C5.17177 4.5 4.5002 5.17157 4.5002 6C4.5002 6.82843 5.17177 7.5 6.0002 7.5Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <span>
                        Em análise
                      </span>
                    </button>
                  </template>

                  <template v-if="exam.status !== 3">
                    <button type="button" class="tw-w-full tw-text-gray-700 tw-flex tw-items-center tw-gap-2 tw-px-4 tw-py-2 tw-text-sm tw-text-left hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-3" @click="exam.status = 3">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                          <path d="M1.5 4.5H10.5M4.5 4.5L4.5 10.5M3.9 1.5H8.1C8.94008 1.5 9.36012 1.5 9.68099 1.66349C9.96323 1.8073 10.1927 2.03677 10.3365 2.31901C10.5 2.63988 10.5 3.05992 10.5 3.9V8.1C10.5 8.94008 10.5 9.36012 10.3365 9.68099C10.1927 9.96323 9.96323 10.1927 9.68099 10.3365C9.36012 10.5 8.94008 10.5 8.1 10.5H3.9C3.05992 10.5 2.63988 10.5 2.31901 10.3365C2.03677 10.1927 1.8073 9.96323 1.66349 9.68099C1.5 9.36012 1.5 8.94008 1.5 8.1V3.9C1.5 3.05992 1.5 2.63988 1.66349 2.31901C1.8073 2.03677 2.03677 1.8073 2.31901 1.66349C2.63988 1.5 3.05992 1.5 3.9 1.5Z" stroke="#F3B364" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <span>
                        Revisão gráfica
                      </span>
                    </button>
                  </template>
                  <template v-if="exam.status !== 4">
                    <button type="button" class="tw-w-full tw-text-gray-700 tw-flex tw-items-center tw-gap-2 tw-px-4 tw-py-2 tw-text-sm tw-text-left hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-4" @click="exam.status = 4">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                          <path d="M2 3.5C2 3.03406 2 2.80109 2.07612 2.61732C2.17761 2.37229 2.37229 2.17761 2.61732 2.07612C2.80109 2 3.03406 2 3.5 2H8.5C8.96594 2 9.19891 2 9.38268 2.07612C9.62771 2.17761 9.82239 2.37229 9.92388 2.61732C10 2.80109 10 3.03406 10 3.5M4.5 10H7.5M6 2V10" stroke="#F3B364" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <span>
                        Revisão textual
                      </span>
                    </button>
                  </template>
                  
                  {% if user.questions_configuration.can_add_revision_after_closing_exam  %}
                  <template v-if="exam.status !== 6">
                    <button type="button" class="tw-w-full tw-text-gray-700 tw-flex tw-items-center tw-gap-2 tw-px-4 tw-py-2 tw-text-sm tw-text-left hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-6" @click="checkBagExistAndShowModal()">
                      <span>
                        <svg width="17" height="17" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M20 12.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H12M14 11H8M10 15H8M16 7H8M19 19L15 15M15 19L19 15" stroke="#F3B364" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <span >
                        Revisão de PDF
                      </span>
                    </button>
                  </template>
                  {% endif %}
                  <template v-if="exam.status !== 2">
                    <button type="button" class="tw-w-full tw-text-gray-700 tw-flex tw-items-center tw-gap-2 tw-px-4 tw-py-2 tw-text-sm tw-text-left hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-2" @click="exam.status = 2">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                          <g clip-path="url(#clip0_2_3631)">
                            <path d="M3.75 6L5.25 7.5L8.25 4.5M11 6C11 8.76142 8.76142 11 6 11C3.23858 11 1 8.76142 1 6C1 3.23858 3.23858 1 6 1C8.76142 1 11 3.23858 11 6Z" stroke="#41C588" stroke-linecap="round" stroke-linejoin="round"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_2_3631">
                              <rect width="16" height="16" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                      </span>
                      <span>
                        Fechado
                      </span>
                    </button>
                  </template>
                  <template v-if="exam.status !== 5">
                    <button type="button" class="tw-w-full tw-text-gray-700 tw-flex tw-items-center tw-gap-2 tw-px-4 tw-py-2 tw-text-sm tw-text-left hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-5" @click="exam.status = 5">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                          <path d="M20 12.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H12M14 11H8M10 15H8M16 7H8M14.5 19L16.5 21L21 16.5" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <span>
                        Pronto para impressão
                      </span>
                    </button>
                  </template>
      
                </div>
              </div>
            </div>
            <button type="submit" :disabled="!verifications()" form="form-exam-create-update" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600">
              Salvar caderno
            </button>
          </div>
        {% endif %}
      </div>
    </div>
    <form method="POST" id="form-exam-create-update" onsubmit="return false">
      <div class="tw-space-y-4">
        
        {% if not only_review %}
          <div data-tg-title="Informações Básicas" data-tg-order="2" data-tg-tour='Insira informações básicas do instrumento avaliativo como título único, prazos e coordenações envolvidas.' data-tg-group="default-exam-create-update" class="tw-bg-white sm:tw-rounded-lg tw-py-8 tw-border tw-border-[#E5E7EA]">
            <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8">
              <h2 class="tw-text-base tw-font-semibold tw-leading-7 tw-text-gray-900 tw-border-b tw-border-gray-900/10 tw-pb-6">
                Informações básicas
              </h2>
              <div class="tw-mt-8 tw-grid tw-grid-cols-1 tw-gap-x-9 tw-gap-y-6 sm:tw-grid-cols-6">
                <div class="sm:tw-col-span-2 sm:tw-col-start-1">
                  <label for="{{ form.category.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    {{ form.category.label }}
                  </label>
                  <div class="tw-mt-2">
                    <select id="{{ form.category.auto_id }}" name="{{ form.category.html_name }}" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.category">
                      <option value="0"{% if category == 'exam' %} selected{% endif %}>Prova</option>
                      <option value="1"{% if category == 'homework' %} selected{% endif %}>Lista de exercício</option>
                    </select>
                  </div>
                </div>
                <div class="sm:tw-col-span-2">
                  <label for="{{ form.name.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    {{ form.name.label }}
                  </label>
                  <div class="tw-mt-2">
                    <input type="text" name="{{ form.name.html_name }}" id="{{ form.name.auto_id }}" autocomplete="on" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.name">
                  </div>
                </div>
                
                <div class="sm:tw-col-span-2">
                  <label for="{{ form.total_grade.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    Nota geral do caderno
                  </label>
                  <div class="tw-relative tw-mt-2 tw-flex tw-items-center">
                    <input type="number" name="{{ form.total_grade.html_name }}" id="{{ form.total_grade.auto_id }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pr-14 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.total_grade" step="0.1">
                    <div class="tw-absolute tw-inset-y-0 tw-right-0 tw-flex tw-py-1.5 tw-pr-1.5">
                      <button type="button" class="tw-inline-flex tw-items-center tw-rounded tw-px-1 tw-text-gray-400" @click="examGetSumWeight(recalculate = true)" title="Recalcular pesos do caderno (Utilize caso você não tenha certeza de que os pesos não foram atualizados automaticamente)">
                        <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-w-6 tw-h-6">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
                <div data-tg-title="Incío da elaboração" data-tg-order="2" data-tg-tour='Defina a data que os professores receberão a solicitação de inserção de itens. Deixe em branco para liberar imediatamente.' data-tg-group="default-exam-create-update" class="sm:tw-col-span-2 sm:tw-col-start-1">
                  <label for="{{ form.release_elaboration_teacher.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    Liberar elaboração do professor
                  </label>
                  <div class="tw-mt-2">
                    <input type="date" name="{{ form.release_elaboration_teacher.html_name }}" id="{{ form.release_elaboration_teacher.auto_id }}" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.release_elaboration_teacher">
                    <small v-if="errors.release_elaboration_teacher" class="tw-text-sm tw-text-red-400">
                      ${errors.release_elaboration_teacher}
                    </small>
                  </div>
                </div>
                
                
                
                <div class="sm:tw-col-span-2">
                  <label for="{{ form.elaboration_deadline.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    {{ form.elaboration_deadline.label }}
                  </label>
                  <div class="tw-mt-2">
                    <input type="date" name="{{ form.elaboration_deadline.html_name }}" id="{{ form.elaboration_deadline.auto_id }}" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.elaboration_deadline">
                  </div>
                </div>
                <div class="sm:tw-col-span-2">
                  <label for="{{ form.review_deadline.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    Prazo para revisar questões
                  </label>
                  <div class="tw-mt-2">
                    <input type="date" name="{{ form.review_deadline.html_name }}" id="{{ form.review_deadline.auto_id }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.review_deadline">
                    <small v-if="errors.review_deadline" class="tw-text-sm tw-text-red-400">
                      ${errors.review_deadline}
                    </small>
                  </div>
                </div>
                <div class="sm:tw-col-span-4" >
                  <label for="{{ form.coordinations.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    {{ form.coordinations.label }}
                  </label>
                  <div class="tw-mt-2" >
                    
                    <div data-tg-title="Coordenações autorizadas" data-tg-order="2" data-tg-tour='Selecione 1 ou mais coordenações que terão acesso a este instrumento avaliativo.' data-tg-group="default-exam-create-update" id="{{ form.coordinations.auto_id }}-treeselect">
                    </div>
                    {% if form.coordinations.errors %}
                      <p class="text-danger">{{ form.coordinations.errors.0 }}</p>
                    {% endif %}
                    <template v-for="error in errors.coordinations">
                      <p class="text-danger">${error}</p>
                    </template>
                    
                    <div data-tg-title="Coordenações autorizadas" data-tg-order="2" data-tg-tour='Você também pode selecionar todas as coordenações de um segmento.' data-tg-group="default-exam-create-update" class="tw-flex tw-gap-2 tw-mt-3">
                      <button type="button" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-px-3 tw-py-1.5 tw-text-xs tw-font-medium tw-shadow-sm focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2" :class="[coordinationsToSelect2.includes('elementarySchool') ? 'tw-text-primary-600 tw-border tw-border-primary-600 hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline-primary-600' : 'tw-text-[#384250] tw-bg-[#F9FAFA] hover:tw-bg-[#ececec] focus-visible:tw-outline-gray-600']" @click="addCoordinationsToSelect2('elementarySchool')">
                        <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                          <path d="M8.00001 3.33331V12.6666M3.33334 7.99998H12.6667" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Anos Iniciais
                      </button>
                      <button type="button" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-px-3 tw-py-1.5 tw-text-xs tw-font-medium tw-shadow-sm focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2" :class="[coordinationsToSelect2.includes('elementarySchool2') ? 'tw-text-primary-600 tw-border tw-border-primary-600 hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline-primary-600' : 'tw-text-[#384250] tw-bg-[#F9FAFA] hover:tw-bg-[#ececec] focus-visible:tw-outline-gray-600']" @click="addCoordinationsToSelect2('elementarySchool2')">
                        <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                          <path d="M8.00001 3.33331V12.6666M3.33334 7.99998H12.6667" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Anos Finais
                      </button>
                      <button type="button" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-px-3 tw-py-1.5 tw-text-xs tw-font-medium tw-shadow-sm focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2" :class="[coordinationsToSelect2.includes('highSchool') ? 'tw-text-primary-600 tw-border tw-border-primary-600 hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline-primary-600' : 'tw-text-[#384250] tw-bg-[#F9FAFA] hover:tw-bg-[#ececec] focus-visible:tw-outline-gray-600']" @click="addCoordinationsToSelect2('highSchool')">
                        <svg width="12" height="12" viewBox="0 0 16 16" fill="none">
                          <path d="M8.00001 3.33331V12.6666M3.33334 7.99998H12.6667" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Ensino médio
                      </button>
                    </div>
                  </div>
                </div>

                <div class="sm:tw-col-span-2 " v-show="{{ form.teaching_stage.field.queryset.exists|lower }}">
                  <label for="{{ form.teaching_stage.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                    {{ form.teaching_stage.label }}
                  </label>
                  <div class="tw-mt-2">
                    {% render_field form.teaching_stage class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.teaching_stage" min="1" %}
                    {% if form.teaching_stage.errors %}
                      <label class="text-danger">{{ form.teaching_stage.errors.0 }}</label>
                    {% endif %}
                  </div>
                </div>
                

                
              </div>
            </div>
          </div>
        {% endif %}
          
        <div data-tg-title="Questões solicitadas aos professores" data-tg-order="2" data-tg-tour='Aqui você pode adicionar ou organizar as solcitações de itens aos professores deste instrumento avaliativo.' data-tg-group="default-exam-create-update" class="tw-bg-white sm:tw-rounded-lg tw-py-8 tw-border tw-border-[#E5E7EA]">
          <template v-if="selectedTeachersStatus === 'loading'">
            <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8">
              <div class="tw-flex tw-items-center tw-justify-between tw-pb-6">
                <h2 class="tw-text-base tw-font-semibold tw-leading-7 tw-text-gray-900">
                  Disciplinas e Professores
                </h2>
              </div>
              <div class="tw-flex tw-items-center tw-justify-center tw-relative tw-h-56 tw-overflow-hidden tw-rounded tw-border tw-border-dashed tw-border-[#D2D6DB]">
                <svg class="tw-animate-spin tw-h-5 tw-w-5" fill="none" viewBox="0 0 24 24">
                  <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
              </div>
            </div>
          </template>
          <template v-else>
            <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8">
              <div class="tw-flex tw-items-center tw-justify-between tw-pb-6">
                <h2 class="tw-text-base tw-font-semibold tw-leading-7 tw-text-gray-900">
                  Disciplinas e Professores
                </h2>
                {% if not only_review %}
                  <div class="tw-flex tw-items-center" v-if="selectedTeachers.length > 1">
                    <div class="custom-control custom-switch" data-tg-title="Língua Estrangeira" data-tg-order="2" data-tg-tour='Marque esta opção quando desejar indicar que o aluno deverá escolher uma entre duas disciplinas de língua estrangeira.' data-tg-group="default-exam-create-update">
                      <input type="checkbox" id="is_english_spanish" name="english_spanish" class="custom-control-input" v-model="exam.is_english_spanish" />
                      <label class="custom-control-label" for="is_english_spanish">
                        <span class="tw-font-semibold tw-text-[#101928]">Caderno com língua estrangeira</span>
                      </label>
                    </div>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Ative esta opção se deseja que o aluno selecione uma língua estrangeira para realizar a prova.">
                      <g clip-path="url(#clip0_8_3857)">
                        <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </g>
                      <defs>
                        <clipPath id="clip0_8_3857">
                          <rect width="16" height="16" fill="white"/>
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                {% endif %}
              </div>

              <template v-if="selectedTeachers.length === 0">
                <div class="tw-flex tw-items-center tw-justify-center tw-relative tw-h-56 tw-overflow-hidden tw-rounded tw-border tw-border-dashed tw-border-[#D2D6DB]">
                  <button data-tg-title="Solicitar questões" data-tg-order="2" data-tg-tour='Clique neste botão para enviar uma solicitação de itens para um professor.' data-tg-group="default-exam-create-update" type="button" class="tw-flex tw-items-center tw-mr-3 tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" data-toggle="modal" data-target="#exampleModal" data-button-type="teacher" @click="openExampleModal">
                    Solicitar itens a um professor
                    <svg width="25" height="24" viewBox="0 0 25 24" fill="none" class="ml-2">
                      <path d="M12.5 5V19M5.5 12H19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
               
                  {% if user.client_can_request_ai_questions or user.can_request_ai_questions %}
                  <button data-tg-title="Solicitar questões" data-tg-order="2" data-tg-tour='Clique neste botão para enviar uma solicitação de itens para uma IA.' data-tg-group="default-exam-create-update" type="button" class="tw-flex tw-items-center tw-ml-3 tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" data-toggle="modal" data-target="#exampleModal" data-button-type="reques_question_ia" @click="openExampleModal">
                      Solicitar questões à IA
                      <svg width="25" height="24" viewBox="0 0 25 24" fill="none" class="ml-2">
                        <path d="M12.5 5V19M5.5 12H19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                  </button>
                  {% endif %}
                </div>
              </template>
            
              <template v-else>
                <div>
                  <template v-if="exam.is_english_spanish">
                    <div class="tw-flex tw-items-center tw-justify-center tw-bg-[#F9FAFA] tw-rounded-xl tw-px-20 tw-py-6 tw-mb-4">
                      <span class="tw-rounded-full tw-bg-[#F3B364] tw-p-3 tw-mr-6">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M18.5 16C20.433 16 22 13.0899 22 9.5C22 5.91015 20.433 3 18.5 3M18.5 16C16.567 16 15 13.0899 15 9.5C15 5.91015 16.567 3 18.5 3M18.5 16L5.44354 13.6261C4.51605 13.4575 4.05231 13.3731 3.67733 13.189C2.91447 12.8142 2.34636 12.1335 2.11414 11.3159C2 10.914 2 10.4427 2 9.5C2 8.5573 2 8.08595 2.11414 7.68407C2.34636 6.86649 2.91447 6.18577 3.67733 5.81105C4.05231 5.62685 4.51605 5.54254 5.44354 5.3739L18.5 3M5 14L5.39386 19.514C5.43126 20.0376 5.44996 20.2995 5.56387 20.4979C5.66417 20.6726 5.81489 20.8129 5.99629 20.9005C6.20232 21 6.46481 21 6.98979 21H8.7722C9.37234 21 9.67242 21 9.89451 20.8803C10.0897 20.7751 10.2443 20.6081 10.3342 20.4055C10.4365 20.1749 10.4135 19.8757 10.3675 19.2773L10 14.5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </span>
                      <p class="tw-text-[#101928] tw-mb-2">
                        Escolha abaixo a primeira disciplina de língua estrangeira. Importante: antes de gerar o malote certifique-se que as disciplinas possuem a mesma quantidade de questões.
                      </p>
                    </div>
                  </template>
                  <draggable class="tw-space-y-2" :list="selectedTeachers" ghost-class="ghost" @change="changeObjectsOrder(selectedTeachers)" @start="dragging = true" @end="dragging = false">
                      <div v-for="(teacher, index) in selectedTeachers" class="tw-flex tw-items-center tw-justify-between tw-border tw-p-6 tw-rounded-2xl" :class="{'tw-bg-[#FEF7EF]': teacher.is_foreign_language && exam.is_english_spanish}">
                        <div>
                          <div class="tw-relative tw-flex tw-items-start" v-if="exam.is_english_spanish && selectedTeachers.find(_teacher => _teacher.is_foreign_language) != teacher" @click="selectForeignLanguage(teacher)">
                            <div class="tw-flex tw-h-6 tw-items-center">
                              <input :id="'check-'+ teacher.teacher_subject.id ? teacher.id : teacher.teacher.id" :name="'name-check-'+ teacher.teacher_subject.id ? teacher.id : teacher.teacher.id" type="checkbox" class="tw-h-4 tw-w-4 tw-rounded tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600">
                            </div>
                            <div class="tw-ml-3 tw-text-sm tw-leading-6">
                              <label :for="'check-'+ teacher.teacher_subject.id ? teacher.id : teacher.teacher.id" class="tw-font-medium tw-text-[#374151]">
                                Marque se for a 1ª opção de língua estrangeira
                              </label>
                            </div>
                          </div>
                          <template v-if="exam.is_english_spanish">
                            <div class="tw-relative tw-flex tw-items-start" v-if="!teacher.teacher_subject && index == 0 || selectedTeachers.find(_teacher => _teacher.is_foreign_language) == teacher">
                              <div class="tw-text-sm tw-leading-6">
                                <p class="tw-font-medium tw-text-[#374151]">
                                  Esta é a <strong>1ª</strong> opção de língua estrangeira
                                </p>
                              </div>
                            </div>
                            <div class="tw-relative tw-flex tw-items-start" v-if="!teacher.teacher_subject && index == 1 || getSecondForeignLanguage(selectedTeachers.find(_teacher => _teacher.is_foreign_language)) == teacher">
                              <div class="tw-text-sm tw-leading-6">
                                <p class="tw-font-medium tw-text-[#374151]">
                                  Esta é a <strong>2ª</strong> opção de língua estrangeira
                                </p>
                              </div>
                            </div>
                          </template>
                          <div class="tw-font-semibold tw-text-[#374151] tw-mb-2">
                            <template v-if="teacher.teacher_subject.teacher">
                              <div class="tw-flex tw-items-center">
                                ${teacher.teacher_subject.teacher.name} 
                                <span v-if="teacher.teacher_subject.teacher.is_inspector_ia || teacher.has_questions_generate_or_modified_by_ia" data-toggle="tooltip" data-placement="top" title="Esta solicitação contem questöes feitas ou modificadas por IA."
                                    style="width: 32px; height: 32px; color: #FF8F3D;"
                                    class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                                      <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                                  </svg>
                                </span>
                              </div>
                            </template>
                            <template v-else>
                              <div class="tw-flex tw-items-center">
                                ${teacher.teacher.name}
                                <span v-if= "teacher.teacher.is_inspector_ia" data-toggle="tooltip" data-placement="top" title="Esta solicitação foi feita a uma IA."
                                  style="width: 32px; height: 32px; color: #FF8F3D;"
                                  class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                                      <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                                  </svg>
                                </span>
                              </div>
                            </template>
                          </div>
                          <span class="tw-text-[#384250]">
                            <template v-if="teacher.teacher_subject.subject">${teacher.teacher_subject.subject.name}</template>
                            <template v-else>${teacher.subject.name}</template> - ${teacher.quantity} questões - ${teacher.grade.full_name}
                          </span>
                          <template v-if="teacher.status_count">
                            <div class="tw-space-x-1 tw-mt-2">
                              <span class="tw-inline-flex tw-items-center tw-rounded-full tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-ring-1 tw-ring-inset tw-ring-[#E5E7EA] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-gray-100" v-for="status in Object.keys(teacher.status_count)" v-if="status !== 'Visto' && teacher.status_count[status] > 0">
                                <span class="tw-ml-1 tw-mr-2">
                                  <i class="fas" :class="[getStatusBadgeClass(status).icon, getStatusBadgeClass(status).color]"></i>
                                </span>
                                <span class="tw-text-[#667085]">
                                  ${teacher.status_count[status]} ${status}
                                </span>
                              </span>
                            </div>
                          </template>
                          <template v-if="teacher.teacher_note">
                            <div class="tw-pt-2 tw-pb-0 tw-mb-0">
                              <span class="tw-font-semibold tw-text-[#374151]">Comentário do professor:</span> <span class="text-muted">${teacher.teacher_note}</span>
                            </div>
                          </template>
                        </div>
                        <div class="tw-flex tw-items-center tw-gap-8">
                          <button data-type='exam-teacher-subject' :id="'exam_teacher_subject-' + teacher.id" type="button" @click="selectedTeacher = teacher; getExamQuestions(teacher); selectedQuestionIndex = 0; openModal('teacherModal')" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-lg tw-bg-primary-600 tw-px-9 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-primary-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" 
                            v-if="teacher.exam_questions.length ? teacher.exam_questions.length : teacher.exam_questions_count">
                            Revisar
                          </button>
                          <div v-show="teacher.has_error_create_exam_question_ia "   class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-lg  tw-px-9 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm tw-bg-red-600 "  data-toggle="tooltip" data-placement="top" title="Erro ao gerar questoes com IA. Por favor, repita a solicitação.">
                            Ocorreu um erro
                          </div>
                          {% if not only_review %}
                            <div class="tw-flex tw-gap-3">
                              {% comment %} .tw-text-red-600 {% endcomment %}
                              <button v-show="(teacher && teacher.teacher && !teacher.teacher.is_inspector_ia) || (teacher && teacher.teacher_subject && teacher.teacher_subject.teacher && !teacher.teacher_subject.teacher.is_inspector_ia)"  type="button" @click="updateExamTeacher(teacher)" class="tw-rounded-full tw-bg-[#9BA3AF] tw-p-3 tw-text-white tw-shadow-sm hover:tw-bg-gray-700 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="">
                                <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                  <path d="M21 21.0001H13M2.5 21.5001L8.04927 19.3657C8.40421 19.2292 8.58168 19.161 8.74772 19.0718C8.8952 18.9927 9.0358 18.9013 9.16804 18.7987C9.31692 18.6831 9.45137 18.5487 9.72028 18.2798L21 7.00006C22.1046 5.89549 22.1046 4.10463 21 3.00006C19.8955 1.89549 18.1046 1.89549 17 3.00006L5.72028 14.2798C5.45138 14.5487 5.31692 14.6831 5.20139 14.832C5.09877 14.9643 5.0074 15.1049 4.92823 15.2523C4.83911 15.4184 4.77085 15.5959 4.63433 15.9508L2.5 21.5001ZM2.5 21.5001L4.55812 16.149C4.7054 15.7661 4.77903 15.5746 4.90534 15.4869C5.01572 15.4103 5.1523 15.3813 5.2843 15.4065C5.43533 15.4354 5.58038 15.5804 5.87048 15.8705L8.12957 18.1296C8.41967 18.4197 8.56472 18.5648 8.59356 18.7158C8.61877 18.8478 8.58979 18.9844 8.51314 19.0947C8.42545 19.2211 8.23399 19.2947 7.85107 19.442L2.5 21.5001Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </button>
                              <button type="button" @click="removeExamTeacherSubject(teacher, index)" class="tw-rounded-full tw-bg-[#9BA3AF] tw-p-3 tw-text-white tw-shadow-sm hover:tw-bg-gray-700 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="">
                                <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                  <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </button>
                            </div>                   
                          {% endif %}
                        </div>
                      </div>
                  </draggable>
                  {% if not only_review %}
                  <button data-tg-title="Solicitar questões" data-tg-order="2" data-tg-tour='Clique neste botão para enviar uma solicitação de itens para um professor.' data-tg-group="default-exam-create-update" type="button" class="tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm tw-mt-4 hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" data-toggle="modal" data-target="#exampleModal" data-button-type="teacher" @click="openExampleModal">
                      Solicitar itens a um professor
                      <svg width="25" height="24" viewBox="0 0 25 24" fill="none" class="ml-2">
                        <path d="M12.5 5V19M5.5 12H19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </button>
                  {% endif %}
                  {% if not only_review and user.client_can_request_ai_questions or user.can_request_ai_questions %}
                  <button data-tg-title="Solicitar questões" data-tg-order="2" data-tg-tour='Clique neste botão para enviar uma solicitação de itens para uma IA.' data-tg-group="default-exam-create-update" type="button" class="tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm tw-mt-4 hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" data-toggle="modal" data-target="#exampleModal" data-button-type="reques_question_ia" @click="openExampleModal">
                    Solicitar questões à IA
                    <svg width="25" height="24" viewBox="0 0 25 24" fill="none" class="ml-2">
                      <path d="M12.5 5V19M5.5 12H19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                {% endif %}
                </div>
              </template>
            </div>
          </template>
        </div>
        
        {% if not only_review %}
          <div data-tg-title="Configurações avançadas" data-tg-order="2" data-tg-tour='Se necesário, insira informações secundárias no instrumento availativo.' data-tg-group="default-exam-create-update" class="tw-bg-white sm:tw-rounded-lg tw-py-8 tw-border tw-border-[#E5E7EA]">
            <div  class="tw-px-4 sm:tw-px-6 lg:tw-px-8">
              <h2 class="tw-text-base tw-font-semibold tw-leading-7 tw-text-gray-900 tw-border-b tw-border-gray-900/10 tw-pb-6">
                Configurações avançadas
              </h2>
              <div>
                <div>
                  <div class="tw-mt-8 tw-grid tw-grid-cols-1 tw-gap-x-9 tw-gap-y-6 sm:tw-grid-cols-6">
                    


                    <div class="sm:tw-col-span-2" v-show="{{ form.education_system.field.queryset.exists|lower }}">
                      <label for="{{ form.education_system.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                        {{ form.education_system.label }}
                      </label>
                      <div class="tw-mt-2">
                        {% render_field form.education_system class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.education_system" min="1" %}
                        {% if form.education_system.errors %}
                          <label class="text-danger">{{ form.education_system.errors.0 }}</label>
                        {% endif %}
                      </div>
                    </div>
                    <div class="sm:tw-col-span-4 sm:tw-col-start-1">
                      <label class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Onde serão mostrados os textos base?</label>
                      <fieldset class="tw-mt-4">
                        <legend class="tw-sr-only">Local do texto base</legend>
                        <div class="tw-space-y-4 sm:tw-flex sm:tw-items-center sm:tw-space-x-10 sm:tw-space-y-0">
                          <div class="tw-flex tw-items-center">
                            <input id="id_per_question" name="base_text_location" type="radio" class="tw-h-4 tw-w-4 tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600" value="0" v-model="exam.base_text_location">
                            <label for="id_per_question" class="tw-ml-3 tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Por questão</label>
                          </div>
                          <div class="tw-flex tw-items-center">
                            <input id="id_exam_top" name="base_text_location" type="radio" class="tw-h-4 tw-w-4 tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600" value="1" v-model="exam.base_text_location">
                            <label for="id_exam_top" class="tw-ml-3 tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Por disciplina</label>
                          </div>
                          <div class="tw-flex tw-items-center">
                            <input id="id_subject_top" name="base_text_location" type="radio" class="tw-h-4 tw-w-4 tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600" value="2" v-model="exam.base_text_location">
                            <label for="id_subject_top" class="tw-ml-3 tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Início do caderno</label>
                          </div>
                          <div class="tw-flex tw-items-center">
                            <input id="id_subject_bottom" name="base_text_location" type="radio" class="tw-h-4 tw-w-4 tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600" value="3" v-model="exam.base_text_location">
                            <label for="id_subject_bottom" class="tw-ml-3 tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">Final do caderno</label>
                          </div>
                        </div>
                      </fieldset>
                    </div>
                    
                    {% if user.questions_configuration.can_add_revision_after_closing_exam  %}
                      <div class="sm:tw-col-span-2">
                        <label for="{{ form.review_deadline_pdf.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Prazo para o elaborador revisar o PDF
                        </label>
                        <div class="tw-mt-2">
                          <input type="date" name="{{ form.review_deadline_pdf.html_name }}" id="{{ form.review_deadline_pdf.auto_id }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.review_deadline_pdf">
                          <small v-if="errors.review_deadline_pdf" class="tw-text-sm tw-text-red-400">
                            ${errors.review_deadline_pdf}
                          </small>
                        </div>
                      </div>
                      {% endif %}
                    <div class="sm:tw-col-span-2">
                      <label for="{{ form.start_number.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                        Qual número irá iniciar o caderno?
                      </label>
                      <div class="tw-mt-2">
                        <input type="number" min="1" name="{{ form.start_number.html_name }}" id="{{ form.start_number.auto_id }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.start_number">
                      </div>
                    </div>
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-checkbox">
                        <input type="checkbox" class="custom-control-input" id="id_use_quantity_alternatives" name="use_quantity_alternatives" v-model="exam.use_quantity_alternatives" @change="handleChangeUseQuantityAlternatives" />
                        <label class="custom-control-label tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900" for="id_use_quantity_alternatives">Limitar quantidade de alternativas</label>
                      </div>
                      <div class="tw-mt-2">
                        <input v-show="exam.use_quantity_alternatives" type="number" min="2" name="{{ form.quantity_alternatives.html_name }}" id="{{ form.quantity_alternatives.auto_id }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.quantity_alternatives" />
                      </div>
                    </div>
                    {% if user.client_has_salta_answer_sheet %}
                      <div class="sm:tw-col-span-2">
                        <label for="{{ form.external_code.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Qual o código deste caderno?
                        </label>
                        <div class="tw-mt-2">
                          <input type="number" min="1" name="{{ form.external_code.html_name }}" id="{{ form.external_code.auto_id }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.external_code">
                        </div>
                      </div>
                    {% endif %}
                    {% if user.client_can_select_header_in_create_or_update_exam %}
                      <div class="sm:tw-col-span-2">
                        <label for="id_exam_print_config_header" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Cabeçalho
                        </label>
                        <div class="tw-relative tw-mt-2 tw-flex tw-items-center">
                          <select id="id_exam_print_config_header" name="exam_print_config_header" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.exam_print_config_header">
                            <option value="">Não aplicar cabeçalhos</option>
                            {% for header in exam_headers %}
                              <option value="{{ header.pk }}" {% if header.main_header %} selected {% endif %}>
                                {{ header.name }} {% if header.main_header %} (Padrão) {% endif %}
                              </option>
                            {% endfor %}
                          </select>
                        </div>
                      </div>
                    {% endif %}
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_related_subjects" name="related_subjects" class="custom-control-input" v-model="exam.related_subjects" />
                        <label class="custom-control-label" for="id_related_subjects">
                          <span class="tw-text-[#101928]" :class="[exam.related_subjects ? 'tw-font-semibold' : 'tw-font-medium']">Relacionar disciplinas</span>
                        </label>
                      </div>
                      <div class="form-row mt-3" v-show="exam.related_subjects">
                        <div class="form-group col-md-12">
                          {{ form.relations.label }}
                          {% render_field form.relations v-model="exam.relations" %}
                          <small class="form-text text-muted">
                            {{ form.relations.help_text }}
                          </small> 
                          {% for error in form.relations.errors %} 
                            <label class="text-danger">{{ error}}</label> 
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_random_questions" name="random_questions" class="custom-control-input" v-model="exam.random_questions" />
                        <label class="custom-control-label" for="id_random_questions">
                          <span class="tw-flex tw-flex-grow tw-flex-col">
                            <span class="tw-text-[#101928] tw-flex tw-flex-row" :class="[exam.random_questions ? 'tw-font-semibold' : 'tw-font-medium']">
                              Embaralhar questões
                              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="As questões serão agrupadas por tipo, sendo nessa ordem: objetivas, discursivas e somatório.">
                          <g clip-path="url(#clip0_8_3857)">
                            <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_8_3857">
                              <rect width="16" height="16" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                            </span>
                            <span class="tw-text-xs tw-text-gray-500" id="id_not_applicable-description">
                              Ao gerar o malote de provas serão criados 5 tipos de provas com as mesmas questões em ordens diferentes e distribuídas aleatoriamente entre os alunos.
                            </span>
                          </span>
                        </label>
                        
                      </div>
                    </div>
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_random_alternatives" name="random_alternatives" class="custom-control-input" v-model="exam.random_alternatives" />
                        <label class="custom-control-label" for="id_random_alternatives">
                          <span class="tw-flex tw-flex-grow tw-flex-col">
                          <span class="tw-text-[#101928]" :class="[exam.random_alternatives ? 'tw-font-semibold' : 'tw-font-medium']">Embaralhar alternativas</span>
                          <span class="tw-text-xs tw-text-gray-500" >
                            Ao gerar o malote de provas serão criados 5 tipos de provas com as alternativas de cada questão objetiva em ordens diferentes.
                          </span>
                          </span>
                        </label>
                      </div>
                    </div>
                    {% if user.client_has_tri %}
                      <div class="sm:tw-col-span-2">
                        <div class="custom-control custom-switch">
                          <input type="checkbox" id="id_is_enem_simulator" name="is_enem_simulator" class="custom-control-input" v-model="exam.is_enem_simulator" />
                          <label class="custom-control-label" for="id_is_enem_simulator">
                            <span class="tw-text-[#101928]" :class="[exam.is_enem_simulator ? 'tw-font-semibold' : 'tw-font-medium']">É um simulado Enem</span>
                          </label>
                        </div>
                      </div>
                    {% endif %}
                    <div class="sm:tw-col-span-2">
                      <div class="tw-flex tw-items-center">
                        <div class="custom-control custom-switch">
                          <input type="checkbox" id="id_show_ranking" name="show_ranking" class="custom-control-input" v-model="exam.show_ranking" />
                          <label class="custom-control-label" for="id_show_ranking">
                            <span class="tw-text-[#101928]" :class="[exam.show_ranking ? 'tw-font-semibold' : 'tw-font-medium']">Mostrar ranking</span>
                          </label>
                        </div>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Ative esta opção se deseja que os alunos vejam sua posição na prova.">
                          <g clip-path="url(#clip0_8_3857)">
                            <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_8_3857">
                              <rect width="16" height="16" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                      </div>
                    </div>
                    <div class="sm:tw-col-span-2">
                      <div class="tw-flex tw-items-center">
                        <div class="custom-control custom-switch">
                          <input type="checkbox" id="id_group_attachments" name="group_attachments" class="custom-control-input" v-model="exam.group_attachments" />
                          <label class="custom-control-label" for="id_group_attachments">
                            <span class="tw-text-[#101928]" :class="[exam.group_attachments ? 'tw-font-semibold' : 'tw-font-medium']">Agrupar anexos</span>
                          </label>
                        </div>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Ative esta opção se deseja que os alunos envie as respostas de anexo agrupadas ao final de cada disciplina.">
                          <g clip-path="url(#clip0_8_3857)">
                            <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_8_3857">
                              <rect width="16" height="16" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                      </div>
                    </div>
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_correction_by_subject" name="correction_by_subject" class="custom-control-input" v-model="exam.correction_by_subject" />
                        <label class="custom-control-label" for="id_correction_by_subject">
                          <span class="tw-text-[#101928]" :class="[exam.correction_by_subject ? 'tw-font-semibold' : 'tw-font-medium']">
                            Permitir correção/visualização por professores da mesma disciplina
                          </span>
                        </label>
                      </div>
                    </div>
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_not_applicable" name="not_applicable" class="custom-control-input" v-model="exam.not_applicable" />
                        <label class="custom-control-label" for="id_not_applicable">
                          <span class="tw-flex tw-flex-grow tw-flex-col">
                            <span class="tw-text-[#101928]" :class="[exam.not_applicable ? 'tw-font-semibold' : 'tw-font-medium']" id="id_not_applicable-label">
                              Não permitir aplicação do caderno
                            </span>
                            <span class="tw-text-xs tw-text-gray-500" id="id_not_applicable-description">
                              Marque esta opção se deseja que esse caderno não seja usado em aplicações.
                            </span>
                          </span>
                        </label>
                      </div>
                    </div>
                    {% if user.client_has_discursive_ai_correction %}
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="enable_discursive_ai_correction" name="enable_discursive_ai_correction" class="custom-control-input" v-model="exam.enable_discursive_ai_correction" />
                        <label class="custom-control-label" for="enable_discursive_ai_correction">
                          <span class="tw-flex tw-flex-grow tw-flex-col">
                            <span class="tw-text-[#101928]" :class="[exam.enable_discursive_ai_correction ? 'tw-font-semibold' : 'tw-font-medium']" id="enable_discursive_ai_correction-label">
                              Habilitar correção de discursivas com IA
                            </span>
                            <span class="tw-text-xs tw-text-gray-500" id="enable_discursive_ai_correction-description">
                              Ative esta opção se deseja que as respostas dos alunos sejam corrigidas por IA e a sugestão seja apresentada no momento da correção pelo professor
                            </span>
                          </span>
                        </label>
                      </div>
                    </div>
                    {% endif %}
                    {% if request.user|has_perm:"exams.can_view_confidential_exam" %}
                    <div class="sm:tw-col-span-2">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="is_confidential" name="is_confidential" class="custom-control-input" v-model="exam.is_confidential" />
                        <label class="custom-control-label" for="is_confidential">
                          <span class="tw-flex tw-flex-grow tw-flex-col">
                            <span class="tw-text-[#101928]" :class="[exam.is_confidential ? 'tw-font-semibold' : 'tw-font-medium']" id="is_confidential-label">
                              Caderno confidencial
                            </span>
                            <span class="tw-text-xs tw-text-gray-500" id="is_confidential-description">
                              Cadernos marcados como confidenciais só poderão ser vistos por coordenadores e professores que possuem a devida permissão de acesso
                            </span>
                          </span>
                        </label>
                      </div>
                      <div class="form-row mt-3" v-show="exam.is_confidential">
                        <div class="form-group col-md-12">
                          <input type="date" name="{{ form.confidential_date.html_name }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="exam.confidential_date">
                          <small v-if="errors.confidential_date" class="tw-text-sm tw-text-red-400">
                            ${errors.confidential_date}
                          </small>
                        </div>
                      </div>
                      
                    </div>
                    {% endif %}
                    <div class="tw-col-span-full">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_show_orientations" name="show_orientations" class="custom-control-input" v-model="showOrientations" @change="handleRemoveOrientation" />
                        <label class="custom-control-label" for="id_show_orientations">
                          <span class="tw-text-[#101928]" :class="[showOrientations ? 'tw-font-semibold' : 'tw-font-medium']">
                            Adicionar orientações
                          </span>
                        </label>
                      </div>
                      <div v-show="showOrientations" class="tw-mt-3">
                        <label for="{{ form.orientations.id_for_label }}" class="tw-flex tw-justify-between tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Orientações para a prova
                        </label>
                        <div class="tw-mt-2">
                          {% render_field form.orientations class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" %}
                          <div class="tw-flex tw-justify-end tw-mt-2">
                            <a href="javascript:void(0)" @click="openModal('orientations'), getOrientations()">
                              Escolher orientação padrão
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      </div>
      <div class="tw-mt-6 tw-mb-9">
        {% if only_review %}
          <a href="{% url 'exams:exams_list' %}" class="tw-w-full tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600">Concluir revisão</a>
        {% else %}
          <button type="submit" :disabled="!verifications()" class="tw-w-full tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600">Salvar caderno</button>
        {% endif %}
      </div>
    </form>
  </div>
</div>

<dialog id="copyQuestionDialog" class="tw-p-4 tw-px-8 tw-rounded-lg tw-w-1/3 tw-h-fit tw-overflow-visible">
  <form onsubmit="return false" @submit="submitCopyQuestion()" class="tw-flex tw-flex-col tw-gap-4">
    <div>
      <h3 class="tw-mb-0">Copiar questão</h3>
      <small>Copie essa questão para um outro caderno</small>
    </div>
    <div>
      <label for="destinationExam" class="tw-block tw-mb-2 tw-text-sm tw-font-medium tw-text-gray-900">Caderno de destino</label>
      <select id="availableExams" name="destinationExam" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
        <option value="">Selecione o caderno de destino</option>
      </select>
    </div>
    <div>
      <label for="destinationExamTeacherSubject" class="tw-block tw-mb-2 tw-text-sm tw-font-medium tw-text-gray-900">Solicitação de destino</label>
      <select id="availableExamTeacherSubjects" name="destinationExamTeacherSubject" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
        <option value="">Selecione a solicitação de destino</option>
        <option v-for="examTeacherSubject in availableExamTeacherSubjects" :value="examTeacherSubject.id" v-html="examTeacherSubject.name"></option>
      </select>
    </div>
    <div class="tw-flex tw-items-start tw-mb-5 tw-gap-1">
      <div class="tw-flex tw-items-center tw-h-5">
        <input id="duplicateQuestion" type="checkbox" v-model="copyQuestionData.duplicateQuestion" class="tw-w-4 tw-h-4 tw-border tw-border-gray-300 tw-rounded tw-bg-gray-50 tw-focus:tw-ring-3 tw-focus:tw-ring-blue-300" />
      </div>
      <label for="duplicateQuestion" class="tw-ms-2 tw-text-sm tw-font-medium tw-text-gray-900 tw-flex tw-flex-col">Duplicar Questão no banco<small>Duplique a questão caso queira fazer alterações sem afetar a original</small></label>
    </div>
    <div class="tw-flex tw-gap-3">
      <button type="submit" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-lg tw-bg-primary-600 tw-px-9 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-primary-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">
        Enviar
      </button>
      <button @click="closeCopyModal()" type="button" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-lg tw-bg-primary-600 tw-px-9 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-primary-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">
        Cancelar
      </button>
    </div>
  </form>
</dialog>


 <dialog id="generatingQuestionModal" class="tw-rounded-lg" >
  <div class="tw-flex tw-items-center tw-justify-center" style="min-height: 360px; min-width: 600px;">
      <div>
          <p class="tw-flex tw-justify-center">
              <img src="{% static 'assets/img/gifs/stars.gif' %}" style="max-height: 120px;" class="img-fluid">
          </p>
          <h5 class="text text-muted text-center">Estamos gerando sua nova questão...</h5>
          <p class="text text-muted text-center">Isso pode levar alguns instantes.</p>
      </div>
  </div>
</dialog> 

<dialog id="errorModal" class="tw-rounded-lg">
  <div class="tw-flex tw-items-center tw-justify-center" style="min-height: 150px; min-width: 600px;">
    <div @click.stop>
        <h5 class="tw-text-center">Erro ao gerar a questão!</h5>
        <p class="text text-muted text-center">Houve um erro ao tentar transformar a questão. Tente novamente.</p>
    </div>
  </div>
  <div class= "tw-flex tw-items-center  tw-justify-center tw-mb-6">
    <button @click="closeErrorModal()" type="button" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-lg tw-bg-primary-600 tw-px-9 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-primary-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">
      Ok
    </button>
  </div>
</dialog>

<dialog id="questionGenerateIaModal" style="border-radius: 12px; z-index: 1; max-width: 60vw; max-height: 100vh;">
  <div class="tw-p-3">
      <div class="tw-flex tw-justify-between tw-mb-3">
          <h4 class="text tx-20">Questão gerada por IA</h4>
          <button @click="closeQuestionGenerateIaModal()" class="tw-bg-transparent border-0">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#D0D3D9" class="bi bi-x-lg" viewBox="0 0 16 16">
                  <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>
              </svg>
          </button>
      </div>
      <div class="tw-rounded-lg lize-card" style="max-height: 500px; overflow-y: scroll;">
          <div class="card-body">
              <div v-if="questionData.enunciation">
                  <div class="col-12">
                      <h3 style="font-size: 16pt !important;">Enunciado</h3>
                      <h6 class="text-5 tw-mt-2" v-html="questionData.enunciation"></h6>
                  </div>
              </div>
              <br>
              <div v-if="questionData.commented_answer && selectedQuestionCategory === 'Objetiva'">
                  <div class="col-12 mt-3">
                      <h3 style="font-size: 16pt !important;">Resposta Comentada</h3>
                      <h6 class="text-5 tw-mt-2" v-html="questionData.commented_answer"></h6>
                  </div>
              </div>
              <div v-if="questionData.alternatives && questionData.alternatives.length > 0">
                  <h4 style="font-size: 14pt !important;" class="tw-mt-3">Alternativas:</h4>
                  <div class="row" v-for="(alternative, alternativeIndex) in questionData.alternatives" :key="alternativeIndex">
                      <div class="tw-flex tw-p-2 tw-items-center" :style="{ backgroundColor: alternative.is_correct ? '#41C58814' : '' }">
                          <span class="rounded-circle tw-flex tw-items-center tw-justify-center" :style="{ color: alternative.is_correct ? '#41C588' : '#E6E8EC' }">
                              <template v-if="alternative.is_correct">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-check-circle" viewBox="0 0 16 16">
                                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                      <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05"/>
                                  </svg>
                              </template>
                              <template v-else>
                                  <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                                      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                                      <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                  </svg>
                              </template>
                          </span>
                          <div class="tw-ml-2">
                            <span class="tw-mr-2 text-uppercase">${ String.fromCharCode(65 + alternativeIndex) }</span>
                            <span  style="line-height: 1.4;" v-html="alternative.text">  <span v-if="alternative.is_correct"></span></span>
                          </div>
                      </div>
                  </div>
              </div>
          </div>          
      </div>
      <div class="tw-flex tw-justify-end tw-gap-3 tw-pt-4 ">
          <button @click="confirmChangeQuestion('{{ csrf_token }}')"class="btn btn-block lize-btn-primary m-1" >
              Adicionar à prova
              <svg xmlns="http://www.w3.org/2000/svg" style="font-size: 2rem !important;" width="24" height="24" fill="currentColor" class="bi bi-check2" viewBox="0 0 16 16">
                  <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
              </svg>
          </button>
      </div>
  </div>
</dialog> 

{% include "dashboard/exams/includes/exam/status_dialog.html" with include_question_fragment=True %}

<dialog id="changeQuestionWithIaDialog" class="tw-p-10 tw-px-12 tw-rounded-lg tw-p-10 tw-h-fit tw-overflow-visible">
  <form onsubmit="return false" @submit="submitChangeQuestionWithIa('{{ csrf_token }}')" class="tw-flex tw-flex-col tw-gap-4">
      <div>
          <div class="tw-flex tw-items-center tw-justify-content-between">
              <h3 class="tw-mb-0 tw-mr-3">Transforme sua questão com a ajuda da IA</h3>
              <span data-toggle="tooltip" data-placement="top" title="" class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center" style="width: 32px; height: 32px; color: rgb(255, 143, 61);" data-original-title="Existem questões nesse caderno que foram geradas por IA."><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="bi bi-stars"><path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"></path></svg></span>
          </div>
          <p class="text-muted tw-mb-6">Otimize a mudança das suas questões com nossa inteligência artificial.</p>

          <div class="tw-mb-3">
              <label>
                  <input type="checkbox" v-model="changeType"  class="tw-w-4 tw-h-4 tw-border tw-border-gray-300 tw-rounded tw-bg-gray-50 tw-focus:tw-ring-3 tw-focus:tw-ring-blue-300"/>
                  Trocar <strong v-if="selectedQuestionCategory === 'Objetiva'">Objetiva</strong>
                  <strong v-else>Discursiva</strong> por 
                  <strong v-if="selectedQuestionCategory === 'Objetiva'">Discursiva</strong>
                  <strong v-else>Objetiva</strong>
              </label>
          </div>

          <div class="tw-mb-3">
                <label><input type="checkbox" v-model="reduceStatement"   class="tw-w-4 tw-h-4 tw-border tw-border-gray-300 tw-rounded tw-bg-gray-50 tw-focus:tw-ring-3 tw-focus:tw-ring-blue-300"/> Reduzir enunciado da questão</label>
          </div>
          <div  v-if="selectedQuestionCategory === 'Objetiva'" class="tw-mb-3">
                <label><input type="checkbox" v-model="reduceAlternatives"  class="tw-w-4 tw-h-4 tw-border tw-border-gray-300 tw-rounded tw-bg-gray-50 tw-focus:tw:ring-3 tw-focus:tw-ring-blue-300"/> Diminuir uma alternativa</label>
          </div>
          <div  v-if="selectedQuestionCategory === 'Objetiva'" class="tw-mb-3">
                <label><input type="checkbox" v-model="reduceTextsAlternatives" class="tw-w-4 tw-h-4 tw-border tw-border-gray-300 tw-rounded tw-bg-gray-50 tw-focus:tw:ring-3 tw-focus:tw:ring-blue-300" /> Reduzir textos das alternativas</label>
          </div>
          <div class="tw-mb-3">
            <label>
              <input type="checkbox" v-model="insertContext" class="tw-w-4 tw-h-4 tw-border tw-border-gray-300 tw-rounded tw-bg-gray-50 tw-focus:tw:ring-3 tw-focus:tw:ring-blue-300" />
              Inserir um novo contexto para a questão
            </label>
            <div v-if="insertContext" class="tw-mb-3 tw-ml-6">
              <textarea v-model="contextText" class="form-control" placeholder="Digite o novo contexto aqui..."></textarea>
            </div>
          </div>
          <div class="tw-flex tw-justify-end tw-gap-3">
            <button type="submit" id="changeQuestionWithIaSubmitButton" :disabled="!checkFormCompletion()" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-lg tw-bg-primary-600 tw-px-9 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-primary-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">Sim</button>
            <button @click="closeChangeQuestionWithIAModal" type="button" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-lg tw-bg-primary-600 tw-px-9 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-primary-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">Cancelar</button>
          </div>
      </div>
  </form>
</dialog> 
{% endblock content-fixed %}


{% block extra-modal %}

<div class="modal" id="modalAbilities" tabindex="-1">
  <div class="modal-dialog  sm:tw-max-w-2xl sm:tw-my-8">
    <div class="modal-content" style="border-radius: 8px;">
      <div class="modal-header">
        <h5 class="modal-title">Habilidades necessárias</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

  
      <div class="modal-body" >
        <div class="d-flex p-2 align-items-center my-2 px-4" v-for="ability in abilities">
          <div class="align-self-start">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
              <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"/>
              <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
            </svg>
          </div>
          <div class="mx-3 w-100" style="color: #6C727F;">
            <span v-if="ability.code" class="tx-bold">${ability.code} - </span>${ability.text}
          </div>
          {% comment %} <div>
            <div class="custom-check" @click="addBNCC('ability', ability)" class="d-flex align-items-center justify-content-center">
              <span >
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-check-lg text-white" viewBox="0 0 16 16">
                  <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z"/>
                </svg>
              </span>
            </div>
          </div> {% endcomment %}
        </div>
      </div>
          {% comment %} ${abilities.filter(b => abilities.includes(b)).join(', ')} {% endcomment %}

      {% comment %} </div>   {% endcomment %}
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>


<div class="modal pr-0" tabindex="-1" role="dialog" id="teacherModal-old">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header bg-white">
          <h5 class="modal-title">
            <i class="fas fa-user mr-2"></i>
            <h6 class="mb-1 mt-1" v-if="selectedTeacher && selectedTeacher.exam_questions">
              ${selectedTeacher.teacher_subject.teacher.name} | 
              <span class="text-muted">
                ${selectedTeacher.teacher_subject.subject.name} - ${selectedTeacher.quantity} questões
              </span> |
              <span>
                <b >(${parseFloat(selectedTeacher.sum_weight ? selectedTeacher.sum_weight:0).toFixed(4)} Pontos)</b>
              </span>
            </h6>
          </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <i class="fas fa-times-circle"></i>
          </button>
        </div>
        <div class="modal-body">
          <template v-if="!loadExamQuestions">
            <div class="row">
              <div class="col-5 pr-0" style="overflow: auto; height: 80vh; max-height: 80vh;">
                <draggable 
                  :list="selectedTeacher.exam_questions" 
                  @change="changeObjectsOrder(null, selectedTeacher.exam_questions)" 
                  class="list-group" 
                  ghost-class="ghost" 
                  handle=".move-handle"
                  @start="dragging = true" 
                  @end="dragging = false"
                >
                  <div 
                    v-for="(exam_question, index) in selectedTeacher.exam_questions"
                    :id="exam_question.id" 
                    :key="exam_question.id"
                    class="list-group-item" 
                    v-bind:class="{'selected-row': exam_question.selected }" 
                    {% if user.questions_configuration and user.questions_configuration.can_edit_and_change_position %}
                      @mouseenter="exam_question['showOptions'] = true, $forceUpdate()" 
                      @mouseleave="exam_question['showOptions'] = false, $forceUpdate()"
                    {% endif %}
                    @click="
                      selectedTeacher.exam_questions[selectedQuestionIndex].selected=false; selectedQuestionIndex=index;
                      exam_question.selected=true;
                      fetchQuestion(exam_question.question);
                      updateWeight = Number(exam_question.weight).toFixed(6);
                    " 
                  >
                    <div class="row mb-1">
                      <div class="col">
                        <span class="float-right">
                          <template v-if="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto')">
                            <span class="badge" :class="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto').class"> <i class="fas"
                              :class="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto').icon"></i>
                              ${exam_question.last_status.status_display || 'Em aberto'}
                            </span>
                          </template>
                        </span>
                        <div class="w-100">
                          <template>
                              <span class="badge badge-warning" v-if="exam_question.question.used_times > 1">
                                Utilizada ${exam_question.question.used_times-1} Vez(es)
                              </span>
                              <span class="badge badge-success" v-else>
                                Inédita
                              </span>
                          </template>
                          <span class="badge badge-success">
                            ${exam_question.question.get_level_display}
                          </span>
                          <h6 class="mb-1 mt-2 font-weight-normal">
                            <p v-if="exam_question.question.board" class="mb-0">
                              (${exam_question.question.board})
                            </p>
                            <template v-if="exam_question.last_status.status_display == 'Anulada'">
                              <del>
                                ${exam_question.question.enunciation}
                              </del>
                            </template>
                            <template v-else>
                              ${exam_question.question.enunciation}
                            </template>
                          </h6>
                          <h6 class="mt-1 mb-0 float-right" v-if="exam_question.question.created_by_name">
                            <span class="text-muted"> Criado por </span><span class="font-weight-bold">
                              ${exam_question.question.created_by_name}
                            </span>
                          </h6>
                          <h6 class="mt-1 mb-0">
                            <template v-if="recalculateWeights">
                              Recalculando notas...
                              <div class="spinner-border text-primary" style="width: .8rem; height: .8rem;" role="status">
                                <span class="sr-only">Loading...</span>
                              </div>
                            </template>
                            <template v-else>
                              <span v-if="exam_question.block_weight">
                                <i class="fas fa-lock text-danger" title="A questão está com a nota travada."></i>
                              </span>
                              <template v-if="exam_question.last_status.status_display != 'Anulada'">
                                <template v-if="unavailableStatus.includes(exam_question.last_status.status_display)">
                                  <strike>${exam_question.weight}</strike> Pontos
                                </template>
                                <template v-else>
                                  <b>${exam_question.weight}</b> Pontos
                                </template>
                              </template>
                            </template>
                            <template>
                              &nbsp;
                            </template>
                          </h6>
                        </div>
                        <p class="mb-1" v-if="exam_question.question.topic_name">
                          <span class="badge badge-primary">
                            ${exam_question.question.topic_name}
                          </span>
                        </p>
                      </div>
                      <div v-if="exam_question['showOptions']" class="col-1 border-left d-flex flex-column justify-content-center aling-items-center">
                        <i class="fa fa-edit mb-2" @click="openNewWindow('/questoes/'+exam_question.question.pk+'/editar/?is_popup=1&request_tags='+request_tags);"></i>
                        <i class="fas fa-expand-arrows-alt mt-2 move-handle"></i>
                      </div>
                    </div>
                  </div>
                </draggable>
              </div>
              <div class="col-7 p-3 selected-row" style="overflow: auto; height: 80vh; max-height: 80vh; max-width: 57%">
                <template v-if="selectedTeacher && selectedTeacher.exam_questions && selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display != 'Anulada'">
                  <div class="d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <template v-if="!loadingBlockWeight && selectedTeacher.exam_questions[selectedQuestionIndex].block_weight">
                        <label for="inputUpdateWeight" class="mb-0">Nota atual:</label>
                        <input style="width: 100px;" id="inputUpdateWeight" v-model="updateWeight" step="any" type="number" class="form-control mx-2" @change="checkUpdateWeight($event, selectedTeacher.exam_questions[selectedQuestionIndex])" @keyup="checkUpdateWeight($event, selectedTeacher.exam_questions[selectedQuestionIndex])">
                        <div class="input-group-append">
                          <button id="update-note" @click="updateWeightQuestionWithBlockWeight(selectedTeacher.exam_questions[selectedQuestionIndex])" class="btn btn-sm btn-outline-secondary" type="button">
                            <i class="fas fa-sync-alt"></i> Atualizar Nota
                          </button>
                        </div>
                      </template>
                      <template v-else>
                        Nota atual: ${selectedTeacher.exam_questions[selectedQuestionIndex].weight}
                      </template>
                    </div>
                    <div class="mt-2">
                      <a href="javascript:;" :class="selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'text-muted':'text-danger'" title="Travar nota da questão." v-if="!loadingBlockWeight" @click="blockQuestionWeight(selectedTeacher.exam_questions[selectedQuestionIndex])">${selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'Destravar nota da questão':'Travar nota da questão'} <i class="cp fas" :class="selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'fa-unlock':'fa-lock'"></i></a>
                    </div>
                  </div>
                  <div class="d-flex flex-row justify-content-between mt-2 mb-3">
                    <div v-if="selectedTeacher && selectedTeacher.exam_questions">
                      {% if not object.total_grade and user_type != 'teacher' or user.inspector.can_update_note %}
                        <div v-if="!selectedTeacher.subject_note && !selectedTeacher.exam_questions[selectedQuestionIndex].block_weight" class="input-group input-group-sm">
                          <input style="width: 100px;" id="input-update-weight-not-load" type="text" class="form-control" :value="selectedTeacher.exam_questions[selectedQuestionIndex].weight">
                          <div class="input-group-append">
                            <button id="update-note" @click="updateWeightQuestion(selectedTeacher.exam_questions[selectedQuestionIndex])" class="btn btn-sm btn-outline-secondary" type="button">
                              <i class="fas fa-sync-alt"></i> Atualizar Nota
                            </button>
                          </div>
                        </div>
                        <div v-if="selectedTeacher.subject_note && !selectedTeacher.exam_questions[selectedQuestionIndex].block_weight" class="alert alert-light" role="alert">
                          A nota da disciplina já foi definida
                        </div>
                      {% endif %}
                    </div>
                    <div>
                        <template v-if="selectedTeacher && selectedTeacher.exam_questions">
                          <template v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display != 'Anulada'">
                            <template v-if="!exam.application_is_finished">

                              {% if user_type != 'teacher' or user.inspector.can_viewed %}
    
                                <button @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 5)"
                                  type="button" class="btn btn-primary btn-sm">
                                  <i class="fas fa-check"></i>
                                  Dar Visto
                                </button>
    
                              {% endif %}
    
                              {% if user_type != 'teacher' or user.inspector.can_approve %}
                              <button @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 0)"
                                v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display !== 'Aprovada'"
                                type="button" class="btn btn-success btn-sm">
                                <i class="fas fa-check"></i>
                                Aprovar
                              </button>
                              {% endif %}

                              {% if user_type != 'teacher' or user.inspector.can_suggest_correction %}
                                <button @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 3)" type="button" class="btn btn-warning btn-sm"><i
                                    class="fas fa-edit"></i>
                                  Correção
                                </button>
                                <button @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 7)" type="button" class="btn btn-info btn-sm"><i class="fas fa-clock"></i>
                                  Usar depois
                                </button>
                              {% endif %}
    
                              {% if user_type != 'teacher' or user.inspector.can_fail %}
                                <button @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 1)"
                                  v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display !== 'Reprovada'"
                                  type="button" class="btn btn-danger btn-sm">
                                  <i class="fas fa-times"></i>
                                  Reprovar
                                </button>
                              {% endif %}
                            </template>

                            {% if user_type != 'teacher' or user.inspector.can_annul %}
                              <button @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 6)"
                                v-if="selectedTeacher.exam_questions[selectedQuestionIndex].has_answer"
                                type="button" class="btn btn-danger btn-sm">
                                <i class="fas fa-times-circle"></i>
                                Anular
                              </button>
                            {% endif %}
                          </template>
                      </template>
                    </div>
                  </div>
                  <hr/>
                </template>      
                
                <div id="question-details" class="mb-3 p-2" v-show="selectedQuestion.enunciation">
                
                  <ul class="nav nav-tabs mb-4" id="questiontab">
                    <li class="nav-item">
                      <a class="nav-link active" data-toggle="tab" href="#question-tab" aria-current="page" >
                        <i class="fas fa-align-right mr-1"></i>
                        Enunciado</a>
                    </li>
                    <li class="nav-item" v-if="selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0">
                      <a class="nav-link" data-toggle="tab" href="#baseText-tab">
                        Textos Base
                        <span class="badge badge-primary ml-1">
                          ${selectedQuestion.base_texts.length}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" data-toggle="tab" href="#data-tab">
                        <i class="fas fa-info-circle  mr-1"></i>
                        Dados Pedagógicos</a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" data-toggle="tab" href="#history-tab">
                        <i class="fas fa-history  mr-1"></i> Histórico 
                        <span class="badge badge-primary ml-1"
                          v-if="selectedTeacher && selectedTeacher.exam_questions">
                          ${selectedTeacher.exam_questions[selectedQuestionIndex].status_list.length}</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" data-toggle="tab" href="#uses-tab">
                        <i class="fas fa-history  mr-1"></i> Utilizações 
                        <span class="badge badge-primary ml-1"
                          v-if="selectedQuestion && selectedQuestion.uses">
                          ${selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}').length}</span>
                      </a>
                    </li>
                  </ul>
                  <div class="tab-content">
                    <div class="tab-pane fade show active" id="question-tab" role="tabpanel" aria-labelledby="question-tab">
                      <p v-if="selectedQuestion.board" class="tw-mb-0">(${selectedQuestion.board})</p>
                      <div v-html="selectedQuestion.enunciation" class="mb-2"></div>
                      <div class="form-check" v-for="alternative in selectedQuestion.alternatives">
                        <input class="form-check-input" type="radio" disabled="disabled" :checked="alternative.is_correct">
                        <label v-bind:class="[alternative.is_correct ? 'text-success' : '']"
                          v-html="alternative.text"></label>
                      </div>
                    </div>
                    
                      <div class="tab-pane fade" id="data-tab" role="tabpanel" aria-labelledby="data-tab">
                        <div class="row">
                          <div class="col-12">
                            <div class="card">
                              <div class="card-header p-2 font-weight-bold">
                                Dificuldade
                              </div>
                              <ul class="list-group list-group-flush">
                                <li class="list-group-item p-1 px-2">${getLevelLabel(selectedQuestion.level)}</li>
                              </ul>
                            </div>
                          </div>
                          <div class="col-12">
                            <div class="card mt-2">
                              <div class="card-header p-1 px-2 font-weight-bold">
                                Assuntos Abordados
                              </div>
                              <ul class="list-group list-group-flush">
                                <template v-if="selectedQuestion.topics">
                                    <li v-if="!selectedQuestion.topics.length" class="list-group-item  p-1">Não há assuntos cadastrados nessa questão</li>
                                    <li v-else v-for="topic in selectedQuestion.topics" class="list-group-item  p-2">
                                      ${topic.name}</li>
                                </template>
                              </ul>
                            </div>
                          </div>
                          <div class="col-12">
                            <div class="card mt-2">
                              <div class="card-header p-2 font-weight-bold">
                                Habilidades
                              </div>
                              <ul class="list-group list-group-flush">
                                <template v-if="selectedQuestion.abilities">
                                  <li v-if="!selectedQuestion.abilities.length" class="list-group-item  p-1">Não há habilidades cadastradas nessa questão</li>
                                  <li v-else v-for="ability in selectedQuestion.abilities" class="list-group-item  p-2">
                                    ${ability.code ? '('+ability.code+')':''} ${ability.text}</li>
                                </template>
                              </ul>
                            </div>
                          </div>
                          <div class="col-12">
                            <div class="card mt-2">
                              <div class="card-header p-2 font-weight-bold">
                                Competências
                              </div>
                              <ul class="list-group list-group-flush">
                                <template v-if="selectedQuestion.competences">
                                  <li v-if="!selectedQuestion.competences.length" class="list-group-item  p-1">Não há competências cadastradas nessa questão</li>
                                  <li v-else v-for="competence in selectedQuestion.competences" class="list-group-item  p-2">
                                    ${competence.code ? '('+competence.code+')':''} ${competence.text}</li>
                                </template>
                              </ul>
                            </div>
                          </div>
                        </div>
                      </div>

                      <div class="tab-pane fade" id="history-tab" role="tabpanel" aria-labelledby="history-tab">
                        <div v-if="selectedTeacher && selectedTeacher.exam_questions">
                          <div class="row">
                            <div class="col-12 my-2 filter-button-group">
                              <label class="bold">Mostrar:</label>
                              <button
                                class="btn btn-sm btn-outline-secondary m-1 py-0 removeFilters" 
                                style="cursor: pointer;"
                                @click="selectedFilter = ''"
                                v-bind:class="!selectedFilter ? 'active':''"
                              >
                              Todos
                            </button>
                              <button 
                                v-for="status in Object.keys(statusList)"
                                :class="`btn btn-sm m-1 py-0 ${getStatusBadgeClass(status).class.replace('badge', 'btn-outline')} ${selectedFilter == status ? 'active':''}`"
                                v-if="status != 'Em aberto'"
                                @click="selectedFilter = status"
                                style="cursor: pointer;"
                              >
                              ${status}
                              </button>
                            </div>
                          </div>
                          <template v-for="note in selectedTeacher.exam_questions[selectedQuestionIndex].status_list">
                              <div class="row" v-show="!selectedFilter || note.status_display == selectedFilter">
                                <div class="col-12">
                                  <div class="card">
                                    <div class="card-header p-2 font-weight-bold">
                                      <span class="float-right text-right">
                                        <span class="badge  mr-1 " :class="getStatusBadgeClass(note.status_display).class">
                                          <i class="fas" :class="getStatusBadgeClass(note.status_display).icon"></i>
                                          ${note.status_display}
                                        </span>
                                        
                                        <p class="text-muted m-0" v-if="note.user_name">por ${note.user_name}
                                        </p>
                                      </span>
                                      

                                      <span class="">
                                        ${momentRef(note.created_at).fromNow()}<br/>
                                        <small class="text-muted p-0">
                                          ${momentRef(note.created_at).format('L')} às ${momentRef(note.created_at).format('LT')}
                                        </small>
                                      </span>
                                      
                                    </div>
                                    <ul class="list-group list-group-flush">
                                      <li class="list-group-item p-2" v-if="note.note">
                                        <template >${note.note}</template>
                                      </li>
                                      <li class="list-group-item p-2" v-if="note.question_fragment">
                                        <template >${note.question_fragment}</template>
                                      </li>
                                      <li class="list-group-item p-2" v-if="status_tags_history.find((status) => note.id==status.pk)">
                                          <span v-for="status in status_tags_history">
                                            <span v-if="status.pk == note.id" v-for="tag in status.tags" class="badge badge-primary m-2">${tag}</span>
                                          </span>
                                      </li>
                                    </ul>
                                  </div>
                                </div>
                              </div>
                            </template>
                        </div>
                      </div>
                      <div class="tab-pane fade" id="uses-tab" role="tabpanel" aria-labelledby="uses-tab">
                        <div class="row" v-if="selectedQuestion && (selectedQuestion.uses && selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}').length)">
                          <div class="col-12 my-2">
                            <table class="table">
                              <thead>
                                <tr>
                                  <th>Cadernos</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr v-for="use in selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}')">
                                  <td>
                                    <strong>${use.exam_name}</strong> <span class="badge badge-primary">ESTA PROVA</span>
                                    <br>
                                    ${use.application_date ? 'Data da aplicação: ' + use.application_date: 'Nenhuma aplicação vinculada'}
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                        <div v-else class="row">
                          <div class="col-12">
                            <h6>A questão não foi utilizada nenhuma vez</h6>
                          </div>
                        </div>
                      </div>
                      <div class="tab-pane fade" id="baseText-tab" role="tabpanel" aria-labelledby="baseText-tab">
                        <div class="row">
                          <div class="col-12 mb-3" v-for="(baseText, index) in selectedQuestion.base_texts">
                            <div class="card">
                              <div class="card-body">
                                <h4 class="text-muted text-uppercase">Texto Base ${index + 1}</h4>
                                <div v-html="baseText.text"></div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                  </div>
                  </div>
              </div>
            </div>
          </template>
          <template v-else>
            <div class="row h-100">
              <div class="col-12 h-100 my-4 d-flex flex-column justify-content-center align-items-center">
                <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                  <span class="sr-only">Loading...</span>
                </div>
                <p class="text-center tx-rubik p-4">Aguarde enquanto carregamos os dados das questões</p>
              </div>
            </div>
          </template>
        </div> 
    </div>
  </div>
</div>

<div class="modal fade" id="teacherModal" tabindex="-1" role="dialog" aria-labelledby="teacherModalLabel" aria-hidden="true">
  <div class="modal-dialog sm:tw-max-w-7xl sm:tw-my-6" role="document" style="height: calc(100vh - 3rem);">
    <div class="modal-content" style="background: inherit; border: inherit; border-radius: inherit; height: 100%;">
      <div class="tw-flex tw-min-h-full tw-items-end tw-justify-center tw-p-4 tw-text-center sm:tw-items-center sm:tw-p-0">
        <div class="tw-relative tw-transform tw-overflow-hidden tw-rounded-lg tw-bg-white tw-text-left tw-shadow-xl tw-transition-all sm:tw-w-full sm:tw-max-w-7xl" style="height: 100%;">
          <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block sm:tw-pt-4 sm:tw-pr-6">
            <button type="button"  @click="closeTeacherModal" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" data-dismiss="modal">
              <span class="tw-sr-only">Close</span>
              <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div style="height: 100%;">
            <div style="height: 100%;">
              <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left" style="height: 100%;">
                <div class="tw-flex tw-items-center tw-px-4 tw-pb-4 tw-pt-5 tw-border-b tw-border-[#E5E7EA] sm:tw-px-6 sm:tw-py-4">
                  <template v-if="selectedTeacher && selectedTeacher.exam_questions">
                    <h3 class="tw-text-base tw-font-medium tw-leading-6 tw-mr-3 tw-text-gray-900" id="modal-title">
                      ${selectedTeacher.teacher_subject.teacher.name}
                    </h3>
                    <span v-if="selectedTeacher.teacher_subject.teacher.is_inspector_ia || hasAiCreatedOrAdaptedQuestion" 
                    data-toggle="tooltip" data-placement="top" title="Questão gerada ou modificada por IA."
                    style="width: 32px; height: 32px; color: #FF8F3D;" class="lize-bg-warning-light rounded-circle d-flex align-items-center justify-content-center">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                        <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"/>
                      </svg>
                    </span>
                  </template>
                </div>
                <div style="height: calc(100% - 3.5rem);">
                  <template v-if="!loadExamQuestions">
                    <div class="tw-grid tw-grid-cols-1 tw-items-start lg:tw-grid-cols-3" style="height: 100%;">
                      <!-- Left column -->
                      <div class="tw-grid tw-grid-cols-1 tw-gap-4" style="height: 100%; overflow: auto;">
                        <section aria-labelledby="section-1-title">
                          <h2 class="tw-sr-only" id="section-1-title">Section title</h2>
                          <div class="tw-overflow-hidden tw-bg-[#F9FAFA]">
                            <div class="">
                              <div class="tw-flex tw-justify-between tw-items-center">
                                <h3 class="tw-text-base tw-font-medium tw-leading-6 tw-text-gray-900 tw-p-6" id="modal-title">
                                  ${selectedTeacher.quantity} questões
                                </h3>
                                <div class="tw-p-6" id="modal-title">
                                  <button
                                    data-toggle="dropdown"
                                    data-tg-title="Filtro por status da questão"
                                    class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-[#667085] tw-border tw-border-[#E5E7EA] tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm tw-bg-white hover:tw-bg-gray-50 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600"
                                    type="button"
                                    id="dropdownStatus"
                                    @click="toggleDropdownStatus"
                                    aria-haspopup="true"
                                    aria-expanded="false"
                                    style="top:55px"
                                  >
                                    <span class="tw-font-semibold">${ selectedStatusLabel }</span>
                                    <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                      <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                                    </svg>
                                  </button>
                                  <div v-show="isDropdownStatusOpen" class="dropdown-menu tw-pb-0" aria-labelledby="dropdownStatus">
                                    <ul>
                                      <li
                                        v-for="status in statuses"
                                        :key="status.value"
                                        @click="selectStatus(status.value)"
                                        class="dropdown-option tw-px-4 tw-py-2 hover:tw-bg-gray-100 tw-cursor-pointer"
                                      >
                                        <i :class="['fa', status.icon, status.color]" :style=""class="tw-mr-2"></i>
                                        <span>${ status.label }</span>
                                      </li>
                                    </ul>
                                  </div>
                                </div>
                              </div>
                              
                              <ul v-show="examQuestionsFiltered && examQuestionsFiltered.length > 0" role="list" class="tw-divide-y tw-divide-gray-100" style="overflow: auto;">
                                <draggable
                                  :list="examQuestionsFiltered"
                                  @change="changeObjectsOrder(null, examQuestionsFiltered)"
                                  ghost-class="ghost"
                                  handle=".move-handle"
                                  @start="dragging = true"
                                  @end="dragging = false"
                                >
                                  <li ref="examQuestionItems" class="tw-flex tw-gap-x-4 tw-py-5 tw-px-6 tw-cursor-pointer" v-for="(exam_question, index) in examQuestionsFiltered" :id="exam_question.id" :key="exam_question.id" :class="{' tw-bg-[#D1FADF]': exam_question.selected }"
                                    {% if user.questions_configuration and user.questions_configuration.can_edit_and_change_position %}
                                      @mouseenter="exam_question['showOptions'] = true, $forceUpdate()"
                                      @mouseleave="exam_question['showOptions'] = false, $forceUpdate()"
                                    {% endif %}
                                    @click="examQuestionsFiltered[selectedQuestionIndex].selected=false; selectedQuestionIndex=index; exam_question.selected=true; fetchQuestion(exam_question.question); updateWeight = Number(exam_question.weight).toFixed(6);">
                                    <!-- <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="tw-flex-none">
                                      <path d="M14 11H8M10 15H8M16 7H8M20 6.8V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V6.8C4 5.11984 4 4.27976 4.32698 3.63803C4.6146 3.07354 5.07354 2.6146 5.63803 2.32698C6.27976 2 7.11984 2 8.8 2H15.2C16.8802 2 17.7202 2 18.362 2.32698C18.9265 2.6146 19.3854 3.07354 19.673 3.63803C20 4.27976 20 5.11984 20 6.8Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg> -->
                                    <div class="d-flex flex-column justify-content-between align-items-center">
                                      <span style="font-size: 1.8rem; color: #667085;">
                                        <template v-if="exam_question.exam_question_number">
                                          ${exam_question.exam_question_number}
                                        </template>
                                        <template v-else>
                                          -
                                        </template>
                                      </span>
                                      <span v-if="canRemoveExamTeacherSubject && selectedStatus == 'todas'" class="tw-flex tw-items-center move-handle">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="tw-flex-none">
                                          <path d="M12 6C12.5523 6 13 5.55228 13 5C13 4.44772 12.5523 4 12 4C11.4477 4 11 4.44772 11 5C11 5.55228 11.4477 6 12 6Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M12 20C12.5523 20 13 19.5523 13 19C13 18.4477 12.5523 18 12 18C11.4477 18 11 18.4477 11 19C11 19.5523 11.4477 20 12 20Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M19 6C19.5523 6 20 5.55228 20 5C20 4.44772 19.5523 4 19 4C18.4477 4 18 4.44772 18 5C18 5.55228 18.4477 6 19 6Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M19 13C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11C18.4477 11 18 11.4477 18 12C18 12.5523 18.4477 13 19 13Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M19 20C19.5523 20 20 19.5523 20 19C20 18.4477 19.5523 18 19 18C18.4477 18 18 18.4477 18 19C18 19.5523 18.4477 20 19 20Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M5 6C5.55228 6 6 5.55228 6 5C6 4.44772 5.55228 4 5 4C4.44772 4 4 4.44772 4 5C4 5.55228 4.44772 6 5 6Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M5 13C5.55228 13 6 12.5523 6 12C6 11.4477 5.55228 11 5 11C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          <path d="M5 20C5.55228 20 6 19.5523 6 19C6 18.4477 5.55228 18 5 18C4.44772 18 4 18.4477 4 19C4 19.5523 4.44772 20 5 20Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                      </span>
                                      <span>&nbsp;</span>
                                    </div>
                                    <div class="tw-flex-auto">
                                      <div class="tw-flex tw-items-baseline tw-justify-between tw-gap-x-4">
                                        <div>
                                          <template v-if="exam_question.question.used_times > 1">
                                            <span class="tw-inline-flex tw-items-center tw-rounded-full tw-bg-[#F3B364] tw-px-3 tw-py-0.5 tw-text-xs tw-font-medium tw-text-white">
                                            Utilizada ${exam_question.question.used_times-1} vez(es)
                                          </span>
                                          </template>
                                          <template v-else>
                                            <span class="tw-inline-flex tw-items-center tw-rounded-full tw-bg-[#0DA55E] tw-px-3 tw-py-0.5 tw-text-xs tw-font-medium tw-text-white">
                                              Inédita
                                            </span>
                                          </template>
                                          <span class="tw-inline-flex tw-items-center tw-rounded-full tw-bg-[#0DA55E] tw-px-3 tw-py-0.5 tw-text-xs tw-font-medium tw-text-white">
                                            ${exam_question.question.get_level_display}
                                          </span>
                                        </div>

                                        <!-- <p class="tw-text-sm tw-font-semibold tw-leading-6 tw-text-gray-900"> -->
                                          <!---->

                                          <!-- <span class="tw-inline-flex tw-items-center tw-rounded-full tw-bg-[#0DA55E] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-white tw-mr-10">Revisado</span> -->
                                        <!-- </p> -->
                                        <div class="tw-flex tw-items-center tw-text-xs tw-text-gray-600">
                                          <template v-if="getStatusBadgeClass(exam_question.last_status.annuled_give_score ? 'Anulada e pontuação dada' : (exam_question.last_status.status_display || 'Em aberto'))">
                                            <span class="tw-inline-flex tw-items-center tw-rounded-full tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-bg-white tw-ring-1 tw-ring-inset tw-ring-[#E5E7EA] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-gray-100">
                                              <span class="tw-ml-1 tw-mr-2">
                                                <i class="fas" :class="[getStatusBadgeClass(exam_question.last_status.annuled_give_score ? 'Anulada e pontuação dada' : (exam_question.last_status.status_display || 'Em aberto')).icon, getStatusBadgeClass(exam_question.last_status.annuled_give_score ? 'Anulada e pontuação dada' : (exam_question.last_status.status_display || 'Em aberto')).color]"></i>
                                              </span>
                                              <span class="tw-text-[#667085]">
                                                ${exam_question.last_status.annuled_give_score ? 'Anulada e pontuação dada' : (exam_question.last_status.status_display || 'Em aberto')}
                                              </span>
                                            </span>
                                          </template>

                                          <!-- <template> -->
                                          <!-- <time datetime="2023-03-04T15:54Z">1d ago</time> -->
                                          <span class="tw-ml-1" :class="[exam_question['showOptions'] ? 'tw-visible' : 'tw-invisible']" @click="openNewWindow('/questoes/'+exam_question.question.pk+'/editar/?is_popup=1&request_tags='+request_tags);">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                              <path d="M11 3.99998H6.8C5.11984 3.99998 4.27976 3.99998 3.63803 4.32696C3.07354 4.61458 2.6146 5.07353 2.32698 5.63801C2 6.27975 2 7.11983 2 8.79998V17.2C2 18.8801 2 19.7202 2.32698 20.362C2.6146 20.9264 3.07354 21.3854 3.63803 21.673C4.27976 22 5.11984 22 6.8 22H15.2C16.8802 22 17.7202 22 18.362 21.673C18.9265 21.3854 19.3854 20.9264 19.673 20.362C20 19.7202 20 18.8801 20 17.2V13M7.99997 16H9.67452C10.1637 16 10.4083 16 10.6385 15.9447C10.8425 15.8957 11.0376 15.8149 11.2166 15.7053C11.4184 15.5816 11.5914 15.4086 11.9373 15.0627L21.5 5.49998C22.3284 4.67156 22.3284 3.32841 21.5 2.49998C20.6716 1.67156 19.3284 1.67155 18.5 2.49998L8.93723 12.0627C8.59133 12.4086 8.41838 12.5816 8.29469 12.7834C8.18504 12.9624 8.10423 13.1574 8.05523 13.3615C7.99997 13.5917 7.99997 13.8363 7.99997 14.3255V16Z" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                          </span>
                                          {% if user|has_perm:'questions.can_duplicate_question' %}
                                            <span class="tw-ml-1" :class="[exam_question['showOptions'] ? 'tw-visible' : 'tw-invisible']" @click="openCopyModal()">
                                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" ><path d="M15 2H9a1 1 0 0 0-1 1v2c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V3c0-.6-.4-1-1-1Z"/><path d="M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2M16 4h2a2 2 0 0 1 2 2v2M11 14h10"/><path d="m17 10 4 4-4 4"/></svg>
                                            </span>
                                          {% endif %}
                                            <!-- <i class="fa fa-edit mb-2" :class="[exam_question['showOptions'] ? 'tw-visible' : 'tw-invisible']" @click="openNewWindow('/questoes/'+exam_question.question.pk+'/editar/?is_popup=1&request_tags='+request_tags);"></i> -->
                                            <!-- <i class="fas fa-expand-arrows-alt mt-2 move-handle tw-cursor-move"></i> -->
                                          <!-- </template> -->
                                        </div>
                                      </div>
                                      <p class="tw-mt-1 tw-line-clamp-2 tw-text-sm tw-leading-6" :class="[exam_question.selected ? 'tw-text-[#101928] tw-font-semibold' : 'tw-text-gray-600']">
                                        <p v-if="exam_question.question.board" class="tw-mb-0">(${exam_question.question.board})</p>
                                        <template v-if="exam_question.last_status.status_display == 'Anulada'">
                                          <del>
                                            ${exam_question.question.enunciation}
                                          </del>
                                        </template>
                                        <template v-else>
                                          ${exam_question.question.enunciation}
                                        </template>
                                      </p>
                                      <div class="tw-flex tw-justify-between tw-text-xs tw-mt-2">
                                        <div v-if="exam_question.question.created_by_name">
                                          <span class="tw-text-gray-500">Criado por </span>
                                          <span class="tw-font-bold">${exam_question.question.created_by_name}</span>
                                        </div>
                                        <div>
                                          <template v-if="recalculateWeights">
                                            Recalculando notas...
                                            <div class="spinner-border text-primary" style="width: .8rem; height: .8rem;" role="status">
                                              <span class="sr-only">Loading...</span>
                                            </div>
                                          </template>
                                          <template v-else>
                                            <span v-if="exam_question.block_weight">
                                              <i class="fas fa-lock text-danger" title="A questão está com a nota travada."></i>
                                            </span>
                                            <template v-if="exam_question.last_status.status_display != 'Anulada' || (exam_question.last_status.status_display == 'Anulada' && exam_question.last_status.annuled_give_score)">
                                              <template v-if="unavailableStatus.includes(exam_question.last_status.status_display) && !exam_question.last_status.annuled_give_score">
                                                <strike>${exam_question.weight}</strike> Pontos
                                              </template>
                                              <template v-else>
                                                <strong>${exam_question.weight}</strong> Pontos
                                              </template>
                                            </template>
                                          </template>
                                        </div>
                                      </div>
                                      <p class="mb-1" v-if="exam_question.question.topic_name">
                                        <span class="badge badge-primary">
                                          ${exam_question.question.topic_name}
                                        </span>
                                      </p>
                                    </div>
                                  </li>
                                </draggable>
                              </ul>
                              <div v-show="examQuestionsFiltered && examQuestionsFiltered.length == 0" class="tw-flex tw-items-center tw-justify-center tw-bg-white tw-text-gray-600 tw-text-md tw-mt-2 tw-pt-2">
                                Nenhuma questão com esse status encontrada
                              </div>
                              <!-- <draggable
                                :list="selectedTeacher.exam_questions"
                                @change="changeObjectsOrder(null, selectedTeacher.exam_questions)"
                                class="list-group"
                                ghost-class="ghost"
                                handle=".move-handle"
                                @start="dragging = true"
                                @end="dragging = false"
                              >
                                <div 
                                  v-for="(exam_question, index) in selectedTeacher.exam_questions"
                                  :id="exam_question.id"
                                  :key="exam_question.id"
                                  class="list-group-item"
                                  v-bind:class="{'selected-row': exam_question.selected }"
                                  {% if user.questions_configuration and user.questions_configuration.can_edit_and_change_position %}
                                    @mouseenter="exam_question['showOptions'] = true, $forceUpdate()"
                                    @mouseleave="exam_question['showOptions'] = false, $forceUpdate()"
                                  {% endif %}
                                  @click="
                                    selectedTeacher.exam_questions[selectedQuestionIndex].selected=false;
                                    selectedQuestionIndex=index;
                                    exam_question.selected=true;
                                    fetchQuestion(exam_question.question);
                                    updateWeight = Number(exam_question.weight).toFixed(6);
                                  "
                                >
                                  <div class="row mb-1">
                                    <div class="col">
                                      <span class="float-right">
                                        <template v-if="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto')">
                                          <span class="badge" :class="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto').class"> <i class="fas"
                                            :class="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto').icon"></i>
                                            ${exam_question.last_status.status_display || 'Em aberto'}
                                          </span>
                                        </template>
                                      </span>
                                      <div class="w-100">
                                        <template>
                                          <span class="badge badge-warning" v-if="exam_question.question.used_times > 1">
                                            Utilizada ${exam_question.question.used_times-1} Vez(es)
                                          </span>
                                          <span class="badge badge-success" v-else>
                                            Inédita
                                          </span>
                                        </template>
                                        <span class="badge badge-success">
                                          ${exam_question.question.get_level_display}
                                        </span>
                                        <h6 class="mb-1 mt-2 font-weight-normal">
                                          <template v-if="exam_question.last_status.status_display == 'Anulada'">
                                            <del>
                                              ${exam_question.question.enunciation}
                                            </del>
                                          </template>
                                          <template v-else>
                                            ${exam_question.question.enunciation}
                                          </template>
                                        </h6>
                                        <h6 class="mt-1 mb-0 float-right" v-if="exam_question.question.created_by_name">
                                          <span class="text-muted"> Criado por </span><span class="font-weight-bold">
                                            ${exam_question.question.created_by_name}
                                          </span>
                                        </h6>
                                        <h6 class="mt-1 mb-0">
                                          <template v-if="recalculateWeights">
                                            Recalculando notas... 
                                            <div class="spinner-border text-primary" style="width: .8rem; height: .8rem;" role="status">
                                              <span class="sr-only">Loading...</span>
                                            </div>
                                          </template>
                                          <template v-else>
                                            <span v-if="exam_question.block_weight">
                                              <i class="fas fa-lock text-danger" title="A questão está com a nota travada."></i>
                                            </span>
                                            <template v-if="exam_question.last_status.status_display != 'Anulada'">
                                              <template v-if="unavailableStatus.includes(exam_question.last_status.status_display)">
                                                <strike>${exam_question.weight}</strike> Pontos
                                              </template>
                                              <template v-else>
                                                <b>${exam_question.weight}</b> Pontos
                                              </template>
                                            </template>
                                          </template>
                                          <template>
                                            &nbsp;
                                          </template>
                                        </h6>
                                      </div>
                                      <p class="mb-1" v-if="exam_question.question.topic_name">
                                        <span class="badge badge-primary">
                                          ${exam_question.question.topic_name}
                                        </span>
                                      </p>
                                    </div>
                                    <div v-if="exam_question['showOptions']" class="col-1 border-left d-flex flex-column justify-content-center aling-items-center">
                                      <i class="fa fa-edit mb-2" @click="openNewWindow('/questoes/'+exam_question.question.pk+'/editar/?is_popup=1&request_tags='+request_tags);"></i>
                                      <i class="fas fa-expand-arrows-alt mt-2 move-handle"></i>
                                    </div>
                                  </div>
                                </div>
                              </draggable> -->

                            </div>
                          </div>
                        </section>
                      </div>
              
                      <!-- Right column -->
                      <div class="tw-grid tw-grid-cols-1 tw-gap-4 tw-overflow-y-scroll tw-h-full lg:tw-col-span-2">
                        <section aria-labelledby="section-2-title">
                          <h2 class="tw-sr-only" id="section-2-title">Section title</h2>
                          <div class="tw-overflow-hidden tw-bg-white" style="height: 100%; display: flex; flex-direction: column; justify-content: space-between;">
                            <div class="tw-pt-6 tw-px-6">

                              <div class="sm:tw-hidden">
                                <label for="tabs" class="tw-sr-only">Select a tab</label>
                                <select id="tabs" name="tabs" class="tw-block tw-w-full tw-rounded-md tw-border-gray-300 focus:tw-border-[#0C7BDB] focus:tw-ring-[#0C7BDB]">
                                  <option selected>Enunciado</option>
                                  <option v-if="selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0">Textos base</option>
                                  <option>Dados pedagógicos</option>
                                  <option>Histórico</option>
                                  <option>Utilizações</option>
                                </select>
                              </div>
                              <div class="tw-hidden sm:tw-block">
                                <div class="tw-border-b tw-border-gray-200">
                                  <nav class="nav tw--mb-px tw-flex" aria-label="Tabs" id="myTab" role="tablist">
                                    <a id="question-tab" data-toggle="tab" href="#question" role="tab" aria-controls="question" aria-selected="false" class="tw-text-[#101928] hover:tw-text-gray-700 tw-border-b-2 tw-py-4 tw-px-1 tw-text-center tw-text-sm tw-font-medium" :class="[teacherModalTabActive === 'question' ? 'tw-border-[#0C7BDB]' : 'tw-border-transparent hover:tw-border-[#E5E7EA]', selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0 ? 'tw-w-1/5' : 'tw-w-1/4']" @click="updateTeacherModalTabActive('question')">Enunciado</a>
                                    <a id="basetext-tab" data-toggle="tab" href="#basetext" role="tab" aria-controls="basetext" aria-selected="false" class="tw-text-[#101928] hover:tw-text-gray-700 tw-border-b-2 tw-py-4 tw-px-1 tw-text-center tw-text-sm tw-font-medium" :class="[teacherModalTabActive === 'basetext' ? 'tw-border-[#0C7BDB]' : 'tw-border-transparent hover:tw-border-[#E5E7EA]', selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0 ? 'tw-w-1/5' : 'tw-w-1/4']" @click="updateTeacherModalTabActive('basetext')" v-if="selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0">Textos base</a>
                                    <a id="data-tab" data-toggle="tab" href="#data" role="tab" aria-controls="data" aria-selected="false" class="tw-text-[#101928] hover:tw-text-gray-700 tw-border-b-2 tw-py-4 tw-px-1 tw-text-center tw-text-sm tw-font-medium" :class="[teacherModalTabActive === 'data' ? 'tw-border-[#0C7BDB]' : 'tw-border-transparent hover:tw-border-[#E5E7EA]', selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0 ? 'tw-w-1/5' : 'tw-w-1/4']" @click="updateTeacherModalTabActive('data')">Dados pedagógicos</a>
                                    <a id="history-tab" data-toggle="tab" href="#history" role="tab" aria-controls="history" aria-selected="false" class="tw-text-[#101928] hover:tw-text-gray-700 tw-border-b-2 tw-py-4 tw-px-1 tw-text-center tw-text-sm tw-font-medium" :class="[teacherModalTabActive === 'history' ? 'tw-border-[#0C7BDB]' : 'tw-border-transparent hover:tw-border-[#E5E7EA]', selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0 ? 'tw-w-1/5' : 'tw-w-1/4']" @click="updateTeacherModalTabActive('history')">Histórico</a>
                                    <a id="uses-tab" data-toggle="tab" href="#uses" role="tab" aria-controls="uses" aria-selected="false" class="tw-text-[#101928] hover:tw-text-gray-700 tw-border-b-2 tw-py-4 tw-px-1 tw-text-center tw-text-sm tw-font-medium" :class="[teacherModalTabActive === 'uses' ? 'tw-border-[#0C7BDB]' : 'tw-border-transparent hover:tw-border-[#E5E7EA]', selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0 ? 'tw-w-1/5' : 'tw-w-1/4']" @click="updateTeacherModalTabActive('uses')">Utilizações</a>
                                  </nav>
                                </div>
                              </div>
                            </div>
                            <div class="tw-flex-1 tw-px-6">
                              <div class="tab-content" id="myTabContent" style="margin-top: 1rem; overflow: auto; max-height: 380px;">
                                <div class="tab-pane fade show active" id="question" role="tabpanel" aria-labelledby="question-tab">
                                  <div v-if="hasAlternativeDuplicate(selectedQuestion)" class="row mb-0 mr-0">
                                    <div class="col-12">
                                      <div class="alert alert-danger dismissable">
                                        Aparentemente essa questão possui 2 ou mais alternativas iguais.
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                  <div v-if="selectedTeacher && selectedQuestion && questionHasEnunciationDuplicate(selectedQuestion.id)" class="row mb-0 mr-0">
                                    <div class="col-12">
                                      <div class="alert alert-warning dismissable">
                                        Aparentemente essa questão possui enunciado duplicado
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                          <span aria-hidden="true">&times;</span>
                                        </button>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="tab-pane fade show active" id="question" role="tabpanel" aria-labelledby="question-tab">
                                    <div  v-if="selectedQuestion.created_with_ai || selectedTeacher.is_inspector_ia" class="row mb-0 mr-0">
                                      <div class="col-12">
                                        <div class="alert alert-info dismissable">
                                          Questão criada ou modificada por IA.
                                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="tab-pane fade show active" id="question" role="tabpanel" aria-labelledby="question-tab">
                                    <div  v-if="checkNoCorrectOption(selectedQuestion)" class="row mb-0 mr-0">
                                      <div class="col-12">
                                        <div class="alert alert-danger dismissable">
                                          Nenhuma alternativa marcada como correta.
                                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="tab-pane fade show active" id="question" role="tabpanel" aria-labelledby="question-tab">
                                    <div  v-if="isOptionCountIncorrect(selectedQuestion)" class="row mb-0 mr-0">
                                      <div class="col-12">
                                        <div class="alert alert-danger dismissable">
                                            Questão com número de alternativas diferente do definido na solicitação.                                          
                                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <div class="tab-pane fade show active" id="question" role="tabpanel" aria-labelledby="question-tab">
                                    <div  v-if="hasMultipleCorrectOptions(selectedQuestion)" class="row mb-0 mr-0">
                                      <div class="col-12">
                                        <div class="alert alert-danger dismissable">
                                            Mais de uma alternativa marcada como correta.                                         
                                          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                  <p v-if="selectedQuestion.board" class="tw-mb-0">(${selectedQuestion.board})</p>
                                  <div v-html="selectedQuestion.enunciation" class="mb-2"></div>
                                  <div v-if="selectedQuestion.cloze_content" v-html="selectedQuestion.cloze_content" class="mb-2"></div>
                                  <div v-if="selectedQuestion.incorrect_cloze_alternatives" class="mt-4">
                                    <span class="font-weight-bold">Opções incorretas:</span> 
                                    ${selectedQuestion.incorrect_cloze_alternatives}
                                  </div>
                                  <div class="form-check" v-for="alternative in selectedQuestion.alternatives">
                                    <input class="form-check-input" type="radio" disabled="disabled" :checked="alternative.is_correct">
                                    <label v-bind:class="[alternative.is_correct ? 'text-success' : '']" v-html="alternative.text"></label>
                                  </div>
                                </div>
                                <div class="tab-pane fade" id="basetext" role="tabpanel" aria-labelledby="basetext-tab">
                                  <div class="row">
                                    <div class="col-12 mb-3" v-for="(baseText, index) in selectedQuestion.base_texts">
                                      <div class="card">
                                        <div class="card-body">
                                          <h4 class="text-muted text-uppercase">Texto Base ${index + 1}</h4>
                                          <div v-html="baseText.text"></div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="tab-pane fade" id="data" role="tabpanel" aria-labelledby="data-tab">
                                  <div class="row">
                                    <div class="col-12">
                                      <div class="card">
                                        <div class="card-header p-2 font-weight-bold">
                                          Dificuldade
                                        </div>
                                        <ul class="list-group list-group-flush">
                                          <li class="list-group-item p-1 px-2">${getLevelLabel(selectedQuestion.level)}</li>
                                        </ul>
                                      </div>
                                    </div>
                                    <div class="col-12">
                                      <div class="card mt-2">
                                        <div class="card-header p-1 px-2 font-weight-bold">
                                          Assuntos Abordados
                                        </div>
                                        <ul class="list-group list-group-flush">
                                          <template v-if="selectedQuestion.topics">
                                            <li v-if="!selectedQuestion.topics.length" class="list-group-item  p-1">Não há assuntos cadastrados nessa questão</li>
                                            <li v-else v-for="topic in selectedQuestion.topics" class="list-group-item  p-2">${topic.name}</li>
                                          </template>
                                        </ul>
                                      </div>
                                    </div>
                                    <div class="col-12">
                                      <div class="card mt-2">
                                        <div class="card-header p-2 font-weight-bold">
                                          Habilidades
                                        </div>
                                        <ul class="list-group list-group-flush">
                                          <template v-if="selectedQuestion.abilities">
                                            <li v-if="!selectedQuestion.abilities.length" class="list-group-item  p-1">Não há habilidades cadastradas nessa questão</li>
                                            <li v-else v-for="ability in selectedQuestion.abilities" class="list-group-item  p-2">${ability.code ? '('+ability.code+')':''} ${ability.text}</li>
                                          </template>
                                        </ul>
                                      </div>
                                    </div>
                                    <div class="col-12">
                                      <div class="card mt-2">
                                        <div class="card-header p-2 font-weight-bold">
                                          Competências
                                        </div>
                                        <ul class="list-group list-group-flush">
                                          <template v-if="selectedQuestion.competences">
                                            <li v-if="!selectedQuestion.competences.length" class="list-group-item  p-1">Não há competências cadastradas nessa questão</li>
                                            <li v-else v-for="competence in selectedQuestion.competences" class="list-group-item  p-2">${competence.code ? '('+competence.code+')':''} ${competence.text}</li>
                                          </template>
                                        </ul>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                                <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                                  <div v-if="selectedTeacher && selectedTeacher.exam_questions">
                                    <div class="row">
                                      <div class="col-12 my-2 filter-button-group">
                                        <label class="bold">Mostrar:</label>
                                        <button
                                          class="btn btn-sm btn-outline-secondary m-1 py-0 removeFilters" 
                                          style="cursor: pointer;"
                                          @click="selectedFilter = ''"
                                          v-bind:class="!selectedFilter ? 'active':''"
                                        >
                                          Todos
                                        </button>
                                        <button 
                                          v-for="status in Object.keys(statusList)"
                                          :class="`btn btn-sm m-1 py-0 ${getStatusBadgeClass(status).class.replace('badge', 'btn-outline')} ${selectedFilter == status ? 'active':''}`"
                                          v-if="status != 'Em aberto'"
                                          @click="selectedFilter = status"
                                          style="cursor: pointer;"
                                        >
                                          ${status}
                                        </button>
                                      </div>
                                    </div>
                                    <template v-for="note in selectedTeacher.exam_questions[selectedQuestionIndex].status_list">
                                      <div class="row justify-content-end" v-show="!selectedFilter || note.status_display == selectedFilter">
                                        <div class="col-12">
                                          <div class="card">
                                            <div class="card-header p-2 font-weight-bold">
                                              <span class="float-right text-right">
                                                <span class="badge  mr-1 " :class="getStatusBadgeClass(note.status_display).class">
                                                  <i class="fas" :class="getStatusBadgeClass(note.status_display).icon"></i>
                                                  ${note.status_display}
                                                </span>
                                                <p class="text-muted m-0" v-if="note.user_name">por ${note.user_name}</p>
                                              </span>
                                              <span>
                                                ${momentRef(note.created_at).fromNow()} <a href="#" @click="selectedSourceStatusQuestion=note.id;requestNoteStatusQuestion(9)">Responder</a><br/>
                                                  <small class="text-muted p-0">
                                                    ${momentRef(note.created_at).format('L')} às ${momentRef(note.created_at).format('LT')}
                                                  </small>
                                              </span>
                                            </div>
                                            <ul class="list-group list-group-flush">

                                              <li id="body-initial-note" class="list-group-item p-2" v-if="note.note">

                                                <div >
                                                  <template><b>Anotação:</b> ${note.note}</template>
                                                </div>

                                                <div v-if="isCoordinationOrIsChecked(note.is_checked_by)" id="checked-by" class="tw-relative tw-flex tw-items-center tw-gap-2">
                                                  <input 
                                                    :id="'checked-by-input-' + note.id"
                                                    @click="updateStatusQuestion(note.id, note.is_checked_by)"                 
                                                    type="checkbox" 
                                                    class="tw-rounded tw-border-gray-300 tw-text-blue-600 focus:tw-ring-blue-600"
                                                    :checked="note.is_checked_by"
                                                  >
                                                  <label v-if="note.is_checked_by" :for="'checked-by-input-' + note.id">
                                                    Visto aplicado por ${note.is_checked_by}
                                                  </label>
                                                  <label v-else :for="'checked-by-input-' + note.id">
                                                    Visto aplicado a questão
                                                  </label>
                                                </div>
                                                      
                                                
                                              </li>
                                              <li class="list-group-item p-2" v-if="note.question_fragment">
                                                <template><b>Fragmento da questão:</b> ${note.question_fragment}</template>
                                              </li>
                                              <li class="list-group-item p-2" v-if="status_tags_history.find((status) => note.id==status.pk)">
                                                  <span v-for="status in status_tags_history">
                                                    <span v-if="status.pk == note.id" v-for="tag in status.tags" class="badge badge-primary m-2">${tag}</span>
                                                  </span>
                                              </li>
                                            </ul>
                                          </div>
                                        </div>
                                        <div class="col-11" v-for="response in note.responses">
                                          <div class="card">
                                            <div class="card-header p-2 font-weight-bold">
                                              <span class="float-right text-right">
                                                <p class="text-muted m-0" v-if="response.user_name">por ${response.user_name}</p>
                                              </span>
                                              <span class="">
                                                ${momentRef(response.created_at).fromNow()}<br/>
                                                <small class="text-muted p-0">
                                                  ${momentRef(response.created_at).format('L')} às ${momentRef(response.created_at).format('LT')}
                                                </small>
                                              </span>
                                            </div>
                                            <ul class="list-group list-group-flush">
                                              <li class="list-group-item p-2" v-if="response.note">
                                                <template><b>Anotação:</b> ${response.note}</template>
                                              </li>
                                            </ul>
                                          </div>
                                        </div>
                                      </div>
                                    </template>
                                  </div>
                                </div>
                                <div class="tab-pane fade" id="uses" role="tabpanel" aria-labelledby="uses-tab">
                                  <div class="row" v-if="selectedQuestion && (selectedQuestion.uses && selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}').length)">
                                    <div class="col-12 my-2">
                                      <table class="table">
                                        <thead>
                                          <tr>
                                            <th>Cadernos</th>
                                          </tr>
                                        </thead>
                                        <tbody>
                                          <tr v-for="use in selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}')">
                                            <td>
                                              <strong>${use.exam_name}</strong> <span class="badge badge-primary">ESTA PROVA</span>
                                              <br>
                                              ${use.application_date ? 'Data da aplicação: ' + use.application_date: 'Nenhuma aplicação vinculada'}
                                            </td>
                                          </tr>
                                        </tbody>
                                      </table>
                                    </div>
                                  </div>
                                  <div v-else class="row">
                                    <div class="col-12">
                                      <h6>A questão não foi utilizada nenhuma vez</h6>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <template v-if="selectedTeacher && selectedTeacher.exam_questions && selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display != 'Anulada'">
                              <div>
                                <div class="tw-px-6">
                                  <hr />
                                  <div class="d-flex flex-column">
                                    <div class="d-flex align-items-center">
                                      <template v-if="!loadingBlockWeight && selectedTeacher.exam_questions[selectedQuestionIndex].block_weight">
                                        <label for="inputUpdateWeight" class="mb-0">Nota atual:</label>
                                        <input style="width: 100px;" id="inputUpdateWeight" v-model="updateWeight" step="any" type="number" class="form-control mx-2" @change="checkUpdateWeight($event, selectedTeacher.exam_questions[selectedQuestionIndex])" @keyup="checkUpdateWeight($event, selectedTeacher.exam_questions[selectedQuestionIndex])">
                                        <div class="input-group-append">
                                          <button id="update-note" @click="updateWeightQuestionWithBlockWeight(selectedTeacher.exam_questions[selectedQuestionIndex])" class="btn btn-sm btn-outline-secondary" type="button">
                                            <i class="fas fa-sync-alt"></i> Atualizar Nota
                                          </button>
                                        </div>
                                      </template>
                                      <template v-else>
                                        Nota atual: ${selectedTeacher.exam_questions[selectedQuestionIndex].weight}
                                      </template>
                                    </div>
                                    <div class="mt-2">
                                      <a href="javascript:;" :class="selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'text-muted':'text-danger'" title="Travar nota da questão." v-if="!loadingBlockWeight" @click="blockQuestionWeight(selectedTeacher.exam_questions[selectedQuestionIndex])">
                                        ${selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'Destravar nota da questão':'Travar nota da questão'} <i class="cp fas" :class="selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'fa-unlock':'fa-lock'"></i>
                                      </a>
                                    </div>
                                  </div>
                                  <div class="mt-2 mb-3">
                                    <div v-if="selectedTeacher && selectedTeacher.exam_questions">
                                      {% if not object.total_grade and user_type != 'teacher' or user.inspector.can_update_note %}
                                        <div v-if="!selectedTeacher.subject_note && !selectedTeacher.exam_questions[selectedQuestionIndex].block_weight" class="input-group input-group-sm">
                                          <input style="width: 100px;" id="input-update-weight" type="text" class="form-control" :value="selectedTeacher.exam_questions[selectedQuestionIndex].weight">
                                          <div class="input-group-append">
                                            <button id="update-note" @click="updateWeightQuestion(selectedTeacher.exam_questions[selectedQuestionIndex])" class="btn btn-sm btn-outline-secondary" type="button">
                                              <i class="fas fa-sync-alt"></i> Atualizar Nota
                                            </button>
                                          </div>
                                        </div>
                                        <div v-if="selectedTeacher.subject_note && !selectedTeacher.exam_questions[selectedQuestionIndex].block_weight" class="alert alert-light" role="alert">
                                          A nota da disciplina já foi definida
                                        </div>
                                      {% endif %}
                                    </div>
                                  </div>
                                </div>
                                <div class="tw-flex tw-justify-center tw-gap-2 tw-p-6 tw-border-t tw-border-gray-200">
                                  <template v-if="selectedTeacher && selectedTeacher.exam_questions">
                                    <template v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display != 'Anulada'">
                                      <template v-if="!exam.application_is_finished">
                                        {% if user_type != 'teacher' or user.inspector.can_viewed %}
                                          <button type="button" class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#E7F2FB] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 5)">
                                            <div class="tw-rounded-full tw-bg-[#E7F2FB] tw-p-2 tw-text-[#0C7BDB] group-hover:tw-text-white group-hover:tw-bg-[#0C7BDB]">
                                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                                <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </div>
                                            <div class="tw-mt-2">
                                              Dar visto
                                            </div>
                                          </button>
                                        {% endif %}
                                        {% if user_type != 'teacher' or user.inspector.can_approve %}
                                          <button type="button" class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#ECF9F3] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display !== 'Aprovada'" @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 0)">
                                            <div class="tw-rounded-full tw-bg-[#ECF9F3] tw-p-2 tw-text-[#41C588] group-hover:tw-text-white group-hover:tw-bg-[#41C588]">
                                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M22 11.0857V12.0057C21.9988 14.1621 21.3005 16.2604 20.0093 17.9875C18.7182 19.7147 16.9033 20.9782 14.8354 21.5896C12.7674 22.201 10.5573 22.1276 8.53447 21.3803C6.51168 20.633 4.78465 19.2518 3.61096 17.4428C2.43727 15.6338 1.87979 13.4938 2.02168 11.342C2.16356 9.19029 2.99721 7.14205 4.39828 5.5028C5.79935 3.86354 7.69279 2.72111 9.79619 2.24587C11.8996 1.77063 14.1003 1.98806 16.07 2.86572M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </div>
                                            <div class="tw-mt-2">
                                              Aprovar
                                            </div>
                                          </button>
                                        {% endif %}
                                      
                                        {% if user_type != 'teacher' or user.inspector.can_suggest_correction %}
                                          <button type="button" class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#FEF7EF] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 3)">
                                            <div class="tw-rounded-full tw-bg-[#FEF7EF] tw-p-2 tw-text-[#F3B364] group-hover:tw-text-white group-hover:tw-bg-[#F3B364]">
                                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M11.9998 8.99999V13M11.9998 17H12.0098M10.6151 3.89171L2.39019 18.0983C1.93398 18.8863 1.70588 19.2803 1.73959 19.6037C1.769 19.8857 1.91677 20.142 2.14613 20.3088C2.40908 20.5 2.86435 20.5 3.77487 20.5H20.2246C21.1352 20.5 21.5904 20.5 21.8534 20.3088C22.0827 20.142 22.2305 19.8857 22.2599 19.6037C22.2936 19.2803 22.0655 18.8863 21.6093 18.0983L13.3844 3.89171C12.9299 3.10654 12.7026 2.71396 12.4061 2.58211C12.1474 2.4671 11.8521 2.4671 11.5935 2.58211C11.2969 2.71396 11.0696 3.10655 10.6151 3.89171Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </div>
                                            <div class="tw-mt-2">
                                              Corrigir
                                            </div>
                                          </button>
                                          <button type="button" class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#FBEAE9] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 7)">
                                            <div class="tw-rounded-full tw-bg-[#FBEAE9] tw-p-2 tw-text-[#D92D20] group-hover:tw-text-white group-hover:tw-bg-[#D92D20]">
                                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M4 7.9966C3.83599 7.99236 3.7169 7.98287 3.60982 7.96157C2.81644 7.80376 2.19624 7.18356 2.03843 6.39018C2 6.19698 2 5.96466 2 5.5C2 5.03534 2 4.80302 2.03843 4.60982C2.19624 3.81644 2.81644 3.19624 3.60982 3.03843C3.80302 3 4.03534 3 4.5 3H19.5C19.9647 3 20.197 3 20.3902 3.03843C21.1836 3.19624 21.8038 3.81644 21.9616 4.60982C22 4.80302 22 5.03534 22 5.5C22 5.96466 22 6.19698 21.9616 6.39018C21.8038 7.18356 21.1836 7.80376 20.3902 7.96157C20.2831 7.98287 20.164 7.99236 20 7.9966M10 13H14M4 8H20V16.2C20 17.8802 20 18.7202 19.673 19.362C19.3854 19.9265 18.9265 20.3854 18.362 20.673C17.7202 21 16.8802 21 15.2 21H8.8C7.11984 21 6.27976 21 5.63803 20.673C5.07354 20.3854 4.6146 19.9265 4.32698 19.362C4 18.7202 4 17.8802 4 16.2V8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </div>
                                            <div class="tw-mt-2">
                                              Usar depois
                                            </div>
                                          </button>
                                        {% endif %}
                                        {% if user_type != 'teacher' or user.inspector.can_fail %}
                                          <button type="button" class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#FBEAE9] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display !== 'Reprovada'" @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 1)">
                                            <div class="tw-rounded-full tw-bg-[#FBEAE9] tw-p-2 tw-text-[#D92D20] group-hover:tw-text-white group-hover:tw-bg-[#D92D20]">
                                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                                <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                              </svg>
                                            </div>
                                            <div class="tw-mt-2">
                                              Reprovar
                                            </div>
                                          </button>
                                        {% endif %}
                                      </template>
                                      {% if not can_remove_exam_teacher_subjects or exam_questions_with_answer %} <!-- Anular questões é permitido caso exista malote gerado, que é o inverso de remover solicitação (ou se existirem respostas associadas) -->
                                      {% if user_type != 'teacher' or user.inspector.can_annul %}
                                        <button type="button" class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#FBEAE9] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 6)">
                                          <div class="tw-rounded-full tw-bg-[#FBEAE9] tw-p-2 tw-text-[#D92D20] group-hover:tw-text-white group-hover:tw-bg-[#D92D20]">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                              <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                          </div>
                                          <div class="tw-mt-2">
                                            Anular
                                          </div>
                                        </button>
                                      {% endif %}
                                      {% endif %}
                                      {% if user.client_can_request_ai_questions or user.can_request_ai_questions %}
                                      <button @click="openChangeQuestionWithIaModal(selectedTeacher.exam_questions[selectedQuestionIndex])" type="button" data-toggle="tooltip" data-placement="top" title='Criar nova versão da questão com IA.' class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#FEF7EF] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" @click="openDialog(selectedTeacher.exam_questions[selectedQuestionIndex], 3)">
                                        <div class="tw-rounded-full tw-bg-[#FEF7EF] tw-p-2 tw-text-[#F3B364] group-hover:tw-text-white group-hover:tw-bg-[#F3B364]">
                                          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16"  class="bi bi-stars">
                                            <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828l.645-1.937zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.734 1.734 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.734 1.734 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.734 1.734 0 0 0 3.407 2.31l.387-1.162zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L10.863.1z"></path>
                                        </svg>
                                        </div>
                                        <div class="tw-mt-2">
                                          Transformar questão com ia
                                        </div>
                                      </button>
                                      {% endif %}

                                    </template>
                                  </template>
                                </div>
                              </div>
                            </template>
                            {% if not can_remove_exam_teacher_subjects or exam_questions_with_answer %} <!-- Anular questões é permitido caso exista malote gerado, que é o inverso de remover solicitação -->
                            {% if user_type != 'teacher' or user.inspector.can_annul %}
                            <template v-if="selectedTeacher && selectedTeacher.exam_questions && selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display == 'Anulada'">
                              <div class="d-flex flex-row justify-content-center mt-2 mb-3">
                                <button type="button" class="tw-group tw-min-w-[112px] tw-min-h-[100px] tw-flex tw-flex-col tw-items-center tw-justify-center tw-rounded-xl tw-px-[18px] tw-py-3 tw-text-[#101928] hover:tw-bg-[#FEF7EF] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" v-if="selectedTeacher.exam_questions[selectedQuestionIndex].has_answer" @click="revertAnullQuestion(selectedTeacher.exam_questions[selectedQuestionIndex])">
                                  <div class="tw-rounded-full tw-bg-[#FEF7EF] tw-p-2 tw-text-[#F3B364] group-hover:tw-text-white group-hover:tw-bg-[#F3B364]">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-undo"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                                  </div>
                                  <div class="tw-mt-2">
                                    Reverter anulação
                                  </div>
                                </button>
                              </div>
                            </template> 
                            {% endif %}
                            {% endif %}
                          </div>
                        </section>
                      </div>
                    </div>

                    <!-- <div class="tw-relative tw-h-[640px] tw-overflow-hidden tw-rounded-xl tw-border tw-border-dashed tw-border-gray-400 tw-opacity-75"> -->
                      
                    <!-- </div> -->
                  </template>
                  <template v-else>
                    <div class="row h-100">
                      <div class="col-12 h-100 my-4 d-flex flex-column justify-content-center align-items-center">
                        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        <p class="text-center tx-rubik p-4">Aguarde enquanto carregamos os dados das questões</p>
                      </div>
                    </div>
                  </template>




                  <!-- <template v-if="!loadExamQuestions">
                    <div class="row">
                      <div class="col-5 pr-0" style="overflow: auto; height: 80vh; max-height: 80vh;">
                        <p>${selectedTeacher.quantity} questões</p>
                        <draggable 
                          :list="selectedTeacher.exam_questions" 
                          @change="changeObjectsOrder(null, selectedTeacher.exam_questions)" 
                          class="list-group" 
                          ghost-class="ghost" 
                          handle=".move-handle"
                          @start="dragging = true" 
                          @end="dragging = false"
                        >
                          <div 
                            v-for="(exam_question, index) in selectedTeacher.exam_questions"
                            :id="exam_question.id" 
                            :key="exam_question.id"
                            class="list-group-item" 
                            v-bind:class="{'selected-row': exam_question.selected }" 
                            {% if user.questions_configuration and user.questions_configuration.can_edit_and_change_position %}
                              @mouseenter="exam_question['showOptions'] = true, $forceUpdate()" 
                              @mouseleave="exam_question['showOptions'] = false, $forceUpdate()"
                            {% endif %}
                            @click="
                              selectedTeacher.exam_questions[selectedQuestionIndex].selected=false; selectedQuestionIndex=index;
                              exam_question.selected=true;
                              fetchQuestion(exam_question.question);
                              updateWeight = Number(exam_question.weight).toFixed(6);
                            " 
                          >
                            <div class="row mb-1">
                              <div class="col">
                                <span class="float-right">
                                  <template v-if="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto')">
                                    <span class="badge" :class="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto').class"> <i class="fas"
                                      :class="getStatusBadgeClass(exam_question.last_status.status_display || 'Em aberto').icon"></i>
                                      ${exam_question.last_status.status_display || 'Em aberto'}
                                    </span>
                                  </template>
                                </span>
                                <div class="w-100">
                                  <template>
                                    <span class="badge badge-warning" v-if="exam_question.question.used_times > 1">
                                      Utilizada ${exam_question.question.used_times-1} Vez(es)
                                    </span>
                                    <span class="badge badge-success" v-else>
                                      Inédita
                                    </span>
                                  </template>
                                  <span class="badge badge-success">
                                    ${exam_question.question.get_level_display}
                                  </span>
                                  <h6 class="mb-1 mt-2 font-weight-normal">
                                    <template v-if="exam_question.last_status.status_display == 'Anulada'">
                                      <del>
                                        ${exam_question.question.enunciation}
                                      </del>
                                    </template>
                                    <template v-else>
                                      ${exam_question.question.enunciation}
                                    </template>
                                  </h6>
                                  <h6 class="mt-1 mb-0 float-right" v-if="exam_question.question.created_by_name">
                                    <span class="text-muted"> Criado por </span><span class="font-weight-bold">${exam_question.question.created_by_name}</span>
                                  </h6>
                                  <h6 class="mt-1 mb-0">
                                    <template v-if="recalculateWeights">
                                      Recalculando notas... 
                                      <div class="spinner-border text-primary" style="width: .8rem; height: .8rem;" role="status">
                                        <span class="sr-only">Loading...</span>
                                      </div>
                                    </template>
                                    <template v-else>
                                      <span v-if="exam_question.block_weight">
                                        <i class="fas fa-lock text-danger" title="A questão está com a nota travada."></i>
                                      </span>
                                      <template v-if="exam_question.last_status.status_display != 'Anulada'">
                                        <template v-if="unavailableStatus.includes(exam_question.last_status.status_display)">
                                          <strike>${exam_question.weight}</strike> Pontos
                                        </template>
                                        <template v-else>
                                          <b>${exam_question.weight}</b> Pontos
                                        </template>
                                      </template>
                                    </template>
                                    <template>
                                      &nbsp;
                                    </template>
                                  </h6>
                                </div>
                                <p class="mb-1" v-if="exam_question.question.topic_name">
                                  <span class="badge badge-primary">
                                    ${exam_question.question.topic_name}
                                  </span>
                                </p>
                              </div>
                              <div v-if="exam_question['showOptions']" class="col-1 border-left d-flex flex-column justify-content-center aling-items-center">
                                <i class="fa fa-edit mb-2" @click="openNewWindow('/questoes/'+exam_question.question.pk+'/editar/?is_popup=1&request_tags='+request_tags);"></i>
                                <i class="fas fa-expand-arrows-alt mt-2 move-handle"></i>
                              </div>
                            </div>
                          </div>
                        </draggable>
                      </div>
                      <div class="col-7 p-3 selected-row" style="overflow: auto; height: 80vh; max-height: 80vh; max-width: 57%">
                        <div id="question-details" class="mb-3 p-2" v-show="selectedQuestion.enunciation">
                          <ul class="nav nav-tabs mb-4" id="questiontab">
                            <li class="nav-item">
                              <a class="nav-link active" data-toggle="tab" href="#question-tab" aria-current="page" >
                                <i class="fas fa-align-right mr-1"></i>
                                Enunciado
                              </a>
                            </li>
                            <li class="nav-item" v-if="selectedQuestion.base_texts && selectedQuestion.base_texts.length > 0">
                              <a class="nav-link" data-toggle="tab" href="#baseText-tab">
                                Textos Base
                                <span class="badge badge-primary ml-1">${selectedQuestion.base_texts.length}</span>
                              </a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link" data-toggle="tab" href="#data-tab">
                                <i class="fas fa-info-circle  mr-1"></i>
                                Dados Pedagógicos
                              </a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link" data-toggle="tab" href="#history-tab">
                                <i class="fas fa-history  mr-1"></i> Histórico 
                                <span class="badge badge-primary ml-1" v-if="selectedTeacher && selectedTeacher.exam_questions">
                                  ${selectedTeacher.exam_questions[selectedQuestionIndex].status_list.length}
                                </span>
                              </a>
                            </li>
                            <li class="nav-item">
                              <a class="nav-link" data-toggle="tab" href="#uses-tab">
                                <i class="fas fa-history  mr-1"></i> Utilizações 
                                <span class="badge badge-primary ml-1" v-if="selectedQuestion && selectedQuestion.uses">
                                  ${selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}').length}
                                </span>
                              </a>
                            </li>
                          </ul>
                          <div class="tab-content">
                            <div class="tab-pane fade show active" id="question-tab" role="tabpanel" aria-labelledby="question-tab">
                              <div v-html="selectedQuestion.enunciation" class="mb-2"></div>
                              <div class="form-check" v-for="alternative in selectedQuestion.alternatives">
                                <input class="form-check-input" type="radio" disabled="disabled" :checked="alternative.is_correct">
                                <label v-bind:class="[alternative.is_correct ? 'text-success' : '']" v-html="alternative.text"></label>
                              </div>
                            </div>
                            <div class="tab-pane fade" id="data-tab" role="tabpanel" aria-labelledby="data-tab">
                              <div class="row">
                                <div class="col-12">
                                  <div class="card">
                                    <div class="card-header p-2 font-weight-bold">
                                      Dificuldade
                                    </div>
                                    <ul class="list-group list-group-flush">
                                      <li class="list-group-item p-1 px-2">${getLevelLabel(selectedQuestion.level)}</li>
                                    </ul>
                                  </div>
                                </div>
                                <div class="col-12">
                                  <div class="card mt-2">
                                    <div class="card-header p-1 px-2 font-weight-bold">
                                      Assuntos Abordados
                                    </div>
                                    <ul class="list-group list-group-flush">
                                      <template v-if="selectedQuestion.topics">
                                        <li v-if="!selectedQuestion.topics.length" class="list-group-item  p-1">Não há assuntos cadastrados nessa questão</li>
                                        <li v-else v-for="topic in selectedQuestion.topics" class="list-group-item  p-2">${topic.name}</li>
                                      </template>
                                    </ul>
                                  </div>
                                </div>
                                <div class="col-12">
                                  <div class="card mt-2">
                                    <div class="card-header p-2 font-weight-bold">
                                      Habilidades
                                    </div>
                                    <ul class="list-group list-group-flush">
                                      <template v-if="selectedQuestion.abilities">
                                        <li v-if="!selectedQuestion.abilities.length" class="list-group-item  p-1">Não há habilidades cadastradas nessa questão</li>
                                        <li v-else v-for="ability in selectedQuestion.abilities" class="list-group-item  p-2">${ability.code ? '('+ability.code+')':''} ${ability.text}</li>
                                      </template>
                                    </ul>
                                  </div>
                                </div>
                                <div class="col-12">
                                  <div class="card mt-2">
                                    <div class="card-header p-2 font-weight-bold">
                                      Competências
                                    </div>
                                    <ul class="list-group list-group-flush">
                                      <template v-if="selectedQuestion.competences">
                                        <li v-if="!selectedQuestion.competences.length" class="list-group-item  p-1">Não há competências cadastradas nessa questão</li>
                                        <li v-else v-for="competence in selectedQuestion.competences" class="list-group-item  p-2">${competence.code ? '('+competence.code+')':''} ${competence.text}</li>
                                      </template>
                                    </ul>
                                  </div>
                                </div>
                              </div>
                            </div>
                            <div class="tab-pane fade" id="history-tab" role="tabpanel" aria-labelledby="history-tab">
                              <div v-if="selectedTeacher && selectedTeacher.exam_questions">
                                <div class="row">
                                  <div class="col-12 my-2 filter-button-group">
                                    <label class="bold">Mostrar:</label>
                                    <button
                                      class="btn btn-sm btn-outline-secondary m-1 py-0 removeFilters" 
                                      style="cursor: pointer;"
                                      @click="selectedFilter = ''"
                                      v-bind:class="!selectedFilter ? 'active':''"
                                    >
                                      Todos
                                    </button>
                                    <button 
                                      v-for="status in Object.keys(statusList)"
                                      :class="`btn btn-sm m-1 py-0 ${getStatusBadgeClass(status).class.replace('badge', 'btn-outline')} ${selectedFilter == status ? 'active':''}`"
                                      v-if="status != 'Em aberto'"
                                      @click="selectedFilter = status"
                                      style="cursor: pointer;"
                                    >
                                      ${status}
                                    </button>
                                  </div>
                                </div>
                                <template v-for="note in selectedTeacher.exam_questions[selectedQuestionIndex].status_list">
                                  <div class="row" v-show="!selectedFilter || note.status_display == selectedFilter">
                                    <div class="col-12">
                                      <div class="card">
                                        <div class="card-header p-2 font-weight-bold">
                                          <span class="float-right text-right">
                                            <span class="badge  mr-1 " :class="getStatusBadgeClass(note.status_display).class">
                                              <i class="fas" :class="getStatusBadgeClass(note.status_display).icon"></i>
                                              ${note.status_display}
                                            </span>
                                            <p class="text-muted m-0" v-if="note.user_name">por ${note.user_name}</p>
                                          </span>
                                          <span class="">
                                            ${momentRef(note.created_at).fromNow()}<br/>
                                            <small class="text-muted p-0">
                                              ${momentRef(note.created_at).format('L')} às ${momentRef(note.created_at).format('LT')}
                                            </small>
                                          </span>
                                        </div>
                                        <ul class="list-group list-group-flush">
                                          <li class="list-group-item p-2">
                                            <template v-if="note.note">${note.note}</template>
                                            <template v-else>Sem anotações</template>
                                          </li>
                                          <li class="list-group-item p-2">
                                            <span v-if="status_tags_history.find((status) => note.id==status.pk)">
                                              <span v-for="status in status_tags_history">
                                                <span v-if="status.pk == note.id" v-for="tag in status.tags" class="badge badge-primary m-2">${tag}</span>
                                              </span>
                                            </span>
                                            <span v-else>
                                              sem tags nesse status
                                            </span>
                                          </li>
                                        </ul>
                                      </div>
                                    </div>
                                  </div>
                                </template>
                              </div>
                            </div>
                            <div class="tab-pane fade" id="uses-tab" role="tabpanel" aria-labelledby="uses-tab">
                              <div class="row" v-if="selectedQuestion && (selectedQuestion.uses && selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}').length)">
                                <div class="col-12 my-2">
                                  <table class="table">
                                    <thead>
                                      <tr>
                                        <th>Cadernos</th>
                                      </tr>
                                    </thead>
                                    <tbody>
                                      <tr v-for="use in selectedQuestion.uses.filter(_use => _use.exam_id != '{{object.id}}')">
                                        <td>
                                          <strong>${use.exam_name}</strong> <span class="badge badge-primary">ESTA PROVA</span>
                                          <br>
                                          ${use.application_date ? 'Data da aplicação: ' + use.application_date: 'Nenhuma aplicação vinculada'}
                                        </td>
                                      </tr>
                                    </tbody>
                                  </table>
                                </div>
                              </div>
                              <div v-else class="row">
                                <div class="col-12">
                                  <h6>A questão não foi utilizada nenhuma vez</h6>
                                </div>
                              </div>
                            </div>
                            <div class="tab-pane fade" id="baseText-tab" role="tabpanel" aria-labelledby="baseText-tab">
                              <div class="row">
                                <div class="col-12 mb-3" v-for="(baseText, index) in selectedQuestion.base_texts">
                                  <div class="card">
                                    <div class="card-body">
                                      <h4 class="text-muted text-uppercase">Texto Base ${index + 1}</h4>
                                      <div v-html="baseText.text"></div>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <template v-if="selectedTeacher && selectedTeacher.exam_questions && selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display != 'Anulada'">
                          <div class="d-flex flex-column">
                            <div class="d-flex align-items-center">
                              <template v-if="!loadingBlockWeight && selectedTeacher.exam_questions[selectedQuestionIndex].block_weight">
                                <label for="inputUpdateWeight" class="mb-0">Nota atual:</label>
                                <input style="width: 100px;" id="inputUpdateWeight" v-model="updateWeight" step="any" type="number" class="form-control mx-2" @change="checkUpdateWeight($event, selectedTeacher.exam_questions[selectedQuestionIndex])" @keyup="checkUpdateWeight($event, selectedTeacher.exam_questions[selectedQuestionIndex])">
                                <div class="input-group-append">
                                  <button id="update-note" @click="updateWeightQuestionWithBlockWeight(selectedTeacher.exam_questions[selectedQuestionIndex])" class="btn btn-sm btn-outline-secondary" type="button">
                                    <i class="fas fa-sync-alt"></i> Atualizar Nota
                                  </button>
                                </div>
                              </template>
                              <template v-else>
                                Nota atual: ${selectedTeacher.exam_questions[selectedQuestionIndex].weight}
                              </template>
                            </div>
                            <div class="mt-2">
                              <a href="javascript:;" :class="selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'text-muted':'text-danger'" title="Travar nota da questão." v-if="!loadingBlockWeight" @click="blockQuestionWeight(selectedTeacher.exam_questions[selectedQuestionIndex])">${selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'Destravar nota da questão':'Travar nota da questão'} <i class="cp fas" :class="selectedTeacher.exam_questions[selectedQuestionIndex].block_weight ? 'fa-unlock':'fa-lock'"></i></a>
                            </div>
                          </div>
                          <div class="d-flex flex-row justify-content-between mt-2 mb-3">
                            <div v-if="selectedTeacher && selectedTeacher.exam_questions">
                              {% if not object.total_grade and user_type != 'teacher' or user.inspector.can_update_note %}
                                <div v-if="!selectedTeacher.subject_note && !selectedTeacher.exam_questions[selectedQuestionIndex].block_weight" class="input-group input-group-sm">
                                  <input style="width: 100px;" id="input-update-weight" type="text" class="form-control" :value="selectedTeacher.exam_questions[selectedQuestionIndex].weight">
                                  <div class="input-group-append">
                                    <button id="update-note" @click="updateWeightQuestion(selectedTeacher.exam_questions[selectedQuestionIndex])" class="btn btn-sm btn-outline-secondary" type="button">
                                      <i class="fas fa-sync-alt"></i> Atualizar Nota
                                    </button>
                                  </div>
                                </div>
                                <div v-if="selectedTeacher.subject_note && !selectedTeacher.exam_questions[selectedQuestionIndex].block_weight" class="alert alert-light" role="alert">
                                  A nota da disciplina já foi definida
                                </div>
                              {% endif %}
                            </div>
                            <div>
                              <template v-if="selectedTeacher && selectedTeacher.exam_questions">
                                <template v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display != 'Anulada'">
                                  <template v-if="!exam.application_is_finished">
                                    {% if user_type != 'teacher' or user.inspector.can_viewed %}
                                      <button @click="createSeenQuestion(5)" type="button" class="btn btn-primary btn-sm">
                                        <i class="fas fa-check"></i>
                                        Dar Visto
                                      </button>
                                    {% endif %}
                                    {% if user_type != 'teacher' or user.inspector.can_approve %}
                                      <button @click="createStatusQuestion(0, '')"
                                        v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display !== 'Aprovada'"
                                        type="button" class="btn btn-success btn-sm"
                                      >
                                        <i class="fas fa-check"></i>
                                        Aprovar
                                      </button>
                                    {% endif %}
                                    {% if user_type != 'teacher' or user.inspector.can_suggest_correction %}
                                      <button @click="requestStatusTags(3)" type="button" class="btn btn-warning btn-sm">
                                        <i class="fas fa-edit"></i>
                                        Correção
                                      </button>
                                      <button @click="requestStatusTags(7)" type="button" class="btn btn-info btn-sm">
                                        <i class="fas fa-clock"></i>
                                        Usar depois
                                      </button>
                                    {% endif %}
                                    {% if user_type != 'teacher' or user.inspector.can_fail %}
                                      <button @click="requestStatusTags(1)"
                                        v-if="selectedTeacher.exam_questions[selectedQuestionIndex].last_status.status_display !== 'Reprovada'"
                                        type="button" class="btn btn-danger btn-sm"
                                      >
                                        <i class="fas fa-times"></i>
                                        Reprovar
                                      </button>
                                    {% endif %}
                                  </template>
                                  {% if user_type != 'teacher' or user.inspector.can_annul %}
                                    <button @click="requestStatusTags(6)"
                                      v-if="selectedTeacher.exam_questions[selectedQuestionIndex].has_answer"
                                      type="button" class="btn btn-danger btn-sm">
                                      <i class="fas fa-times-circle"></i>
                                      Anular
                                    </button>
                                  {% endif %}
                                </template>
                              </template>
                            </div>
                          </div>
                          <hr />
                        </template>

                      </div>
                    </div>
                  </template> -->
                  <!-- <template v-else>
                    <div class="row h-100">
                      <div class="col-12 h-100 my-4 d-flex flex-column justify-content-center align-items-center">
                        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                          <span class="sr-only">Loading...</span>
                        </div>
                        <p class="text-center tx-rubik p-4">Aguarde enquanto carregamos os dados das questões</p>
                      </div>
                    </div>
                  </template> -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal pr-0" tabindex="-1" role="dialog" id="orientations">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header bg-white">
        <h5 class="modal-title">
          Lista com todas as orientações
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="fas fa-times-circle"></i>
        </button>
      </div>
      <div class="modal-body p-3" style="max-height: fit-content !important; height: fit-content !important;">
        <div class="table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Número</th>
                <th>Título</th>
                <th class="text-right">Opções</th>
              </tr>
            </thead>
            <tbody>
              <template v-for="(orientation, index) in orientations">
                <tr>
                  <td>#${index + 1}</td>
                  <td class="text-truncate" style="max-width: 15rem;" :title="orientation.title">${orientation.title}</td>
                  <td class="text-right">
                    <div class="d-flex justify-content-end align-items-center">
                      <button class="btn btn-sm m-1 btn-success btn-xs" @click="handleUseOrientation(orientation.content)">
                        <span class="d-flex align-items-center"><i class="fas fa-hand-pointer mr-1"></i> Utilizar</span>
                      </button>
                      <button class="btn btn-sm m-1 btn-primary btn-xs" data-toggle="collapse" :data-target="'#collapse-'+index" aria-expanded="true" :aria-controls="'#collapse-'+index"><i class="fas fa-eye"></i></button>
                    </div>
                  </td>
                </tr>
                <tr :id="'collapse-'+index" class="collapse" :aria-labelledby="'heading-'+index" >
                  <td colspan="3">
                    <div class="card-body" v-html="orientation.content"></div>
                  </td>
                </tr>
              </template>
              <tr v-if="!orientations.length">
                <td colspan="3">Não há orientações cadastradas, você pode cadastrar uma nova orientação padrão no menu superior clicando em <br><strong> <a href="{% url 'exams:exam_orientations_list' %}" target="_blank">"Gerenciamento > Provas > Adiciona Orientações</a> </strong></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div> 
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog sm:tw-max-w-2xl sm:tw-my-8" role="document">
    <div class="modal-content" style="background: inherit; border: inherit; border-radius: inherit;">
      <div class="tw-flex tw-min-h-full tw-items-end tw-justify-center tw-p-4 tw-text-center sm:tw-items-center sm:tw-p-0">
        <div class="tw-relative tw-transform tw-overflow-hidden tw-rounded-lg tw-bg-white tw-px-4 tw-pb-4 tw-pt-5 tw-text-left tw-shadow-xl tw-transition-all sm:tw-w-full sm:tw-max-w-2xl sm:tw-p-6">
          <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block">
            <button type="button" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" data-dismiss="modal">
              <span class="tw-sr-only">Close</span>
              <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <form method="GET" onsubmit="return false;" @submit="addTeacher">
            <div>
              <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
                <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
                  <h3 class="tw-text-base tw-font-semibold tw-leading-6 tw-text-gray-900" id="modal-title">
                    <template v-if="is_request_question_ia">
                      Gerar questões com IA
                    </template>
                    <template v-else>
                      <template v-if="!selectedTeacherToUpdate">
                        Adicionar Professor
                      </template>
                      <template v-else>
                        Edição de Solicitação
                      </template>
                    </template>
                  </h3>
                </div>
                <hr/>
                <div class="tw-mt-4 tw-grid tw-grid-cols-1 tw-gap-x-6 tw-gap-y-8 sm:tw-grid-cols-6">
                  <div 
                    v-show="isNoTeacherSelectedOrHasNoQuestions() || canChangeSubjectWithExistingQuestions || canChangeGradeWithExistingQuestions" 
                    class="tw-col-span-full"
                  > 
                    <div v-show="isNoTeacherSelectedOrHasNoQuestions() || canChangeGradeWithExistingQuestions" class="tw-col-span-full" >
                      <label for="{{ form.grades.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                        {{ form.grades.label }}
                      </label>
                      <div class="tw-mt-2">
                        <select id="{{ form.grades.auto_id }}" name="{{ form.grades.html_name }}" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="selectedGrade">
                          {% for grade in grades %}
                            <option value="{{ grade.pk }}">{{ grade.full_name }}</option>
                          {% endfor %}
                        </select>
                      </div>
                    </div>
                    <!-- Selecione uma Disciplina -->
                    <div
                      v-show="isNoTeacherSelectedOrHasNoQuestions() || canChangeSubjectWithExistingQuestions" 
                      class="tw-col-span-full mt-3"
                    >
                      <label for="selectedSubject" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                        Escolha uma disciplina
                      </label>
                      <div class="tw-mt-2">
                        <select id="selectedSubject" name="subject" requerid class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                          <option value="">Selecione uma disciplina</option>
                          <option v-for="subject in subjects" :value="subject.id" v-html="subject.name + ' - ' + subject.knowledge_area_name"></option>
                        </select>
                      </div>
                    </div>
                    <div v-show="!is_request_question_ia" class="tw-col-span-full">
                      <div v-show="subDisciplines.length && (isNoTeacherSelectedOrHasNoQuestions() || canChangeSubjectWithExistingQuestions)" class="mt-3">
                        <label for="selectedSubdiscipline" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Escolha uma subdisciplina <span class="text-muted">(este campo é opcional)</span>
                        </label>
                        <div class="tw-mt-2">
                          <select id="selectedSubdiscipline" name="subdiscipline" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                            <option value="">Selecione uma subdisciplina</option>
                            <option v-for="subdiscipline in subDisciplines" :value="subdiscipline.id" v-html="subdiscipline.name + ' - ' + subdiscipline.knowledge_area_name"></option>
                          </select>
                        </div>
                      </div>
                      <div class="mt-3" v-show="!selectedTeacherToUpdate">
                        <label for="selectedTeacher" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Escolha o professor
                        </label>
                        <div class="tw-mt-2">
                          <select id="selectedTeacher" name="teacher" :required="!is_request_question_ia" multiple class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                            <option v-for="teacher in teachers" :value="teacher.id" v-html="teacher.teacher.name"></option>
                          </select>
                        </div>
                      </div>
                      <div class="mt-3">
                        <div class="tw-flex tw-items-center">
                          <div class="custom-control custom-switch">
                            <input type="checkbox" id="id_block_quantity_limit" name="block_quantity_limit" class="custom-control-input" v-model="block_quantity_limit" />
                            <label class="custom-control-label" for="id_block_quantity_limit">
                              <span class="tw-text-[#101928]" :class="[block_quantity_limit ? 'tw-font-semibold' : 'tw-font-medium']">Limitar quantidade de questões inseridas</span>
                            </label>
                          </div>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Ao ativar essa opção você limitará a quantidade de questões que podem ser inseridas por este professor.">
                            <g clip-path="url(#clip0_8_3857)">
                              <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </g>
                            <defs>
                              <clipPath id="clip0_8_3857">
                                <rect width="16" height="16" fill="white"/>
                              </clipPath>
                            </defs>
                          </svg>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="tw-col-span-full">
                    <label for="id_quantity" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                      Quantidade de questões
                    </label>
                    <input 
                      type="number" 
                      min="1" 
                      class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 noscroll" 
                      id="id_quantity" 
                      v-model="quantity" 
                      @input="handleQuantityChange" 
                      @change="adjustQuantity"
                      required
                    />
                  </div>

                  <div v-show="!is_request_question_ia" class="tw-col-span-full">
                    <div class="tw-flex tw-items-center">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_block_questions_quantity" name="block_questions_quantity" class="custom-control-input" v-model="block_questions_quantity" />
                        <label class="custom-control-label" for="id_block_questions_quantity">
                          <span class="tw-text-[#101928]" :class="[block_questions_quantity ? 'tw-font-semibold' : 'tw-font-medium']">Definir quantidade de questões objetivas/discursivas</span>
                        </label>
                      </div>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Ative esta opção caso você deseje limitar a quantidade de questões inseridas por este professor. O total das questões discursivas e objetivas deve ser igual a quantidade de questẽos definidas.">
                        <g clip-path="url(#clip0_8_3857)">
                          <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </g>
                        <defs>
                          <clipPath id="clip0_8_3857">
                            <rect width="16" height="16" fill="white"/>
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                    <div v-if="!questionsQuantityDefinitionsIsValid" class="text-danger small">
                      O total de questões objetivas e discursivas deve ser igual a quantidade de questões definida
                    </div>
                  </div>

                  <!-- A task tá aqui -->
                  <template v-if="block_questions_quantity">
                    <div class="tw-col-span-full tw-ml-10 tw-grid tw-grid-cols-1 tw-gap-x-6 tw-gap-y-8 sm:tw-grid-cols-6">
                      <div class="sm:tw-col-span-2">
                        <label for="id-objective-questions" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Objetivas
                        </label>
                        <div class="tw-mt-2">
                          <input @change="checkInputCompletation()" @focus="selectedQuantityInput = 'objectiveQuantity'" @focusout="selectedQuantityInput = null" type="number" min="0" :required="block_questions_quantity" step="1" name="objective-questions" id="id-objective-questions" autocomplete="given-name" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 noscroll" v-model.number="objective_quantity">
                          <small v-if="selectedQuantityInput == 'objectiveQuantity' && !questionsQuantityDefinitionsIsValid" class="text-muted">Máximo permitido: ${quantity - discursive_quantity}</small> 
                        </div>
                      </div>
                      <div class="sm:tw-col-span-2">
                        <label for="id-discursive-questions" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Discursivas
                        </label>
                        <div class="tw-mt-2">
                          <input @change="checkInputCompletation()" @focus="selectedQuantityInput = 'discursiveQuantity'" @focusout="selectedQuantityInput = null" type="number" min="0" :required="block_questions_quantity" step="1" name="discursive-questions" id="id-discursive-questions" autocomplete="family-name" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 noscroll" v-model.number="discursive_quantity"> 
                          <small v-if="selectedQuantityInput == 'discursiveQuantity' && !questionsQuantityDefinitionsIsValid" class="text-muted">Máximo permitido: ${quantity - objective_quantity}</small> 
                        </div>
                      </div>
                    </div>
                  </template>

                  {% if user.client_has_review_system %}
                    <div class="tw-col-span-full">
                      <label for="id_reviewed_by" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                        Revisores
                      </label>
                      <div class="tw-mt-2">
                        <select id="id_reviewed_by" name="reviewed_by" multiple class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                          <option v-for="reviewer in reviewers" :value="reviewer.id">${reviewer.name}</option>
                        </select>
                      </div>
                    </div>
                  {% endif %}

                  <div v-show="!is_request_question_ia" class="tw-col-span-full">
                    <div class="tw-flex tw-items-center">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_block_subject_note" name="block_subject_note" class="custom-control-input" v-model="block_subject_note" />
                        <label class="custom-control-label" for="id_block_subject_note">
                          <span class="tw-text-[#101928]" :class="[block_subject_note ? 'tw-font-semibold' : 'tw-font-medium']">Travar nota do professor</span>
                        </label>
                      </div>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Ative esta opção se deseja que a nota do caderno não seja redistribuída entre os professores.">
                        <g clip-path="url(#clip0_8_3857)">
                          <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </g>
                        <defs>
                          <clipPath id="clip0_8_3857">
                            <rect width="16" height="16" fill="white"/>
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                  </div>

                  <template v-if="(!exam.total_grade || block_subject_note)">
                    <div v-show="!is_request_question_ia"class="tw-col-span-full">
                      <label for="id_subject_note" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                        Nota da disciplina
                      </label>
                      <div class="tw-mt-2">
                        <input type="number" min="0" step="any" name="subject_note" id="id_subject_note" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 noscroll" @change="checkSubjectNoteValue($event)">
                      </div>
                    </div>
                  </template>

                  <div v-show="!is_request_question_ia && subject_note" class="tw-col-span-full">
                    <div class="tw-flex tw-items-center">
                      <div class="custom-control custom-switch">
                        <input type="checkbox" id="id_distribute_scores_freely" name="distribute_scores_freely" class="custom-control-input" v-model="distribute_scores_freely" />
                        <label class="custom-control-label" for="id_distribute_scores_freely">
                          <span class="tw-text-[#101928]" :class="[distribute_scores_freely ? 'tw-font-semibold' : 'tw-font-medium']">Permitir que o professor distribua a pontuação livremente.</span>
                        </label>
                      </div>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" data-placement="top" title="Ao ativar essa opção você permitirá que o professor distribua as notas das questões livremente.">
                        <g clip-path="url(#clip0_8_3857)">
                          <path d="M8.00004 10.6666V7.99998M8.00004 5.33331H8.00671M14.6667 7.99998C14.6667 11.6819 11.6819 14.6666 8.00004 14.6666C4.31814 14.6666 1.33337 11.6819 1.33337 7.99998C1.33337 4.31808 4.31814 1.33331 8.00004 1.33331C11.6819 1.33331 14.6667 4.31808 14.6667 7.99998Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </g>
                        <defs>
                          <clipPath id="clip0_8_3857">
                            <rect width="16" height="16" fill="white"/>
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                  </div>
                  <div class="tw-col-span-full">
                    <!-- Label exibido se `is_request_question_ia` for falso -->
                    <label v-if="!is_request_question_ia" for="id_note" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                      Observação para o professor (opcional)
                    </label>
                    <!-- Área de texto padrão -->
                    <div  v-show="!is_request_question_ia" class="tw-mt-2 ">
                      <textarea id="id_note"
                                name="note"
                                rows="3"
                                class="tw-block tw-w-full tw-mb-2 tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6"
                                v-model="note">
                      </textarea>
                    </div>
        
                    <!-- Campos adicionais de textarea exibidos se o checkbox estiver marcado -->
                    <div v-if="is_request_question_ia " class="">
                      <div v-if="is_request_question_ia" class="tw-flex tw-justify-between">
                        <label for="id_note" :required="is_request_question_ia" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          Instrução para Criação da Questão - 1
                        </label>
                        <div>
                          <input type="checkbox" id="show_textareas" @change="toggleTextareas">
                          <label for="show_textareas" data-toggle="tooltip" data-placement="top" title="Adicione o número de questões a preencher (máximo de 5). Campos adicionais aparecerão automaticamente." class="tw-ml-2 tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                            Adicionar Instruções por Questão
                          </label>
                        </div>
                      </div>
                      <div v-for="(note, index) in visibleNotes.slice(0, quantity)" :key="index" class="tw-mb-2">
                        <label :for="'id_note_additional_' + index" :required="is_request_question_ia" class="tw-mb-2 tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                          <span v-if= "index !== 0">Instrução para Criação da Questão - ${ index + 1 } </span>
                        </label>
                        <textarea :id="'id_note_additional_' + index"
                                  name="note_additional"
                                  v-model="note.text"
                                  rows="3"
                                  class="tw-block tw-w-full tw-rounded-md  tw-mb-2 tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                        </textarea>
                        <div  v-show="is_request_question_ia" class="tw-mb-2">
                          <div class="d-flex align-items-center">
                              <label :for="'imageUpload_' + index" class="cp">
                              <template v-if="note.image">
                                <span class="text-muted d-flex align-items-center tx-14 ">
                                  <span style="color: #6C727F;">Imagem selecionada: </span>
                                  <span style="color: #384250;" class="mx-2">${ nameImage }</span>
                                </span>
                              </template>
                              <template v-else>
                                <span style="color: #FF8F3D;"><b>Clique para adicionar </b> </span> 
                                <span style="color: #6C727F;">uma imagem de referência para a questão.</span>
                              </template>
                            </label>
                            <template v-if="note.image">
                              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#FF8F3D" class="bi bi-trash mx-2 cp" viewBox="0 0 16 16" @click="removeImage(index)">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/>
                              </svg>
                            </template>
                          </div>
                          <input type="file" class="d-none" :id="'imageUpload_' + index" @change="handleImageUpload($event, index)" />
                          <input type="hidden" :name="'image_location_' + index" :value="note.imageLocation">
                        </div>
                   
                      
                        <div v-if="is_request_question_ia" class="d-flex justify-content-between">
                          <div class="dropdown dropup">
                            <button 
                              class="tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm  hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600"
                              type="button" 
                              :id="'dropdownLevelsButton_' + index" 
                              aria-haspopup="true" 
                              aria-expanded="false"
                              style="height: 32px; width: 163px; max-width: 163px; border-radius: 8px;"
                              @click.stop="toggleDropdownLevels(index)"
                            >
                              <span data-toggle="tooltip" data-placement="top" title="Nível de Dificuldade">
                                ${ getLevelLabel(note.level)  || 'Nível de Dificuldade' }
                              </span>
                            </button>
                            <div v-show="isDropdownLevel[index]" class="dropdown-menu p-3 show" :style="{ width: '150px' }" :aria-labelledby="'dropdownLevelsButton_' + index">
                              <a v-for="level in levels" :key="level.value" class="dropdown-item" href="#" @click.prevent="selectLevel(level.value, index)">
                                ${ level.label }
                              </a>
                            </div>
                          </div>
                          <div class="dropdown">
                            <button 
                              type="button"
                              :class="{
                                'tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600': !isButtonAbilitiesDisabled,
                                'tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-full tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-[#667085] tw-text-sm tw-font-medium focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2': isButtonAbilitiesDisabled
                              }"
                              data-toggle="dropdown" 
                              :disabled="isButtonAbilitiesDisabled"
                              :id="'dropdownAbilitiesButton_' + index"
                              aria-haspopup="true"
                              aria-expanded="false"
                              @click="toggleDropdownAbilities(index)"
                              style="height: 32px; border-radius: 8px;"
                            >
                              <span data-toggle="tooltip" data-placement="top" :title="tooltipTitleAbility">
                                Habilidades (${ selectedAbilities[index]?.length || 0 })
                              </span>
                            </button>
                            
                            <div 
                              v-show="isDropdownAbilitiesOpen[index]"
                              class="dropdown-menu p-3"
                              :aria-labelledby="'dropdownAbilitiesButton_' + index"
                              style="width: 400px;"
                              @click.stop

                            >
                               <input 
                                type="text"
                                class="form-control mb-3"
                                placeholder="Buscar..."
                                v-model="searchQuery"
                                @click.stop

                              > 
                               <div 
                                v-for="ability in filteredAbilities" 
                                :key="ability.id"
                                @click="toggleSelectionAbilities(ability.id, index)"
                                :class="{'row-bncc': true, 'row-bncc-selected': selectedAbilities[index]?.includes(ability.id)}"
                                class="d-flex align-items-center mb-3"
                              >
                                <div class="align-self-start tw-mr-2">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" class="bi bi-file-earmark-text">
                                    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"></path>
                                    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"></path>
                                  </svg>
                                </div>
                                <span class="flex-grow-1">
                                  <span v-if="ability.code" class="font-weight-bold">${ ability.code } - </span>${ ability.text }
                                </span>
                              </div> 
                            </div>
                          </div>
                          <div class="dropdown">
                            <button 
                              :class="{
                                'tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600': !isButtonCompetenceDisabled,
                                'tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-full tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-[#667085] tw-text-sm tw-font-medium focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2': isButtonCompetenceDisabled
                              }"
                              type="button"
                              :disabled="isButtonCompetenceDisabled"
                              :id="'dropdownCompetencesButton_' + index"
                              data-toggle="dropdown"
                              aria-haspopup="true"
                              aria-expanded="false"
                              @click="toggleDropdownCompetences(index)"
                              style="height: 32px; border-radius: 8px;"
                            >
                              <span data-toggle="tooltip" data-placement="top" :title="tooltipTitleCompetence">
                                Competências (${ selectedCompetences[index]?.length || 0 })
                              </span>
                            </button>
                            
                            <div 
                              v-show="isDropdownCompetencesOpen[index]"
                              class="dropdown-menu  dropdown-menu-right p-3"
                              :aria-labelledby="'dropdownCompetencesButton_' + index"
                              style="width: 400px;"
                              @click.stop
                            >
                              <input 
                                type="text"
                                class="form-control mb-3"
                                placeholder="Buscar..."
                                v-model="searchQueryCompetences"
                                @click.stop
                              >
                              <div 
                                v-for="(competence, competenceIndex) in filteredCompetences" 
                                :key="competence.id"
                                @click="toggleSelectionCompetences(competence.id, index)"
                                :class="{'row-bncc': true, 'row-bncc-selected': selectedCompetences[index]?.includes(competence.id)}"
                                class="d-flex align-items-center mb-3"
                              >
                                <div class="align-self-start tw-mr-2">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" class="bi bi-file-earmark-text">
                                    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"></path>
                                    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"></path>
                                  </svg>
                                </div>
                                <span class="flex-grow-1">
                                  <span v-if="competence.code" class="font-weight-bold">${ competence.code } - </span>${ competence.text }
                                </span>
                              </div>
                            </div>
                          </div> 
                          <div class="dropdown">
                            <button 
                              type="button"
                              :class="{
                                'tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600': !isButtonTopicDisabled,
                                'tw-flex tw-w-full tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-full tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-[#667085] tw-text-sm tw-font-medium focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2': isButtonTopicDisabled
                              }"
                              data-toggle="dropdown"
                              :disabled="isButtonTopicDisabled"
                              :id="'dropdownTopicsButton_' + index"
                              aria-haspopup="true"
                              aria-expanded="false"
                              @click="toggleDropdownTopics(index)"
                              style="height: 32px; border-radius: 8px;"
                            >
                              <span data-toggle="tooltip" data-placement="top" :title="tooltipTitleTopic">
                                Assuntos (${ selectedTopics[index]?.length || 0 })
                              </span>
                            </button>
                            
                            <div 
                              v-show="isDropdownTopicsOpen[index]"
                              class="dropdown-menu dropdown-menu-right p-3"
                              :aria-labelledby="'dropdownTopicsButton_' + index"
                              style="width: 300px;"
                              @click.stop
                            >
                              <input 
                                type="text"
                                class="form-control mb-3"
                                placeholder="Buscar..."
                                v-model="searchQueryTopics"
                                @click.stop
                              >
                              <div 
                                v-for="(topic, topicIndex) in filteredTopics"
                                :key="topic.id"
                                @click="toggleSelectionTopics(topic.id, index)"
                                :class="{'row-bncc': true, 'row-bncc-selected': selectedTopics[index]?.includes(topic.id)}"
                                class="d-flex align-items-center mb-3"
                              >
                                <div class="align-self-start tw-mr-2">
                                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" class="bi bi-file-earmark-text">
                                    <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z"></path>
                                    <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"></path>
                                  </svg>
                                </div>
                                <span class="flex-grow-1">
                                  ${ topic.name } 
                                </span>
                              </div>
                            </div>
                          </div>       
                                  
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <template v-if="editing">
              <div class="tw-mt-5 sm:tw-mt-4 sm:tw-flex sm:tw-flex-row-reverse">
                <button 
                  type="button" 
                  :disabled="!questionsQuantityDefinitionsIsValid" 
                  class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-green-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-green-500 sm:tw-ml-3 sm:tw-w-auto" 
                  @click="selectedTeacherToUpdate.id && (!exam.total_grade ? subject_note:true) ? confirmSubjectNote():updateExamTeacher(selectedTeacherToUpdate, 'update')"
                >Confirmar</button> 
                <button type="button" class="tw-mt-3 tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50 sm:tw-mt-0 sm:tw-w-auto" @click="updateExamTeacher(selectedTeacherToUpdate, 'reset')">Cancelar</button>
              </div>
            </template>
            <template v-else>
              <div v-if="!is_request_question_ia" class="tw-mt-5 sm:tw-mt-4 sm:tw-grid sm:tw-grid-flow-row-dense sm:tw-grid-cols-2 sm:tw-gap-3">
                <button
                  :disabled="!questionsQuantityDefinitionsIsValid"
                  type="submit"
                  name="_action"
                  value="addanother"
                  class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-500 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-400 not-disable"
                >
                  Adicionar e solicitar mais
                </button>
                <button 
                  :disabled="!questionsQuantityDefinitionsIsValid"
                  type="submit"
                  name="_action"
                  value="save"
                  class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 not-disable"
                  >
                  Adicionar Professor
                </button>              
              </div>
              <div v-show="is_request_question_ia"  class="tw-mt-5 sm:tw-mt-4">
                <button
                    type="submit"
                    name="_action"
                    value="save"
                    class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-500 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-400 not-disable"
                  >
                Gerar Questões
               </button>
              </div>
            </template>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModalHistory" tabindex="-1" role="dialog" aria-labelledby="exampleModalHistoryLabel" aria-hidden="true">
  <div class="modal-dialog sm:tw-max-w-2xl sm:tw-my-8" role="document">
    <div class="modal-content" style="background: inherit; border: inherit; border-radius: inherit;">
      <div class="tw-flex tw-min-h-full tw-items-end tw-justify-center tw-p-4 tw-text-center sm:tw-items-center sm:tw-p-0">
        <div class="tw-relative tw-transform tw-overflow-hidden tw-rounded-lg tw-bg-white tw-text-left tw-shadow-xl tw-transition-all sm:tw-w-full sm:tw-max-w-2xl">
          <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block sm:tw-pt-6 sm:tw-pr-6">
            <button type="button" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" data-dismiss="modal">
              <span class="tw-sr-only">Close</span>
              <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div>
            <div>
              <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
                <div class="tw-px-4 tw-pb-4 tw-pt-5 tw-border-b tw-border-[#E5E7EA] sm:tw-p-6">
                  <h3 class="tw-text-lg tw-font-medium tw-leading-6 tw-text-gray-900" id="modal-title">Histórico de Alterações</h3>
                </div>
                <div class="tw-px-4 tw-pb-4 sm:tw-pt-1.5 sm:tw-px-6 sm:tw-pb-6">
                  <table class="tw-min-w-full tw-divide-y tw-divide-[#E5E7EA]">
                    <thead>
                      <tr>
                        <th scope="col" class="tw-py-3.5 tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085] sm:tw-pl-0">Modificado por</th>
                        <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085]">Mudanças</th>
                        <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085]">Data</th>
                      </tr>
                    </thead>
                    <tbody class="tw-divide-y tw-divide-[#E5E7EA]">
                      {% for change in object.changes %}
                        {% if change.fields %}
                          <tr>
                            <td class="tw-whitespace-nowrap tw-py-4 tw-pl-4 tw-pr-3 tw-text-base tw-font-semibold tw-text-[#374151] sm:tw-pl-0">
                              {{ change.history_user }}
                            </td>
                            <td class="tw-px-3 tw-py-4 tw-text-sm tw-text-[#384250]">
                              {{ change.fields }}
                            </td>
                            <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-[#384250]">
                              {{ change.history_date|date:"d/m/Y \à\s H:i" }}
                            </td>
                          </tr>
                          {% endif %}
                      {% endfor %}
                    </tbody>
                  </table>
                  <div class="tw-mt-5 sm:tw-mt-4 sm:tw-flex">
                    <button type="button" class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500" data-dismiss="modal">Fechar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="exampleModalMaterial" tabindex="-1" role="dialog" aria-labelledby="exampleModalMaterialLabel" aria-hidden="true">
  <div class="modal-dialog sm:tw-max-w-2xl sm:tw-my-8" role="document">
    <div class="modal-content" style="background: inherit; border: inherit; border-radius: inherit;">
      <div class="tw-flex tw-min-h-full tw-items-end tw-justify-center tw-p-4 tw-text-center sm:tw-items-center sm:tw-p-0">
        <div class="tw-relative tw-transform tw-overflow-hidden tw-rounded-lg tw-bg-white tw-text-left tw-shadow-xl tw-transition-all sm:tw-w-full sm:tw-max-w-2xl">
          <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block sm:tw-pt-6 sm:tw-pr-6">
            <button type="button" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" data-dismiss="modal">
              <span class="tw-sr-only">Close</span>
              <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div>
            <div>
              <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
                <div class="tw-px-4 tw-pb-4 tw-pt-5 tw-border-b tw-border-[#E5E7EA] sm:tw-p-6">
                  <h3 class="tw-text-lg tw-font-medium tw-leading-6 tw-text-gray-900" id="modal-title">Materiais de estudo</h3>
                </div>
                <div class="tw-px-4 tw-pb-4 sm:tw-px-6 sm:tw-py-6">

                  <!-- {% if object %} v-if="!exam.materials.length || exam.materials.length && exam.materials[exam.materials.length-1].id" {% endif %} -->
                  <template v-if="savedExamMaterials.length === 0 && unsavedExamMaterials.length === 0">
                    <div class="tw-flex tw-items-center tw-justify-center tw-relative tw-h-[32rem] tw-overflow-hidden tw-rounded tw-border tw-border-dashed tw-border-[#D2D6DB]">
                      <div class="tw-flex tw-flex-col tw-items-center tw-gap-8">
                        <div class="tw-flex tw-flex-col tw-items-center tw-gap-2">
                          <p class="tw-text-lg tw-font-medium tw-leading-6 tw-text-gray-900">Nenhum material foi adicionado!</p>
                          <p class="tw-text-sm tw-text-gray-900">Clique no botão abaixo para adicionar.</p>
                        </div>
                        <button type="button" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" @click="addMaterial()">
                          Cadastrar material
                          <svg width="25" height="24" viewBox="0 0 25 24" fill="none" class="ml-2">
                            <path d="M12.5 5V19M5.5 12H19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div>
                  </template>

                  <template v-else-if="savedExamMaterials.length > 0 && unsavedExamMaterials.length === 0">
                    <div>
                      <button type="button" class="tw-w-full tw-flex tw-justify-center tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 tw-mb-6" @click="addMaterial()">
                        Cadastrar material
                        <svg width="25" height="24" viewBox="0 0 25 24" fill="none" class="ml-2">
                          <path d="M12.5 5V19M5.5 12H19.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <div class="tw-space-y-2">
                        <div v-for="(material, index) in savedExamMaterials" class="tw-flex tw-items-center tw-justify-between tw-border tw-p-6 tw-rounded-2xl">
                          <div>
                            <div class="tw-font-semibold tw-text-[#374151] tw-mb-2">
                              ${material.title}
                            </div>
                            <span class="tw-text-[#384250]">
                              ${material.stage} - ${release_material_study}
                            </span>
                          </div>
                          <div class="tw-flex tw-items-center tw-gap-8">
                            <div class="tw-flex tw-gap-3">
                              <button type="button" @click="editMaterial(material)" class="tw-rounded-full tw-bg-[#9BA3AF] tw-p-3 tw-text-white tw-shadow-sm hover:tw-bg-gray-700 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="">
                                <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                  <path d="M21 21.0001H13M2.5 21.5001L8.04927 19.3657C8.40421 19.2292 8.58168 19.161 8.74772 19.0718C8.8952 18.9927 9.0358 18.9013 9.16804 18.7987C9.31692 18.6831 9.45137 18.5487 9.72028 18.2798L21 7.00006C22.1046 5.89549 22.1046 4.10463 21 3.00006C19.8955 1.89549 18.1046 1.89549 17 3.00006L5.72028 14.2798C5.45138 14.5487 5.31692 14.6831 5.20139 14.832C5.09877 14.9643 5.0074 15.1049 4.92823 15.2523C4.83911 15.4184 4.77085 15.5959 4.63433 15.9508L2.5 21.5001ZM2.5 21.5001L4.55812 16.149C4.7054 15.7661 4.77903 15.5746 4.90534 15.4869C5.01572 15.4103 5.1523 15.3813 5.2843 15.4065C5.43533 15.4354 5.58038 15.5804 5.87048 15.8705L8.12957 18.1296C8.41967 18.4197 8.56472 18.5648 8.59356 18.7158C8.61877 18.8478 8.58979 18.9844 8.51314 19.0947C8.42545 19.2211 8.23399 19.2947 7.85107 19.442L2.5 21.5001Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </button>
                              <button type="button" @click="deleteMaterial(material)" class="tw-rounded-full tw-bg-[#9BA3AF] tw-p-3 tw-text-white tw-shadow-sm hover:tw-bg-gray-700 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="">
                                <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                  <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>

                  <template v-else>
                    <div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-lg tw-font-semibold tw-leading-6 tw-text-gray-900">Cadastrar material</p>
                        <button type="button" @click="removeMaterial()">Voltar</button>
                      </div>
                      <div v-for="(material, index) in unsavedExamMaterials" class="tw-mt-10 tw-grid tw-grid-cols-1 tw-gap-x-6 tw-gap-y-8 sm:tw-grid-cols-6">
                        <div class="sm:tw-col-span-3">
                          <label for="id-material-title" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                            Título do Material
                          </label>
                          <div class="tw-mt-2">
                            <input type="text" name="material-title" id="id-material-title" autocomplete="on" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="material.title">
                          </div>
                        </div>
                        <div class="sm:tw-col-start-1 sm:tw-col-span-3">
                          <label for="id-teaching-stage" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                            Etapa de ensino
                          </label>
                          <div class="tw-mt-2">
                            <select id="id-teaching-stage" name="teaching-stage" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="material.stage">
                              <option value="0">1ª Etapa</option>
                              <option value="1">2ª Etapa</option>
                              <option value="2">3ª Etapa</option>
                              <option value="3">4ª Etapa</option>
                              <option value="4">5ª Etapa</option>
                              <option value="5">6ª Etapa</option>
                              <option value="6">Geral</option>
                            </select>
                          </div>
                        </div>
                        <div class="sm:tw-col-start-1 sm:tw-col-span-3">
                          <label for="id-material-release-date" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                            Quando liberar para alunos
                          </label>
                          <div class="tw-mt-2">
                            <input type="date" name="material-release-date" id="id-material-release-date" required class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="release_material_study">
                          </div>
                        </div>
  
                        <div class="sm:tw-col-start-4 sm:tw-col-span-3 sm:tw-row-start-1 sm:tw-row-span-3">
                          <label for="id-material-cover-image" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                            Imagem de capa do material
                          </label>
                          <div class="tw-mt-2 tw-flex tw-justify-center tw-rounded-2xl tw-bg-[#F9FAFA] tw-px-6 tw-py-10" style="height: calc(100% - 2rem);">
                            <div class="tw-text-center">
                              <svg class="tw-mx-auto tw-h-12 tw-w-12 tw-text-gray-300" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z" clip-rule="evenodd" />
                              </svg>
                              <div class="tw-mt-4 tw-flex tw-justify-center tw-text-sm tw-leading-6 tw-text-gray-600">
                                <label for="id-material-cover-image" class="tw-relative tw-cursor-pointer tw-rounded-md tw-bg-[#F9FAFA] tw-font-semibold tw-text-primary-600 focus-within:tw-outline-none focus-within:tw-ring-2 focus-within:tw-ring-primary-600 focus-within:tw-ring-offset-2 hover:tw-text-primary-500">
                                  <span>Clique para adicionar</span>
                                  <input id="id-material-cover-image" name="material-cover-image" type="file" class="tw-sr-only" accept="image/*" @change="material.thumbnail = $event.target.files[0]" required />
                                </label>
                              </div>
                              <p class="tw-text-xs tw-leading-5 tw-text-gray-600">PDF, PNG, JPG ou JPEG (max. 20 MB)</p>
                            </div>
                          </div>
                        </div>
  
                        <div class="tw-col-span-full">
                          <label for="id-material-file" class="tw-sr-only">Material</label>
                          <div class="tw-mt-2 tw-flex tw-justify-center tw-rounded-lg tw-border tw-border-dashed border-gray-900/25 tw-px-6 tw-py-10">
                            <div class="tw-text-center">
                              <svg class="tw-mx-auto tw-h-12 tw-w-12 tw-text-gray-300" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z" clip-rule="evenodd" />
                              </svg>
                              <div class="tw-mt-4 tw-flex tw-text-sm tw-leading-6 tw-text-gray-600">
                                <label for="id-material-file" class="tw-relative tw-cursor-pointer tw-rounded-md tw-bg-white tw-font-semibold tw-text-primary-600 focus-within:tw-outline-none focus-within:tw-ring-2 focus-within:tw-ring-primary-600 focus-within:tw-ring-offset-2 hover:tw-text-primary-500">
                                  <span>Clique para adicionar</span>
                                  <input id="id-material-file" name="material-file" type="file" class="tw-sr-only" accept="image/*" @change="material.material = $event.target.files[0]" required />
                                </label>
                                <p class="tw-pl-1">ou arraste e solte</p>
                              </div>
                              <p class="tw-text-xs tw-leading-5 tw-text-gray-600">PDF, PNG, JPG ou JPEG (max. 20 MB)</p>
                            </div>
                          </div>
                        </div>
  
                        <div class="tw-col-span-full">
                          <button type="button" class="btn btn-primary btn-sm d-flex align-items-center" @click="updateMaterial(material)" v-if="material.id" :disabled="material.saving || !material.title.length">
                            ${material.saving ? 'Aguarde' : 'Confirmar alterações'}
                            <div class="spinner-border text-info mx-2" role="status" v-if="material.saving">
                              <span class="sr-only">Alterando...</span>
                            </div>
                          </button>
                          {% if object %}
                            <button type="button" class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500" @click="createMaterial(material)" :disabled="savingMaterial" v-else>
                              ${savingMaterial ? 'Aguarde' : 'Cadastrar Material'}
                              <div class="spinner-border text-secondary mx-2" role="status" v-if="savingMaterial">
                                <span class="sr-only">Cadastrando...</span>
                              </div>
                            </button>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </template>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock extra-modal %}


{% block js-additional %}


<script src="{% static 'administration/lib/typeahead.js/typeahead.bundle.min.js' %}"></script>
<script src="{% static 'administration/lib/bootstrap-tagsinput/bootstrap-tagsinput.min.js' %}"></script>
<script src="{% static 'administration/lib/select2/js/select2.min.js' %}"></script>
<script src="{% static 'administration/assets/vendor/jquery.mask.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment-with-locales.min.js"></script>
<script src="{% static 'js/numeric.js' %}"></script>
<script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>
<script src="//unpkg.com/focus-overlay@latest/dist/focusoverlay.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/@sjmc11/tourguidejs/dist/tour.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script type="text/javascript">
  moment.locale('pt-br');
  var app_question = new Vue({
    delimiters: ['${', '}'],
    el: '#app',
    data: {
      selectedQuestionCategory:"",
      selectedContent: '',
      selectedSourceStatusQuestion: '',
      loadingBlockWeight: false,
      selectedAnnulationType: 0,
      request_tags: {% if exam.status %}true{% else %}false{% endif %},
      no_client_tags: {% if not client_tags %}true{% else %}false{% endif %},
      clientTags: [
          {% for tag in client_tags %}
          {
              id: "{{ tag.pk }}",
              name: "{{ tag.name }}",
          },
          {% endfor %}
      ],
      status_tags_history: [
        {% for tag_status in questions_status_tags %}
        {
          'pk': '{{tag_status.status.pk}}',
          'tags':
          [
            {% for tag in tag_status.tags.all %}
              '{{tag.name}}',
            {% endfor %}
          ],
        },
        {% endfor %}
      ],
      orientations: [],
      showOrientations: {% if object.orientations %}true{% elif form.orientations.value %}true{% else %}false{% endif %},
      exam: {
        coordinations: [],
        category: 
        {% if not object %}
          {% if category == 'homework' %}
            1
          {% else %}
            0
          {% endif %}
        {% else %}
          {{ object.category }}
        {% endif %},
        name: '',
        status: {% if object == 0 %}{{ object.status }}{% else %}0{% endif %},
        base_text_location: 0,
        random_alternatives: false,
        random_questions: false,
        group_by_topic: false,
        elaboration_deadline: '',
        release_elaboration_teacher: '',
        review_deadline: null,
        correction_by_subject: false,
        is_english_spanish: false,
        teacher_subjects: [],
        materials: [],
        group_attachments: false,
        start_number: 1,
        total_grade: null,
        related_subjects: false,
        relations: [],
        teaching_stage: null,
        education_system: null,
        exam_print_config_header: '',
        use_quantity_alternatives: {% if object and object.quantity_alternatives %}true{% else %}false{% endif %},
        quantity_alternatives: {% if object and object.quantity_alternatives %}{{ object.quantity_alternatives }}{% else %}null{% endif %},
        enable_discursive_ai_correction: false,
        is_confidential: false,
      },
      canAddRevisionAfterClosingExam: {{ user.questions_configuration.can_add_revision_after_closing_exam|lower|default:"false" }},
      canChangeSubjectWithExistingQuestions: {{ user.questions_configuration.can_change_subject_with_existing_questions|lower|default:"false" }},
      canChangeGradeWithExistingQuestions: {{ user.questions_configuration.can_change_grade_with_existing_questions|lower|default:"false" }},
      selectedLevel: "",
      dragging: false,
      selectedTeachers: [],
      selectedTeachersStatus: 'idle',
      teachersOnSelect: [],
      subjects: [],
      subDisciplines: [],
      teachers: [],
      selectedGrade: "",
      selectedSubject: "",
      selectedSubdiscipline: "",
      selectedTeacher: '',
      quantity: 1,
      reviewed_by: [],
      reviewers: [],
      subject_note: "",
      block_subject_note: false,
      block_questions_quantity: false,
      block_quantity_limit: false,
      distribute_scores_freely: false,
      objective_quantity: 0,
      discursive_quantity: 0,
      note: "",
      noteText: "Instruções para criação das questões",      
      is_request_question_ia: false,
      showTextareas: false,
      defaultText: 'Quero uma questão que aborde o assunto [tema ou tópico] que trabalhe a habilidade [habilidade da BNCC], contextualizada com [contexto ou situação realista] de dificuldade [médio, fácil ou difícil].',
      additionalNotes: Array(5).fill(null).map(() => ({ 
        text: 'Quero uma questão que aborde o assunto [tema ou tópico] que trabalhe a habilidade [habilidade da BNCC], contextualizada com [contexto ou situação realista] de dificuldade [médio, fácil ou difícil].', 
        level: '',
        abilities: [],
        competences: [],
        topics: [],
        image: null,
      })),
      predefinedTeacherIA: null, 
      selectedQuestion: {},
      selectedQuestionIndex: 0,
      coordinations: [
        {% for coordination in form.coordinations.field.queryset.all %}
          {
            pk: '{{coordination.pk}}',  
            highSchool: {{coordination.high_school|lower}}, 
            elementarySchool: {{coordination.elementary_school|lower}}, 
            elementarySchool2: {{coordination.elementary_school2|lower}}, 
          },
        {% endfor %}
      ],
      //Controls for edit teacher subject
      selectedTeacherToUpdate: "",
      editing: false,
      loading: false,
      historicalQuestion: '',
      statusList: {
        "Em aberto": {class: "badge-warning", icon: "fa-eye", color: "tw-text-[#F3B364]"},
        "Aprovada": {class: "badge-success", icon: "fa-check", color: "tw-text-[#41C588]"},
        "Reprovada": {class: "badge-danger", icon: "fa-times", color: "tw-text-[#D92D20]"},
        "Aguardando correção": {class: "badge-info", icon: "fa-clock", color: "tw-text-[#38bdf8]"},
        "Corrigido": {class: "badge-warning", icon: "fa-eye", color: "tw-text-[#F3B364]"},
        "Visto": {class: "badge-primary", icon: "fa-eye", color: "tw-text-[#0C7BDB]"},
        "Anulada": {class: "badge-danger", icon: "fa-times-circle", color: "tw-text-[#D92D20]"},
        "Anulada e pontuação dada": {class: "badge-danger", icon: "fa-times-circle", color: "tw-text-[#D92D20]"},
        "Usar depois": {class: "badge-info", icon: "fa-clock", color: "tw-text-[#38bdf8]"},
        "Rascunho": {class: "badge-secondary", icon: "fa-pen", color: "tw-text-[#8392A5]"},
        "Resposta do professor": {class: "badge-secondary", icon: "fa-reply", color: "tw-text-[#8392A5]"}
      },
      levels: [
        { value: '3', label: 'Indefinido' },
        { value: '0', label: 'Fácil' },
        { value: '1', label: 'Médio' },
        { value: '2', label: 'Difícil' }
      ],
      nameImage: "",
      selectedImage: null,
      selectedImageCreate: null,
      isDropdownLevel: Array(5).fill(false),
      isDropdownAbilitiesOpen: Array(5).fill(false),
      isDropdownCompetencesOpen: Array(5).fill(false),
      isDropdownTopicsOpen: Array(5).fill(false),
      imageIAURL: '',
      searchQueryCompetences: '', 
      selectedCompetences: Array(5).fill([]),
      competences: [],
      topics: [],
      abilities: [],
      searchQuery: '',
      selectedAbilities: Array(5).fill([]),
      searchQueryTopics: '',
      selectedTopics: Array(5).fill([]),
      selectedFilter: '',
      selectedGrades: '',
      release_material_study: '',
      savingMaterial: false,
      loadExamQuestions: false,
      recalculateWeights: false,
      updateWeight: '',
      blockedWeight: 0,
      unavailableStatus: ["Reprovada", "Anulada", "Usar depois", "Anulada e pontuação dada"],
      coordinationsToSelect2: [],
      treeselect: null,
      teacherModalTabActive: 'question',
      errors: {},
      currentYear: new Date().getFullYear(),
      availableExams: [],
      availableExamTeacherSubjects: [],
      copyQuestionData: {
        examQuestionToCopy: "",
        destinationExam: "",
        destinationExamTeacherSubject: "",
        duplicateQuestion: false,
      },
      // Caso a variável não venha da view, o template filter "default" não está funcionando corretamente, esse if foi como consegui fazer funcionar
      {% if not can_remove_exam_teacher_subjects == None %}
        canRemoveExamTeacherSubject: {{ can_remove_exam_teacher_subjects|lower }},
      {% else %}
        canRemoveExamTeacherSubject: true,
      {% endif %}
      isGenerating: false,
      isButtonDisabled: false,
      questionData: {
          enunciation: '',
          commented_answer: '',
          alternatives: []
      },
      changeType: false, 
      reduceStatement: false,
      reduceAlternatives: false,
      reduceTextsAlternatives: false,
      contextText: '',
      insertContext: false,
      selectedContent: '', 
      sendFragment: false,
      questionSugestion: false,
      newStatusQuestion: {
        status: "",
        note: "",
        give_score: false,
        distributeInExamTeacherSubject: false,
        question_fragment: "",
        source_status_question: "",
      },
      statusDialogElement: null,
      selectedExamQuestion: null,
      statusMap: [
          "Aprovada",
          "Reprovada",
          "Em aberto",
          "Aguardando correção",
          "Corrigido",
          "Visto",
          "Anulada",
          "Usar depois",
          "Rascunho"
      ],
      checkIsBagExist: {{ checkIsBagExist|lower|default:"false"  }},
      selectedStatus: "todas",
      isDropdownStatusOpen: false,
      statuses: [
        { value: 'todas', label: 'Todas', class: '', icon: 'fa-eye', color: 'tw-text-[#41C588]' },
        { value: 'Aprovada', label: 'Aprovada',  icon: 'fa-check', color: 'tw-text-[#41C588]' },
        { value: 'Em aberto', label: 'Em aberto', icon: 'fa-eye', color: 'tw-text-[#F3B364]' },
        { value: 'Corrigido', label: 'Corrigido', icon: 'fa-eye', color: 'tw-text-[#F3B364]' },
        { value: 'Usar depois', label: 'Usar depois', icon: 'fa-clock', color: 'tw-text-[#38bdf8]' },
        { value: 'Aguardando correção', label: 'Aguardando correção',  icon: 'fa-clock', color: 'tw-text-[#38bdf8]' },
        { value: 'Reprovada', label: 'Reprovada', icon: 'fa-times', color: 'tw-text-[#D92D20]' },
        { value: 'Anulada', label: 'Anulada',  icon: 'fa-times-circle', color: 'tw-text-[#D92D20]' },
      ],
      selectedQuantityInput: null,
      maxExamTotalGrade: {% if exam.total_grade %}{{ exam.total_grade|safe }}{% else %}null{% endif %},
    },
    computed: {
      selectedStatusLabel() {
        const status = this.statuses.find(status => status.value === this.selectedStatus);
        return status ? status.label : 'Todas';
      },
      examQuestionsFiltered() {
        if (this.selectedStatus === 'todas') {
          return this.selectedTeacher.exam_questions; 
        }
        return this.selectedTeacher.exam_questions.filter(
          (question) => question.last_status.status_display === this.selectedStatus
        );
      },
      hasAiCreatedOrAdaptedQuestion() {
        const result = this.selectedTeacher && this.selectedTeacher.exam_questions
          ? this.selectedTeacher.exam_questions.some(question => {
              return question.question.created_with_ai;
            })
          : false;
  
        return result;
      },
      visibleNotes() {
        return this.showTextareas ? this.additionalNotes : this.additionalNotes.slice(0, 1);
      },
      tooltipTitleCompetence() {
        return this.isButtonCompetenceDisabled
        ? 'Nenhuma disciplina selecionada ou nenhuma competência disponível para a disciplina selecionada.' 
        : "Competência(s) selecioanda(s)";
      },
      tooltipTitleTopic() {
        return this.isButtonTopicDisabled 
          ? 'Nenhuma disciplina selecionada ou nenhum assunto disponível para a disciplina selecionada.' 
          : "Assunto(s) selecioando(s)";
      },
      tooltipTitleAbility() {
        return this.isButtonAbilitiesDisabled 
          ? 'Nenhuma disciplina selecionada ou nenhum tópico disponível para a disciplina selecionada.' 
          : "Habilidade(s) selecioanda(s)";
      },
      isButtonCompetenceDisabled(){
        return this.selectedSubject === '' && !this.competences || this.competences.length == 0;
      },
      isButtonAbilitiesDisabled(){
        return this.selectedSubject === '' && !this.abilities || this.abilities.length == 0;
      },
      isButtonTopicDisabled() {
        return this.selectedSubject === '' && !this.topics || this.topics.length == 0;
      },
      filteredTopics() {
        return this.topics.filter(topic => topic.name.toLowerCase().includes(this.searchQueryTopics.toLowerCase()));
      },
      filteredCompetences() {
        return this.competences.filter(competence =>
          competence.text.toLowerCase().includes(this.searchQueryCompetences.toLowerCase())
        );
      },
      selectedLevelLabel() {
        const selected = this.levels.find(level => level.value === this.selectedLevel);
        return selected ? selected.label : '';
      },
      filteredAbilities() {
        return this.abilities.filter(ability => {
          const searchText = this.searchQuery.toLowerCase();
          return ability.text.toLowerCase().includes(searchText) || (ability.code && ability.code.toLowerCase().includes(searchText));
        });
      },
      savedExamMaterials() {
        return this.exam.materials.filter(material => material.id);
      },
      unsavedExamMaterials() {
        return this.exam.materials.filter(material => !material.id || material.editing);
      },
      questionsQuantityDefinitionsIsValid() {
        if (this.block_questions_quantity) {
          let calculatedQuantitySum = parseInt(this.discursive_quantity || 0) + parseInt(this.objective_quantity || 0)
          return calculatedQuantitySum == this.quantity
        }
        return true
      },
    },
    watch: {
      quantity(newQuantity) {
        if (this.showTextareas || this.is_request_question_ia) {
          this.updateAdditionalNotes();
        }
      },
      is_request_question_ia() {
        this.updateAdditionalNotes(); 
      },
      'exam.start_number': function(value){
        if (value < 1) {
          this.exam.start_number = 1;
        }
      },
      selectedFilter: function(value) {
        this.selectedFilter = value
      },
      'exam.is_english_spanish': function(value) {
        if(!value) {
          this.changeForeignLanguage()
          this.resetForeignLanguage()
        }
      },
      'copyQuestionData.destinationExam': function(newVal, oldVal) {
        this.availableExamTeacherSubjects = []
        this.copyQuestionData.destinationExamTeacherSubject = ""
        
        let url = '{% url "exams:exam_teacher_subjects_from_exam" %}' + `?exam_pk=${newVal}`
        axios.get(`${url}`).then((res) => {
          this.availableExamTeacherSubjects = res.data
        })

      },
    },
    methods: {
      isNoTeacherSelectedOrHasNoQuestions() {
        return !this.selectedTeacherToUpdate || (this.selectedTeacherToUpdate && !(this.selectedTeacherToUpdate.exam_questions.length || this.selectedTeacherToUpdate.exam_questions_count))
      }, 
      isCoordinationOrIsChecked(isCheckedBy) {
        if (isCheckedBy) {
          return true
        }
        if ('{{ user.user_type }}' === 'coordination') {
          return true
        }
        return false
      },
      updateStatusQuestion(noteId, isCheckedBy) {

        // Função para atualizar um StatusQuestion

        let url = "{% url 'exams:exams_status_question_api_update'  pk='00000000-0000-0000-0000-000000000000' %}";
        url = url.replace('00000000-0000-0000-0000-000000000000', noteId);

        axios.put(url).then((res) => {
          // Operação bem-sucedida
          this.alertTop("Visto atualizado com sucesso");
          const note = this.selectedTeacher.exam_questions[this.selectedQuestionIndex].status_list.find(n => n.id === noteId);
          Vue.set(this.selectedTeacher.exam_questions[this.selectedQuestionIndex].status_list, this.selectedTeacher.exam_questions[this.selectedQuestionIndex].status_list.indexOf(note), res.data);
        })
        .catch((error) => {
            if (error.response && error.response.status === 403) { 
                // Um usuário diferente adicionou o visto
                $('#checked-by-input-'+noteId).prop('checked', true);
                this.alertTop("A remoção do visto só pode ser realizada pelo usuário que o aplicou",'info');
            } 
            else {
                // Tratamento para erros inesperados
                this.alertTop("Erro ao atualizar a aplicação do visto",'error');
            }
        });
      },
      checkInputCompletation(input) {
        if(!this.objective_quantity || this.objective_quantity < 0) {
          this.objective_quantity = 0
        } 
        if (!this.discursive_quantity || this.discursive_quantity < 0) {
          this.discursive_quantity = 0
        }
        if(this.objective_quantity > this.quantity) {
          this.objective_quantity = this.quantity
        }
        if(this.discursive_quantity > this.quantity) {
          this.discursive_quantity = this.quantity
        }
      },
      closeTeacherModal() {
        this.selectedStatus = 'todas'; 
        this.isDropdownStatusOpen = false; 
      },
      toggleDropdownStatus() {
        this.isDropdownStatusOpen = !this.isDropdownStatusOpen;
      },
      selectStatus(statusValue) {
        this.selectedStatus = statusValue;
        this.isDropdownStatusOpen = false; 
      },
      hasMultipleCorrectOptions(question) {
        if (question.category === "Objetiva") {
            return question.alternatives.filter((alt) => alt.is_correct === true).length > 1;
        }
        return false
      },
      isOptionCountIncorrect(question){
        if (question.category === "Objetiva" && this.exam.use_quantity_alternatives){
          return question.alternatives.length != this.exam.quantity_alternatives
        }
        return false
      },
      checkNoCorrectOption(question){
        if (question.category === "Objetiva"){
          return question.alternatives.every((alt) => alt.is_correct === false)
        }
        return false
      },
      checkBagExistAndShowModal() {
        if (this.checkIsBagExist) {
          Swal.fire({
            icon: 'warning',
            title: 'Atenção',
            text: 'Este caderno já possui um malote gerado e não poderá haver a revisão de PDF.',
          });
        } else {
          this.exam.status = 6;
        }
      },
      cleanHtml(content) {
        let cleanedContent = content.replace(/src="(.*?\.png)\\/, 'src="$1"');
        cleanedContent = cleanedContent.replace(/data-mce-src="(.*?\.png)\\/, 'data-mce-src="$1"');
        return cleanedContent;
      },
      handleImageUpload(event, index) {
        const file = event.target.files[0];
        if (!file) return;
        this.nameImage = file.name
        this.$set(this.additionalNotes, index, { ...this.additionalNotes[index], image: file });
      
        let formData = new FormData();
        formData.append('file', file);
      
        axios.post("{% url 'core:upload_image_ia' %}", formData, {
            headers: {
                'Content-Type': 'multipart/form-data'
            }
        })
        .then(response => {
          
          let newImageUrl = response.data.location;
          
          this.$set(this.additionalNotes, index, { ...this.additionalNotes[index], image: newImageUrl });
        })
        .catch(error => {
          console.error('Erro ao enviar imagem para o backend:', error);
        });
      },
      removeImage(index) {
        this.$set(this.additionalNotes, index, { ...this.additionalNotes[index], image: null, imageLocation: '' });
        document.getElementById(`imageUpload_${index}`).value = '';
      },
      cleanInputsQuestionQualifiers(){
        this.selectedImage = null
        this.selectedImageCreate = null
        this.selectedTopics = Array(5).fill([]);
        this.selectedAbilities = Array(5).fill([]);
        this.selectedCompetences = Array(5).fill([]);
        this.isDropdownLevel = Array(5).fill(false);
        this.isDropdownAbilitiesOpen = Array(5).fill(false);
        this.isDropdownCompetencesOpen = Array(5).fill(false);
        this.isDropdownTopicsOpen = Array(5).fill(false);
        this.additionalNotes = Array(5).fill(null).map(() => ({
          text: 'Quero uma questão que aborde o assunto [tema ou tópico] que trabalhe a habilidade [habilidade da BNCC], contextualizada com [contexto ou situação realista] de dificuldade [médio, fácil ou difícil].',
          level: '',
          abilities: [],
          competences: [],
          topics: [],
          image: null,
        }));
      },  
      checkFormCompletion() {
        const isAnyOptionSelected = 
            this.changeType || 
            this.reduceStatement || 
            this.reduceAlternatives || 
            this.reduceTextsAlternatives || 
            this.contextText.trim() !== '';
    
        return isAnyOptionSelected;
      },
      showNotification(message, type = 'success') {
        this.alertTop( "Sua questão foi alterada com sucesso. Verifique na revisão sua alteração.")
        
      },
      async submitChangeQuestionWithIa(csrfToken) {
        self = this
        this.showGeneratingQuestionModal();
        this.closeChangeQuestionWithIAModal();
        questionID = this.selectedTeacher.exam_questions[this.selectedQuestionIndex].question.id

        try {
            if (!questionID) {
                alert('ID da questão e tipo da questão são obrigatórios.');
                return;
            }

            let url = "{% url 'questions:change_question_ia' %}";

            const dataToSend = {
              question_id: questionID,
              change_type: this.changeType,  
              reduce_statement: this.reduceStatement,  
              reduce_alternatives: this.reduceAlternatives,  
              reduce_texts_in_alternatives: this.reduceTextsAlternatives,  
              context: this.contextText 
            };

            const response = await axios.post(url, dataToSend, {
                headers: {
                    'X-CSRFToken': csrfToken
                }
            });

            this.questionData = response.data;
            const { enunciation, image_tags } = response.data;
            const finalEnunciation = self.formatEnunciation(enunciation, image_tags);
            this.questionData.enunciation = finalEnunciation;
            if (this.questionData.alternatives){
              this.questionData.alternatives = self.questionData.alternatives.map(alternative => {  
                return {
                  ...alternative,
                  text: self.cleanHtml(alternative.text) 
                };
              });
            }

            this.closeGeneratingQuestionModal();
            this.showQuestionGenerateIaModal()
        } catch (error) {
            this.isGenerating = false;
            this.hasError = true;
            this.closeGeneratingQuestionModal();
            this.showErrorModal()
            console.error('Erro ao transformar a questão:', error);
        }
      },
      showGeneratingQuestionModal() {
        this.isGenerating = true;
        const dialog = document.getElementById('generatingQuestionModal');
        if (dialog) {
          dialog.showModal();  
        }
      },
      closeGeneratingQuestionModal() {
        this.isGenerating = false;
        const dialog = document.getElementById('generatingQuestionModal');
        if (dialog) {
          dialog.close(); 
        }
      },
      showErrorModal() {
        const dialog = document.getElementById('errorModal');
        if (dialog && !dialog.open) {
          dialog.showModal();
        }
      },
      closeErrorModal() {
        const dialog = document.getElementById('errorModal');
        if (dialog && dialog.open) { 
          dialog.close();
        }
      },
      closeChangeQuestionWithIAModal() {
        let dialogEl = document.getElementById("changeQuestionWithIaDialog")
        if (dialogEl && dialogEl.open) {
          dialogEl.close()
          const submitButton = document.getElementById('changeQuestionWithIaSubmitButton');
          submitButton.disabled = false
        }
      },
      openChangeQuestionWithIaModal(examQuestion) {
        if (examQuestion.question.get_category_display)
          this.selectedQuestionCategory = examQuestion.question.get_category_display
        const submitButton = document.getElementById('changeQuestionWithIaSubmitButton');
        submitButton.disabled = false 
        document.getElementById("changeQuestionWithIaDialog").showModal()
      },
      formatEnunciation(enunciation, imageTags) {
        if (imageTags && imageTags.length > 0) {
            const imageHtml = imageTags.join(''); // Concatena todas as tags de imagem
            return `<div>${imageHtml}</div><br><br><div style="text-align: justify;">${enunciation}</div>`;
        } else {
            return `<div style="text-align: justify;"><br>${enunciation}</div>`;
        }
      },
      showQuestionGenerateIaModal() {
        const dialog = document.getElementById('questionGenerateIaModal');
        if (dialog && !dialog.open) {
          dialog.showModal();
        }
      },
      closeQuestionGenerateIaModal() {
        const dialog = document.getElementById('questionGenerateIaModal');
        if (dialog && dialog.open) {
          dialog.close();
          this.isQuestionGenerateIaModalOpen = false;
        }
      },
      async confirmChangeQuestion(csrfToken) {
        questionID = this.selectedTeacher.exam_questions[this.selectedQuestionIndex].question.id

        if (this.selectedQuestionCategory == "Discursiva")
          category = "Objetiva"
        else
          category = "Discursiva"
        keepChangeType = false
        if (this.reduceAlternatives || this.reduceTextsAlternatives && category != "Discursiva")
          keepChangeType = true
        try {
            let url = "{% url 'questions:confirm_change_question_type' %}";
            const response = await axios.post(url, {
                question_id: questionID,
                enunciation: this.questionData.enunciation,
                category: category,
                alternatives: this.questionData.alternatives, 
                keep_change_type: keepChangeType, 
            }, {
                headers: {
                    'X-CSRFToken': csrfToken
                }
            });    

            localStorage.setItem('selectedTeacher', JSON.stringify(this.selectedTeacher));
            localStorage.setItem('selectedQuestionIndex', this.selectedQuestionIndex);
            localStorage.setItem('updateSuccess', 'true');
            window.location.reload();
        } catch (error) {
            localStorage.setItem('updateSuccess', 'false');
        }
      },
      adjustQuantity() {
        if (this.is_request_question_ia && this.showTextareas) {
          this.quantity = Math.min(this.quantity, 5);
          this.updateAdditionalNotes(); 
        } else if (this.is_request_question_ia){
          this.quantity = Math.min(Math.max(this.quantity, 1), 5);
        }
      },     
      toggleSelectionCompetences(competenceId, index) {
        const competenceIndex = this.selectedCompetences[index]?.indexOf(competenceId);
        if (competenceIndex === -1) {
          this.$set(this.selectedCompetences, index, [
            ...(this.selectedCompetences[index] || []),
            competenceId
          ]);
        } else {        
          this.$set(this.selectedCompetences, index, this.selectedCompetences[index].filter(id => id !== competenceId));

        }
        this.addSelectedCompetence()
      },
      toggleSelectionTopics(topicId, index) {
        const selected = this.selectedTopics[index] || [];
        const isSelected = selected.includes(topicId);
        
        if (isSelected) {
          this.$set(this.selectedTopics, index, selected.filter(id => id !== topicId));
        } else {
          this.$set(this.selectedTopics, index, [...selected, topicId]);
        }
        this.addSelectedTopic()
      },
      toggleSelectionAbilities(abilityId, index) {
        const abilityIndex = this.selectedAbilities[index]?.indexOf(abilityId);
        if (abilityIndex === -1) {
          this.$set(this.selectedAbilities, index, [
            ...(this.selectedAbilities[index] || []),
            abilityId
          ]);
        } else {
          this.$set(this.selectedAbilities, index, this.selectedAbilities[index].filter(id => id !== abilityId));
        }
        this.addSelectedAbilities()
      },
      toggleDropdownAbilities(index) {
        this.$set(this.isDropdownAbilitiesOpen, index, !this.isDropdownAbilitiesOpen[index]);
        this.isDropdownCompetencesOpen = Array(5).fill(false);
        this.isDropdownTopicsOpen = Array(5).fill(false);
        this.isDropdownLevel = Array(5).fill(false);

      },
      toggleDropdownCompetences(index) {
        this.$set(this.isDropdownCompetencesOpen, index, !this.isDropdownCompetencesOpen[index]);
        this.isDropdownAbilitiesOpen = Array(5).fill(false);
        this.isDropdownTopicsOpen = Array(5).fill(false);
        this.isDropdownLevel = Array(5).fill(false);

      },
      handleClickOutside(event) {
        const dropdowns = document.querySelectorAll('.dropdown-menu');
        dropdowns.forEach(dropdown => {
          if (!dropdown.contains(event.target) && !event.target.closest('.dropdown')) {
            this.isDropdownTopicsOpen = this.isDropdownTopicsOpen.map(() => false)
            this.isDropdownCompetencesOpen = this.isDropdownCompetencesOpen.map(() => false)
            this.isDropdownAbilitiesOpen= this.isDropdownAbilitiesOpen.map(() => false)
            this.isDropdownLevel = this.isDropdownLevel.map(() => false);
          }
        });
      },
      toggleDropdownTopics(index) {
        this.$set(this.isDropdownTopicsOpen, index, !this.isDropdownTopicsOpen[index]);
        this.isDropdownAbilitiesOpen = Array(5).fill(false);
        this.isDropdownCompetencesOpen = Array(5).fill(false);
        this.isDropdownLevel = Array(5).fill(false);
      },
      toggleDropdownLevels(index) {
        this.isDropdownLevel = this.isDropdownLevel.map((open, i) => i === index ? !open : false);
        this.isDropdownAbilitiesOpen = Array(5).fill(false);
        this.isDropdownCompetencesOpen = Array(5).fill(false);
        this.isDropdownTopicsOpen = Array(5).fill(false);
      },
      selectLevel(levelValue, index) {
        this.$set(this.additionalNotes, index, {
          ...this.additionalNotes[index],
          level: levelValue
        });
        this.toggleDropdownLevels(index);
      },
      addSelectedAbilities() {
        this.additionalNotes = this.additionalNotes.map((note, index) => ({
          ...note,
          abilities: this.selectedAbilities[index] || [],
        }));
      },
      addSelectedCompetence() {
        this.additionalNotes = this.additionalNotes.map((note, index) => ({
          ...note,
          competences: this.selectedCompetences[index] || [],
        }));
      },
      addSelectedTopic() {
        this.additionalNotes = this.additionalNotes.map((note, index) => ({
          ...note,
          topics: this.selectedTopics[index] || [],
        }));
      },
      fetchTopic: function(subject){
        var self = this
        
        var objectSubject = self.subjects.find(function(subject_obj){
          return subject_obj.id == subject
        })
        var topictListUrl = `{% url 'subjects:topic_list_api' %}?grade=${this.selectedGrade}&subject_pk=${subject}`

        axios.get(topictListUrl).then(function(response) {
            self.topics = response.data
        })
      },
      fetchCompetences: function(subject){
        var self = this
        if(subject) {
          var objectSubject = self.subjects.find(function(subject_obj){
            return subject_obj.id == subject
          })
  
          var competenceListUrl = `{% url 'bncc:competence_list_api' %}?`
  
          if(subject){
            competenceListUrl += `&subject_in_or_none=${subject}`
            
            if (objectSubject && objectSubject.parent_subjects){
              objectSubject.parent_subjects.forEach(function(parent){
                competenceListUrl += `&subject_in_or_none=${parent}`
              })
            }
          }
          
          if(objectSubject.knowledge_area_id){
            competenceListUrl += `&knowledge_area=${objectSubject.knowledge_area_id}`
          }  
  
          axios.get(competenceListUrl).then(function(response) {
              self.competences = response.data

          })
        }
      },
      fetchAbilities: function(subject){
        var self = this
        if(subject) {
          var objectSubject = self.subjects.find(function(subject_obj){
            return subject_obj.id == subject
          })

          var abilityUrl = `{% url 'bncc:ability_list_api' %}?grades=${self.selectedGrade}`
  
          if(subject){
            abilityUrl += `&subject_in_or_none=${subject}`
            
            if (objectSubject && objectSubject.parent_subjects){
              objectSubject.parent_subjects.forEach(function(parent){
                abilityUrl += `&subject_in_or_none=${parent}`
              })
            }
          }

        if(objectSubject.knowledge_area_id){
            abilityUrl += `&knowledge_area=${objectSubject.knowledge_area_id}`
          }  
  
          axios.get(abilityUrl).then(function(response) {
              self.abilities = response.data
          })
        }
      },
      handleQuantityChange(event) {
        if (this.showTextareas) {
          this.updateAdditionalNotes();
        }
      },
      toggleTextareas(event) {
        this.showTextareas = event.target.checked;
        if (this.showTextareas ) {
          this.updateAdditionalNotes();
        } 
        else {
          this.additionalNotes = this.additionalNotes.slice(0, 1);

          this.additionalNotes = this.additionalNotes.map((note, index) => ({
            ...note,
            text: this.defaultText
          }));
        }
      },
      updateAdditionalNotes() {
        const maxQuantity = 5;
        this.quantity = Math.min(this.quantity, maxQuantity);
        
        this.additionalNotes = Array.from({ length: this.quantity }, (_, i) => {
          return this.additionalNotes[i] || { text: this.defaultText, level: '' };
        });
    
        while (this.additionalNotes.length < this.quantity) {
          this.additionalNotes.push({ text: this.defaultText, level: '' });
        }
    
        if (this.additionalNotes.length > this.quantity) {
          this.additionalNotes.splice(this.quantity);
        }
      },
      concatenateNotes() {
        if (this.note) {
          return this.note
        }
    
        if (this.additionalNotes.length > 0 && this.is_request_question_ia) {
            if (this.showTextareas) {
                const notesToConcatenate = Array.from({ length: this.quantity }, (_, i) => {
                    return this.additionalNotes[i] || { text: this.additionalNotes[0].text, level: '' };
                });
    
                return notesToConcatenate.map((note, index) => {
                    const abilitiesForNote = this.selectedAbilities[index] || [];
                    const abilitiesString = abilitiesForNote.join('###');
    
                    const competencesForNote = this.selectedCompetences[index] || [];
                    const competencesString = competencesForNote.join('###');
                    
                    const topicsForNote = this.selectedTopics[index] || [];
                    const topicsString = topicsForNote.join('###');
    
                    const promptText = note.text;
                    const imageUrl = note.image || '';
                    return `level:${note.level}&&abilities:${abilitiesString}&&competences:${competencesString}&&topic:${topicsString}&&image:${imageUrl}&&prompt:${promptText}`;
                }).join('@@@');
            } else {
                const combinedNote = {
                    text: this.additionalNotes[0].text,
                    level: this.additionalNotes[0].level || '',
                    image: this.additionalNotes[0].image || ''
                };
    
                const abilitiesString = this.selectedAbilities.flat().join('###');
                const competencesString = this.selectedCompetences.flat().join('###');
                const topicsString = this.selectedTopics.flat().join('###');
    
                return `level:${combinedNote.level}&&abilities:${abilitiesString}&&competences:${competencesString}&&topic:${topicsString}&&image:${combinedNote.image}&&prompt:${combinedNote.text}`;
            }
        }
      },
    
      openExampleModal(event) {
        this.is_request_question_ia = false;
        this.selectedTeacher =  ""
        this.cleanInputs()
        const buttonType = event.currentTarget.getAttribute('data-button-type');
        if (buttonType === 'reques_question_ia') {
          this.is_request_question_ia = true;
        }
        $('#exampleModal').modal('show');
      },  
      momentRef(args) {
        return moment(args)
      },
      handleChangeUseQuantityAlternatives() {
        if (this.exam.use_quantity_alternatives) {
          this.exam.quantity_alternatives = 5
        } else {
          this.exam.quantity_alternatives = null
        }
      },
      openCopyModal() {
        this.closeGeneratingQuestionModal()
        this.closeChangeQuestionWithIAModal()
        this.closeErrorModal()
        this.closeQuestionGenerateIaModal()
        document.getElementById("copyQuestionDialog").showModal()
        document.getElementById("copyQuestionDialog").focus();
        
      },
      closeCopyModal() {
        let dialogEl = document.getElementById("copyQuestionDialog")
        dialogEl.close()
        dialogEl.querySelectorAll("button").forEach((btn) => btn.disabled = false)
      },
      submitCopyQuestion() {
        this.copyQuestionData.examQuestionToCopy = this.selectedTeacher.exam_questions[this.selectedQuestionIndex].id

        let url = '{% url "exams:exam_question_copy" %}'
        axios.post(url, this.copyQuestionData).then((res) => {
          let dialogEl = document.getElementById("copyQuestionDialog")
          dialogEl.querySelectorAll("button").forEach((btn) => btn.disabled = false)

          this.alertTop('Questão copiada com sucesso!')
          this.closeCopyModal()

        }).catch((e) => {
          this.alertTop(e.response.data, 'error')

          let dialogEl = document.getElementById("copyQuestionDialog")
          dialogEl.querySelectorAll("button").forEach((btn) => btn.disabled = false)
          console.error("Erro ao copiar a questão")
        })

      },
      handleUseOrientation(content) {
        tinymce.get('id_orientations').setContent(content)
        $('#orientations').modal('hide')
      },
      updateTeacherModalTabActive(value) {
        this.teacherModalTabActive = value
      },
      handleRemoveOrientation() {
        if (!this.showOrientations) {
          this.exam.orientations = ''
          tinymce.get('id_orientations').setContent('')
        }
      },
      getLevelLabel(level) {
        labels = {
          0: "Fácil",
          1: "Médio",
          2: "Difícil",
          3: "Indefinido",
        }
        return labels[level]
      },
      getExamQuestions(teacher, reload = false) {
        {% if object %}
          
          if(this.exam.total_grade || teacher.subject_note) {
            teacher.exam_questions_load = false
          }

          if(!teacher.exam_questions_load || reload) {
            if (!reload) {
              this.loadExamQuestions = true
            }
            axios.get(`{% url 'exams:api-exam-get-exam-questions' object.pk %}?exam_teacher_subject_pk=${teacher.id}`).then((response) => {
              if(reload) {
                response.data.forEach((exam_question) => {
                  let examQuestiontoUpdate = teacher.exam_questions.find((e) => e.id == exam_question.id)
                  examQuestiontoUpdate.weight = exam_question.weight
                })
              } else {
                teacher.exam_questions = response.data
                if(teacher.exam_questions.length) {
                  teacher.exam_questions[this.selectedQuestionIndex].selected = false;
                  teacher.exam_questions[0].selected = true;
                  this.fetchQuestion(teacher.exam_questions[0].question, true); 
                }
              }
              teacher.exam_questions_load = true
            }).finally(() => {
              this.loadExamQuestions = false
              this.recalculateWeights = false
              this.loadingBlockWeight = false
              this.updateSelectedTeacherWeight()
            })
          } else {
            if(teacher.exam_questions.length) {
              teacher.exam_questions[this.selectedQuestionIndex].selected = false;
              teacher.exam_questions[0].selected = true;
              this.fetchQuestion(teacher.exam_questions[0].question, true);
            }
          }
        {% endif %}
      },
      updateSelectedTeacherWeight(){
        if(this.selectedTeacher && this.selectedTeacher.exam_questions && this.selectedTeacher.exam_questions.length) {
          sum = 0
          this.selectedTeacher.exam_questions.forEach((element) => {
            if(!this.unavailableStatus.includes(element.last_status.status_display)) {
              sum += parseFloat(element.weight)
            }
          })
          this.selectedTeacher.sum_weight = sum
        }
      },
      updateWeightQuestion(question){
        self = this
        data = {"weight": $("#input-update-weight").val()}

        url = "{% url 'exams:exam_question_partial_update' pk='00000000-0000-0000-0000-000000000000'  %}"
        axios.put(url.replace("00000000-0000-0000-0000-000000000000", question.id), data
        ).then(function(response){
          question.weight = response.data.weight
          self.updateSelectedTeacherWeight()
        })
      },
      updateWeightQuestionWithBlockWeight(question){
        if (question.block_weight) {
          this.loadingBlockWeight = true
          this.recalculateWeights = true
        }

        data = { "weight": this.updateWeight }

        url = "{% url 'exams:exam_question_partial_update' pk='00000000-0000-0000-0000-000000000000'  %}"
        axios.put(url.replace("00000000-0000-0000-0000-000000000000", question.id), data).then((response) => {
          question.weight = response.data.weight
          this.getExamQuestions(this.selectedTeacher, reload = true)
        }).finally(() => {
          if (!question.block_weight) {
            this.loadingBlockWeight = false
            this.recalculateWeights = false
          }
          this.getBlockedWeight()
        })
      },
      sumQuestionWeight(){
        return this.selectedTeachers.reduce((total = 0, teacher) => total += teacher.sum_weight, 0)
      },
      requestStatusTags(status, distributeWeightToQuestions=true){
        self = this
        if(this.no_client_tags){
          return self.requestNoteStatusQuestion(status, [], distributeWeightToQuestions)
        }
        Swal.fire({
          title: 'Selecione os motivos para essa ação',
          html: 
          '{% for tag in client_tags %}<input type="checkbox" class="btn-check statusTags" id="{{tag.pk}}" autocomplete="off"><label class="btn btn-outline-primary btn-sm" for="{{tag.pk}}">{{tag.name}}</label>{% endfor %}',
          focusConfirm: false,
          preConfirm: () => {
            const statusTags = document.querySelectorAll('.statusTags')
            const selectedPks = []

            statusTags.forEach((tagElement)=>{
              if(tagElement.checked) selectedPks.push(tagElement.id)
            })
            return selectedPks
          },
          showCancelButton: true,
          showConfirmButton: true,
          confirmButtonText: "Continuar",
          cancelButtonText: "Cancelar",
        }).then((result) => {
          if(result.isConfirmed) {
            self.requestNoteStatusQuestion(status, result.value, distributeWeightToQuestions)
          }
        })
      },
      requestNoteStatusQuestion(status, tags, distributeWeightToQuestions=true) {
        self = this
        self.selectedContent = parseInt(status) != 9 ? window.getSelection().toString() :  ''
        Swal.fire({
          title: parseInt(status) != 9 ? 'Deseja enviar alguma anotação para o professor?' : 'Envie um comentário sobre uma revisão',
          html: this.selectedContent
            ? `<p><b>Fragmento:</b> ${this.selectedContent}</p>` 
            :  parseInt(status) != 9 
              ? '<div class="alert alert-info">Se desejar selecione um fragmento da questão para o enviar junto com a anotação!<div>' 
              : '',
          input: 'textarea',
          inputPlaceholder: 'Adicione a anotação que deseja enviar para o professor, você pode deixar vazio caso não tenha nenhuma anotação a enviar.',
          inputAttributes: {
            'aria-label': 'Adicione a anotação que deseja enviar para o professor, você pode deixar vazio caso não tenha nenhuma anotação a enviar.'
          },
          showCancelButton: true,
          showConfirmButton: true,
          confirmButtonText: "Enviar anotação",
          cancelButtonText: "Cancelar",
        }).then((result) => {
          if(result.isConfirmed) {
            self.createStatusQuestion(status=status, newStatusNote=result.value, tags=tags, distributeWeightToQuestions, questionFragment=self.selectedContent)
          }
        })
      },
      revertAnullQuestion(exam_question) {
        Swal.fire({
          title: 'Confirmação',
          text: "Ao reverter a anulação, os pesos serão recalculados. Deseja continuar?",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Confirmar',
          cancelButtonText: 'Cancelar',
        }).then(result => {
          if(result.isConfirmed) {
              axios.post("{% url 'exams:revert_status_question' %}", {
                exam_question: exam_question.id
              }).then((response) => {
                if(response.data.new_status){
                  this.selectedTeacher.status_count[exam_question.last_status.status_display] -= 1
                  exam_question.last_status = response.data.new_status

                  exam_question.status_list.unshift(response.data.new_status)
                  this.selectedTeacher.status_count[exam_question.last_status.status_display] += 1

                  this.recalculateWeights = true
                  this.getExamQuestions(this.selectedTeacher, reload = true)
                }else if(response.data.noLastStatus){
                  exam_question.last_status = {
                    annuled_give_score: false,
                    note: "",
                    status: 2,
                    status_display: "Em aberto"
                  }
                  this.recalculateWeights = true
                  this.getExamQuestions(this.selectedTeacher, reload = true)
                }
              }).catch(() => {
                Swal.fire({
                  icon: 'error',
                  title: 'Erro',
                  text: 'Não foi possível reverter a anulação.',
                })
              })
            }
          }
        )
      },
      createAnullQuestion(status) {
        self = this
        Swal.fire({
          title: 'Como deseja anular essa questão?',
          width: '800px',
          html: `
          <div>
            <div class="btn-group btn-group-toggle py-2" data-toggle="buttons">
              <label id="distributeWeightToQuestions" @click="setSelectedAnnulationType(0)" class="btn btn-outline-primary btn-sm active" >
                <input type="radio" >
                <span>
                  Distribuir nota entre questões da prova
                </span>
              </label>
              <label @click="setSelectedAnnulationType(2)" class="btn btn-outline-primary btn-sm">
                <input type="radio" id="distributeInExamTeacherSubject">
                <span>
                  Distribuir nota entre questões da solicitação
                </span>
              </label>
              <label @click="setSelectedAnnulationType(1)" class="btn btn-outline-primary btn-sm">
                <input type="radio" id="giveScore">
                <span>
                  Dar nota aos alunos
                </span>
              </label>
            </div>
            <div>
              <small>
                Marcar "dar nota aos alunos" irá dar a nota integral da questão para <b>todos</b> os alunos da aplicação. <br/>Certifique-se que essa é a ação desejada antes de confirmar a anulação.
              </small>
            </div>
          </div>`,
          focusConfirm: false,
          onOpen: () => {
            new Vue({
              el: Swal.getHtmlContainer(),
              data: {
                selectedAnnulationType: app_question.selectedAnnulationType,
              },
              methods: {
                setSelectedAnnulationType(value) {
                  app_question.selectedAnnulationType = value
                }
              },
              mounted: function() {
                this.setSelectedAnnulationType(0)
              },
            })
          },
          preConfirm: () => {
            const distributeWeightToQuestions = document.getElementById('distributeWeightToQuestions').classList.contains('active')
            return {
              distributeWeightToQuestions: distributeWeightToQuestions,
            }
          },
          showCancelButton: true,
          showConfirmButton: true,
          confirmButtonColor: '#dc3545',
          confirmButtonText: "Confirmar Anulação",
          cancelButtonText: "Cancelar",
        }).then((result) => { 
          if(result.isConfirmed) {
            self.requestStatusTags(status, result.value.distributeWeightToQuestions)
          }
        })
      },
      createStatusTags(statusPk, tags){
        self = this
        newStatusTagsRecord = {
          status: statusPk,
          tags: tags
        }
        let url = "{% url 'exams:exams_status_tags_api_create'  pk='00000000-0000-0000-0000-000000000000' %}"
        url = url.replace('00000000-0000-0000-0000-000000000000', statusPk)

        axios.post(url, newStatusTagsRecord).then((response)=>{
          const newStatus = {
            'pk': response.data.status,
            'tags': response.data.tags_display
          }
          this.status_tags_history.push(newStatus)
        })
      },
      openDialog(examQuestion, status) {
        this.newStatusQuestion.status = status
        this.selectedExamQuestion = examQuestion
        if(status != 0){
            this.newStatusQuestion.question_fragment = window.getSelection().toString()
            this.statusDialogElement.showModal()
        }else{
            this.newStatusQuestion.question_fragment = ''
            this.submitNewStatus( this.newStatusQuestion.status)
        }
      },
      closeDialog() {
          let buttons = this.statusDialogElement.querySelectorAll("button")
          buttons.forEach((b) => b.disabled = false)
          this.resetNewStatusObject()
          this.statusDialogElement.close()
          this.questionSugestion = false
      },
      resetNewStatusObject(){
          this.newStatusQuestion = {
              status: "",
              note: "",
              give_score: false,
              question_fragment:""
          }
      },
      updateQuestionStatus(targetStatus, updatedStatus) {
        Object.keys(updatedStatus).forEach(key => {
          if (targetStatus.hasOwnProperty(key)) {
              targetStatus[key] = updatedStatus[key];
          }
        });
        return targetStatus;
      },
      submitNewStatus() {
        if (!this.questionSugestion && this.newStatusQuestion.status == 5){
            this.newStatusQuestion.note = "Estou de acordo com a questão"
            this.questionSugestion = false 
        }
        let url = "{% url 'exams:exams_status_question_api_create'  pk='00000000-0000-0000-0000-000000000000' %}"
        url = url.replace('00000000-0000-0000-0000-000000000000', this.selectedExamQuestion.id)
        this.newStatusQuestion.source_status_question = parseInt(this.newStatusQuestion.status) == 9 ? self.selectedSourceStatusQuestion : '' 

        axios.post(url, this.newStatusQuestion).then((response) => {
            if(this.newStatusQuestion.status != 0 && this.newStatusQuestion.status != 5){
              this.createStatusTags(response.data.id)
            }
            
            let updateQuestion = this.selectedTeacher.exam_questions[this.selectedQuestionIndex]
            
            this.selectedTeacher.status_count[updateQuestion.last_status.status_display] -= 1
            updateQuestion.last_status = this.updateQuestionStatus(updateQuestion.last_status, response.data)

            this.recalculateWeights = true

            this.selectedTeacher.status_count[updateQuestion.last_status.status_display] += 1
            this.getExamQuestions(this.selectedTeacher, reload = true)
            
            this.resetNewStatusObject()
            this.alertTop('Situação da questão atualizada')
            this.statusDialogElement.close()
        }).finally(() => {
          this.getExamQuestionsNumber(this.selectedTeacher.exam_questions)
        })
      },
      createStatusQuestion(status, newStatusNote, tags, distributeWeightToQuestions = true, questionFragment='') {
        self = this
        
        newStatusQuestion = {
          status: status,
          note: newStatusNote,
          give_score: this.selectedAnnulationType == 1 ? true : false,
          distributeInExamTeacherSubject: this.selectedAnnulationType == 2 ? true : false,
          question_fragment:questionFragment,
          source_status_question: parseInt(status) == 9 ? self.selectedSourceStatusQuestion : ''
        }

        let question = self.selectedTeacher.exam_questions[self.selectedQuestionIndex]
        
        let last_status = Object.assign({}, question.last_status)

        let questionNotAvailable = this.unavailableStatus.includes(last_status.status_display)
        
        let url = "{% url 'exams:exams_status_question_api_create'  pk='00000000-0000-0000-0000-000000000000' %}"
        url = url.replace('00000000-0000-0000-0000-000000000000', question.id)

        axios.post(url, newStatusQuestion).then((response) => {
          
          this.selectedTeacher.status_count[question.last_status.status_display] -= 1
          this.selectedTeacher.status_count[response.data.status_display] += 1

          if(status != 0 && status != 5 && status != 9){
            self.createStatusTags(response.data.id, tags)
          }

          if(status == 6) { //Igual a anulada
            this.recalculateWeights = true
            this.getExamQuestions(this.selectedTeacher, reload = true)
          }

          if(status != 5 && (questionNotAvailable != this.unavailableStatus.includes(response.data.status_display))) {
            if(this.exam.total_grade || this.selectedTeacher.subject_note) {
              if(distributeWeightToQuestions){
                this.recalculateWeights = true
                this.getExamQuestions(this.selectedTeacher, reload = true)
              }
            }
          }
          
          if(status != 5 && status != 9) {
            question.last_status = response.data
          }
          if(status!=9){
              question.status_list.unshift(
                response.data
              )
            }else{
            //se for resposta ele não adioinca na lista e sim dentro de uma revisão que já existe
              question.status_list.find(
                (status) => status.id == self.selectedSourceStatusQuestion
              ).responses.push(response.data)
          }
        }).finally(() => {
          this.getStatusCount(this.selectedTeacher.id)
          this.getExamQuestionsNumber(this.selectedTeacher.exam_questions)
        })
        
        $('#update-note').click()
      },
      getStatusBadgeClass(status) {
        return this.statusList[status]
      },
      openModal(id){
        $('#'+id).modal('toggle');
      },
      openNewWindow(url){
        let popupWidth = screen.width / 2
        var leftPos = screen.width - popupWidth;
        window.open(url, "DescriptiveWindowName", "width=" + popupWidth + ", height=1040, top=0, left=" + leftPos +", resizable,scrollbars,status");
      },
      async fetchReviewers(subject) {
        this.select2LoadData('#id_reviewed_by')
        this.reviewers = []
        
        let url = `{% url 'inspectors:teacher_simple_list_api' %}?teachersubject__subject=${subject}&is_discipline_coordinator=true`
        
        axios.get(url).then((response) => {
          this.reviewers = response.data
        }).finally(() => {
          this.select2LoadData("#id_reviewed_by", false)
          $('#id_reviewed_by').val(this.reviewed_by).trigger('change')
        })
      },
      updateExamTeacher(teacher, option = 'select') {
        if(this.block_questions_quantity && !this.questionsQuantityDefinitionsIsValid) {
          Swal.fire({
            icon: 'error',
            title: 'Atenção',
            text: 'O total de questões objetivas e discursivas deve ser igual a quantidade de questões definida',
          });
          return
        }

        if(option == 'reset') {
          $('#exampleModal').modal('hide');
          {% comment %} $("[data-type='exam-teacher-subject']").show() {% endcomment %}
          this.cleanInputs()
          return this.editing = false
        } else if (option == 'select') {
  
          this.editing = true

          if (teacher.teacher_subject && teacher.teacher_subject.subject && teacher.teacher_subject.subject.id)
            subject_id = teacher.teacher_subject.subject.id
          else
            subject_id = teacher.subject.id

          this.fetchReviewers(subject=subject_id)
          this.getExamQuestions(teacher);

          this.selectedSubdiscipline = '';
          this.selectedTeacherToUpdate = teacher;

          if (teacher.grade) {
              this.selectedGrade = this.selectedTeacherToUpdate.grade.id;
              $('#id_grades').val(this.selectedGrade).trigger('change');
          }
          
          let selectedTeacherSubjectToUpdate = this.selectedTeacherToUpdate.teacher_subject

          if (selectedTeacherSubjectToUpdate) {
            this.selectedTeacher = selectedTeacherSubjectToUpdate.id ? selectedTeacherSubjectToUpdate.id : this.selectedTeacherToUpdate.teacher.id
            $('#selectedTeacher').val(this.selectedTeacher).trigger('change')
            this.selectedSubject = selectedTeacherSubjectToUpdate.subject ? selectedTeacherSubjectToUpdate.subject.id : this.selectedTeacherToUpdate.subject.id

            if(this.isNoTeacherSelectedOrHasNoQuestions() || this.canChangeSubjectWithExistingQuestions) {

              this.fetchSubject(this.selectedGrade, true).then((response) => {

                this.subjects = response.data

              }).finally(() => {
                  
                let parentSubject = selectedTeacherSubjectToUpdate.subject?.parent_subject

                this.fetchSubSubject(parentSubject || this.selectedSubject, true).then((response) => {
                  this.$nextTick().then(() => {
                    this.subDisciplines = response.data
                  }).then(() => {
                    if (this.subDisciplines.length) {
                      if(parentSubject) {
                        this.selectedSubject = parentSubject
                      } else {
                        this.selectedSubdiscipline = this.selectedSubject 
                      }
                    }
                    this.select2LoadData('#selectedSubdiscipline', false)
                    $('#selectedSubdiscipline').val(this.selectedSubdiscipline).trigger('change')
                  }).then(() => {
                    this.select2LoadData('#selectedSubject', false)
                    $('#selectedSubject').val(this.selectedSubject).trigger('change')
                  })
                })
              })
            }
          
          }
      
          this.$nextTick().then(() => {
            this.quantity = this.selectedTeacherToUpdate.quantity;
            this.note = this.selectedTeacherToUpdate.note;
            this.subject_note = teacher.subject_note;
            this.block_subject_note = teacher.block_subject_note;
            this.block_questions_quantity = teacher.block_questions_quantity;
            this.block_quantity_limit = teacher.block_quantity_limit; 
            this.distribute_scores_freely = teacher.distribute_scores_freely;
            this.objective_quantity = teacher.objective_quantity;
            this.discursive_quantity = teacher.discursive_quantity;
          }).then(() => {
            $("#id_subject_note").val(this.subject_note);
          })
        }
      
        else if(option == 'update') {
          // essa variável é local, usada apenas para verificação nesse if
          let examQuestions = this.selectedTeacherToUpdate.exam_questions ? this.selectedTeacherToUpdate.exam_questions : []
          const addedQuestions = examQuestions.filter(question => question.last_status.status != 7 && question.last_status.status != 1)
          const opened = examQuestions.filter(question => question.last_status.status == 2)
          const approved = examQuestions.filter(question => question.last_status.status == 0)
          
          if(!this.selectedSubject) {
            Swal.fire({
              icon: 'warning',
              title: 'Informação',
              text: `Você deve selecionar uma disciplina ou uma subdisciplina para continuar.`,
            })
            return
          }

          if(this.quantity < addedQuestions.length && this.block_quantity_limit) {
            Swal.fire({
              icon: 'info',
              title: 'Informação',
              text: `Não é possível limitar a quantidade de questões para ${this.quantity} pois existem ${addedQuestions.length} questões adicionadas (${approved.length} com status aprovado e ${opened.length} com status em aberto). Revise questões em aberto antes de reduzir a quantidade`,
            })
          } else {
            this.selectedTeacherToUpdate.id = teacher.id
            this.selectedTeacherToUpdate.exam_questions_load = teacher.exam_questions_load
            this.selectedTeacherToUpdate.quantity = this.quantity
            this.selectedTeacherToUpdate.note = this.note
            this.selectedTeacherToUpdate.subject_note = this.subject_note
            this.selectedTeacherToUpdate.reviewed_by = this.reviewed_by
            this.selectedTeacherToUpdate.block_subject_note = this.block_subject_note
            this.selectedTeacherToUpdate.block_questions_quantity = this.block_questions_quantity
            this.selectedTeacherToUpdate.block_quantity_limit = this.block_quantity_limit
            this.selectedTeacherToUpdate.objective_quantity = this.objective_quantity
            this.selectedTeacherToUpdate.discursive_quantity = this.discursive_quantity
            this.selectedTeacherToUpdate.distribute_scores_freely = this.distribute_scores_freely

            {% if object %}
              note = this.concatenateNotes();
              teacher_update = {
                'id': teacher.id,
                'teacher_subject': this.selectedTeacher,
                'grade': this.selectedGrade,
                'quantity': this.quantity,
                'reviewed_by': this.reviewed_by,
                'note': note,
                'subject_note': this.subject_note,
                'block_subject_note': this.block_subject_note,
                'block_questions_quantity': this.block_questions_quantity,
                'block_quantity_limit': this.block_quantity_limit,
                'distribute_scores_freely': this.distribute_scores_freely,
                'objective_quantity': this.objective_quantity,
                'discursive_quantity': this.discursive_quantity,
                'subject_id': this.selectedSubdiscipline || this.selectedSubject,
                'subdiscipline_id': this.selectedSubdiscipline,
                'suppor_image': this.selectedImage,
              }
              this.updateExamTeacherSubject(teacher_update) 
            
            {% else %}
              note = this.concatenateNotes();
              _teacher = {
                teacher: {
                  id: this.selectedTeacher,
                  name: $('#selectedTeacher').find(":selected").text()
                },
                subject: {
                  id: this.selectedSubject,
                  name: $('#selectedSubject').find(":selected").text()
                },
                grade: {
                  id: this.selectedGrade,
                  full_name: $('#{{form.grades.auto_id}}').find(":selected").text()
                },
                quantity: this.quantity,
                reviewed_by: this.reviewed_by,
                note: note,
                subject_note: this.subject_note,
                block_subject_note: this.block_subject_note,
                block_questions_quantity: this.block_questions_quantity,
                block_quantity_limit: this.block_quantity_limit,
                distribute_scores_freely: this.distribute_scores_freely,
                objective_quantity: this.objective_quantity,
                discursive_quantity: this.discursive_quantity,
                suppor_image: this.selectedImage,
              }
              teacher = _teacher
              this.editing = false
              this.cleanInputs()
            {% endif %}
          }
        }
        $('#exampleModal').modal('show');
      },
      confirmSubjectNote() {
        Swal.fire({
          title: 'Confirmação',
          text: "Ao confirmar essa alteração os pesos que o professor deu as questões serão ignorados, você deseja continuar?",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Confirmar',
          cancelButtonText: 'Cancelar',
        }).then(result => {
          if (result.isConfirmed) {
            {% comment %}
              url  = "{% url 'exams:api-exam-distribute-weights' pk='00000000-0000-0000-0000-000000000000' %}"
              axios.post(url.replace('00000000-0000-0000-0000-000000000000', this.selectedTeacherToUpdate.id), {weights: this.subject_note}).then((response) => {
                this.selectedTeacherToUpdate.exam_questions.forEach((examQuestion) => examQuestion.weight = response.data.exam_questions.find(_examQuestion => examQuestion.id == _examQuestion.id).weight)
                this.selectedTeacherToUpdate.sum_weight = response.data.sum_weight
              })
            {% endcomment %}
            this.updateExamTeacher(this.selectedTeacherToUpdate, 'update')
          }
        })
      },
      updateExamTeacherSubject(teacher_update) {
        if(!this.selectedTeacherToUpdate.id) {
          this.addTeacher()
          return
        }

        url = "{% url 'exams:api-exam-update-exam-teacher-subject'  pk='00000000-0000-0000-0000-000000000000' %}"
        axios.put(url.replace('00000000-0000-0000-0000-000000000000', teacher_update.id), teacher_update).then((response) => { 
          this.alertTop('Disciplina atualizada com sucesso!')
          this.editing = false
          this.cleanInputs()
          $('#exampleModal').modal('hide');

          teacher = this.selectedTeachers.find(teacher => teacher.id == teacher_update.id)
          teacher.teacher_subject = response.data.teacher_subject
          teacher.grade = response.data.grade
          $("[data-type='exam-teacher-subject']").show()
          this.examGetSumWeight()
          this.getBlockedWeight()
        }).catch((error) => {
          this.alertError('Erro ao atualizar a disciplina!')
        })
      },
      getExamQuestionsNumber(examQuestions) {
        {% if object %}
          if(examQuestions && examQuestions.length) {
            axios.get("{% url 'exams:api-exam-get-exam-questions-number' pk=object.id %}").then((response) => {
              response.data.forEach((_e) => {
                let examQuestion = this.selectedTeacher.exam_questions.find((e) => e.id == _e.id)
                if(examQuestion) {
                  examQuestion.exam_question_number = _e.exam_question_number
                }
              })
            })
          }
        {% endif %}
      },
      questionHasEnunciationDuplicate(id){
        try {
          if(this.selectedTeacher && this.selectedTeacher.exam_questions){
            return this.selectedTeacher.exam_questions.find((e) => e.question.pk == id).has_duplicate_enunciation
          }
          else{
            return false
          }
        } catch (error) {
          return false
        }
        
      },
      changeObjectsOrder(teacherSubjects, examQuestions) {
        object = {
          teacher_subjects: teacherSubjects,
          exam_questions: examQuestions,
        }
        axios.put("{% url 'exams:api-exam-swap-position' %}", object).then((response) => {
          this.alertTop('As alterações foram salvas.')
          if(teacherSubjects) {
            this.selectForeignLanguage(teacherSubjects.find(teacher => teacher.is_foreign_language))
          }
          this.getExamQuestionsNumber(examQuestions)
        }).catch((error) => {
          this.alertError('Erro ao tentar modificar a ordem das questões, tente novamente, caso o erro persista entre em contato com o suporte.')
        })
      },
      changeReleaseMaterial(new_date) {
        {% if object %}
          if(this.release_material_study && this.exam.materials.length && this.exam.materials.some(material => material.id)) {
            axios.patch("{% url 'exams:api-exam-change-release-material-date' object.pk %}", { release_material_study: this.release_material_study}).then((response) => { 
              this.alertTop('A data de liberação dos materiais foi alterada com sucesso!')
            }).catch((error) => {
              this.alertError('Erro ao tentar alterar a data dos materiais, tente novamente, caso o erro persista entre em contato com o suporte.')
            })
          }
        {% endif %}
      },
      initializeSelect2: function() {
        self = this
        $("#{{form.coordinations.auto_id}}").select2({
          closeOnSelect: false,
          width: '100%',
        })
        $("#{{form.grades.auto_id}}").select2({width: '100%', placeholder: 'Selecione'})
        
        $("#selectedGradeIa").select2({width: '100%', placeholder: 'Selecione'})
        
        $("#selectedSubject").select2({width: '100%', placeholder: 'Selecione'})

        $("#availableExams").select2({
          width: '100%',
          placeholder: 'Selecione', 
          dropdownParent: $('#copyQuestionDialog'),
          ajax: {
            url: '{% url "exams:exams_api_list" %}',
            delay: 250,
            data: function (params) {
                return {
                    search: params.term
                }
            },
            processResults: function(results) {
                let new_results = $.map(results, function(element) {
                  element.text = element.name
                  return element
                })
                
                return {
                    results: new_results,
                }
            }
          },
        })
        $("#availableExamTeacherSubjects").select2({width: '100%', placeholder: 'Selecione', dropdownParent: $('#copyQuestionDialog'),})
        $("#selectedSubdiscipline").select2({width: '100%', placeholder: 'Selecione uma opção'})    
        $("#selectedTeacher").select2({width: '100%', placeholder: 'Selecione', closeOnSelect: false})    
        $("#id_reviewed_by").select2({width: '100%', placeholder: 'Selecione', closeOnSelect: false})    
        $("#{{form.relations.auto_id}}").select2({ width: '100%', placeholder: 'Selecione uma opção', closeOnSelect: false })    
      },
      selectBodyCustom(data, arg2) {
        if (!data.id) {
          return data.text;
        }

        return $('<div').append($('<label>').append($('<input type="checkbox" />').prop('checked', data.element.selected)).append(data.text));
      },
      
      select2LoadData(selector='', loading = true) {
        $(selector).select2({
          disabled: loading ? true:false,
          placeholder: loading ? "Aguarde, carregando dados...":"Selecione",
          width: '100%',
        });
      },
      fetchSubject: function(grade, promise) {
        if(this.isNoTeacherSelectedOrHasNoQuestions() || this.canChangeSubjectWithExistingQuestions) {
          this.select2LoadData('#selectedSubject')
          this.subjects = []
          this.teachers = []
          this.subDisciplines = []

          if (grade == "")
            return
          
          let subjectListUrl = `{% url 'subjects:subject_list_api' %}?knowledge_area__grades=${grade}`

          let teacherId = this.selectedTeacherToUpdate?.teacher_subject?.teacher?.id
          if(teacherId) {
            subjectListUrl += `&teachersubject__teacher=${teacherId}`
          }
          
          if(promise) {
            return axios.get(subjectListUrl)
          }
          axios.get(subjectListUrl).then((response) => {
            self.subjects = response.data
          }).finally(() => {
            this.select2LoadData('#selectedSubject', false)
          })
        }
      },
      fetchSubSubject: function(subject, promise) {
        this.subDisciplines = []
        this.select2LoadData('#selectedSubdiscipline')
        let subjectListUrl = `{% url 'subjects:subject_list_api' %}?knowledge_area__grades=${this.selectedGrade}&parent_subject=${subject}`
        
        let teacherId = this.selectedTeacherToUpdate?.teacher_subject?.teacher?.id
        if(teacherId) {
          subjectListUrl += `&teachersubject__teacher=${teacherId}`
        }

        if(promise) {
          return axios.get(subjectListUrl)
        }

        axios.get(subjectListUrl).then(function(response) {
          self.subDisciplines = response.data

        }).finally(() => {
          this.select2LoadData('#selectedSubdiscipline', false) 
        })

      },
      fetchTeacher: function(subject, promise){
        this.select2LoadData('#selectedTeacher')
        this.teachers = []

        if(!subject) 
          return
        
        let teacherListUrl = `{% url 'inspectors:teacher_list_api' %}?subject=${subject}&teacher__can_elaborate_questions=true&teacher__is_inspector_ia=false`
        if (this.is_request_question_ia)
          teacherListUrl = `{% url 'inspectors:teacher_list_api' %}?subject=${subject}&teacher__can_elaborate_questions=true&teacher__is_inspector_ia=true`
       
          if(promise) {
            return axios.get(teacherListUrl)  
        }
        axios.get(teacherListUrl).then((response) => {
          this.teachers = response.data
          if (this.is_request_question_ia ) {
            this.teachers.forEach(teacher => {
              if (teacher.teacher.is_inspector_ia) {
                this.selectedTeacher = teacher.id;
                this.teachersOnSelect.push({id: teacher.id, name: teacher.teacher.user_first_name, is_inspector_ia: teacher.teacher.is_inspector_ia})     
              }
            });
      
          }
        }).finally(() => {
          this.select2LoadData('#selectedTeacher', false)
          this.fetchReviewers(subject=subject)
        })
      },
      async fetchReviewers(subject) {
        this.select2LoadData('#id_reviewed_by')
        this.reviewers = []
        
        let url = `{% url 'inspectors:teacher_simple_list_api' %}?teachersubject__subject=${subject}&is_discipline_coordinator=true`
        
        axios.get(url).then((response) => {
          this.reviewers = response.data
        }).finally(() => {
          this.select2LoadData("#id_reviewed_by", false)
          $('#id_reviewed_by').val(this.selectedTeacherToUpdate.reviewed_by).trigger('change')
        })
      },
      getHistoricalQuestion(question) {
        let questionUrl = "{% url 'questions:question_historical' pk='00000000-0000-0000-0000-000000000000' %}"
        axios.get(questionUrl.replace('00000000-0000-0000-0000-000000000000', question.id)).then((response) => {
          this.historicalQuestion = response.data.exam_question
        })
      },
      getParams(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param)
      },
      hasAlternativeDuplicate(question){
        if(question.alternatives){
          const textos_alternativas = question.alternatives.map(a => this.cleanAlternative(a.text))
          const textos_alternativas_unicos = new Set(textos_alternativas)
          return textos_alternativas.length > textos_alternativas_unicos.size
        }
        return false;
      },
      cleanAlternative: function(a) {
        return a.replace(/<[^>]*>/g, '').trim();
      },
      fetchQuestion: function(question, automatic=false){
        let questionUrl = "{% url 'questions:questions_api_detail' pk='00000000-0000-0000-0000-000000000000' %}"
        questionUrl = questionUrl.replace('00000000-0000-0000-0000-000000000000', question.id)
        axios.get(questionUrl).then(response => {
          this.selectedQuestion = response.data
          this.selectedQuestion.alternatives.forEach(element => {
            element.text = element.text.replaceAll('\\\\', '\\')
          })
          this.selectedQuestion.answer = question.answer
        }).finally(() => {
          if(this.getParams('exam_question') && automatic) {
            $('#'+this.getParams('exam_question')).click()
         }
        })
        this.getHistoricalQuestion(question)
        this.selectedFilter = ''
      },
      async addTeacher(e) {

        note = this.concatenateNotes();
        {% if object %}
            if (this.teachersOnSelect) {
              const processTeacher = async (teacher) => {
                  const newTeacher = {
                      teacher_subject: teacher.id,
                      grade: this.selectedGrade,
                      order: this.generateObjectOrder(),
                      quantity: this.quantity,
                      reviewed_by: this.reviewed_by,
                      note: note,
                      subject_note: this.subject_note,
                      block_subject_note: this.block_subject_note,
                      block_questions_quantity: this.block_questions_quantity,
                      block_quantity_limit: this.block_quantity_limit,
                      distribute_scores_freely: this.distribute_scores_freely,
                      objective_quantity: this.objective_quantity,
                      discursive_quantity: this.discursive_quantity,
                      exam_questions: [],
                  };
      
                  try {
                      const response = await axios.post("{% url 'exams:api-exam-create-exam-teacher-subject' object.pk %}", newTeacher);
                      this.selectedTeachers.push(response.data);
      
                      if (this.is_request_question_ia) {
                          await this.alertBeforeSaveTeacher(true);
                      }
      
                      this.alertTop('Professor adicionado com sucesso!');
                  } catch (error) {
                      if (error.response && error.response.status === 409) {
                          this.alertError('Erro ao adicionar o professor!', 'O professor já foi adicionado anteriormente.');
                      } else {
                          this.alertError('Erro ao adicionar professor!', 'Tente novamente, caso o erro persista, entre em contato com o suporte.');
                      }
                  }
              };
      
              const teacherPromises = this.teachersOnSelect.map(teacher => processTeacher(teacher));
              await Promise.all(teacherPromises);
      
              this.cleanInputs();
    
          }
        {% else %}
        note = this.concatenateNotes();

        if (this.teachersOnSelect) {
            this.teachersOnSelect.forEach(teacher => {
                const newTeacher = {
                    teacher_subject: teacher.id,
                    teacher: {
                        id: teacher.id,
                        name: teacher.name,
                        is_inspector_ia: teacher.is_inspector_ia
                    },
                    subject: {
                        id: this.selectedSubject,
                        name: $('#selectedSubject').find(":selected").text()
                    },
                    grade: {
                        id: this.selectedGrade,
                        full_name: $('#{{form.grades.auto_id}}').find(":selected").text()
                    },
                    order: this.generateObjectOrder(),
                    quantity: this.quantity,
                    reviewed_by: this.reviewed_by,
                    note: note,
                    subject_note: this.subject_note,
                    block_subject_note: this.block_subject_note,
                    block_questions_quantity: this.block_questions_quantity,
                    objective_quantity: this.objective_quantity,
                    discursive_quantity: this.discursive_quantity,
                    block_quantity_limit: this.block_quantity_limit,
                    distribute_scores_freely: this.distribute_scores_freely,
                    exam_questions: [],
                    is_foreign_language: false,
                };

                this.selectedTeachers.push(newTeacher);
                this.exam.teacher_subjects.push(newTeacher);
            });
    
            if (this.is_request_question_ia) {
                await this.alertBeforeSaveTeacher(false);
            }
            this.cleanInputs();
        }
        {% endif %}
    
        if (e.submitter.value === 'addanother') {
            $('#exampleModal').scrollTop(0);
        } else {
            $('#exampleModal').modal('hide');
        }
      },
      alertBeforeSaveTeacher(has_object) {
        let htmlContent = `
          <div style="text-align: left;">
            Para garantir que sua solicitação seja atendida, é <b>necessário salvar este caderno</b>.<br><br>
            Não se preocupe, <b>você receberá um e-mail</b> confirmando que as questões já foram geradas e estão prontas para revisão.
          </div>
        `;
        if (has_object){
           htmlContent = `
          <div style="text-align: left;">
            Não se preocupe, <b>você receberá um e-mail</b> confirmando que as questões já foram geradas e estão prontas para revisão.
          </div>
        `;
        }

        return Swal.fire({
          title: 'Atenção!',
          html: htmlContent,
          icon: 'info',
          confirmButtonColor: '#3085d6',
          confirmButtonText: 'Ok!',
        });
      },      
      removeExamTeacherSubject(examTeacherSubject, index) {
        if(this.canRemoveExamTeacherSubject) {
          Swal.fire({
            title: 'Confirmação?',
            text: "Você confirma que quer remover este professor do caderno?",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sim, Confirmo!',
            cancelButtonText: 'Cancelar'
          }).then((result) => {
            if (result.isConfirmed) {
              url  = "{% url 'exams:api-exam-delete-exam-teacher-subject' pk='00000000-0000-0000-0000-000000000000' %}"
              if(!examTeacherSubject.id) {
                this.selectedTeachers.splice(index, 1)
                return
              }
              axios.post(url.replace('00000000-0000-0000-0000-000000000000', examTeacherSubject.id)).then((response) => {
                  this.alertTop('O professor foi removido com sucesso.')
                  this.selectedTeachers.splice(index, 1)
              }).catch((error) => {
                  this.alertError('Ocorreu um erro ao remover o professor do caderno.')
              })
            }
          })
        }else{
          Swal.fire({
            title: 'Alerta',
            text: "Não é possível remover essa solicitação pois existe um malote gerado para esse caderno.",
            icon: 'error',
            showCancelButton: false,
            confirmButtonText: 'Ok',
          })
        }
      },
      generateObjectOrder(){
        return this.selectedTeachers.length
      },
      cleanInputs(){
        this.teachersOnSelect = []
        this.selectedTeacherToUpdate = ""
        this.selectedGrade = ""
        this.selectedSubject = ""
        this.selectedSubdiscipline = ""
        this.selectedTeacher = ""
        this.quantity = 1
        this.reviewed_by = []
        this.subject_note = ""
        this.block_subject_note = false
        this.block_questions_quantity = false
        this.objective_quantity = 0
        this.discursive_quantity = 0
        this.note = ""
        this.prompt = ""
        this.subjects = []
        this.subDisciplines = []
        this.teachers = []
        this.is_request_question_ia = false
        this.showTextareas = false
        this.cleanInputsQuestionQualifiers()
        
        $("#{{form.grades.auto_id}}").val(null).trigger('change')
        $("#selectedSubject").val(null).trigger('change')
        $("#selectedSubdiscipline").val(null).trigger('change')    
        $("#selectedTeacher").val(null).trigger('change')    
        $("#id_reviewed_by").val(null).trigger('change')    
      },
      isOnlyPropertyTrue(coordination, coordinationsToSelect2, propertyName) {
        for (const prop in coordination) {
          if (prop !== propertyName && coordinationsToSelect2.includes(prop) && coordination[prop] === true) {
            return false
          }
        }
        return coordination[propertyName] === true
      },
      addCoordinationsToSelect2(type) {
        let coordinationsToSelect2 = []
        let examCoordinations = []
        if (!this.coordinationsToSelect2.includes(type)) {
          coordinationsToSelect2 = [...this.coordinationsToSelect2, type]
          examCoordinations = [
            ...this.exam.coordinations,
            ...this.coordinations.filter(coordination => coordination[type]).map(coordination => coordination.pk),
          ]
        } else {
          coordinationsToSelect2 = this.coordinationsToSelect2.filter(element => element !== type)
          examCoordinations = this.exam.coordinations.filter(
            coordination => !this.isOnlyPropertyTrue(this.coordinations.find(coordinationObj => coordinationObj.pk === coordination), coordinationsToSelect2, type)
          )
        }

        this.coordinationsToSelect2 = coordinationsToSelect2
        this.exam.coordinations = examCoordinations
        this.treeselect.updateValue(examCoordinations)

        $('#{{ form.coordinations.auto_id }}').val(examCoordinations)
        $('#{{ form.coordinations.auto_id }}').trigger('change')
      },
      checkSteps: async function(step) {
        if(this.selectedGrade){
          return step = 2
        }
        return step
      },
      verifications() {
        if(this.selectedTeachers.some((teacher) => !teacher.teacher_subject)) {
          return false
        }
        return true
      },
      confirmationBeforeSubmit() {
        Swal.fire({
          title: 'Caderno com língua estrangeira',
          html: 'Se o gabarito utilizado for <em>MODELO ENEM</em>, <strong>Inglês</strong> deve ser a primeira disciplina e <strong>Espanhol</strong> deve ser a segunda, ambas com 5 questões.',
          icon: 'warning', 
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          cancelButtonText: 'Cancelar',
          confirmButtonText: 'Ok',
          width: '60%'
        }).then((result) => {
          if (result.isConfirmed) {
            this.saveExam()
          } else {
            $('button').prop('disabled', false)
          }
        })
      },
      formIsValid() {
        this.errors = {}
        if (!this.treeselect.value.length) {
          this.errors['coordinations'] =  ['Você deve selecionar pelo menos uma coordenação']
        }
        setTimeout(() => {
          $('button').prop('disabled', false)
        }, 8000)
        if(this.exam.elaboration_deadline && this.exam.release_elaboration_teacher){
          if(this.exam.release_elaboration_teacher > this.exam.elaboration_deadline){
            this.errors['release_elaboration_teacher'] = 'A data de liberação para elaboração deve ser anterior a data limite para elaboração'
          }
        }
        if (this.exam.confidential_date) {

          const today = new Date("{{ today }}")
          const confidentialDate = new Date(this.exam.confidential_date)
          confidentialDate.setUTCHours(3, 0, 0, 0);  // Define 3 hrs no UTC para ficar meia noite após a conversão

          if (confidentialDate < today) {
            this.errors['confidential_date'] = 'A data de sigilo deve ser posterior a data atual'
          }
        }
        return !Object.keys(this.errors).length
      },
      saveExam() {
        if(this.formIsValid()) {
          this.exam.orientations = tinymce.get('id_orientations').getContent()
          if(!this.exam.total_grade || this.exam.total_grade === null) {
            this.exam['total_grade'] = null
          }
          
          this.exam.coordinations = this.treeselect.value
          this.exam.quantity_alternatives = this.exam.quantity_alternatives === '' ? null : this.exam.quantity_alternatives
          axios({
            {% if object %}
              url: "{% url 'exams:api-exam-detail' object.pk %}",
              method: 'put',
            {% else %}
              url: "{% url 'exams:api-exam-list' %}",
              method: 'post',
            {% endif %}
            data: this.exam
          }).then((response) => {
            if(response.data.redirect_url) {
              window.location.href = response.data.redirect_url
            } else {
              window.location.href = "{% url 'exams:exams_list' %}"
            }
          }).catch((error) => {
            let errorMessage = error.response.data.detail ? error.response.data.detail : 'Tente novamente, caso o erro persista, entre em contato com o suporte.'
            this.alertError('Erro ao salvar o caderno!', errorMessage)
          }) 
        } else {
          this.alertError('Erro no Formulário', 'Alguns campos possuem inconsistências. Por favor, verifique as mensagens de erro e tente novamente.')
        }
      },
      addMaterial() {
        this.exam.materials.push({
          title: '',
          thumbnail: '',
          material: '',
          stage: 6,
          emphasis: false,
          release_material_study: this.release_material_study,
        })
      },
      editMaterial(material) {
        this.exam.materials = this.exam.materials.map(materialItem => {
          if (materialItem.id === material.id) {
            return { ...material, editing: true }
          }
          return materialItem
        })
      },
      removeMaterial() {
        this.exam.materials = this.exam.materials.filter(material => material.id).map(material => {
          return { id: material.id, title: material.title, thumbnail: material.thumbnail, material: material.material, stage: material.stage, emphasis: material.emphasis, release_material_study: material.release_material_study }
        })
      },
      createMaterial(material) {
        const formData = new FormData()
        formData.append('title', material.title)
        formData.append('thumbnail', material.thumbnail)
        formData.append('material', material.material)
        formData.append('stage', Number(material.stage))
        formData.append('emphasis', material.emphasis)
        formData.append('release_material_study', this.release_material_study ? this.release_material_study:moment().format('YYYY-MM-DD'))
          
        {% if object %}
          this.savingMaterial = true
          url  = "{% url 'exams:api-exam-create-update-material' pk='00000000-0000-0000-0000-000000000000' %}"
          axios.post(url.replace('00000000-0000-0000-0000-000000000000', this.exam.id), formData, { 
            headers: { 
              'Content-Type': 'multipart/form-data'
            }
          }).then((response) => {
            material['id'] = response.data.id
            this.alertTop('Material criado com sucesso.')
          }).catch((error) => {
            if(error.response.data['title']) {
              return this.alertError('Certifique-se que você digitou um título para o material e tente novamente.')
            }
            if(error.response.data['thumbnail']) {
              return this.alertError('Certifique-se que enviou um formato de imagem válida para a capa do material e tente novamente.')
            }
            this.alertError('Ocorreu um erro ao criar o material, verifique se preencheu corretamente todos os campos e tente novamente.')

          }).finally(() => {
            this.savingMaterial = false
          })
        {% endif %}
      },
      updateMaterial(material) {
        material['saving'] = true
        this.$forceUpdate()
        const formData = new FormData()
        formData.append('title', material.title)
        formData.append('thumbnail', material.thumbnail)
        formData.append('material', material.material)
        formData.append('stage', Number(material.stage))
        formData.append('emphasis', material.emphasis)
        formData.append('release_material_study', this.release_material_study ? this.release_material_study:moment().format('YYYY-MM-DD'))

        url  = "{% url 'exams:api-exam-create-update-material' pk='00000000-0000-0000-0000-000000000000' %}"
        axios.put(url.replace('00000000-0000-0000-0000-000000000000', material.id), formData, { 
          headers: { 
            'Content-Type': 'multipart/form-data'
          } 
        }).then((response) => {
          this.alertTop('Material atualizado com sucesso.')
        }).catch((error) => {
          this.alertError('Ocorreu um erro ao criar o material.')
        }).finally(() => {
          material['saving'] = false
          this.$forceUpdate()
        })


      },
      deleteMaterial(material) {
        if(material.id) {
          Swal.fire({
            title: 'Confirmação?',
            text: 'Você deseja remover o material?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sim, Confirmo!',
            cancelButtonText: 'Cancelar'
          }).then((result) => {
            if (result.isConfirmed) {
              url  = "{% url 'exams:api-exam-delete-material' pk='00000000-0000-0000-0000-000000000000' %}"
              axios.post(url.replace('00000000-0000-0000-0000-000000000000', material.id)).then((response) => {
                  this.alertTop('O material foi removido com sucesso.')
                  this.exam.materials.splice(this.exam.materials.indexOf(material), 1)
              }).catch((error) => {
                  this.alertError('Ocorreu um erro ao remover o material do caderno.')
              })
            }
          })
        } else {
          this.exam.materials.splice(this.exam.materials.indexOf(material), 1)
        }
      },
      alertTop(text, icon='success') {
        Swal.fire({
          position: 'top-end',
          text: text,
          icon: icon,
          showConfirmButton: false,
          timer: 2500,
          toast: true,
          timerProgressBar: true,
        })
      },
      alertError(title = "Erro", text = '') {
        Swal.fire(
          title,
          text,
          'error'
        )
      },
      resetAddTeacherInputs() {
        $('#selectedSubject').val(null).trigger('change')
        $('#selectedSubdiscipline').val(null).trigger('change')
        
        $('#selectedTeacher').val(null).trigger('change')
        this.subjects = []
        this.subDisciplines = []
        this.teachers = []
   
      },
      getOrientations() {
        axios.get("{% url 'exams:api-exam-get-orientations' %}").then((response) => this.orientations = response.data)
      },
      getStatusCount(examTeacherSubjectID) {
        url = `{% url 'exams:api-exam-get-status-count' pk='00000000-0000-0000-0000-000000000000' %}?exam_teacher_subject=${examTeacherSubjectID}`
        axios.get(url.replace('00000000-0000-0000-0000-000000000000', '{{object.id}}')).then((response) => {
          this.selectedTeacher.status_count = response.data
        })
      },
      selectForeignLanguage(firstTeacher) {
        new Promise((resolve, reject) => {
          this.resetForeignLanguage()
          resolve()
        }).then((response) => {
          firstTeacher.is_foreign_language = true
          secondTeacher = this.getSecondForeignLanguage(firstTeacher)

          this.changeForeignLanguage([
            firstTeacher.id,
            secondTeacher.id
          ])
        })
      },
      resetForeignLanguage() {
        this.selectedTeachers.filter(teacher => {
          if(teacher.is_foreign_language) {
            teacher.is_foreign_language = false
          }
        })
      },
      getSecondForeignLanguage(firstTeacherIsForeignLanguage) {
        if(firstTeacherIsForeignLanguage) {
          secondTeacherIsForeignLanguage = this.selectedTeachers[this.selectedTeachers.indexOf(firstTeacherIsForeignLanguage) + 1]
          if(secondTeacherIsForeignLanguage) {
            secondTeacherIsForeignLanguage.is_foreign_language = true
            return secondTeacherIsForeignLanguage
          }
        }
        return false
      },
      changeForeignLanguage(teachers) {
        {% if object %}
          axios.post("{% url 'exams:api-exam-change-foreign-language' object.id %}", teachers).then((response) => {
            this.alertTop('Alteração salva com sucesso.')
          }).catch((error) => {
            this.alertError('Ocorreu um erro ao tentar fazer a alteração, tente novamente e se o erro persistir entre em contato com o suporte.')
          })
        {% endif %}
      },
      call(result) {
        if (result.updated) {
          let examQuestion = this.selectedTeacher.exam_questions.find((exam_question) => exam_question.question.id == result.id || exam_question.question.pk == result.pk)
          let question = examQuestion.question
          this.fetchQuestion(question)
          Swal.fire({
            title: 'Questão atualizada',
            icon: 'success',
          })
        }
      },
      blockQuestionWeight(examQuestion) {
        this.loadingBlockWeight = true
        let block_weight = !examQuestion.block_weight
        
        let url = "{% url 'exams:exam_question_partial_update' pk='00000000-0000-0000-0000-000000000000'  %}"
        axios.put(url.replace("00000000-0000-0000-0000-000000000000", examQuestion.id), { block_weight: block_weight }).then((response) => {
          examQuestion.block_weight = response.data.block_weight
          if(!block_weight && (this.exam.total_grade || this.selectedTeacher.subject_note)) {
            this.recalculateWeights = true
            this.getExamQuestions(this.selectedTeacher, reload = true)
          }
          if(block_weight) {
            this.alertTop("A nota da questão foi travada")
          } else {
            this.alertTop("A nota da questão foi destravada")
          }
        }).catch((error) => {
          this.alertTop("Não foi possível travar a nota da questão", "error")
        }).finally(() => {
          this.loadingBlockWeight = false
          this.getBlockedWeight()
        })
      },
      checkSubjectNoteValue(event) {
        let noteValue = Number(event.target.value);
        if (noteValue == NaN || noteValue === 0) {
          this.distribute_scores_freely = false;
        }

        let examTeacherSubjectBloquedSubjectNote = this.exam.teacher_subjects.filter(
          teacherSubject => teacherSubject.block_subject_note && teacherSubject.subject_note
        ).reduce((total = 0, teacherSubject) => total += Number(teacherSubject.subject_note), 0)

        let examTeacherSubjectBloquedExamQuestionsWeight = this.selectedTeacherToUpdate?.exam_questions?.filter(
          examquestion => examquestion.block_weight
        ).reduce((total = 0, examquestion) => total += Number(examquestion.weight), 0)

        if(this.maxExamTotalGrade != null && this.maxExamTotalGrade >= 0) {
          let available_grade = (Number(this.maxExamTotalGrade) - Number(this.blockedWeight)) + Number(this.selectedTeacherToUpdate?.subject_note || 0)

          if(noteValue >= available_grade) { 
            noteValue = Math.abs(available_grade.toFixed(4))
          }

          if (this.selectedTeacherToUpdate?.block_subject_note && (noteValue < examTeacherSubjectBloquedExamQuestionsWeight)) {
            noteValue = Math.abs(examTeacherSubjectBloquedExamQuestionsWeight.toFixed(4))
          }
          
          if(noteValue < 0) {
            noteValue = 0
          }

        }
        this.subject_note = noteValue
        $("#id_subject_note").val(this.subject_note)
      },
      getBlockedWeight() {
        {% if object %}
          axios.get("{% url 'exams:api-exam-get-blocked-weights' object.id %}").then((response) => this.blockedWeight = response.data)
        {% endif %}
      },
      checkUpdateWeight(event, question) {
        
        let maxValue = Number((10000)).toFixed(6)
        let number = Number(this.updateWeight)
        
        
        if (this.selectedTeacher.subject_note) {
          let blockedWeightExamTeacherSubject = this.selectedTeacher.exam_questions.filter(examquestion => examquestion.block_weight).reduce((total = 0, examquestion) => total += Number(examquestion.weight), 0)
          maxValue = (Number(this.selectedTeacher.subject_note) - blockedWeightExamTeacherSubject + Number(question.weight)).toFixed(6)
        }
        
        else if (this.exam.total_grade) {
          maxValue = (this.exam.total_grade - this.blockedWeight + Number(question.weight)).toFixed(6)
        }

        if(number >= maxValue) {
          this.updateWeight = maxValue
        } 
        
        if(number < 0) {
          this.updateWeight = 0
        }

      },
      examGetSumWeight(recalculate = false) {
        {% if object %}
          let url = "{% url 'exams:api-exam-get-sum-weight' object.id %}"
          if(recalculate) {
            url += '?recalculate=true'
          }
          axios.get(url).then((response) => {
            response.data.exam_teacher_subjects.forEach((examTeacherSubject) => {
              let teacher = this.selectedTeachers.find((teacher) => teacher.id == examTeacherSubject.id)
              if(teacher) {
                teacher.sum_weight = examTeacherSubject.sum_weight
              }
            })
          }).finally(() => {
            if(recalculate) {
              this.alertTop('Os pesos do caderno foram recalculados com sucesso.')
            }
          })
        {% endif %}
      },
      async initializeFromLocalStorage() {
        const selectedTeacher = JSON.parse(localStorage.getItem('selectedTeacher'));
        const selectedQuestionIndex = parseInt(localStorage.getItem('selectedQuestionIndex'), 10);
  
        if (selectedTeacher && !isNaN(selectedQuestionIndex)) {
          this.selectedTeacher = selectedTeacher;
          this.selectedQuestionIndex = selectedQuestionIndex;
          this.selectedQuestion = this.selectedTeacher.exam_questions[this.selectedQuestionIndex];
          this.updateWeight = Number(this.selectedQuestion.weight).toFixed(6);
  
          this.$nextTick(() => {
            this.openModal('teacherModal');
            const buttonId = this.selectedTeacher.exam_questions[this.selectedQuestionIndex].id;
            const buttonElement = document.querySelector(`[id='${buttonId}']`);
            if (buttonElement) {
              buttonElement.click();
            }
  
            localStorage.removeItem('selectedTeacher');
            localStorage.removeItem('selectedQuestionIndex');
          });
        } 
      },
    },
    mounted: function(){ 

      document.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener("wheel", function (event) {
          event.preventDefault(); // Impede que o scroll altere o número
        });
      });

      this.updateAdditionalNotes()
      document.addEventListener('click', this.handleClickOutside);
      this.statusDialogElement = document.querySelector("#status-dialog")

      this.$nextTick(() => {
        $('[data-toggle="tooltip"]').tooltip('update');
      });
      
      if(this.getParams('exam_question') && this.getParams('is_popup')) {

        $('#teacherModal').on('hide.bs.modal', (event) => {
            if (window.opener.app_question && window.opener.app_question.call()) {
            }else if(window.opener.app){
              window.opener.app.callExamQuestions(this.selectedTeacher.exam_questions)
            }
            window.close();
        })
      }
      self = this
      self.initializeSelect2()
      self.initializeFromLocalStorage()

      {% include 'help/includes/tour_guide.js' with group_guide_name='default-exam-create-update' %}

      {% if object %}
        this.loading = true
        this.selectedTeachersStatus = 'loading'
        let url = '{% url "exams:api-exam-detail" object.pk %}'
        {% if user_type == 'teacher' and request.user.inspector.is_discipline_coordinator %}
        url += '?is_discipline_coordinator=true'
        {% endif %}
        axios.get(url).then((response) => {
          this.exam = response.data
          this.exam.use_quantity_alternatives = response.data.quantity_alternatives ? true : false
          this.exam.exam_print_config_header = {% if object and object.exam_print_config %}'{{ object.exam_print_config.header.pk }}'{% else %}''{% endif %}
          if(this.exam.materials && this.exam.materials.length) {
            this.release_material_study = moment(this.exam.materials[0].release_material_study).format("YYYY-MM-DD")
          }
          this.selectedTeachers = response.data.teacher_subjects
          this.examGetSumWeight()
        }).finally(() => {
          if(this.exam.coordinations && this.exam.coordinations.length) {
            $('#{{form.coordinations.auto_id}}').trigger('change')
          }
          if(this.exam.relations && this.exam.relations.length) {
            $('#{{form.relations.auto_id}}').trigger('change')
          }
          if(this.getParams('exam_teacher_subject')){
            setTimeout(() => {
              $('#exam_teacher_subject-'+this.getParams('exam_teacher_subject')).click()
            }, "2000")
          }
          this.loading = false
          this.selectedTeachersStatus = 'idle'
          this.getBlockedWeight()
        })
      {% endif %}
      $('#id_elaboration_deadline').val('{{form.elaboration_deadline.value|safe}}')
      $('#id_release_elaboration_teacher').val('{{form.release_elaboration_teacher.value|safe}}')
      $('#id_review_deadline').val('{{form.review_deadline.value|default:''|safe}}')
      $.fn.modal.Constructor.prototype._enforceFocus = function() {};

      $('#{{form.coordinations.auto_id}}').on('select2:select select2:unselect', (e) => {
        self.exam.coordinations = $('#{{form.coordinations.auto_id}}').val()
      })

      $('#{{form.relations.auto_id}}').on('select2:select select2:unselect', (e) => {
        self.exam.relations = $('#{{form.relations.auto_id}}').val()
      })

      $('#form-exam-create-update').on('submit', function(e) {
        if(self.exam.is_english_spanish) {
          self.confirmationBeforeSubmit()
          return
        }
        self.saveExam()
      })

      $('#{{form.grades.auto_id}}').on('select2:select', (e) => {
        id = e.params.data.id
        if (id) {
          this.selectedGrade = id
          if(this.isNoTeacherSelectedOrHasNoQuestions() || this.canChangeSubjectWithExistingQuestions) {
            this.selectedSubject = null
          }
          this.fetchSubject(id)
        } else {
          self.resetAddTeacherInputs()
        }
      })
      {% comment %} $('#selectedGradeIa').select2(); {% endcomment %}

      $('#selectedGradeIa').on('select2:select', (e) => {
        id = e.params.data.id
        if (id) {
          this.selectedGrade = id
          this.fetchSubject(id)
        } else {
          self.resetAddTeacherInputs()
        }
      })
      $('#selectedSubject').on('select2:select', (e) => {
        id = e.params.data.id
        if (id) {
          this.selectedSubject = id
          this.fetchSubSubject(id)
          if(!this.selectedTeacherToUpdate) {
            this.fetchTeacher(id)
          }
          this.fetchAbilities(id) 
          this.fetchCompetences(id)
          this.fetchTopic(id)
          this.cleanInputsQuestionQualifiers()
        }
      })
      
      $('#availableExams').on('select2:select', (e) => {
        id = e.params.data.id
        if (id) {
          this.copyQuestionData.destinationExam = id
        }
      })
      $('#availableExamTeacherSubjects').on('select2:select', (e) => {
        id = e.params.data.id
        if (id) {
          this.copyQuestionData.destinationExamTeacherSubject = id
        }
      })
      $('#selectedSubdiscipline').on('select2:select', (e) => {
        id = e.params.data.id
        if (id) {
          this.selectedSubdiscipline = id
          if(!this.selectedTeacherToUpdate) {
            this.fetchTeacher(id)
          }
        } else {
          if(!this.selectedTeacherToUpdate) {
            this.fetchTeacher(this.selectedSubject)
          }
        }
      })
      $('#selectedTeacher').on('select2:select', (e) => {
        id = e.params.data.id
        name = e.params.data.text
        if (id) {
          this.teachersOnSelect.push({id: id, name: name, is_inspector_ia: false, has_error_create_exam_question_ia: false})
          this.selectedTeacher = id
        }
      })
      $("#selectedTeacher").on("select2:unselect", (e) => {
        let id = e.params.data.id
        if(id){
          this.teachersOnSelect = this.teachersOnSelect.filter(teacher => teacher.id !== id)
        }
      })
      $("#id_reviewed_by").on("change", (e) => {
        this.reviewed_by = $("#id_reviewed_by").val()
      })
      $('#teacherModal').on('hide.bs.modal', (event) => {
        this.examGetSumWeight()
      })

      $('#exampleModal').on('hide.bs.modal', (event) => {
        this.cleanInputs()
        this.editing = false
      })

      const options = [
        {% for unity in unities %}
          {
            name: '{{ unity }}',
            value: '{{ unity.id }}',
            children: [
              {% for coordination in unity.coordinations.all %}
                {
                  name: '{{ coordination }}',
                  value: '{{ coordination.id }}',
                  // value: 'unity-{{ unity.id }}-coordination-{{ coordination.id }}',
                  children: []
                },
              {% endfor %}
            ]
          },
        {% endfor %}
      ]

      const domElement = document.getElementById('{{ form.coordinations.auto_id }}-treeselect')
      this.treeselect = new Treeselect({
        parentHtmlContainer: domElement,
        value: [
          {% for coordination in form.coordinations.value %}
            '{{ coordination }}',
          {% endfor %}
        ],
        options: options,
        showTags: false,
        showCount: true,
        showItemIfOnlyOneSelected: false,
        showSelectedItemsCount: true,
        tagsCountText: 'selecionada(s)',
        // alwaysOpen: true,
        placeholder: 'Digite o nome de uma unidade que deseja autorizar',
        clearable: false,
        emptyText: 'Nenhum resultado encontrado...',
      })


    },
    beforeDestroy() {
      document.addEventListener('click', this.handleClickOutside);
    },
    updated: function(){
      if(window.MathJax) {
        MathJax.typeset();
      }
      $('#input-update-weight').numeric(
        {altDecimal: ',', decimal: '.', decimalPlaces : 4, negative : false }
      );
      this.$nextTick(() => {
        $('[data-toggle="tooltip"]').tooltip('dispose').tooltip(); // Remove e reinicializa o tooltip
      });
    },
  })


</script>

<!-- <script>
const editorContainer = document.querySelector(".tox-editor-header");
const sidebarWrap = document.querySelector(".tox-sidebar-wrap");

sidebarWrap.addEventListener("focus", () => {
  hiddenHeader.style.display = "block";
});

sidebarWrap.addEventListener("blur", () => {
  hiddenHeader.style.display = "none";
});
</script> -->


{% endblock %}