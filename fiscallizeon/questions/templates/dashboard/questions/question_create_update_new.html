{% extends 'redesign/base.html' %}
{% comment %} {% extends 'dashboard/base_fixed.html' %} {% endcomment %}
{% load static %}
{% load widget_tweaks %}
{% load remove_line_break %}
{% load questions_tags %}
{% load num_to_char %}
{% load exams_tags %}

{% block title %}
  {% if not object %}
    Adicionar questão - Lize
  {% else %}
    Alteração de questão - Lize
  {% endif %}
{% endblock title %}

{% block css-additional %}
<link href="{% static 'administration/lib/select2/css/select2.min.css' %}" rel="stylesheet" />
<link href="{% static 'administration/assets/css/boostrap5.css' %}" rel="stylesheet">
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/styles/choices.min.css"
/>
<style>
  .modal-html img{
    max-width:100%;
    height: auto;
  }
  .modal-body{
      max-height: 75vh !important;
  }
  .modal-body-create-topic {
      /* max-height: 55vh ; */
      /* overflow: auto; */
      margin: 15px;
  }
  label{
    margin-bottom: 0 !important;
  }
  .wrs_tickContainer{
    display: none !important;
  }
  #base_button{
    margin-top: -36px;
  }
  #margin_button{
    margin-right: 15px;
  }
  .df-settings {
    position: fixed;
    top: 0;
    right: 0px;
    /* left: 700px; */
    bottom: 0;
    z-index: 1200;
    transition: all 0.2s;
  }
  .df-settings.show {
    right: 95px;
  }
  .df-settings-body {
    position: absolute;
    height: auto;
    top:29%;
    left: 0;
    width: 142px;
    background-color: #fff;
    border-left: 1px solid #c0ccda;
    box-shadow: 0 0 15px rgb(28 39 60 / 10%);
    padding: 18px 10px;
    overflow-y: auto;
  }
  .df-settings-link {
    top: 291px;
  }
  .modal-content .close {
    margin-left: -21%;
  }
  .btnMenu {
    position: absolute;
    top: 20px;
    right: 5px;
    z-index: 9999;
    cursor: pointer;
    float: right;
  }
  .bg-success-custom {
    background-color: rgb(141, 219, 173)
  }
  .grayscale {
    filter: gray; 
    -webkit-filter: grayscale(1); 
    filter: grayscale(1); 
  }

  .vue-select2 {
    width: 300px;
  }
  
</style>

<style>
  .nav-tabs .nav-link {
    border: 0;
    padding: 0;
    background: unset;
    color: #6b7280;
  }

  .nav-tabs .nav-item + .nav-item {
    margin-left: 0;
  }

  .nav-tabs .nav-link:hover, .nav-tabs .nav-link:focus {
    background: unset;
    border-bottom: 2px solid #d1d5db;
    color: #374151;
  }

  .nav-tabs .nav-link > svg {
    color: #D3D6DB;
  }

  .nav-tabs .nav-link.active {
    border: 0;
    border-bottom: 2px solid #0C7BDB;
    /* color: #0e62c5; */
  }

  .nav-tabs .nav-link.active > svg {
    color: #0C7BDB;
  }
</style>

<style>
  .tox-tinymce {
    border-radius: 0.375rem !important;
    border: 1px solid #d1d5db !important;

    /* padding-top: 0.375rem !important;
    padding-bottom: 0.375rem !important;
    padding-right: 0.75rem !important;
    padding-left: 0.75rem !important; */
  }

  #row-alternatives .tox-tinymce {
    border: none !important;
    height: 54px !important;
  }

  #row-alternatives .tox .tox-edit-area__iframe {
    background: unset !important;
  }

  .transition {
    transition: transform 0.2s ease;
  }

  details[open] > summary .rotate-icon {
    transform: rotate(90deg);
  }

  .custom-choices__inner {
    min-height: unset;
    padding: 0.391rem 0.5rem;
    border-radius: 4px;
  }

  .custom-choices__list--single {
    padding: 0
  }
</style>
{% endblock css-additional %}

{% comment %}
{% block breadcrumb-fixed %}
<div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-10">
  <div>
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb breadcrumb-style1 mg-b-10">
        <li class="breadcrumb-item"><a href="#">QUESTÕES</a></li>
        <li class="breadcrumb-item active" aria-current="page">CADASTRAR</li>
      </ol>
    </nav> 

    {% if request.resolver_match.url_name == 'questions_update' %}
    <h4 class="mb-0">Atualizar questão</h4>
    {% else %}
    <h4 class="mb-0">Cadastrar questão</h4>
    {% endif %}


    <small class="text-muted">Informe os dados abaixo dessa questão</small>
  </div>
  <div class="d-none d-md-block">
      {% if is_popup %}
        <button class="btn btn-sm pd-x-15 btn-white btn-uppercase" onclick="window.close();">
          <i class="fas fa-times" class="wd-10 mg-r-5"></i> Fechar
        </button>
      {% else %}
        <button class="btn btn-sm pd-x-15 btn-white btn-uppercase" onclick="history.back();">
          <i data-feather="arrow-left" class="wd-10 mg-r-5"></i> Voltar
        </button>
      {% endif %}
  </div>
</div>
{% endblock breadcrumb-fixed %}
{% endcomment %}

{% block content-fixed %}
<div class="tw-flex tw-justify-center">
  <div class="ard cer dcv tw-max-w-[100rem] tw-flex-1 tw-mb-16">
    <div class="ls" style="margin-top: 1.25rem; margin-bottom: 1.5rem; justify-content: space-between;">
      <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-8 sm:tw-flex-nowrap tw-w-full">
        <div class="tw-flex tw-justify-between {% if only_review %}tw-w-full{% endif %}">
          <h1 class="tw-text-xl tw-font-semibold tw-leading-7 tw-text-[#374151] sm:tw-truncate sm:tw-text-2xl sm:tw-tracking-tight tw-mb-0">
            {% if not object %}
              Cadastrar questão
            {% else %}
              Editar questão
            {% endif %}
          </h1>
        </div>
        <div class="tw-order-last tw-flex tw-w-full tw-gap-x-4 tw-text-sm tw-font-semibold tw-leading-6 sm:tw-order-none sm:tw-w-auto sm:tw-leading-7">
          {% if object.history.all %}
            <button type="button" class="tw-flex tw-items-center tw-text-[#384250] tw-border tw-border-[#E5E7EA] tw-rounded-lg tw-px-2 tw-py-0.5" data-toggle="modal" data-target="#modalHistory">
              <span class="mr-2">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <g clip-path="url(#clip0_58_2653)">
                    <path d="M15.1333 9L13.8004 7.66667L12.4666 9M14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C10.2013 2 12.1257 3.18542 13.1697 4.95273M8 4.66667V8L10 9.33333" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_58_2653">
                      <rect width="16" height="16" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </span>
              <span>Histórico</span>
            </button>
          {% endif %}
          <button v-if="historicalQuestion.length > 0" type="button" class="tw-flex tw-items-center tw-text-[#384250] tw-border tw-border-[#E5E7EA] tw-rounded-lg tw-px-2 tw-py-0.5" data-toggle="modal" data-target="#modalUses">
            <span class="mr-2">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M8 11.244C6.64743 9.89078 4.60858 9.64201 3.00325 10.4977C2.54773 10.7405 1.9975 10.441 1.9975 9.9248V3.86094C1.9975 3.43676 2.19358 3.02859 2.53906 2.78249C4.19641 1.60066 6.51271 1.75339 8 3.24068C9.48728 1.75339 11.8036 1.60066 13.4609 2.78249C13.8064 3.02859 14.0025 3.43676 14.0025 3.86094V9.9248C14.0025 10.441 13.4523 10.7411 12.9967 10.4977C11.3914 9.64201 9.35256 9.89078 8 11.244Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M3.00323 13.2562C4.60857 12.4005 6.64742 12.6493 7.99998 14.0025C9.35255 12.6493 11.3914 12.4005 12.9967 13.2562" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8.00001 11.244V3.24066" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
            <span>Utilizações</span>
          </button>
        </div>
        <div class="tw-ml-auto tw-flex tw-gap-4">
          <button type="submit" form="questionForm" class="tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600">
            Salvar questão
          </button>
        </div>
      </div>
    </div>
    <template>
      <div class="tw-flex tw-gap-3">
        <div :class="[customToolbarStatus === 'active' ? 'tw-opacity-100' : 'tw-opacity-50']">
          <div class="tw-sticky tw-top-3 tw-rounded-lg tw-bg-white tw-shadow tw-divide-y tw-divide-gray-100 tw-px-1 tw-py-1">
            <div class="tw-flex tw-flex-col tw-py-1">
              <button
                id="custom-toolbar-undo"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-w-5 tw-h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3" />
                </svg>
              </button>
              <button
                id="custom-toolbar-redo"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-w-5 tw-h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3" />
                </svg>
              </button>
            </div>
            <div class="tw-flex tw-flex-col tw-py-1">
              <button
                id="custom-toolbar-image"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-w-5 tw-h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                </svg>
              </button>
              <button
                id="custom-toolbar-media"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-w-5 tw-h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 0 1-1.125-1.125M3.375 19.5h1.5C5.496 19.5 6 18.996 6 18.375m-3.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-1.5A1.125 1.125 0 0 1 18 18.375M20.625 4.5H3.375m17.25 0c.621 0 1.125.504 1.125 1.125M20.625 4.5h-1.5C18.504 4.5 18 5.004 18 5.625m3.75 0v1.5c0 .621-.504 1.125-1.125 1.125M3.375 4.5c-.621 0-1.125.504-1.125 1.125M3.375 4.5h1.5C5.496 4.5 6 5.004 6 5.625m-3.75 0v1.5c0 .621.504 1.125 1.125 1.125m0 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m1.5-3.75C5.496 8.25 6 7.746 6 7.125v-1.5M4.875 8.25C5.496 8.25 6 8.754 6 9.375v1.5m0-5.25v5.25m0-5.25C6 5.004 6.504 4.5 7.125 4.5h9.75c.621 0 1.125.504 1.125 1.125m1.125 2.625h1.5m-1.5 0A1.125 1.125 0 0 1 18 7.125v-1.5m1.125 2.625c-.621 0-1.125.504-1.125 1.125v1.5m2.625-2.625c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125M18 5.625v5.25M7.125 12h9.75m-9.75 0A1.125 1.125 0 0 1 6 10.875M7.125 12C6.504 12 6 12.504 6 13.125m0-2.25C6 11.496 5.496 12 4.875 12M18 10.875c0 .621-.504 1.125-1.125 1.125M18 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m-12 5.25v-5.25m0 5.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125m-12 0v-1.5c0-.621-.504-1.125-1.125-1.125M18 18.375v-5.25m0 5.25v-1.5c0-.621.504-1.125 1.125-1.125M18 13.125v1.5c0 .621.504 1.125 1.125 1.125M18 13.125c0-.621.504-1.125 1.125-1.125M6 13.125v1.5c0 .621-.504 1.125-1.125 1.125M6 13.125C6 12.504 5.496 12 4.875 12m-1.5 0h1.5m-1.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M19.125 12h1.5m0 0c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h1.5m14.25 0h1.5" />
                </svg>
              </button>
            </div>
            <div class="tw-flex tw-flex-col tw-py-1">
              <button
                id="custom-toolbar-bullist"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-w-5 tw-h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 6.75h12M8.25 12h12m-12 5.25h12M3.75 6.75h.007v.008H3.75V6.75Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0ZM3.75 12h.007v.008H3.75V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm-.375 5.25h.007v.008H3.75v-.008Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                </svg>
              </button>
              <button
                id="custom-toolbar-numlist"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="tw-w-5 tw-h-5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M8.242 5.992h12m-12 6.003H20.24m-12 5.999h12M4.117 7.495v-3.75H2.99m1.125 3.75H2.99m1.125 0H5.24m-1.92 2.577a1.125 1.125 0 1 1 1.591 1.59l-1.83 1.83h2.16M2.99 15.745h1.125a1.125 1.125 0 0 1 0 2.25H3.74m0-.002h.375a1.125 1.125 0 0 1 0 2.25H2.99" />
                </svg>
              </button>
            </div>
            <div class="tw-flex tw-flex-col tw-py-1">
              <button
                id="custom-toolbar-superscript"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="currentColor" viewBox="0 0 24 24" class="tw-w-5 tw-h-5">
                  <path d="M15 9.4 10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4Zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11Z" fill-rule="nonzero"></path>
                </svg>
              </button>
              <button
                id="custom-toolbar-subscript"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="currentColor" viewBox="0 0 24 24" class="tw-w-5 tw-h-5">
                  <path d="m10.4 10 4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10ZM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 0 0-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 0 1-1.3 1.3l-.6.6h2.6V19Z" fill-rule="nonzero"></path>
                </svg>
              </button>
            </div>
            <div class="tw-flex tw-flex-col tw-py-1">
              <button
                id="custom-toolbar-outdent"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="currentColor" viewBox="0 0 24 24" class="tw-w-5 tw-h-5">
                  <path d="M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 1 1 0-2Zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm-5 4h12a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2Zm1.6-3.8a1 1 0 0 1-1.2 1.6l-3-2a1 1 0 0 1 0-1.6l3-2a1 1 0 0 1 1.2 1.6L6.8 12l1.8 1.2Z" fill-rule="evenodd"></path>
                </svg>
              </button>
              <button
                id="custom-toolbar-indent"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="currentColor" viewBox="0 0 24 24" class="tw-w-5 tw-h-5">
                  <path d="M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 1 1 0-2Zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2Zm-5 4h12a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2Zm-2.6-3.8L6.2 12l-1.8-1.2a1 1 0 0 1 1.2-1.6l3 2a1 1 0 0 1 0 1.6l-3 2a1 1 0 1 1-1.2-1.6Z" fill-rule="evenodd"></path>
                </svg>
              </button>
            </div>
            <div class="tw-flex tw-flex-col tw-py-1">
              <button
                id="custom-toolbar-tiny_mce_wiris"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="currentColor" viewBox="0 0 24 24" class="tw-w-5 tw-h-5">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M9 4.8c.1-.5.5-.8 1-.8h10a1 1 0 1 1 0 2h-9.2L8.3 19.2a1 1 0 0 1-1.7.4l-3.4-4.2a1 1 0 0 1 1.6-1.2l2 2.5L9 4.8Zm9.7 5.5c.4.4.4 1 0 1.4L17 13.5l1.8 1.8a1 1 0 1 1-1.4 1.4L15.5 15l-1.8 1.8a1 1 0 0 1-1.4-1.4l1.8-1.8-1.8-1.8a1 1 0 0 1 1.4-1.4l1.8 1.8 1.8-1.8a1 1 0 0 1 1.4 0Z"></path>
                </svg>
              </button>
            </div>
            <div class="tw-flex tw-flex-col tw-py-1">
              <button
                id="custom-toolbar-clearformat"
                class="tw-text-gray-500 tw-rounded tw-p-2"
                :class="[customToolbarStatus === 'active' ? 'hover:tw-text-primary-600 hover:tw-bg-gray-50' : '!tw-cursor-not-allowed']"
              >
                <svg fill="currentColor" viewBox="0 0 24 24" class="tw-w-5 tw-h-5">
                  <path d="M13.2 6a1 1 0 0 1 0 .2l-2.6 10a1 1 0 0 1-1 .8h-.2a.8.8 0 0 1-.8-1l2.6-10H8a1 1 0 1 1 0-2h9a1 1 0 0 1 0 2h-3.8ZM5 18h7a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Zm13 1.5L16.5 18 15 19.5a.7.7 0 0 1-1-1l1.5-1.5-1.5-1.5a.7.7 0 0 1 1-1l1.5 1.5 1.5-1.5a.7.7 0 0 1 1 1L17.5 17l1.5 1.5a.7.7 0 0 1-1 1Z" fill-rule="evenodd"></path>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <div class="tw-w-full">
          {% with form.instance|check_can_be_updated:user as can_be_updated %}
            <form id="questionForm" method="post" action="#" onsubmit="return false" @change="checkIfExistTemplate()" @submit="handleSubmitFormQuestion">
              {% csrf_token %}
              {{ question_option_formset.management_form }}
              {% if is_popup %}
                <input type="hidden" name="is_popup" value="1" />
              {% endif %}
              {% if exam_teacher %}
                <input type="hidden" name="exam_teacher" value="{{ exam_teacher }}" />
              {% endif %}
              <div class="tw-overflow-hidden tw-rounded-lg tw-bg-white tw-shadow">
                <div class="tw-px-4 tw-py-5 sm:tw-p-6">
                  <ul class="nav nav-tabs tw-gap-5" id="myTab" role="tablist">
                    <li class="nav-item">
                      <a class="tw-text-sm tw-font-medium tw-gap-2 nav-link active" data-toggle="tab" href="#question-data" role="tab">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                          <path d="M11.6663 9.1665H6.66634M8.33301 12.4998H6.66634M13.333 5.83317H6.66634M16.6663 5.6665V14.3332C16.6663 15.7333 16.6663 16.4334 16.3939 16.9681C16.1542 17.4386 15.7717 17.821 15.3013 18.0607C14.7665 18.3332 14.0665 18.3332 12.6663 18.3332H7.33301C5.93288 18.3332 5.23281 18.3332 4.69803 18.0607C4.22763 17.821 3.84517 17.4386 3.60549 16.9681C3.33301 16.4334 3.33301 15.7333 3.33301 14.3332V5.6665C3.33301 4.26637 3.33301 3.56631 3.60549 3.03153C3.84517 2.56112 4.22763 2.17867 4.69803 1.93899C5.23281 1.6665 5.93288 1.6665 7.33301 1.6665H12.6663C14.0665 1.6665 14.7665 1.6665 15.3013 1.93899C15.7717 2.17867 16.1542 2.56112 16.3939 3.03153C16.6663 3.56631 16.6663 4.26637 16.6663 5.6665Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tw-text-[#384250]">Enunciado</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="tw-text-sm tw-font-medium tw-gap-2 nav-link" data-toggle="tab" href="#question-feedback" role="tab">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                          <g clip-path="url(#clip0_893_3885)">
                            <path d="M8.33366 12.5L5.77095 15.0947C5.41348 15.4567 5.23475 15.6376 5.08112 15.6504C4.94784 15.6615 4.81734 15.6079 4.73029 15.5064C4.62996 15.3893 4.62996 15.135 4.62996 14.6263V13.3263C4.62996 12.87 4.25622 12.5397 3.80466 12.4736V12.4736C2.71178 12.3135 1.85347 11.4552 1.69339 10.3623C1.66699 10.1821 1.66699 9.96709 1.66699 9.53703V5.66666C1.66699 4.26653 1.66699 3.56646 1.93948 3.03168C2.17916 2.56128 2.56161 2.17882 3.03202 1.93914C3.5668 1.66666 4.26686 1.66666 5.66699 1.66666H11.8337C13.2338 1.66666 13.9339 1.66666 14.4686 1.93914C14.939 2.17882 15.3215 2.56128 15.5612 3.03168C15.8337 3.56646 15.8337 4.26653 15.8337 5.66666V9.16666M15.8337 18.3333L14.02 17.0724C13.765 16.8951 13.6376 16.8065 13.4988 16.7437C13.3757 16.6879 13.2462 16.6473 13.1133 16.6228C12.9635 16.5952 12.8083 16.5952 12.4978 16.5952H11.0003C10.0669 16.5952 9.60019 16.5952 9.24368 16.4136C8.93007 16.2538 8.6751 15.9988 8.51532 15.6852C8.33366 15.3287 8.33366 14.862 8.33366 13.9286V11.8333C8.33366 10.8999 8.33366 10.4332 8.51532 10.0767C8.6751 9.76307 8.93007 9.5081 9.24368 9.34831C9.60019 9.16666 10.0669 9.16666 11.0003 9.16666H15.667C16.6004 9.16666 17.0671 9.16666 17.4236 9.34831C17.7372 9.5081 17.9922 9.76307 18.152 10.0767C18.3337 10.4332 18.3337 10.8999 18.3337 11.8333V14.0952C18.3337 14.8718 18.3337 15.2601 18.2068 15.5664C18.0376 15.9747 17.7132 16.2992 17.3048 16.4684C16.9985 16.5952 16.6102 16.5952 15.8337 16.5952V18.3333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_893_3885">
                              <rect width="20" height="20" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                        <span class="tw-text-[#384250]">Feedback</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="tw-text-sm tw-font-medium tw-gap-2 nav-link" data-toggle="tab" href="#question-subject" role="tab">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                          <g clip-path="url(#clip0_790_3200)">
                            <path d="M10.0003 13.3332V9.99984M10.0003 6.6665H10.0087M18.3337 9.99984C18.3337 14.6022 14.6027 18.3332 10.0003 18.3332C5.39795 18.3332 1.66699 14.6022 1.66699 9.99984C1.66699 5.39746 5.39795 1.6665 10.0003 1.6665C14.6027 1.6665 18.3337 5.39746 18.3337 9.99984Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_790_3200">
                              <rect width="20" height="20" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                        <span class="tw-text-[#384250]">Pedagógico</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="tw-text-sm tw-font-medium tw-gap-2 nav-link mr-1" data-toggle="tab" href="#question-bncc" role="tab">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                          <path d="M10.0003 17.5L9.91695 17.3749C9.33808 16.5066 9.04864 16.0725 8.66624 15.7582C8.32771 15.4799 7.93763 15.2712 7.51833 15.1438C7.0447 15 6.52292 15 5.47935 15H4.33366C3.40024 15 2.93353 15 2.57701 14.8183C2.2634 14.6586 2.00844 14.4036 1.84865 14.09C1.66699 13.7335 1.66699 13.2668 1.66699 12.3333V5.16667C1.66699 4.23325 1.66699 3.76654 1.84865 3.41002C2.00844 3.09641 2.2634 2.84144 2.57701 2.68166C2.93353 2.5 3.40024 2.5 4.33366 2.5H4.66699C6.53383 2.5 7.46725 2.5 8.18029 2.86331C8.8075 3.18289 9.31744 3.69282 9.63701 4.32003C10.0003 5.03307 10.0003 5.96649 10.0003 7.83333M10.0003 17.5V7.83333M10.0003 17.5L10.0837 17.3749C10.6626 16.5066 10.952 16.0725 11.3344 15.7582C11.6729 15.4799 12.063 15.2712 12.4823 15.1438C12.956 15 13.4777 15 14.5213 15H15.667C16.6004 15 17.0671 15 17.4236 14.8183C17.7372 14.6586 17.9922 14.4036 18.152 14.09C18.3337 13.7335 18.3337 13.2668 18.3337 12.3333V5.16667C18.3337 4.23325 18.3337 3.76654 18.152 3.41002C17.9922 3.09641 17.7372 2.84144 17.4236 2.68166C17.0671 2.5 16.6004 2.5 15.667 2.5H15.3337C13.4668 2.5 12.5334 2.5 11.8204 2.86331C11.1932 3.18289 10.6832 3.69282 10.3636 4.32003C10.0003 5.03307 10.0003 5.96649 10.0003 7.83333" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="tw-text-[#384250]">Assuntos e BNCC</span>
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="tw-text-sm tw-font-medium tw-gap-2 nav-link" data-toggle="tab" href="#question-print" role="tab">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                          <g clip-path="url(#clip0_1359_3418)">
                            <path d="M15.0003 5.83329V4.33329C15.0003 3.39987 15.0003 2.93316 14.8187 2.57664C14.6589 2.26304 14.4039 2.00807 14.0903 1.84828C13.7338 1.66663 13.2671 1.66663 12.3337 1.66663H7.66699C6.73357 1.66663 6.26686 1.66663 5.91034 1.84828C5.59674 2.00807 5.34177 2.26304 5.18198 2.57664C5.00033 2.93316 5.00033 3.39987 5.00033 4.33329V5.83329M5.00033 15C4.22535 15 3.83786 15 3.51994 14.9148C2.65721 14.6836 1.98335 14.0097 1.75218 13.147C1.66699 12.8291 1.66699 12.4416 1.66699 11.6666V9.83329C1.66699 8.43316 1.66699 7.7331 1.93948 7.19832C2.17916 6.72791 2.56161 6.34546 3.03202 6.10578C3.5668 5.83329 4.26686 5.83329 5.66699 5.83329H14.3337C15.7338 5.83329 16.4339 5.83329 16.9686 6.10578C17.439 6.34546 17.8215 6.72791 18.0612 7.19832C18.3337 7.7331 18.3337 8.43316 18.3337 9.83329V11.6666C18.3337 12.4416 18.3337 12.8291 18.2485 13.147C18.0173 14.0097 17.3434 14.6836 16.4807 14.9148C16.1628 15 15.7753 15 15.0003 15M12.5003 8.74996H15.0003M7.66699 18.3333H12.3337C13.2671 18.3333 13.7338 18.3333 14.0903 18.1516C14.4039 17.9918 14.6589 17.7369 14.8187 17.4233C15.0003 17.0668 15.0003 16.6 15.0003 15.6666V14.3333C15.0003 13.3999 15.0003 12.9332 14.8187 12.5766C14.6589 12.263 14.4039 12.0081 14.0903 11.8483C13.7338 11.6666 13.2671 11.6666 12.3337 11.6666H7.66699C6.73357 11.6666 6.26686 11.6666 5.91034 11.8483C5.59674 12.0081 5.34177 12.263 5.18198 12.5766C5.00033 12.9332 5.00033 13.3999 5.00033 14.3333V15.6666C5.00033 16.6 5.00033 17.0668 5.18198 17.4233C5.34177 17.7369 5.59674 17.9918 5.91034 18.1516C6.26686 18.3333 6.73357 18.3333 7.66699 18.3333Z" stroke="currentColor" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                          </g>
                          <defs>
                            <clipPath id="clip0_1359_3418">
                              <rect width="20" height="20" fill="white"/>
                            </clipPath>
                          </defs>
                        </svg>
                        <span class="tw-text-[#384250]">Impressão</span>
                      </a>
                    </li>
                  </ul>
                  <div class="tab-content tw-pt-5 sm:tw-pt-6" id="myTabContent">
                    <div class="tab-pane fade show active" id="question-data" role="tabpanel" aria-labelledby="home-tab">
                      <div class="row m-0">
                        <div class="col-12 col-md-6{% if question_editing and object.category == 1 %} mb-3{% endif %}">
                          {% if question_editing and object.category == 1 %}
                            <div class="custom-control custom-switch">
                              <input type="checkbox" id="canceled_question" class="custom-control-input">
                              <label for="canceled_question" class="custom-control-label">
                                Questão anulada
                              </label>
                              <small class="form-text text-muted mt-0" style="line-height: initial;">
                                Todas as alternativas serão consideradas corretas e esta questão será anulada em todas as provas as quais a utilizem.
                              </small>
                            </div>
                          {% endif %}
                        </div>
                        <div class="col-12 col-md-6 d-none">
                          <div class="form-group">
                            <label for="{{ form.coordinations.auto_id }}">
                              {{ form.coordinations.label }}
                            </label>
                            {% render_field form.coordinations class="form-control" %}
                            <small class="form-text text-muted">
                              {{ form.coordinations.help_text }}
                            </small>
                            {% if form.coordinations.errors %}
                              <label class="text-danger">
                                {{ form.coordinations.errors.0 }}
                              </label>
                            {% endif %}
                          </div>
                        </div>
                      </div>

                      <div>
                        <select name="category" id="id_category" class="tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" {% if not can_be_updated %}disabled{% endif %}>
                          <option value="1" {% if form.category.value == 1 %}selected{% endif %}>Múltipla escolha</option>
                          <option value="0" {% if form.category.value == 0 %}selected{% endif %}>Discursiva</option>
                          <option value="2" {% if form.category.value == 2 %}selected{% endif %}>Arquivo anexado</option>
                          <option value="3" {% if form.category.value == 3 %}selected{% endif %}>Somatório</option>
                        </select>

                        {% comment %} {% render_field form.category class="tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" %}{% endcomment %}

                        {% if not can_be_updated %}
                          <input type="hidden" name="{{ form.category.name }}" value="{{ form.instance.category }}" />
                        {% endif %}

                        <small class="text-muted">{{ form.category.help_text }}</small>
                        {% if form.category.errors %}
                          <label class="text-danger">{{ form.category.errors.0 }}</label>
                        {% endif %}
                      </div>

                      {% if form.errors or form.non_field_errors %}
                        <div class="row mb-0">
                          <div class="col-12">
                            <div class="alert alert-danger dismissable mt-3">
                              Por favor, revise o formulário e corrija os campos destacados abaixo para continuar.
                            </div>
                          </div>
                        </div>
                      {% endif %}

                      {% if erros %}
                        <div class="row mb-0">
                          <div class="col-12">
                            <div class="alert alert-danger dismissable">
                              {{ erros }}
                            </div>
                          </div>
                        </div>
                      {% endif %}

                      <div class="tw-py-4">
                        {% if not correction_textual_answer and not correction_file_answer %}
                          <div>
                            <div id="selectCompetence" class="custom-control custom-switch">
                              <input type="checkbox" class="custom-control-input" id="checkBoxCorrection">
                              <label class="custom-control-label" for="checkBoxCorrection">
                                <h6 class="mb-0">Correção com competências<span class="badge badge-info ml-1">Atenção</span></h6>
                              </label>
                              <small class="form-text text-muted mt-0">
                                Esse tipo de correção normalmente é utilizado para avaliar redações.
                              </small>
                            </div>
                          </div>
                        {% endif %}
                        <div v-if="selectTextCorrection" class="tw-pt-4">
                          <label for="{{ form.text_correction.auto_id }}">{{ form.text_correction.label }}</label>
                            {% if not correction_textual_answer and not correction_file_answer %}
                              {% render_field form.text_correction class="tw-mt-2 tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" %}
                            {% else %}
                              {% render_field form.text_correction class="tw-mt-2 tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" disabled="disabled"  %}
                              <input type="hidden" name="{{ form.text_correction.name }}" value="{{ form.instance.text_correction.id }}">
                            {% endif %}
                            <small class="form-text text-muted">
                              {{ form.text_correction.help_text }}
                            </small>
                            {% if form.text_correction.errors %}
                              <label class="text-danger">
                                {{ form.text_correction.errors.0 }}
                              </label>
                            {% endif %}
                          </label>
                        </div>
                      </div>

                      <div>
                        {% for error in obligation_error.has_corrent_alternative %}
                          <h6 class="text-danger">{{ error.message }}</h6>
                        {% endfor %}
                        <div class="alert" :class="{ 'alert-success': formatter.status == 'success', 'alert-danger': formatter.status == 'error'}" v-if="formatter.status != 'iddle'">
                          <p v-if="formatter.status == 'success'" class="mb-0">A formatação foi concluída com sucesso.</p>
                          <p v-if="formatter.status == 'error'" class="mb-0">
                            Ocorreu um erro ao tentar formatar a questão, tente novamente. 
                            <br />
                            <div id="errorCode"></div>
                          </p>
                        </div>

                        <!-- <label class="font-weight-bold" for="">{{ form.enunciation.label }}</label>   -->

                        <div v-if="{{ can_be_updated|lower }}">
                          <!-- <p class="text-muted mb-0">
                            <span class="font-weight-bold">Importante:</span>
                            <span>
                              Não adicione o número da questão no enunciado;
                              <br />
                              Para melhor experiência do aluno limpe a formatação do texto clicando no ícone.
                              <svg width="24" height="24">
                                <path d="M13.2 6a1 1 0 010 .2l-2.6 10a1 1 0 01-1 .8h-.2a.8.8 0 01-.8-1l2.6-10H8a1 1 0 110-2h9a1 1 0 010 2h-3.8zM5 18h7a1 1 0 010 2H5a1 1 0 010-2zm13 1.5L16.5 18 15 19.5a.7.7 0 01-1-1l1.5-1.5-1.5-1.5a.7.7 0 011-1l1.5 1.5 1.5-1.5a.7.7 0 011 1L17.5 17l1.5 1.5a.7.7 0 01-1 1z" fill-rule="evenodd">
                                </path>
                              </svg> abaixo
                            </span>
                          </p>
                          <small class="form-text text-muted">
                            {{ form.enunciation.help_text }}
                          </small> -->
                        </div>
                        <div v-else>
                          <div class="alert alert-warning d-flex align-items-center mt-3" role="alert">
                            <i data-feather="alert-circle" class="mg-r-10"></i> Enunciado e texto das alternativas não podem ser alterados pois já foram utilizados em uma aplicação e possui respostas associadas.
                          </div>
                        </div>

                        {% comment %}{% render_field form.enunciation %}{% endcomment %}

                        <textarea id="{{ form.enunciation.auto_id }}" name="{{ form.enunciation.html_name }}" rows="3" placeholder="Enunciado" style="border-width: 0px;">{{ form.enunciation.value|default_if_none:"" }}</textarea>

                        {% for error in form.enunciation.errors %}
                          <label class="text-danger">
                            {{ error }}
                          </label>
                        {% endfor %}
                      </div>
                      <!-- <div class="row">
                        <div class="col-12">
                          <p class="text-muted">
                            <span>
                              <span class="font-weight-bold">Importante:</span> 
                              Não adicione a letra da alternativa;
                              <br />
                              Selecione o conteúdo da alternativa e limpe a formatação clicando em 
                              <svg width="24" height="24">
                                <path d="M13.2 6a1 1 0 010 .2l-2.6 10a1 1 0 01-1 .8h-.2a.8.8 0 01-.8-1l2.6-10H8a1 1 0 110-2h9a1 1 0 010 2h-3.8zM5 18h7a1 1 0 010 2H5a1 1 0 010-2zm13 1.5L16.5 18 15 19.5a.7.7 0 01-1-1l1.5-1.5-1.5-1.5a.7.7 0 011-1l1.5 1.5 1.5-1.5a.7.7 0 011 1L17.5 17l1.5 1.5a.7.7 0 01-1 1z" fill-rule="evenodd"></path>
                              </svg> nos formulários abaixo!
                            </span>
                          </p>
                        </div>
                      </div> -->
                      <div id="row-alternatives" class="tw-flex tw-flex-col tw-pt-4 tw-gap-2">
                        {% for question_option_form in question_option_formset %}
                          {% if not object or can_be_updated or object and question_option_form.instance.pk and question_option_form.instance.text %}
                            <div class="tw-flex tw-justify-center tw-items-center tw-rounded tw-px-4 tw-py-1" style="background-color: rgb(249, 250, 250);">
                              <div>
                                {{ question_option_form.id }}
                                <div class="custom-control custom-switch">
                                  {% render_field question_option_form.is_correct class="custom-control-input check-is-correct" %}
                                  <label class="custom-control-label" for="{{ question_option_form.is_correct.auto_id }}">
                                    <!-- {{ question_option_form.is_correct.label }} -->
                                    &nbsp;
                                  </label>
                                  <!-- <small class="form-text text-muted mt-0" style="line-height: initial;">
                                    {{ question_option_form.is_correct.help_text }}
                                  </small> -->
                                </div>
                              </div>
                              <div class="w-100">
                                <div>
                                  {% comment %}{% render_field question_option_form.text class="form-control question-option" %}{% endcomment %}

                                  <textarea id="{{ question_option_form.text.auto_id }}" name="{{ question_option_form.text.html_name }}" rows="2" placeholder="Alternativa..." style="border-width: 0px;">{{ question_option_form.text.value|default_if_none:"" }}</textarea>

                                  <small class="text-muted">
                                    {{ question_option_form.text.help_text }}
                                  </small>
                                  {% if question_option_form.text.errors %}
                                    <label class="text-danger">
                                      {{ question_option_form.text.errors.0 }}
                                    </label>
                                  {% endif %}
                                </div>
                              </div>
                              <div>
                                <div class="d-none">
                                  {% if question_option_form.instance.created_at and forloop.counter > 2 %}
                                    {{ question_option_form.DELETE }}
                                  {% endif %}
                                </div>
                                {% if forloop.counter > 2 and can_be_updated %}
                                  <a href="#" @click.prevent.default="removeQuestionOption( {{ forloop.counter0 }} )">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                      <path d="M15 5L5 15M5 5L15 15" stroke="#D0D3D9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                  </a>
                                {% endif %}
                              </div>
                            </div>
                          {% endif %}
                        {% endfor %}
                      </div>
                      <div class="tw-pt-4">
                        <button
                          type="button"
                          class="tw-group tw-flex tw-font-semibold tw-text-sm tw-leading-6 hover:tw-text-slate-900"
                          :class="[selectedBaseTexts.length > 0 ? 'tw-text-primary-600' : 'tw-text-slate-400']"
                          data-toggle="modal"
                          data-target="#modalBaseTexts"
                        >
                          <svg viewBox="0 0 20 20" fill="none" class="tw-overflow-visible tw-mr-3 tw-text-slate-400 tw-w-auto tw-h-6 group-hover:tw-text-slate-600">
                            <path d="M16.6663 8.75008V5.66675C16.6663 4.26662 16.6663 3.56655 16.3939 3.03177C16.1542 2.56137 15.7717 2.17892 15.3013 1.93923C14.7665 1.66675 14.0665 1.66675 12.6663 1.66675H7.33301C5.93288 1.66675 5.23281 1.66675 4.69803 1.93923C4.22763 2.17892 3.84517 2.56137 3.60549 3.03177C3.33301 3.56655 3.33301 4.26662 3.33301 5.66675V14.3334C3.33301 15.7335 3.33301 16.4336 3.60549 16.9684C3.84517 17.4388 4.22763 17.8212 4.69803 18.0609C5.23281 18.3334 5.93288 18.3334 7.33301 18.3334H9.99967M11.6663 9.16675H6.66634M8.33301 12.5001H6.66634M13.333 5.83341H6.66634M14.9997 17.5001V12.5001M12.4997 15.0001H17.4997" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                          <template v-if="selectedBaseTexts.length > 0">
                            ${selectedBaseTexts.length} texto(s) base adicionado
                          </template>
                          <template v-else>
                            Adicionar texto base
                          </template>
                        </button>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="question-feedback" role="tabpanel" aria-labelledby="feedback-tab">
                      <div class="tw-bg-[#F9FAFA] tw-rounded-xl tw-border tw-border-[#E5E7EA] tw-p-10">
                        <div class="tw-grid tw-grid-cols-1 tw-gap-x-6 tw-gap-y-6 sm:tw-grid-cols-6">
                          <div class="tw-col-span-full">
                            <label for="{{ form.commented_awnser.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                              {{ form.commented_awnser.label }}
                            </label>
                            <div class="tw-mt-2">
                              <textarea id="{{ form.commented_awnser.auto_id }}" name="{{ form.commented_awnser.html_name }}" rows="3" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Digite aqui">
                                {{ form.commented_awnser.value|default_if_none:"" }}
                              </textarea>
                              {% if form.commented_awnser.errors %}
                                {% for error in form.commented_awnser.errors %}
                                  <label class="text-danger">{{ error }}</label>
                                {% endfor %}
                              {% endif %}
                            </div>
                          </div>
                          <div class="tw-col-span-full">
                            <label for="{{ form.feedback.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                              {{ form.feedback.label }}
                            </label>
                            <div class="tw-mt-2">
                              <textarea id="{{ form.feedback.auto_id }}" name="{{ form.feedback.html_name }}" rows="3" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Digite aqui">
                                {{ form.feedback.value|default_if_none:"" }}
                              </textarea>
                              {% if form.feedback.errors %}
                                <label class="text-danger">{{ form.feedback.errors.0 }}</label>
                              {% endif %}
                            </div>
                          </div>
                          <div v-if="canAddSupportContentDiscursiveQuestions" class="tw-col-span-full">
                            <label for="{{ form.support_content_question.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900">
                              {{ form.support_content_question.label }}
                            </label>
                            {% render_field form.support_content_question class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" %}
                            {% if form.support_content_question.errors %}
                              {% for error in form.support_content_question.errors %}
                                <label class="text-danger">{{ error }}</label>
                              {% endfor %}
                            {% endif %}
                          </div>
                          <div class="tw-col-span-full">
                            <fieldset>
                              <legend class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900 tw-mb-0">
                                Resposta comentada em vídeo
                              </legend>
                              <div class="tw-mt-2 tw-grid tw-grid-cols-1 tw-gap-x-6 tw-gap-y-8 sm:tw-grid-cols-6">
                                <div class="sm:tw-col-span-1">
                                  <label for="{{ form.answer_video_type.id_for_label }}" class="tw-sr-only">{{ form.answer_video_type.label }}</label>
                                  <div>
                                    {% render_field form.answer_video_type class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-max-w-xs sm:tw-text-sm sm:tw-leading-6" %}
                                    {% if form.answer_video_type.errors %}
                                      <label class="text-danger">{{ form.answer_video_type.errors.0 }}</label>
                                    {% endif %}
                                  </div>
                                </div>
                                <div class="sm:tw-col-span-5">
                                  <label for="{{ form.answer_video.id_for_label }}" class="tw-sr-only">{{ form.answer_video.label }}</label>
                                  <div>
                                    <input type="text" name="{{ form.answer_video.html_name }}" id="{{ form.answer_video.auto_id }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" />
                                    {% if form.answer_video.errors %}
                                      <label class="text-danger">{{ form.answer_video.errors.0 }}</label>
                                    {% endif %}
                                  </div>
                                </div>
                              </div>
                            </fieldset>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="question-subject" role="tabpanel" aria-labelledby="profile-tab">
                      <div class="tw-bg-[#F9FAFA] tw-rounded-xl tw-border tw-border-[#E5E7EA] tw-p-10">
                        <div class="tw-space-y-8 tw-pb-12 sm:tw-space-y-6 sm:tw-pb-0">
                          <div class="sm:tw-grid sm:tw-grid-cols-3 sm:tw-items-start sm:tw-gap-4">
                            <label for="selectLevel" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900 sm:tw-pt-1.5">Segmento</label>
                            <div class="tw-mt-2 sm:tw-col-span-2 sm:tw-mt-0">
                              <select id="selectLevel" name="selectLevel" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="selectedLevel">
                                <option value="0">Ensino médio</option>
                                <option value="1">Ensino fundamental 1</option>
                                <option value="2">Ensino fundamental 2</option>
                              </select>
                            </div>
                          </div>
                          <div class="sm:tw-grid sm:tw-grid-cols-3 sm:tw-items-start sm:tw-gap-4">
                            <label for="selectGrade" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900 sm:tw-pt-1.5">Ano/Série</label>
                            <div class="tw-mt-2 sm:tw-col-span-2 sm:tw-mt-0">
                              <select id="selectGrade" name="grade" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="selectedGrade" :required="clientTeacherObligation.pedagogicalData">
                                <option value="">Selecione um ano/série</option>
                                <option v-for="grade in grades" :value="grade.id" v-html="grade.name"></option>
                              </select>
                              {% for error in obligation_error.grade %}
                                <small class="text-danger">{{ error.message }}</small>
                              {% endfor %}
                            </div>
                          </div>
                          <div class="sm:tw-grid sm:tw-grid-cols-3 sm:tw-items-start sm:tw-gap-4">
                            <label for="selectArea" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900 sm:tw-pt-1.5">Área de conhecimento</label>
                            <div class="tw-mt-2 sm:tw-col-span-2 sm:tw-mt-0">
                              <select id="selectArea" name="selectArea" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="selectedArea" :required="clientTeacherObligation.pedagogicalData">
                                <option value="">Selecione uma área de conhecimento</option>
                                <option v-for="selectedArea in knowledgeAreas" :value="selectedArea.id" v-html="selectedArea.name"></option>
                              </select>
                            </div>
                          </div>
                          <div class="sm:tw-grid sm:tw-grid-cols-3 sm:tw-items-start sm:tw-gap-4">
                            <label for="selectSubject" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900 sm:tw-pt-1.5">Disciplina</label>
                            <div class="tw-mt-2 sm:tw-col-span-2 sm:tw-mt-0">
                              <select id="selectSubject" name="subject" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="selectedSubject" :required="clientTeacherObligation.pedagogicalData">
                                <option value="">Selecione uma disciplina</option>
                                <option v-for="subject in subjects" :value="subject.id" v-html="subject.name"></option>
                              </select>
                              {% for error in obligation_error.subject %}
                                <small class="text-danger">{{ error.message }}</small>
                              {% endfor %}
                            </div>
                          </div>
                          <div class="sm:tw-grid sm:tw-grid-cols-3 sm:tw-items-start sm:tw-gap-4">
                            <label for="{{ form.level.id_for_label }}" class="tw-block tw-text-sm tw-font-medium tw-leading-6 tw-text-gray-900 sm:tw-pt-1.5">{{ form.level.label }}</label>
                            <div class="tw-mt-2 sm:tw-col-span-2 sm:tw-mt-0">
                              <select id="{{ form.level.auto_id }}" name="{{ form.level.html_name }}" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" v-model="level" :required="clientTeacherObligation.difficult">
                                <option value="0">Fácil</option>
                                <option value="1">Médio</option>
                                <option value="2">Difícil</option>
                                <option value="3" v-if="!clientTeacherObligation.difficult">Indefinido</option>
                              </select>
                              {% for error in obligation_error.difficult %}
                                <small class="text-danger">{{ error.message }}</small>
                              {% endfor %}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="question-bncc" role="tabpanel" aria-labelledby="contact-tab">
                      <!-- <h5>
                        BNCC - Habilidade e Competências
                      </h5> -->
                      <div>
                        <div class="d-flex justify-content-between tw-mb-0 tw-ml-0">
                          <h5 class="tw-pt-2 tw-font-medium">Assuntos Abordados</h5>
                          {% if 'questions.can_add_subject_question' in  user.get_all_permissions or 'subjects.add_topic' in user.get_all_permissions %}
                            <button id="bt_create_topic" type="button" data-toggle="tooltip" :title="tooltipTitle" :disabled="!enableRegistration" @click="openModalCreateTopic" class="btn btn-primary">
                              <i class="fas fa-plus"></i> Cadastrar Assunto
                            </button>
                          {% endif %}
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <div class="form-group">
                              <label for="">Buscar assuntos disponíveis</label>
                              <input placeholder="Digite aqui o assunto que você está procurando" type="text" v-model="searchTopic" class="form-control" :required="clientTeacherObligation.topics && !currentTopics.length">
                              {% for error in obligation_error.topics %}
                                <small class="text-danger">{{error.message}}</small>
                              {% endfor %}
                            </div>
                          </div>
                          <input v-for="topicId in currentTopics" type="hidden" :value="topicId" name="topics">
                          <div class="col-6" style="margin-bottom: 1rem;" v-for="stage in topicsRegrouped">
                            <h6>
                              Assuntos (${stage.name})
                              <span class="text-muted small">Assuntos abordados nessa questão</span>
                            </h6>
                            <details v-for="theme in stage.themes" open>
                              <summary class="d-flex align-items-center cursor-pointer" style="padding: 0.5rem 1rem;">
                                <span class="mr-2 rotate-icon transition">&#9654;</span>
                                <div class="custom-control custom-checkbox font-weight-bold">
                                  <input
                                    type="checkbox"
                                    class="custom-control-input"
                                    :id="'stage_' + stage.id + '_theme_' + (theme.id || 'null')"
                                    :checked="isThemeChecked(theme)"
                                    @change="toggleTheme(theme, $event)"
                                  />
                                  <label class="custom-control-label" :for="'stage_' + stage.id + '_theme_' + (theme.id || 'null')">
                                    ${theme.name}
                                  </label>
                                </div>
                              </summary>
                              <details v-for="mainTopic in theme.mainTopics" class="ml-3" open>
                                <summary class="d-flex align-items-center cursor-pointer" style="padding: 0.5rem 1rem;">
                                  <span class="mr-2 rotate-icon transition">&#9654;</span>
                                  <div class="custom-control custom-checkbox">
                                    <input
                                      type="checkbox"
                                      class="custom-control-input"
                                      :id="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null')"
                                      :checked="isMainTopicChecked(mainTopic)"
                                      @change="toggleMainTopic(mainTopic, $event)"
                                    />
                                    <label class="custom-control-label" :for="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null')">
                                      ${mainTopic.name}
                                    </label>
                                  </div>
                                </summary>
                                <div v-for="topic in mainTopic.topics" class="ml-4">
                                  <div style="padding: 0.5rem 1rem;">
                                    <div class="custom-control custom-checkbox">
                                      <input
                                        type="checkbox"
                                        class="custom-control-input"
                                        :id="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null') + '_topic_' + topic.id"
                                        :value="topic.id"
                                        v-model="currentTopics"
                                      />
                                      <label class="custom-control-label" :for="'stage_' + stage.id + '_theme_' + (theme.id || 'null') + '_mainTopic_' + (mainTopic.id || 'null') + '_topic_' + topic.id">
                                        ${topic.name}
                                      </label>
                                    </div>
                                  </div>
                                </div>
                              </details>
                            </details>
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-6">
                          <div class="form-group">
                            <label for="">Buscar competências disponíveis</label>
                            {% if 'questions.can_add_ability_and_competence_question' in  user.get_all_permissions or 'subjects.add_topic' in user.get_all_permissions %}
                              <div class="d-flex justify-content-between">
                                <input placeholder="Digite aqui a competência que está procurando" type="text" v-model="searchCompetence" class="form-control" :required="clientTeacherObligation.competences && !currentCompetences.length">
                                  {% for error in obligation_error.competences %}
                                    <small class="text-danger">{{error.message}}</small>
                                  {% endfor %}
                                <button id="bt_create_competence" type="button"  data-toggle="tooltip" :title="tooltipTitleCompetence"  :disabled="!enableRegistration" @click="openModalCreateCompetence" class="ml-2 btn btn-primary">
                                  <i class="fas fa-plus" ></i> 
                                </button>
                              </div>
                              {% else %}
                              <div class="d-flex justify-content-between">
                                <input placeholder="Digite aqui a competência que está procurando" type="text" v-model="searchCompetence" class="form-control" :required="clientTeacherObligation.competences && !currentCompetences.length">
                                  {% for error in obligation_error.competences %}
                                    <small class="text-danger">{{error.message}}</small>
                                  {% endfor %}
                              </div>
                            {% endif %}
                          </div>
                          <table class="table table table-bordered table-sm table-hover">
                            <thead>
                              <tr>
                                <th>Competências
                                  <span class="text-muted small">Competências necessárias para realizar esta questão</span>
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <input v-for="competence in currentCompetences" v-if="competence.id" type="hidden" :value="competence.id" name="competences">
                              <tr v-for="competence in filterCompetences">
                                <td>
                                  <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" :id="'competence_'+competence.id"
                                      :value="competence.id" :checked="checkExist(competence.id, currentCompetences)"
                                      name="competences_reference"
                                      @change="checkOption(competence, currentCompetences, $event)">
                                    <label class="custom-control-label" :for="'competence_'+competence.id">
                                      ${competence.text}
                                    </label>
                                  </div>
                                </td>
                              <tr v-if="!competences.length > 0">
                                <td>Não há competências disponíveis</td>
                              </tr>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                        <div class="col-6">
                          <div class="form-group">
                            <label for="">Buscar habilidades disponíveis</label>
                            {% if 'questions.can_add_ability_and_competence_question' in  user.get_all_permissions or 'subjects.add_topic' in user.get_all_permissions %}
                              <div class="d-flex justify-content-between">
                                <input placeholder="Digite aqui a habilidade que está procurando" type="text" v-model="searchAbility" class="form-control" :required="clientTeacherObligation.abilities && !currentAbilities.length">
                                  {% for error in obligation_error.abilities %}
                                      <small class="text-danger">{{error.message}}</small>
                                  {% endfor %}
                                  <button id="bt_create_ability" type="button"  data-toggle="tooltip" :title="tooltipTitleAbility"  :disabled="!enableRegistration" @click="openModalCreateAbility" class="ml-2 btn btn-primary">
                                    <i class="fas fa-plus" ></i> 
                                  </button>
                              </div>
                              {% else %}
                              <div class="d-flex justify-content-between">
                                <input placeholder="Digite aqui a habilidade que está procurando" type="text" v-model="searchAbility" class="form-control" :required="clientTeacherObligation.abilities && !currentAbilities.length">
                                {% for error in obligation_error.abilities %}
                                    <small class="text-danger">{{error.message}}</small>
                                  {% endfor %}
                              </div>
                            {% endif %}
                            {% comment %} <div class= "d-flex justify-content-between">
                              <input placeholder="Digite aqui a habilidade que está procurando" type="text" v-model="searchAbility" class="form-control" :required="clientTeacherObligation.abilities && !currentAbilities.length">
                              {% for error in obligation_error.abilities %}
                                <small class="text-danger">{{error.message}}</small>
                              {% endfor %}
                              <button id="bt_create_ability" type="button"  data-toggle="tooltip" :title="tooltipTitleAbility"  :disabled="!enableRegistration" @click="openModalCreateAbility" class="ml-2 btn btn-primary">
                                <i class="fas fa-plus" ></i> 
                              </button>
                            </div> {% endcomment %}
                          </div>
                          <table class="table table table-bordered table-sm table-hover">
                            <thead>
                              <tr>
                                <th>Habilidades
                                  <span class="text-muted small">Habilidades necessárias para realizar esta questão</span>
                                </th>
                              </tr>
                            </thead>
                            <tbody>
                              <input v-for="ability in currentAbilities" v-if="ability.id" type="hidden" :value="ability.id"
                                name="abilities">
                              <tr v-for="ability in filterAbilities">
                                <td>
                                  <div class="custom-control custom-checkbox">
                                    <input type="checkbox" class="custom-control-input" :id="'ability_'+ability.id"
                                      :value="ability.id" :checked="checkExist(ability.id, currentAbilities)"
                                      name="abilities_reference" @change="checkOption(ability, currentAbilities, $event)">
                                    <label class="custom-control-label" :for="'ability_'+ability.id">
                                      (${ability.code}) ${ability.text}
                                    </label>
                                  </div>
                                </td>
                              </tr>
                              <tr v-if="!abilities.length > 0">
                                <td>Não há habilidades disponíveis</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                    <div class="tab-pane fade" id="question-print" role="tabpanel" aria-labelledby="contact-tab">
                      <!-- <h5>Configuração de impressão</h5> -->
                      <div class="row">
                        <div class="col-6 col-md-4">
                          <div class="custom-control custom-switch ">
                            {% render_field form.print_only_enunciation class="custom-control-input" %}
                            <label class="custom-control-label" for="{{form.print_only_enunciation.auto_id}}">
                              <i class="fas fa-print"></i>
                              {{ form.print_only_enunciation.label }}</label>
                            <small class="form-text text-muted mt-0" style="line-height: initial;">
                              {{ form.print_only_enunciation.help_text }}
                            </small>
                            {% if form.print_only_enunciation.errors %}
                            <label class="text-danger">
                              {{ form.print_only_enunciation.errors.0 }}
                            </label>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-6 col-md-4">
                          <div class="custom-control custom-switch ">
                            {% render_field form.break_enunciation class="custom-control-input" %}
                            <label class="custom-control-label" for="{{form.break_enunciation.auto_id}}">
                              <i class="fas fa-print"></i>
                              {{ form.break_enunciation.label }}</label>
                            <small class="form-text text-muted mt-0" style="line-height: initial;">
                              {{ form.break_enunciation.help_text }}
                            </small>
                            {% if form.break_enunciation.errors %}
                            <label class="text-danger">
                              {{ form.break_enunciation.errors.0 }}
                            </label>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-6 col-md-4">
                          <div class="custom-control custom-switch ">
                            {% render_field form.force_one_column class="custom-control-input" %}
                            <label class="custom-control-label" for="{{form.force_one_column.auto_id}}">
                              <i class="fas fa-print"></i>
                              {{ form.force_one_column.label }}</label>
                            <small class="form-text text-muted mt-0" style="line-height: initial;">
                              {{ form.force_one_column.help_text }}
                            </small>
                            {% if form.force_one_column.errors %}
                            <label class="text-danger">
                              {{ form.force_one_column.errors.0 }}
                            </label>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-6 col-md-4">
                          <div class="custom-control custom-switch ">
                            {% render_field form.force_choices_with_statement class="custom-control-input" %}
                            <label class="custom-control-label" for="{{form.force_choices_with_statement.auto_id}}">
                              <i class="fas fa-print"></i>
                              {{ form.force_choices_with_statement.label }}</label>
                            <small class="form-text text-muted mt-0" style="line-height: initial;">
                              {{ form.force_choices_with_statement.help_text }}
                            </small>
                            {% if form.force_choices_with_statement.errors %}
                            <label class="text-danger">
                              {{ form.force_choices_with_statement.errors.0 }}
                            </label>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                      <div class="row mb-0">
                        <div class="col-6 col-md-4">
                          <div class="form-group">
                            <label for="{{ form.text_question_format.auto_id }}">
                              <i class="fas fa-bars"></i>
                              {{ form.text_question_format.label }}</label>
                            {% render_field form.text_question_format class="form-control" %}
                            <small class="form-text text-muted">
                              {{ form.text_question_format.help_text }}
                            </small>
                            {% if form.text_question_format.errors %}
                            <label class="text-danger">
                              {{ form.text_question_format.errors.0 }}</label>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                      <div class="row mb-0">
                        <div class="col-6 col-md-4">
                          <div class="form-row">
                            <div class="form-group">
                              <label for="{{ form.quantity_lines.auto_id }}">
                                <i class="fas fa-bars"></i>
                                {{ form.quantity_lines.label }}</label>
                              {% render_field form.quantity_lines class="form-control" %}
                              <small class="form-text text-muted">
                                {{ form.quantity_lines.help_text }}
                              </small>
                              {% if form.quantity_lines.errors %}
                              <label class="text-danger">
                                {{ form.quantity_lines.errors.0 }}</label>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row mb-0">
                        <div class="col-6 col-md-4">
                          <div class="form-row w-75">
                            <div class="form-group">
                              <label for="{{ form.draft_rows_number.auto_id }}">
                                <i class="fas fa-bars"></i>
                                {{ form.draft_rows_number.label }}</label>
                              {% render_field form.draft_rows_number class="form-control" %}
                              <small class="form-text text-muted">
                                {{ form.draft_rows_number.help_text }}
                              </small>
                              {% if form.draft_rows_number.errors %}
                              <label class="text-danger">
                                {{ form.draft_rows_number.errors.0 }}</label>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-6 col-md-4">
                          <div class="custom-control custom-switch ">
                            {% render_field form.force_break_page class="custom-control-input" %}
                            <label class="custom-control-label" for="{{form.force_break_page.auto_id}}">
                              <i class="fas fa-print"></i>
                              {{ form.force_break_page.label }}</label>
                            <small class="form-text text-muted mt-0" style="line-height: initial;">
                              {{ form.force_break_page.help_text }}
                            </small>
                            {% if form.force_break_page.errors %}
                            <label class="text-danger">
                              {{ form.force_break_page.errors.0 }}
                            </label>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-6 col-md-4">
                          <div class="custom-control custom-switch ">
                            {% render_field form.number_is_hidden class="custom-control-input" %}
                            <label class="custom-control-label" for="{{form.number_is_hidden.auto_id}}">
                              <i class="fas fa-print"></i>
                              {{ form.number_is_hidden.label }}</label>
                            <small class="form-text text-muted mt-0" style="line-height: initial;">
                              {{ form.number_is_hidden.help_text }}
                            </small>
                            {% if form.number_is_hidden.errors %}
                            <label class="text-danger">
                              {{ form.number_is_hidden.errors.0 }}
                            </label>
                            {% endif %}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- <div class="d-flex justify-content-start align-items-start mt-3">
                <span class="float-left" v-if="!selectedGrade">
                  <b class="text-danger">Atenção:</b> A questão está sem dados pedagógicos. <br/>
                  <span class="text-muted">
                    Estes dados te ajudarão a gerar análises mais precisas<br /> sobre a performance de seus alunos no
                    futuro.
                  </span>
                </span>
                <input type="hidden" name="selected_tags" id="selected_tags" :value="selectedTags" />
                <input type="hidden" name="status_note" id="status_note" />
                <input type="hidden" name="has_corrent_alternative" :value="has_corrent_alternative" />
              </div> -->
              <template v-for="baseText in selectedBaseTexts">
                <input type="hidden" name="base_texts" :value="baseText.id" />
              </template>
              <div class="tw-mt-6 tw-mb-9">
                <button type="submit" id="button-save-question" class="tw-w-full tw-flex tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600">Salvar questão</button>
              </div>
            </form>
          {% endwith %}

          <!-- <div class="df-settings show">
            <i id="dfSettingsShow" class="df-settings-link fa fa-times"></i>
            <div class="df-settings-body">
              <div class="mt-2">
                <button class="btn btn-sm pd-x-15 btn-white btn-uppercase" data-toggle="modal" data-target="#shortcutFunction">
                  <i class="fas fa-braille"></i> Atalhos <span class="badge badge-light ml-1 font-weight-bold">Ctrl + L</span>
                </button>
              </div>
              {% if user.client_has_question_formatter or user.ispector and user.ispector.has_question_formatter %}
                {% if not object %}
                  <div class="mt-2">
                    <button class="btn btn-sm pd-x-15 btn-white btn-uppercase" data-toggle="modal" data-target="#formatterQuestion">
                      <i class="fas fa-magic"></i> Formatar questão <span class="badge badge-primary ml-1 font-weight-bold">NOVO</span>
                    </button>
                  </div>
                {% endif %}
              {% endif %}
              <div class="mt-2">
                <button id="view-question" class="btn btn-sm pd-x-15 btn-white btn-uppercase"  @click="modalForm(), getSelectedAlternatives(), openModal('viewQuestion')">
                  <i class="far fa-eye"></i> Visualizar questão <span class="badge badge-light ml-1 font-weight-bold">Ctrl + I</span>
                </button>
              </div>
              <div class="mt-2 px-12">
                <button class="btn btn-sm pd-x-15 btn-primary btn-uppercase" type="button" @click="requestStatusTags()">
                  <i class="fas fa-save"></i> Salvar questão <span class="badge badge-light ml-1 font-weight-bold">Ctrl + S</span>
                </button>
              </div>
            </div>
          </div> -->

        </div>
      </div>
    </template>
  </div>
</div>
{% endblock content-fixed %}

{% block extra-modal %}
<div class="modal fade" id="modalHistory" tabindex="-1" role="dialog" aria-labelledby="modalHistoryLabel" aria-hidden="true">
  <div class="modal-dialog sm:tw-max-w-2xl sm:tw-my-8" role="document">
    <div class="modal-content" style="background: inherit; border: inherit; border-radius: inherit;">
      <div class="tw-flex tw-min-h-full tw-items-end tw-justify-center tw-p-4 tw-text-center sm:tw-items-center sm:tw-p-0">
        <div class="tw-relative tw-transform tw-overflow-hidden tw-rounded-lg tw-bg-white tw-text-left tw-shadow-xl tw-transition-all sm:tw-w-full sm:tw-max-w-2xl">
          <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block sm:tw-pt-6 sm:tw-pr-6">
            <button type="button" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" data-dismiss="modal">
              <span class="tw-sr-only">Fechar</span>
              <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div>
            <div>
              <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
                <div class="tw-px-4 tw-pb-4 tw-pt-5 tw-border-b tw-border-[#E5E7EA] sm:tw-p-6">
                  <h3 class="tw-text-lg tw-font-medium tw-leading-6 tw-text-gray-900" id="modal-title">Histórico de alterações</h3>
                </div>
                <div class="tw-px-4 tw-pb-4 sm:tw-pt-1.5 sm:tw-px-6 sm:tw-pb-6">
                  <table class="tw-min-w-full tw-divide-y tw-divide-[#E5E7EA]">
                    <thead>
                      <tr>
                        <th scope="col" class="tw-py-3.5 tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085] sm:tw-pl-0">Modificado por</th>
                        <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085]">Mudanças</th>
                        <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085]">Data</th>
                      </tr>
                    </thead>
                    <tbody class="tw-divide-y tw-divide-[#E5E7EA]">
                      {% for change in object.changes %}
                        <tr>
                          <td class="tw-whitespace-nowrap tw-py-4 tw-pl-4 tw-pr-3 tw-text-base tw-font-semibold tw-text-[#374151] sm:tw-pl-0">
                            {{ change.history_user }}
                          </td>
                          <td class="tw-px-3 tw-py-4 tw-text-sm tw-text-[#384250]">
                            {{ change.fields }}
                          </td>
                          <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-[#384250]">
                            {{ change.history_date|date:"d/m/Y \à\s H:i" }}
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <div class="tw-mt-5 sm:tw-mt-4 sm:tw-flex">
                    <button type="button" class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500" data-dismiss="modal">Fechar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalUses" tabindex="-1" role="dialog" aria-labelledby="modalUsesLabel" aria-hidden="true">
  <div class="modal-dialog sm:tw-max-w-2xl sm:tw-my-8" role="document">
    <div class="modal-content" style="background: inherit; border: inherit; border-radius: inherit;">
      <div class="tw-flex tw-min-h-full tw-items-end tw-justify-center tw-p-4 tw-text-center sm:tw-items-center sm:tw-p-0">
        <div class="tw-relative tw-transform tw-overflow-hidden tw-rounded-lg tw-bg-white tw-text-left tw-shadow-xl tw-transition-all sm:tw-w-full sm:tw-max-w-2xl">
          <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block sm:tw-pt-6 sm:tw-pr-6">
            <button type="button" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" data-dismiss="modal">
              <span class="tw-sr-only">Fechar</span>
              <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          <div>
            <div>
              <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
                <div class="tw-px-4 tw-pb-4 tw-pt-5 tw-border-b tw-border-[#E5E7EA] sm:tw-p-6">
                  <h3 class="tw-text-lg tw-font-medium tw-leading-6 tw-text-gray-900" id="modal-title">Histórico de utilizações</h3>
                </div>
                <div class="tw-px-4 tw-pb-4 sm:tw-pt-1.5 sm:tw-px-6 sm:tw-pb-6">
                  <table class="tw-min-w-full tw-divide-y tw-divide-[#E5E7EA]">
                    <thead>
                      <tr>
                        <th scope="col" class="tw-py-3.5 tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085] sm:tw-pl-0">Caderno</th>
                        <th scope="col" class="tw-whitespace-nowrap tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085]">Data da aplicação</th>
                        <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-normal tw-text-[#667085]">Disciplina</th>
                      </tr>
                    </thead>
                    <tbody class="tw-divide-y tw-divide-[#E5E7EA]">
                      <tr v-for="examQuestion in historicalQuestion">
                        <td class="tw-whitespace-nowrap tw-py-4 tw-pl-4 tw-pr-3 tw-text-base tw-font-semibold tw-text-[#374151] sm:tw-pl-0" :title="examQuestion.exam_name">
                          ${examQuestion.exam_name}
                        </td>
                        <td class="tw-px-3 tw-py-4 tw-text-sm tw-text-[#384250]">
                          <span v-if="examQuestion.application_date">
                            ${momentRef(examQuestion.application_date).format("DD/MM/YYYY")}
                          </span>
                          <span v-if="!examQuestion.application_date">O exame não foi aplicado</span>
                        </td>
                        <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-[#384250]">
                          <span v-if="examQuestion.teacher_name">
                            ${examQuestion.teacher_name} em ${examQuestion.teacher_subject}
                          </span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                  <div class="tw-mt-5 sm:tw-mt-4 sm:tw-flex">
                    <button type="button" class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500" data-dismiss="modal">Fechar</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Modal -->
<div class="modal fade" id="modalBaseTexts" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header py-2">
        <h5 class="modal-title" id="modalBaseTextsLabel">Textos Base</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button> 
      </div>
      <div class="modal-body">
        <div class="card mb-3 pb-0" v-show="addBaseText">
          <div class="row">
            <div class="card-body">
              <div class="col-12">
                <div class="form-group">
                  <label for="base-title">Título</label>
                  <input v-model="newBaseText.title" maxlength="100" class="form-control form-control-sm" id="base-title" placeholder="Digite o título" type="text">
                </div>
              </div>
              <div v-if="alertRequiredField" class="alert alert-warning d-flex align-items-center" role="alert">
                <i data-feather="alert-circle" class="mg-r-10"></i> 
                Todos os campos são obrigatorios! 
              </div>
              <div class="col-12">
                <label for="base-text">Texto base</label>
                {{form_base_texts.text}}
              </div>
              <div class="col-12 mt-3">
                <button class="btn btn-primary m-1" v-if="!editBaseText" @click="createBaseText()" :disabled="!validValueBaseText()"><i class="fas fa-plus"></i> Adicionar</button>
                <button class="btn btn-primary m-1" v-if="editBaseText" @click="updateBaseTextEdit()" :disabled="!validValueBaseText()"><i class="fas fa-plus"></i> Atualizar</button>
                <button class="btn btn-secondary m-1" @click="btnCancelBaseText()">Cancelar</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row" v-show="!addBaseText">
          <div class="col-md-6 order-1 order-md-0">
            <input type="search" v-model="searchBaseText" id="id_search_base_text" class="form-control form-control-sm" placeholder="Pesquisar por texto base">
          </div>
          <div class="col-md-6 order-0 order-md-1">
            <button class="btn btn-success btn-sm float-right mb-2" type="button" @click="startCreationNewBaseText()"><i class="fas fa-plus"></i> Adicionar Novo Texto Base</button>
          </div>
        </div>

        <template v-if="baseTextFounds.length > 0">
          <h5 class="text-muted">Lista de textos base encontrados</h5>
          <div id="accordionBaseTexts">
            <div class="card my-2" v-for="baseText in baseTextFounds">
              <div class="card-header p-0" style="cursor: pointer;">
                <div class="row mb-0 d-flex justify-content-between align-items-center" data-toggle="collapse" :data-target="'#baseText-' +baseText.id" aria-expanded="true" :aria-controls="'baseText-' +baseText.id">
                  <div class="col">
                    <p class="mb-0 p-2 tx-medium">
                      ${baseText.title}
                    </p>
                    <div class="col text-right" id="base_button" >
                      <button type="button" v-if="!baseTextCheckExist(baseText)" @click="deleteBaseText(baseText.id)" class="btn btn-xs btn-danger btn-icon"><i class="fas fa-trash px-2"></i></button>
                      <i v-if="baseTextCheckExist(baseText)" class="far fa-check-circle px-2 text-success"></i>
                      <button type="button"  @click="selectToEdit(baseText)" class="btn btn-xs btn-primary btn-icon"><i class="far fa-edit px-2"></i></button>
                    </div>
                  </div>
                </div>
              </div>

              <div :id="'baseText-' +baseText.id" class="collapse" data-parent="#accordionBaseTexts">
                <div class="card-body pb-0" v-html="baseText.text"></div>

                <div class="row">
                  <div class="col">
                    <template v-if="baseTextCheckExist(baseText)">
                      <button class="btn btn-sm btn-secondary float-right" type="button" @click="selectBaseText(baseText)">Não Usar Este Texto <i class="fas fa-times"></i></button>
                    </template>
                    <template v-else>
                      <button class="btn btn-sm btn-primary float-right mr-2" type="button" @click="selectBaseText(baseText)">Usar Este Texto <i class="far fa-share-square"></i></button>
                    </template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </template>

        <template v-else>
          <template v-if="selectedBaseTexts.length > 0">
            <h5 class="text-muted mb-0 d-flex align-items-center">
              <span class="badge badge-primary mr-2">${selectedBaseTexts.length}</span> Texto(s) base utilizado(s) nesta questão
            </h5>
            <div id="accordionBaseTexts" class="mb-4">
              <div class="card my-2" v-for="baseText in selectedBaseTexts">
                <div class="card-header p-0" style="cursor: pointer;">
                  <div class="row mb-0 d-flex justify-content-between align-items-center" data-toggle="collapse" :data-target="'#baseText-' +baseText.id" aria-expanded="true" :aria-controls="'baseText-' +baseText.id">
                    <div class="col">
                      <p class="mb-0 p-2 tx-medium">
                        ${baseText.title}
                      </p>
                    </div>
                    <div class="col text-right" id="margin_button" v-if="baseTextCheckExist(baseText)">
                      <i class="far fa-check-circle px-2 text-success"></i>
                      <button type="button" @click="selectToEdit(baseText)" class="btn btn-xs btn-primary btn-icon"><i class="far fa-edit px-2"></i></button>
                    </div>
                  </div>
                </div>

                <div :id="'baseText-' +baseText.id" class="collapse" data-parent="#accordionBaseTexts">
                  <div class="card-body pb-0" v-html="baseText.text"></div>
                  
                  <div class="row">
                    <div class="col">
                      <button class="btn btn-sm btn-secondary float-right mr-2" type="button" @click="selectBaseText(baseText)">Não Usar Este Texto <i class="fas fa-times"></i></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>   
          </template>
        
          <h5 class="text-muted">Lista de textos base</h5>
          <div id="accordionBaseTexts">
            <div class="card my-2" v-for="baseText in baseTexts" v-if="!baseTextCheckExist(baseText)">
              <div class="card-header p-0" style="cursor: pointer;">
                <div class="row mb-0 d-flex justify-content-between align-items-center" data-toggle="collapse" :data-target="'#baseText-' +baseText.id" aria-expanded="true" :aria-controls="'baseText-' +baseText.id">
                  <div class="col">
                    <p class="mb-0 p-2 tx-medium">
                      ${baseText.title}
                    </p>
                    <div class="col text-right" id="base_button" v-if="!baseTextCheckExist(baseText)">
                      <button type="button"  @click="deleteBaseText(baseText.id)" class="btn btn-xs btn-danger btn-icon"><i class="fas fa-trash px-2"></i></button>
                      <button type="button" @click="selectToEdit(baseText), goToTop()" class="btn btn-xs btn-primary btn-icon"><i class="far fa-edit px-2"></i></button>
                    </div>
                  </div>
                </div>
              </div>

              <div :id="'baseText-' +baseText.id" class="collapse" data-parent="#accordionBaseTexts">
                <div class="card-body pb-0" v-html="baseText.text"></div>
                
                <div class="row">
                  <div class="col">
                    <button class="btn btn-sm btn-primary float-right mr-2" type="button" @click="selectBaseText(baseText)">Usar Este Texto <i class="far fa-share-square"></i></button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
        </template>
      
      </div>
      
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Concluir</button>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="viewQuestion" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">DETALHES DA QUESTÃO</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body modal-html">

        <div class="alert" :class="{ 'alert-success': formatter.status == 'success' }" v-if="formatter.status != 'iddle'">
          <p v-if="formatter.status == 'success'" class="mb-0">
            A formatação foi concluída com sucesso.
            <br>
            <strong>Se precisar fazer alguma alteração, feche essa janela e edite a questão normalmente.</strong>
          </p>
        </div>

        <div id="question-details" class="mb-3" >
          <ul class="nav nav-tabs mb-4" id="questiontab">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#question-tab" aria-current="page">
                <i class="fas fa-align-right mr-1"></i>
                Enunciado</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#data-tab">
                <i class="fas fa-info-circle  mr-1"></i>
                Dados Pedagógicos <span class="badge badge-secondary ml-1">${currentTopics.length} selecionados</span></a>  
            </li>
          </ul>

          <div class="tab-content">
              <div class="tab-pane fade show active" id="question-tab" role="tabpanel" aria-labelledby="question-tab">
                <div class="container">
                  <i class="fas "></i>
                  <div class="row">
                    <div class="col-12 font-weight-bold">
                      <div class="d-flex justify-content-between align-items-center">
                        <span>
                          <i class="fas fa-check" v-if="categoryForm == 'Objetiva'"></i>
                          <i class="fas fa-align-justify" v-if="categoryForm == 'Discursiva'"></i>
                          <i class="fas fa-folder-plus" v-if="categoryForm == 'Arquivo anexado'"></i>
                          Questão ${categoryForm}
                        </span>
                        <button class="btn btn-sm" :class="contrast ? 'btn-dark':'btn-outline-dark'" title="Ver imagens em preto e branco" @click="contrast = !contrast">${contrast ? 'Visualizar Normal':'Visualizar P&B'} <i class="fas fa-adjust"></i></button>
                      </div>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-12">
                      <div v-if="enunciationForm" :class="{ 'grayscale' : contrast }" v-html="enunciationForm"></div>
                      <div class="tab-pane fade show active" id="question-tab" role="tabpanel" aria-labelledby="question-tab">
                        <div class="mb-2">
                        </div>
                        <table class="table table-sm tx-13 mt-4 mg-b-0">
                          <tbody>
                            <tr v-for="alternative in selectedAlternatives">
                              <td style="border-radius: 0.375rem;"  v-bind:class="alternative.is_correct ? 'bg-success-custom' : ''">
                                <div class="d-flex align-items-center">
                                  <div class="wd-15 ht-15 rounded-circle bd bd-3 mr-2" v-bind:class="alternative.is_correct ? 'border-success' : ''">
                                  </div> 
                                  <div class="w-100 clean-v-html" v-html="alternative.text">
                                  </div>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="tab-pane fade" id="data-tab" role="tabpanel" aria-labelledby="data-tab">
                <div class="row">
                  <div class="col-12">
                    <div class="card">
                      <div class="card-header p-2 font-weight-bold">
                        Assuntos Abordados
                      </div>
                        <table class="table table table-bordered table-sm table-hover">
                          <tr v-for="topic in currentTopicsObj">
                            <td>
                              ${topic.name} 
                            </td>
                            <tr v-if="!topics.length > 0">
                            <td>Não há assuntos disponíveis para esses dados pedagógicos</td>
                          </tr>
                        </table>
                    </div>
                  </div>

                  <div class="col-12">
                    <div class="card mt-2">
                      <div class="card-header p-2 font-weight-bold">
                        Habilidades
                      </div>
                      
                        <table class="table table table-bordered table-sm table-hover">
                          <tr v-for="ability in currentAbilities">
                            <td>
                              ${ability.text}
                            </td>
                          </tr>
                          <tr v-if="!currentAbilities.length > 0">
                            <td>Não há habilidades disponíveis</td>
                          </tr>
                        </table>
                    </div>
                  </div>
                  
                  <div class="col-12">
                    <div class="card mt-2">
                      <div class="card-header p-2 font-weight-bold">
                        Competências
                      </div>
                        <table class="table table table-bordered table-sm table-hover">
                          <tr v-for="competence in currentCompetences">
                            <td>
                              ${competence.text}
                            </td>
                          </tr>
                          <tr v-if="!currentCompetences.length > 0">
                            <td>Não há competências disponíveis</td>
                          </tr>
                        </table>
                    </div>
                  </div>
                </div>
              </div>

          </div>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <div>
          <div role="group" aria-label="Basic example" class="btn-group btn-group-justified">
            <button type="button" class="btn btn-secondary mt-2 " data-dismiss="modal"> Fechar </button>
          </div>
          <div role="group" aria-label="Basic example" class="btn-group btn-group-justified">
            <button class="btn btn-primary mt-2" type="button" data-dismiss="modal" @click="changeTab('#question-subject')">Inserir dados pedagógicos</button>
          </div>
        </div>
        <div>
          <div role="group" aria-label="Basic example" class="btn-group btn-group-justified">
            <button class="btn btn-primary mt-2" type="button" @click="requestStatusTags()">Salvar questão</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal fade shortcut" id="shortcutFunction" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class='col-12 modal-title text-center'>ATALHOS</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">F1</span> Dados da questão 
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">F2</span> Pedagógico e Assuntos 
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">F3</span> BNCC e Matriz ENEM 
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">F4</span> Configuração de impressão
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">F5</span> Histórico
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">F6</span> Utilizações
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">CTRL + L</span> Atalhos
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">CTRL + I</span> Visualizar Questão
        </div>
        <div class="col-12 mt-3">
          <span class="badge badge-light ml-1 font-weight-bold">CTRL + S</span> Salvar questão
        </div>
        <div class="modal-footer bg-light text-right mt-5">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>
</div>
{% if user.client_has_question_formatter or user.ispector and user.ispector.has_question_formatter %}
  <div class="modal fade" id="formatterQuestion" role="dialog" tabindex="-1">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="col-12 modal-title text-center">FORMATADOR DE QUESTÕES</h5>
          <button type="button" class="close" data-dismiss="modal" id="closeFormatterQuestion" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body h-100">
          <div class="alert" :class="{ 'alert-success': formatter.status == 'success', 'alert-danger': formatter.status == 'error'}" v-if="formatter.status != 'iddle'">
            <p v-if="formatter.status == 'success'" class="mb-0">A formatação foi concluída com sucesso.</p>
            <p v-if="formatter.status == 'error'" class="mb-0">Ocorreu um erro ao tentar formatar a questão, tente novamente. <br> <div id="errorCode"></div></p>
          </div>
          <div v-show="!formatter.loading">
            <textarea id="questionFormatterInput"></textarea>
            
            <p class="text-right mt-2">${formatter.tokens}</p>

            <button class="btn btn-primary btn-block mt-3" @click="formatterQuestion()" :disabled="formatter.loading">${ formatter.loading ? 'Aguarde...':'Formatar Questão'}</button>
          </div>
          <div class="row" v-if="formatter.loading">
            <div class="col-12 text-center py-5 text-center">
              <div class="spinner-border text-primary mx-2" role="status">
                <span class="sr-only">Loading...</span>
              </div>
              <h3 class="mt-2">${formatter.fakeStatus}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}

<div class="modal fade" id="modalCreateTopic" role="dialog" tabindex="-1">
  <div class=" modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class='col-12 modal-title text-center'>Cadastrar Assunto</h5>
      </div>
      <div class="modal-body-create-topic">
        <form id="topicCreateTopic">
          {% csrf_token %}
          <div class="col-12 border-bottom pb-3">
            <div class="d-flex justify-content-between mb-2">
                <div>
                    <h6 class="mb-0 text-muted">Disciplina:</h6>
                    <span class="font-weight-normal subject-value"></span>
                </div>
                <div>
                    <h6 class="mb-0 text-muted">Ano/Série:</h6>
                    <span class="font-weight-normal grade-value"></span>
                </div>
            </div>
            <div>
                <h6 class="text-muted">Área de conhecimento:</h6>
                <span class="font-weight-normal area-value"></span>
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="topic" class="mb-0 mt-1">Nome do assunto</label>
              <input type="text" v-model="topicName" id="topic" class="form-control" placeholder="Digite aqui">
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="etapa" class="mb-0 mt-1">Etapa</label>
              <select v-model="stage" id="etapa" class="form-control form-control-sm">
                <option value="" selected>Selecione uma Etapa</option>
                <option value="1">1ª Etapa</option>
                <option value="2">2ª Etapa</option>
                <option value="3">3ª Etapa</option>
                <option value="4">4ª Etapa</option>
                <option value="5">5ª Etapa</option>
                <option value="6">6ª Etapa</option>
                <option value="7">Geral</option>
              </select>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="form-group mb-2">
              <label for="selectedTheme" class="mb-0 mt-1">Tema<small class="text-muted mt-0"> (Opcional)</small></label>
              <div v-show="isAddingNewTheme">
                <div class="d-flex align-items-center">
                  <input type="text" class="form-control" v-model="newThemeName" placeholder="Digite o novo tema">
                  <button class="btn btn-success ml-2" @click.prevent="saveNewTheme('{{ csrf_token }}')">
                    Salvar
                  </button>
                  <button class="btn btn-secondary ml-2" @click.prevent="toggleThemeInput">
                    Cancelar
                  </button>
                </div>
              </div>
              <div v-show="!isAddingNewTheme">
                <div class="d-flex align-items-center">
                  <select class="form-control flex-grow-1" name="theme" id="theme" v-model="selectedTheme">
                    <!-- <option value="" selected>Selecione um Tema</option> -->
                    <!-- <option v-for="theme in themes" :value="theme.id" v-html="theme.name"></option> -->
                  </select>
                  <button class="btn btn-primary ml-2"  title="Cadastar Tópico" data-toggle="tooltip"  @click.prevent="toggleThemeInput">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div> 
          <div class="col-12" >
            <div class="form-group mb-2" id="filderMainTopic" data-toggle="tooltip"  :title="titleMainTopic">
              <label for="selectedMainTopic" class="mb-0 mt-1">Tópico<small class="text-muted mt-0"> (Opcional)</small></label>
              <div v-show="isAddingNewMainTopic">
                <div class="d-flex align-items-center">
                  <input type="text" class="form-control" v-model="newMainTopicName" placeholder="Digite o novo tópico">
                  <button class="btn btn-success ml-2" @click.prevent="saveNewMainTopic('{{ csrf_token }}')">
                    Salvar
                  </button>
                  <button class="btn btn-secondary ml-2" @click.prevent="toggleMainTopicInput">
                    Cancelar
                  </button>
                </div>
              </div>
              <div v-show="!isAddingNewMainTopic">
                <div class="d-flex align-items-center">
                  <select :disabled="!selectedTheme" class="form-control"  name="main_topic" id="main_topic" v-model="selectedMainTopic" >
                    <!-- <option value="" selected>Selecione um Tópico</option> -->
                    <!-- <option v-for="mainTopic in mainTopics" :value="mainTopic.id" v-html="mainTopic.name"></option> -->
                  </select>
                  <button class="btn btn-primary ml-2" data-toggle="tooltip" id="bt_create_main_topic"  :title="tooltipTitleMainTopic" :disabled="!enableMainTopicRegistration" @click.prevent="toggleMainTopicInput">
                    <i class="fas fa-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light text-right">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        <button type="button" class="btn btn-success"  @click="submitForm('{{ csrf_token }}')">Salvar</button>
      </div>
    </div>
  </div>
</div>


<div class="modal fade" id="modalCreateAbility" role="dialog" tabindex="-1">
  <div class=" modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class='col-12 modal-title text-center'>Cadastrar Habilidade</h5>
      </div>
      <div class="modal-body-create-topic mt-3">
        <form >
          {% csrf_token %}
          <div class="col-12 border-bottom pb-3">
            <div class="d-flex justify-content-between mb-2">
                <div>
                    <h6 class="mb-0 text-muted">Disciplina:</h6>
                    <span class="font-weight-normal subject-value"></span>
                </div>
                <div>
                    <h6 class="mb-0 text-muted">Ano/Série:</h6>
                    <span class="font-weight-normal grade-value"></span>
                </div>
            </div>
            <div>
                <h6 class="text-muted">Área de conhecimento:</h6>
                <span class="font-weight-normal area-value"></span>
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="code" class="mb-0 mt-1">Código da Habilidade</label>
              <input type="text" v-model="selectedAbilityCode" id="code" class="form-control" placeholder="Digite aqui">
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="text" class="mb-0 mt-1">Habilidade</label>
              <textarea name="text"v-model="selectedAbility"  cols="40" rows="2" maxlength="4096"  id="text" class="form-control"></textarea>            
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light text-right">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        <button type="button" class="btn btn-success"  @click="submitFormCreateAbility('{{ csrf_token }}')">Salvar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalCreateCompetence" role="dialog" tabindex="-1">
  <div class=" modal-dialog modal-lg modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class='col-12 modal-title text-center'>Cadastrar Competência</h5>
      </div>
      <div class="modal-body-create-topic mt-3">
        <form >
          {% csrf_token %}
          <div class="col-12 border-bottom pb-3">
            <div class="d-flex justify-content-between mb-2">
                <div>
                    <h6 class="mb-0 text-muted">Disciplina:</h6>
                    <span class="font-weight-normal subject-value"></span>
                </div>
                <div>
                    <h6 class="mb-0 text-muted">Ano/Série:</h6>
                    <span class="font-weight-normal grade-value"></span>
                </div>
            </div>
            <div>
                <h6 class="text-muted">Área de conhecimento:</h6>
                <span class="font-weight-normal area-value"></span>
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="code" class="mb-0 mt-1">Código da competência</label>
              <input type="text" v-model="selectedCompetenceCode" id="code" class="form-control" placeholder="Digite aqui">
            </div>
          </div>
          <div class="col-12">
            <div class="form-group mb-2">
              <label for="text" class="mb-0 mt-1">Competência</label>
              <textarea name="text"v-model="selectedCompetence"  cols="40" rows="2" maxlength="4096"  id="text" class="form-control" data-lt-tmp-id="lt-401381"></textarea>            
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer bg-light text-right">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        <button type="button" class="btn btn-success"  @click="submitFormCreateCompetence('{{ csrf_token }}')">Salvar</button>
      </div>
    </div>
  </div>
</div>
{% endblock extra-modal %}

{% block js-additional %}
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/5.3.0/tinymce.min.js"></script>
<script type="text/javascript" src="{% static 'django_custom_tinymce/init_tinymce.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<script src="{% static 'administration/lib/jquery/jquery.min.js' %}"></script>
<script src="{% static 'administration/lib/jquery-steps/build/jquery.steps.min.js' %}"></script>
<script src="{% static 'administration/lib/select2/js/select2.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/lodash@4.17.20/lodash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/choices.js@11.1.0/public/assets/scripts/choices.min.js"></script>
<script>
  function goToTop(){
    $("html, body").animate({ scrollTop: "0"}, 3000);
  }
</script>

<script type="text/javascript">
  var app_question = new Vue({
    delimiters: ['${', '}'],
    el: '#app',
    data: {
      selectedTags: [],
      requestTags: 
      {% if request_tags == 'true' and question.created_by.id != user.id %}
        true
      {% else %}
        false
      {% endif %},
      no_tags: {% if not tags %}true{% else %}false{% endif %},
      historical_tags:[
        {% for record in tags_history %}
          {
            "record_id": '{{record.record_id}}',
            "record_tags": [{% for tag in record.tags.all %} '{{tag.name}}', {% empty %} 'tags não encontradas' {% endfor %}]
          },
        {% endfor %}
      ],
      level: {% if object %} {{object.level}} {% elif form.level.value %} {{form.level.value}} {% else %} 3 {% endif %},
      has_corrent_alternative: false,
      selectedAlternatives: [],
      questionForm: '', 
      enunciationForm: '',
      categoryForm: '',
      searchTopic: "",
      searchCompetence: "",
      searchAbility: "",
      searchThemes: "",
      topicName: "",
      stage: "",
      grades: [],
      knowledgeAreas: [],
      subjects: [],
      competences: [],
      abilities: [],
      topics: [],
      themes: [],
      mainTopics:[],
      isAddingNewMainTopic: false,
      newMainTopicName: '',
      isAddingNewTheme: false,
      newThemeName: '',
      currentGrade: "{{form.instance.grade.pk|default:current_grade|default:''}}",
      currentKnowledgeArea: "{{form.instance.subject.knowledge_area.pk|default:current_knowledge_area|default:''}}",
      current_subject: "{{form.instance.subject.pk|default:current_subject|default:''}}",
      searchQuery: '',
      selectedLevel: "0",
      selectedGrade: "",
      selectedArea:"",
      selectedSubject:"",
      selectedTopic: "",
      selectedCompetenceCode: "",
      selectedCompetence: "",
      selectedAbility:  "",
      selectedAbilityCode: "",
      selectedTheme: "",
      selectedMainTopic: "",
      alternaticves: "",
  
      currentTopics: [
        {% for topic in form.instance.topics.all %}
          {
            id:'{{topic.id}}',
            name:'{{topic.name|remove_line_break|safe}}'
          },
        {% endfor %}
      ],
      currentCompetences: [
        {% if form.competences.value %}
          {% for competence in form.competences.value %}
            {
              id:'{{competence}}',
              text: ''
            },
          {% endfor %}
        {% else %}
          {% for competence in form.instance.competences.all %}
            {
              id:'{{competence.id}}',
              text:'{{competence.text|remove_line_break|safe}}'
            },  
          {% endfor %}
        {% endif %}
      ],
      currentAbilities: [
        {% if form.competences.value %}
          {% for ability in form.abilities.value %}
            {
              id:'{{ability}}',
              text: ''
            },
          {% endfor %}
        {% else %}
          {% for ability in form.instance.abilities.all %}
            {
              id:'{{ability.id}}',
              text:'{{ability.text|remove_line_break|safe}}'
            },  
          {% endfor %}
        {% endif %}
      ],
      teste: [],
      historicalQuestion: '',
      baseTexts: [],
      selectedBaseText: '',
      selectedBaseTexts: [
        {% for base_text in base_texts %}
          {
            id: "{{base_text.id}}",
            title: "{{base_text.title}}",
            text: "{{base_text.text_escaped|remove_line_break|safe}}",
          },
        {% endfor %}
      ],
      newBaseText: {
        title: '',  
        text: '',  
      },
      searchBaseText: '',
      baseTextFounds: [],
      addBaseText: false,
      editBaseText: false,
      alertRequiredField: false,
      selectCompetence: false,
      selectTextCorrection: false,
      textCorrection: {% if object.text_correction %}true{% else %}false{% endif %},
      contrast: false,
      clientTeacherObligation: {
        {% if object and object.grade %}
          {% with user|get_teacher_obligation:object.grade.level as teacher_obligation %}
            template: {{teacher_obligation.template|default:False|lower}},
            topics: {{teacher_obligation.topics|default:False|lower}},
            abilities: {{teacher_obligation.abilities|default:False|lower}},
            competences: {{teacher_obligation.competences|default:False|lower}},
            difficult: {{teacher_obligation.difficult|default:False|lower}},
            pedagogical_data: {{teacher_obligation.pedagogical_data|default:False|lower}},
            commentedResponse: {{teacher_obligation.commented_response|default:False|lower}},
            apply_on_homework: {{teacher_obligation.apply_on_homework|default:False|lower}},
          {% endwith %}
        {% else %}
          template: false,
          topics: false,
          abilities: false,
          competences: false,
          difficult: false,
          pedagogical_data: false,
          commentedResponse: false,
          apply_on_homework: false,
        {% endif %}
      },
      formatter: {
        loading: false,
        status: 'iddle',
        fakeStatus: '',
        statusList: [
          'Analisando conteúdo da questão...', 
          'Identificando enunciado e alternativas...', 
          'Formatando questão...', 
          'Revisando formatação da questão...',
          'Estamos quase lá...',
          'Finalizando criação da questão...',
        ],
        statusCopy: [],
        interval: null,
        tokens: 0,
        maxTokens: 3000
      },
      canAddSupportContentDiscursiveQuestions: {{ user.questions_configuration.can_add_support_content_discursive_questions|lower|default:"false" }},

      tinyMCEDefaults: {{tinymce_configs|safe}},

      customToolbarStatus: 'idle',
      choicesRefThemes: null,
      choicesRefMainTopics: null,
    },
    watch: {
      themes: function(value) {
        this.choicesRefThemes.destroy()
        let elementTheme = document.getElementById('theme')
        this.choicesRefThemes = new Choices(elementTheme, {
          placeholderValue: 'Selecione um Tema',
          removeItemButton: true,
          classNames: {
            containerOuter: ['choices', 'w-100', 'mb-0'],
            containerInner: ['choices__inner', 'custom-choices__inner'],
            listSingle: ['choices__list--single', 'custom-choices__list--single'],
          },
        })
        this.choicesRefThemes.clearChoices()
        let choices = value.map(theme => ({ value: theme.id, label: theme.name }))
        this.choicesRefThemes.setChoices(
          choices,
          'value',
          'label',
          false,
        )
        this.choicesRefThemes.setChoiceByValue(this.selectedTheme)
      },
      mainTopics: function(value) {
        this.choicesRefMainTopics.destroy()
        let elementMainTopic = document.getElementById('main_topic')
        this.choicesRefMainTopics = new Choices(elementMainTopic, {
          placeholderValue: 'Selecione um Tópico',
          removeItemButton: true,
          classNames: {
            containerOuter: ['choices', 'w-100', 'mb-0'],
            containerInner: ['choices__inner', 'custom-choices__inner'],
            listSingle: ['choices__list--single', 'custom-choices__list--single'],
          },
        })
        this.choicesRefMainTopics.clearChoices()
        let choices = value.map(theme => ({ value: theme.id, label: theme.name }))
        this.choicesRefMainTopics.setChoices(
          choices,
          'value',
          'label',
          false,
        )
        this.choicesRefMainTopics.setChoiceByValue(this.selectedMainTopic)
      },
      selectedTheme: function(value) {
        this.choicesRefMainTopics.clearStore()
        this.selectedMainTopic = ''
        this.fetchTheme(value)
        this.fetchMainTopic(value)
      },
      selectedLevel: function(value){ this.fetchGrades(value)},
      selectedGrade: function(value){ this.fetchKnowledgeArea(value) },
      selectedArea: function(value){
        if (value ==   "")
          this.selectedSubject = ""
        if (value !== "" || this.selectedSubject !== ""){
          this.fetchSubject(value)
          this.fetchCompetences(this.selectedSubject, value)
          this.fetchAbilities(this.selectedSubject, value)
          return
        }
        this.resetBNCCsAndTopics()
        this.resetPedagogicalData()
      },
      selectedSubject: function(value){
        if(value !== "" || this.selectedArea !== ""){
          this.fetchCompetences(value, this.selectedArea)
          this.fetchAbilities(value, this.selectedArea)
        }
        else {
          this.resetBNCCsAndTopics()
        }
        if (value !== "" ) {
          this.fetchTopic(value, this.selectedGrade)
        }
        else {
          this.topics = []
        }
      },
      searchBaseText: function(value) {        
        if(value == ""){
          this.baseTextFounds = []
        }
      },
    },
    computed: {
      titleMainTopic(){
        if (this.selectedTheme) {
          $('#filderMainTopic').attr('data-original-title', "");
          $('#filderMainTopic').tooltip('update');
        } else {
          return "Selecione um tema para habilitar este campo."
        }
      },
      enableRegistration() {
        return this.selectedSubject !== '' && this.selectedGrade !== '' && this.selectedLevel !== ''  && this.selectedArea !== '' ;
      },
      enableMainTopicRegistration() {
        return this.selectedTheme;
      },
      tooltipTitleCompetence(){
        if (this.enableRegistration) {
          $('#bt_create_competence').attr('data-original-title', "Cadastrar Competência");
          $('#bt_create_competence').tooltip('update');
        } else {
          return 'Preencha os dados pedagógicos para poder cadastrar uma nova competência.';
        }
      },
      tooltipTitleAbility(){
        if (this.enableRegistration) {
          $('#bt_create_ability').attr('data-original-title', "Cadastrar Habilidade");
          $('#bt_create_ability').tooltip('update');
        } else {
          return 'Preencha os dados pedagógicos para poder cadastrar uma nova habilidade.';
        }
      },
      tooltipTitleMainTopic(){
        if (this.enableMainTopicRegistration) {
          $('#bt_create_main_topic').attr('data-original-title', "Cadastrar Tema");
          $('#bt_create_main_topic').tooltip('update');
        } else {
          return 'Voçê deve selecionar Tema para poder cadastrar um novo Tópico.';
        }
      },
      tooltipTitle() {
        if (this.enableRegistration) {
          $('#bt_create_topic').attr('data-original-title', "Cadastrar Assunto");
          $('#bt_create_topic').tooltip('update');
        } else {
          return 'Preencha os dados pedagógicos para poder cadastrar um novo assunto.';
        }
      },
      regroupedTopics: function(){
        var self = this;
        return _.groupBy(self.filterTopics, "stage")
      },
      filterTopics: function(){
        return this.topics.filter(item => {
          return item.name.toLowerCase().indexOf(this.searchTopic.toLowerCase()) > -1
        })
      },
      filterCompetences: function(){
        return this.competences.filter(item => {
          return item.text.toLowerCase().indexOf(this.searchCompetence.toLowerCase()) > -1 || (item.code && item.code.toLowerCase().indexOf(this.searchCompetence.toLowerCase()) > -1)
        })
      },
      filterAbilities: function(){
        return this.abilities.filter(item => {
          return item.text.toLowerCase().indexOf(this.searchAbility.toLowerCase()) > -1 || (item.code && item.code.toLowerCase().indexOf(this.searchAbility.toLowerCase()) > -1)
        })
      },
      filteredThemes: function() {
        if (this.searchFilterThemes) {
            return this.themes.filter(theme => {
                return theme.name.toLowerCase().indexOf(this.searchThemes.toLowerCase()) !== -1;
            });
        } else {
            return this.themes;
        }
      },
      topicsRegrouped: function() {
        let items = this.filterTopics
        let result = {}

        items.forEach(topic => {
          let stageId = this.slugify(topic.stage) || 'sem-etapa'
          let stageName = topic.stage || 'Sem etapa'

          if (!result[stageId]) {
            result[stageId] = {
              id: stageId,
              name: stageName,
              themes: {}
            }
          }

          let themeId = null
          let themeName = null

          if (topic.theme) {
            themeId = topic.theme.id
            themeName = topic.theme.name
          } else if (topic.main_topic && topic.main_topic.theme) {
            themeId = topic.main_topic.theme.id
            themeName = topic.main_topic.theme.name
          }

          if (themeId) {
            if (!result[stageId].themes[themeId]) {
              result[stageId].themes[themeId] = {
                id: themeId,
                name: themeName,
                main_topics: {}
              }
            }
          }

          let mainTopicId = null
          let mainTopicName = null

          if (topic.main_topic) {
            mainTopicId = topic.main_topic.id
            mainTopicName = topic.main_topic.name

            if (!themeId) {
              themeId = 'without-theme'
              if (!result[stageId].themes[themeId]) {
                result[stageId].themes[themeId] = {
                  id: 'without-theme',
                  name: 'Sem tema',
                  main_topics: {}
                }
              }
            }

            if (!result[stageId].themes[themeId].main_topics[mainTopicId]) {
              result[stageId].themes[themeId].main_topics[mainTopicId] = {
                id: mainTopicId,
                name: mainTopicName,
                topics: []
              }
            }
          } else {
            if (!themeId) {
              themeId = 'without-theme'
              if (!result[stageId].themes[themeId]) {
                result[stageId].themes[themeId] = {
                  id: 'without-theme',
                  name: 'Sem tema',
                  main_topics: {}
                }
              }
            }

            mainTopicId = 'without-main-topic'
            if (!result[stageId].themes[themeId].main_topics[mainTopicId]) {
              result[stageId].themes[themeId].main_topics[mainTopicId] = {
                id: 'without-main-topic',
                name: 'Sem tópico principal',
                topics: []
              }
            }
          }

          result[stageId].themes[themeId].main_topics[mainTopicId].topics.push({
            id: topic.id,
            name: topic.name
          })
        })

        let formattedResult = Object.values(result)
          .map((stage) => ({
            ...stage,
            themes: Object.values(stage.themes)
              .map((theme) => ({
                ...theme,
                mainTopics: Object.values(theme.main_topics)
                  .map((mainTopic) => ({
                    ...mainTopic,
                    topics: [...mainTopic.topics].sort((a, b) =>
                      a.name.localeCompare(b.name),
                    ),
                  }))
                  .sort((a, b) => a.name.localeCompare(b.name)),
              }))
              .sort((a, b) => a.name.localeCompare(b.name)),
          }))
          .sort((a, b) => a.name.localeCompare(b.name))

        return formattedResult
      },
      currentTopicsObj() {
        return this.topics.filter(item => this.currentTopics.includes(item.id))
      },
    },
    methods: {
      slugify(text) {
        if (!text) return ''
        return text
          .toString()
          .toLowerCase()
          .trim()
          .replace(/\s+/g, '-')
          .replace(/[^\w\-]+/g, '')
          .replace(/\-\-+/g, '-')
          .replace(/^-+/, '')
          .replace(/-+$/, '')
      },
      activateCustomToolbar() {
        this.customToolbarStatus = 'active';
      },
      deactivateCustomToolbar() {
        this.customToolbarStatus = 'idle';
      },
      tinymceDefaultSetup(editor) {
        const vueContext = this;
        editor.on('focus', function(e) {
          vueContext.activateCustomToolbar()
        })
        editor.on('blur', function(e) {
          vueContext.deactivateCustomToolbar()
        })
      },
      handleSubmitFormQuestion(event) {
        if (event.ctrlKey && event.which == 83 || event.type === 'submit') {
          event.preventDefault(); 
          this.submitQuestionForm(); 
        }
      },
      stripHtmlTags(text) {              
        text = text.replace(/<[^>]*>/g, '');// Remove todas as tags HTML
        text = text.replace(/\.\s*$/, ''); // Remove o ponto final seguido de zero ou mais espaços no final da string
        text = text.replace(/\s+$/, '');   // Remove sequências de espaços em branco no final da string
        text = text.replace(/[,\.]/g, '');  // Remove os caracteres ',' e '.'

        return text;
      },
       hasQuestionsDuplicates() {
        const seen = new Set();
        selectedAlternatives = this.getSelectedAlternatives()
        lenAlternatives = selectedAlternatives.length;

        for (let i = 0; i < lenAlternatives; i++) {
          const option = selectedAlternatives[i];
          const normalizedOption = option.text.toLowerCase();

          const text = this.stripHtmlTags(normalizedOption);
          if (seen.has(text) && text != "") {
            return true;
          }
          seen.add(text); 
          if (i == lenAlternatives && seen.has(text)) {
            return true;
          }
        }
        return false; 
      },
      submitQuestionForm( event) {
        if (this.hasQuestionsDuplicates()) {
          Swal.fire({
            icon: 'warning',
            title: 'Alternativas iguais',
            text: 'Atenção! Aparentemente a questão possui 2 ou mais alternativas iguais, certeza que deseja continuar?',
            showCancelButton: true,
            confirmButtonText: 'Sim, continuar',
            cancelButtonText: 'Não, corrigir',
          }).then((result) => {
            if (result.isConfirmed) {
              document.getElementById('questionForm').submit();
            }
            const submitButton = this.$el.querySelector('#button-save-question');
            submitButton.disabled = false;
          });
        } else {
          document.getElementById('questionForm').submit();
        }
      },
      toggleThemeInput() {
        this.isAddingNewTheme = !this.isAddingNewTheme;
        this.newThemeName = '';
      },
      saveNewTheme(csrf_token) {
        if (this.newThemeName.trim()) {
          var postData = {
            name: this.newThemeName, 
          };
          var themeUrl = `{% url 'subjects:theme_create_api' %}`; 
          axios.post(themeUrl, postData, {
            headers: {
              'X-CSRFToken': csrf_token 
            }
          })
          .then(response => {
            if (response.status === 201) {
              const theme = response.data;
              this.themes.push(theme);
              this.themes.sort((a, b) => a.name.localeCompare(b.name));
              this.selectedTheme = theme.id;
              this.isAddingNewTheme = false;
              this.newThemeName = '';
              this.showMessageToast("Tema criado com sucesso!", 'success')

            } else {
              throw new Error('Network response was not ok ' + response.statusText);
            }
          })
          .catch(error => {
            this.showMessageToast("Ocorreu algum erro ao criar o tema. Verifique os dados e tente novamente.", 'error')
          });
        }
      },
      toggleMainTopicInput() {
        this.isAddingNewMainTopic = !this.isAddingNewMainTopic;
        this.newMainTopicName = '';
      },
      saveNewMainTopic(csrf_token) {
        if (this.newMainTopicName.trim()) {
          var postData = {
            name: this.newMainTopicName, 
            theme: this.selectedTheme 
          };
          var mainTopicUrl = `{% url 'subjects:main_topic_create_api' %}`; 
          axios.post(mainTopicUrl, postData, {
            headers: {
              'X-CSRFToken': csrf_token 
            }
          })
          .then(response => {
            if (response.status === 201) {
              const mainTopic = response.data;
              this.mainTopics.push(mainTopic);
              this.mainTopics.sort((a, b) => a.name.localeCompare(b.name));
              this.selectedMainTopic = mainTopic.id;
              this.isAddingNewMainTopic = false;
              this.newMainTopicName = '';
              this.showMessageToast("Tópico criado com sucesso!", 'success')

            } else {
              throw new Error('Network response was not ok ' + response.statusText);
            }
          })
          .catch(error => {
            this.showMessageToast("Para criar um Tópico é necessário selecioanar ou criar um Tema.", 'error')
          });
        }
      },
      showMessageToast(errorMessage, icon) {
        Swal.fire({
            position: 'top-end',
            text: errorMessage,
            icon: icon,
            showConfirmButton: false,
            timer: 5000,
            toast: true,
            timerProgressBar: true,
        });
      },
      updateSelectedValues() {
        var selectedGradeText = $('#selectGrade option:selected').text();
        $('.grade-value').text(selectedGradeText);
    
        var selectedArea = $('#selectArea option:selected').text();
        $('.area-value').text(selectedArea);
    
        var selectedSubject = $('#selectSubject option:selected').text();
        $('.subject-value').text(selectedSubject);
      },
      openModalCreateTopic() {
        this.selectedTheme = '';
        this.selectedMainTopic = '';
        this.topicName = '';
        this.stage = '';

        this.updateSelectedValues();

        $('#modalCreateTopic').modal('show');
      },
      openModalCreateCompetence() {
        this.selectedCompetenceCode = '';
        this.selectedCompetence = '';

        this.updateSelectedValues();

        $('#modalCreateCompetence').modal('show');
      },
      openModalCreateAbility() {
        this.selectedAbilityCode = '';
        this.selectedAbility = '';

        this.updateSelectedValues();

        $('#modalCreateAbility').modal('show');
      },
      submitFormCreateCompetence(csrf_token) {
        const postData = {
            code: this.selectedCompetenceCode,
            text: this.selectedCompetence,
            grade: this.selectedGrade,
            subject: this.selectedSubject,
            knowledge_area: this.selectedArea,

        };
        var postUrl = "{% url 'bncc:competence_create_api' %}";

        axios.post(postUrl, postData, {
          headers: {
            'X-CSRFToken': csrf_token 
          }
        })
        .then(response => {
          if (response.status === 201) {
                const competence = response.data;
                this.competences.push(competence)
                this.competences.sort((a, b) => a.text.localeCompare(b.text))
                this.showMessageToast("Assunto cadastrado com sucesso!", 'success')
                $('#modalCreateCompetence').modal('hide');    
          } 
        })
       .catch(error => {
          if (error.response && error.response.data && error.response.data.non_field_errors) {
            this.showMessageToast( error.response.data.non_field_errors, "error")
          } else {
            this.showMessageToast("Ocorreu algum erro no preenchimento do formulário. Por favor, verifique se preencheu todos os campos e tente novamente.", 'error')
          }
        });
      }, 
      submitFormCreateAbility(csrf_token) {
        grades = []
        grades.push(this.selectedGrade)
        const postData = {
            code: this.selectedAbilityCode,
            text: this.selectedAbility,
            grades: grades,
            subject: this.selectedSubject,
            knowledge_area: this.selectedArea,

        };
        var postUrl = "{% url 'bncc:ability_create_api' %}";

        axios.post(postUrl, postData, {
          headers: {
            'X-CSRFToken': csrf_token 
          }
        })
        .then(response => {
          if (response.status === 201) {
                const ability = response.data;
                this.abilities.push(ability)
                this.abilities.sort((a, b) => a.text.localeCompare(b.text))
                this.showMessageToast("Assunto cadastrado com sucesso!", 'success')
                $('#modalCreateAbility').modal('hide');    
          } 
        })
        .catch(error => {
          if (error.response && error.response.data && error.response.data.non_field_errors) {
            this.showMessageToast(error.response.data.non_field_errors, "error")
          } else {
            this.showMessageToast("Ocorreu algum erro no preenchimento do formulário. Por favor, verifique se preencheu todos os campos e tente novamente.", 'error')
          }
        });
      }, 
      submitForm(csrf_token) {
        const postData = {
            grade: this.selectedGrade,
            subject: this.selectedSubject,
            theme: this.selectedTheme,
            main_topic: this.selectedMainTopic,
            name: this.topicName,
            stage: this.stage || null,
        };
        var postUrl = "{% url 'subjects:topic_create_complete' %}";

        axios.post(postUrl, postData, {
          headers: {
            'X-CSRFToken': csrf_token 
          }
        })
        .then(response => {
          if (response.status === 201) {
                const topic = response.data;
                this.topics.push(topic);
                this.topics.sort((a, b) => a.name.localeCompare(b.name));
                this.showMessageToast("Assunto cadastrado com sucesso!", 'success')
                this.closeModal();       
          } 
        })
        .catch(error => {
          this.showMessageToast(" Ocorreu algum erro no preenchimento do formulário. Por favor, verifique se preencheu todos os campos e tente novamente.", 'error')
        });
      },
      closeModal() {
        $('#modalCreateTopic').modal('hide');
        $('.modal-backdrop').remove(); 
      },
      momentRef(args) {
        return moment(args)
      },
      requestStatusTags(){
        self = this

        if(this.no_tags){
          return this.submitQuestionForm()
        }
        if(this.requestTags){
          Swal.fire({
            title: 'Selecione os motivos para essa ação',
            html: 
              '{% for tag in tags %}<input type="checkbox" class="btn-check statusTags" id="{{tag.pk}}" autocomplete="off"><label class="btn btn-outline-primary btn-sm" for="{{tag.pk}}">{{tag.name}}</label>{% endfor %}',
            focusConfirm: false,
            preConfirm: () => {
              const statusTags = document.querySelectorAll('.statusTags')
              const selectedPks = []
  
              statusTags.forEach((tagElement)=>{
                if(tagElement.checked) selectedPks.push(tagElement.id)
              })
              return selectedPks
            },
            showCancelButton: true,
            showConfirmButton: true,
            confirmButtonText: "Continuar",
            cancelButtonText: "Cancelar",
          }).then((result) => {
            if(result.isConfirmed) {
              result.value.forEach((value)=>{
                this.selectedTags.push(value)
              })
              $("#selected_tags").val(this.selectedTags)
              this.requestNote()
            }
          })
        }else{
          this.submitQuestionForm()
        }
      },
      requestNote() {
        self = this
        Swal.fire({
          title: 'Deseja enviar alguma anotação para o professor?',
          input: 'textarea',
          inputPlaceholder: 'Adicione a anotação que deseja enviar para o professor, você pode deixar vazio caso não tenha nenhuma anotação a enviar.',
          inputAttributes: {
            'aria-label': 'Adicione a anotação que deseja enviar para o professor, você pode deixar vazio caso não tenha nenhuma anotação a enviar.'
          },
          showCancelButton: true,
          showConfirmButton: true,
          confirmButtonText: "Enviar anotação",
          cancelButtonText: "Cancelar",
        }).then((result) => {
          if(result.isConfirmed) {
            $("#status_note").val(result.value)
            this.submitQuestionForm()          
          }
        })
      },
      checkIfExistTemplate() { 
        if($('#{{form.category.auto_id}} :selected').text() == 'Objetiva') {
          this.has_corrent_alternative = $("[id*='-is_correct']").is(':checked')
        } else {
          this.has_corrent_alternative = true
        }
      },
      getSelectedAlternatives() {
        self = this;
        this.selectedAlternatives = []
        $("textarea[id*='-text']").each(function(){
          let id = $(this).attr('id')
          let check = id.replace('text', 'is_correct')
          if(tinymce.get(id) && tinymce.get(id).getContent()){
            self.selectedAlternatives.push({
              text: tinymce.get(id).getContent(),
              is_correct: $('#'+check).is(':checked')
            })
          }
        })
        return this.selectedAlternatives
      },
      modalForm(){
        this.enunciationForm = tinymce.get("{{form.enunciation.auto_id}}").getContent()
        this.categoryForm = $('#{{form.category.auto_id}} :selected').text()
      },  
      changeTab(tab){
        $('.nav-tabs a[href="'+tab+'"]').tab('show')
      },
      checkOption(from, to, event){
         if (event.target.checked) {
            to.push(from)
         } else {
          let i = to.map(item => item.id).indexOf(from.id) // find index of your object
          to.splice(i, 1)
         }
      },
      fetchGrades: function(level){
        var self = this
        if(level || level == 0) {
          var gradeListUrl = `{% url 'classes:grade_list_api' %}?level=${level}`
          axios.get(gradeListUrl).then(function(response) {
              self.grades = response.data
              self.selectedGrade = self.checkExist(self.currentGrade, self.grades)
          })
        } else {
          this.resetPedagogicalData()
        }
      },
      fetchTheme: function () {
        var self = this
          var themeListUrl = `{% url 'subjects:theme_list_api' %}` 
          axios.get(themeListUrl).then(function(response) {
            self.themes = response.data
        })
      },
      fetchMainTopic: function (theme) {
        var self = this
        if (theme) {
          var mainTopicListUrl = `{% url 'subjects:main_topic_list_api' %}?theme_pk=${theme}` 
          axios.get(mainTopicListUrl).then(function(response) {
            self.mainTopics = response.data
          })
          return
        }
        else {
          var mainTopicListUrl = `{% url 'subjects:main_topic_list_api' %}`
          axios.get(mainTopicListUrl).then(function(response) {
              self.mainTopics = response.data
          })
          }
      },

      fetchKnowledgeArea: function(grade){
        var self = this
        this.selectedSubject = ''
        this.knowledgeAreas = []
        this.subjects = []
        
        if(grade) {
          var knowledgeAreaListUrl = `{% url 'subjects:knowledge_area_list_api' %}?grades=${grade}`
          axios.get(knowledgeAreaListUrl).then(function(response) {
              self.knowledgeAreas = response.data
              self.selectedArea = self.checkExist(self.currentKnowledgeArea, self.knowledgeAreas)
          })
        } else {
          this.resetPedagogicalData()
        }
      },
      fetchSubject: function(knowledgeArea){
        var self = this
        this.subjects = []
        if(knowledgeArea) {
          var subjectListUrl = `{% url 'subjects:subject_list_api' %}?knowledge_area=${knowledgeArea}`
          axios.get(subjectListUrl).then(function(response) {
              self.subjects = response.data
              self.selectedSubject = self.checkExist(self.current_subject, self.subjects)
          })
        }
      },
      fetchTopic: function(subject, grade){
        var self = this
        
        var objectSubject = self.subjects.find(function(subject_obj){
          return subject_obj.id == subject
        })

        var topictListUrl = `{% url 'subjects:topic_list_api' %}?grade=${grade}&subject_pk=${subject}`

        axios.get(topictListUrl).then(function(response) {
            self.topics = response.data
        })
      },
      fetchCompetences: function(subject, knowledge_area){
        var self = this
        if(subject) {
          var objectSubject = self.subjects.find(function(subject_obj){
            return subject_obj.id == subject
          })
  
          var competenceListUrl = `{% url 'bncc:competence_list_api' %}?`
  
          if(subject){
            competenceListUrl += `&subject_in_or_none=${subject}`
            
            if (objectSubject && objectSubject.parent_subjects){
              objectSubject.parent_subjects.forEach(function(parent){
                competenceListUrl += `&subject_in_or_none=${parent}`
              })
            }
          }
          
          if(knowledge_area){
            competenceListUrl += `&knowledge_area=${knowledge_area}`
          }
  
          axios.get(competenceListUrl).then(function(response) {
              self.competences = response.data
          })
        }
      },
      fetchAbilities: function(subject, knowledge_area){
        var self = this

        if(subject) {
          var objectSubject = self.subjects.find(function(subject_obj){
            return subject_obj.id == subject
          })
  
          var abilityUrl = `{% url 'bncc:ability_list_api' %}?grades=${self.selectedGrade}`
  
          if(subject){
            abilityUrl += `&subject_in_or_none=${subject}`
            
            if (objectSubject && objectSubject.parent_subjects){
              objectSubject.parent_subjects.forEach(function(parent){
                abilityUrl += `&subject_in_or_none=${parent}`
              })
            }
          }
          
          if(knowledge_area){
            abilityUrl += `&knowledge_area=${knowledge_area}`
          }
  
          axios.get(abilityUrl).then(function(response) {
              self.abilities = response.data
          })
        }
      },
      removeQuestionOption(option_index) {
        let editing_question = {{ question|yesno:"true,false" }}; 
        
        const alternative_container = $(`#id_question-option-form-${option_index}-text`).parent().parent();
        const delete_input = $(`#id_question-option-form-${option_index}-DELETE`);
        const is_correct_input = $(`#id_question-option-form-${option_index}-is_correct`);

        alternative_container.hide();
        is_correct_input.prop("checked", false);

        if (editing_question){
          delete_input.prop("checked", true);
        }
      },
      checkCategory: function(category_id) {
        if(category_id == 0 || category_id == 2){
          $("#selectCompetence").show(400)
        }else{
          $("#selectCompetence").hide(400)
          $("#checkBoxCorrection").prop('checked', false)
          this.selectTextCorrection = false;
          
        }
        switch (parseInt(category_id)) {
          case 1:
          case 3:
            $("#row-alternatives").show()
            $('input:hidden#id_question-option-form-MIN_NUM_FORMS').val(5)
            break;
          default:
            $("#row-alternatives").hide()
            $('input:hidden#id_question-option-form-MIN_NUM_FORMS').val(0)
        }
      },
      checkExist(value, list){
        var elementExists = list.find(element => element.id == value)
        return elementExists ? elementExists.id  : ""
      },
      getHistoricalQuestion() {
        {% if object.pk %}
          let questionUrl = "{% url 'questions:question_historical' pk='00000000-0000-0000-0000-000000000000' %}"
          axios.get(questionUrl.replace('00000000-0000-0000-0000-000000000000', '{{object.pk}}')).then((response) => {
            this.historicalQuestion = response.data.exam_question
          })
        {% endif %}
      },
      getBaseTexts() {
        return axios.get("{% url 'questions:base_text_list_create' %}").then((response) => {
          this.baseTexts = response.data
        })
      },
      startCreationNewBaseText() {
        this.newBaseText = {
          title: '', text: ''
        }
        this.addBaseText = true
        this.alertRequiredField = false
        tinymce.get('id_new_base_text').setContent("<p></p>");
      },
      createBaseText() {
        if(tinymce.get("id_new_base_text").getContent({ format: 'text'}).length > 1 && this.newBaseText.title.length){
          this.newBaseText.text = tinyMCE.get('id_new_base_text').getContent()
          axios.post("{% url 'questions:base_text_list_create' %}", {title: this.newBaseText.title, text: this.newBaseText.text }).then((response) => {
          this.baseTexts.push(response.data)
          this.selectedBaseTexts.push(response.data)
          Swal.fire({
            title: 'Texto base criado com sucesso!',
            text: "O texto base será adicionado nesta questão",
            icon: 'success',
          })
          this.fetchBaseTexts()
          this.addBaseText = false
          })
        }else{
          this.alertRequiredField = true
        }
      },

      validValueBaseText() {
        //&& tinyMCE.get('id_new_base_text').getContent().length > 0
        if(this.newBaseText.title.length > 0)
          return true
        return false
      },
      updateBaseTextEdit() {
        if(tinymce.get("id_new_base_text").getContent({ format: 'text'}).length > 1 && this.newBaseText.title.length){
          this.selectedBaseText.title = this.newBaseText.title
          baseText = Object.assign(this.selectedBaseText, {})
        
          baseText.text = tinyMCE.get('id_new_base_text').getContent()
          
          let baseTextUpdatenUrl = "{% url 'questions:base_text_retrive_update_destroy' pk='00000000-0000-0000-0000-000000000000' %}"
          axios.put(baseTextUpdatenUrl.replace('00000000-0000-0000-0000-000000000000', baseText.id), baseText).then(response => {
              Swal.fire({
                title: 'Texto base atualizado com sucesso!',
                icon: 'success',
              })
              this.selectedBaseText = response.data
            
              tinymce.get('id_new_base_text').setContent("<p></p>");
              this.fetchBaseTexts()
              this.addBaseText = false
              this.editBaseText = false
              this.alertRequiredField = false
          })
        }else{
          this.alertRequiredField = true
        }
      },
      selectToEdit(baseText){
        this.addBaseText = true
        this.editBaseText = true
        this.alertRequiredField = false

        this.selectedBaseText = baseText
        this.newBaseText.title = baseText.title
        tinymce.get('id_new_base_text').setContent(baseText.text)
      },
      deleteBaseText(baseText) {
        Swal.fire({
          title: 'Deseja realmente deletar o texto base?',
          text: "Você não será capaz de reverter isso!",
          icon: 'warning',
          showCancelButton: true,
          cancelButtonColor: '#d33',
          confirmButtonText: 'Sim, deletar!'
        }).then((result) => {
          if (result.isConfirmed) {
            let baseTextDeleteUrl = "{% url 'questions:base_text_retrive_update_destroy' pk='00000000-0000-0000-0000-000000000000' %}"
            axios.delete(baseTextDeleteUrl.replace('00000000-0000-0000-0000-000000000000', baseText))
            .then(response => {
              Swal.fire({
                title: 'Texto base deletado com sucesso!',
                icon: 'success',
              })
              this.getBaseTexts()
              this.fetchBaseTexts()
            }).catch(e => {
              Swal.fire({
                title: 'Não foi possível deletar!',
                text: 'Verifique se o texto base não está vinculado a uma questão',
                icon: 'error',
              })
            })
          }
        })
      },
      btnCancelBaseText(){
        this.addBaseText = false
        this.editBaseText = false
        this.alertRequiredField = false
      },
      baseTextCheckExist(baseText) {
        return this.selectedBaseTexts.find((_baseText) => _baseText.id == baseText.id)
      },
      selectBaseText(baseText) {
        if(!this.baseTextCheckExist(baseText))
          this.selectedBaseTexts.push(baseText)
        else
          this.selectedBaseTexts.splice(this.selectedBaseTexts.indexOf(baseText), 1)
      },
      fetchBaseTexts() {
        if(this.searchBaseText.length > 1) {
          axios.get(`{% url 'questions:base_text_list_create' %}?search=${this.searchBaseText}`).then((response) => this.baseTextFounds = response.data)
        }
      },
      openModal(id){
        $('#'+id).modal('toggle');
      },
      resetBNCCsAndTopics() {
        this.currentCompetences = []
        this.currentAbilities = []
        this.competences = []
        this.abilities = []
      },
      resetPedagogicalData(grades) {
        this.selectedSubject = ''
        this.selectedGrade = ''
        this.selectedArea = ''
      },
      getFormatterTokens() {
        let text = tinymce.get('questionFormatterInput').getContent()
        text = text.replace(/\s+/g, ' ').trim();
        this.formatter.tokens = text.length
      
      },
      getFormatterStatus(seconds = 3) {
        this.formatter.statusCopy = Object.assign(this.formatter.statusList, [])
        this.formatter.fakeStatus = this.formatter.statusCopy.shift()
        this.formatter.interval = setInterval(() => {
          if(this.formatter.statusCopy.length) {
            this.formatter.fakeStatus = this.formatter.statusCopy.shift()
          }
        }, seconds * 1000)
        
      },
      formatterQuestion() {
        {% if user.client_has_question_formatter or user.ispector and user.ispector.has_question_formatter %}
          
          this.formatter.loading = true
          let content = tinymce.get('questionFormatterInput').getContent()
          this.getFormatterStatus()
          axios({
            method: 'post',
            url: "{% url 'questions:formatter' %}",
            data: {
              text: String(content)
            },
          }).then((response) => {
            tinymce.get("{{form.enunciation.auto_id}}").setContent(response.data.enunciation)

            response.data.alternatives.forEach((alternative, index) => {
              if(alternative.is_correct) {
                $(`#id_question-option-form-${index}-is_correct`).click()
              }
              tinymce.get(`id_question-option-form-${index}-text`).setContent(alternative.text)
            })
            tinymce.get('questionFormatterInput').setContent('')

            $("#closeFormatterQuestion").click();
            $(".modal-backdrop").remove();
            $("#view-question").click();
            this.formatter.status = 'success'
          
          }).finally(() => {
            this.formatter.loading = false
            clearInterval(this.formatter.interval)
          }).catch((e) => {
            this.formatter.status = 'error'
            $("#errorCode").text(e)
          })
        {% endif %}
      },
      getAllTopicIdsFromTheme(theme) {
        return theme.mainTopics.flatMap(mt => mt.topics.map(t => t.id))
      },
      getAllTopicIdsFromMainTopic(mainTopic) {
        return mainTopic.topics.map(t => t.id)
      },
      isThemeChecked(theme) {
        let topicIds = this.getAllTopicIdsFromTheme(theme)
        return topicIds.every(id => this.currentTopics.includes(id))
      },
      isMainTopicChecked(mainTopic) {
        let topicIds = this.getAllTopicIdsFromMainTopic(mainTopic)
        return topicIds.every(id => this.currentTopics.includes(id))
      },
      toggleTheme(theme, event) {
        let topicIds = this.getAllTopicIdsFromTheme(theme)
        if (event.target.checked) {
          this.currentTopics = Array.from(new Set([...this.currentTopics, ...topicIds]))
        } else {
          this.currentTopics = this.currentTopics.filter(id => !topicIds.includes(id))
        }
      },
      toggleMainTopic(mainTopic, event) {
        let topicIds = this.getAllTopicIdsFromMainTopic(mainTopic)
        if (event.target.checked) {
          this.currentTopics = Array.from(new Set([...this.currentTopics, ...topicIds]))
        } else {
          this.currentTopics = this.currentTopics.filter(id => !topicIds.includes(id))
        }
      },
    },
    updated: function() {
      if(window.MathJax) {
        MathJax.typeset();
      }
    },
    mounted: function() {
      let elementTheme = document.getElementById('theme')
      this.choicesRefThemes = new Choices(elementTheme, {
        removeItemButton: true,
        classNames: {
          containerOuter: ['choices', 'w-100', 'mb-0'],
          containerInner: ['choices__inner', 'custom-choices__inner'],
          listSingle: ['choices__list--single', 'custom-choices__list--single'],
        },
      })
      let elementMainTopic = document.getElementById('main_topic')
      this.choicesRefMainTopics = new Choices(elementMainTopic, {
        removeItemButton: true,
        classNames: {
          containerOuter: ['choices', 'w-100', 'mb-0'],
          containerInner: ['choices__inner', 'custom-choices__inner'],
          listSingle: ['choices__list--single', 'custom-choices__list--single'],
        },
      })

      window.addEventListener('keydown', this.handleSubmitFormQuestion);

      // this.questionForm = document.getElementById('questionForm');
      // this.questionForm.addEventListener('submit', this.handleSubmitFormQuestion);

      self = this

      const vueContext = this;

      tinymce.init({
        ...self.tinyMCEDefaults,
        placeholder: 'Enunciado',
        toolbar: 'custom-toolbar',
        selector: '#{{ form.enunciation.auto_id }}',
        setup: vueContext.tinymceDefaultSetup,
      })

      {% for question_option_form in question_option_formset %}
        tinymce.init({
          ...self.tinyMCEDefaults,
          placeholder: 'Alternativa...',
          toolbar: 'custom-toolbar',
          selector: '#{{ question_option_form.text.auto_id }}',
          setup: vueContext.tinymceDefaultSetup,
        })
      {% endfor %}

      tinymce.init({
        ...self.tinyMCEDefaults,
        selector: '#questionFormatterInput',
        setup: function(editor) {
          editor.on('focus', function(e) {
            vueContext.activateCustomToolbar()
          })
          editor.on('blur', function(e) {
            vueContext.deactivateCustomToolbar()
          })
          editor.on('keyup paste input', function(e) {
            self.getFormatterTokens()
          })
        }
      })

      tinymce.init({
        ...self.tinyMCEDefaults,
        placeholder: 'Digite aqui',
        toolbar: 'custom-toolbar',
        selector: '#{{ form.commented_awnser.auto_id }}',
        setup: vueContext.tinymceDefaultSetup,
      })

      tinymce.init({
        ...self.tinyMCEDefaults,
        placeholder: 'Digite aqui',
        toolbar: 'custom-toolbar',
        selector: '#{{ form.feedback.auto_id }}',
        setup: vueContext.tinymceDefaultSetup,
      })
      
      if(this.textCorrection){
        $('#checkBoxCorrection').prop('checked', true)
        this.selectTextCorrection = true
      }
      
      $('#checkBoxCorrection').on('change', (e) => {
        $(e.target).prop('checked') ? this.selectTextCorrection = true : this.selectTextCorrection = false
      })
      
      var self = this;
      this.checkCategory($("#id_category").val())
      this.getHistoricalQuestion()
      this.getBaseTexts()

      $('#dfSettingsShow').on('click', function (e) {
        if ($(this).hasClass('fa fa-times')) {
            $(this).removeClass('fa fa-times').addClass('fa fa-angle-left');
        }else{
            $(this).removeClass('fa fa-angle-left').addClass('fa fa-times');
        }
      });

      document.onkeydown = function(e) {
        if (e.which == 112) {
          self.changeTab('#question-data')
          return false;
        }else if(e.which == 113){
          self.changeTab('#question-subject')
          return false;
        }else if(e.which == 114){
          self.changeTab('#question-bncc')
          return false;
        }else if(e.which == 115){
          self.changeTab('#question-print')
          return false;
        }else if(e.which == 116){
          self.changeTab('#question-history')
          return false;
        }else if(e.which == 117){
          self.changeTab('#history-ult-tab')
          return false;
        }else if(e.ctrlKey && e.which == 73){
          $('#view-question').click();
          return false;
        }else if(e.ctrlKey && e.which == 76){
          $('[data-target="#shortcutFunction"]').click()
          return false;
        }
      };

      {% comment %} else if(e.ctrlKey && e.which == 83){
        $('#submitModal').click() {% endcomment %}
      
      $('#id_search_base_text').on('keyup', _.debounce(() => this.fetchBaseTexts(), 800))
      {% if form.instance.grade %}
        this.selectedLevel = {{ form.instance.grade.level }}
      {% elif current_selected_level %}
        this.selectedLevel = {{current_selected_level}}
      {% else %}
        this.selectedLevel = 1
      {% endif %}


      self.fetchGrades(self.selectedLevel)
      self.fetchTheme()
      self.fetchMainTopic(this.selectedTheme)


      $(document).ready(function () {
        $(".select2").select2();
      });
      
      $('.vue-select2').select2({
        matcher: function(params, data) {
          if ($.trim(params.term) === '') {
            return data;
          }
          if (typeof data.text === 'undefined') {
            return null;
          }
          if (data.text.toUpperCase().indexOf(params.term.toUpperCase()) == 0) {
            return data;
          }
          return null;
        }
      });
      
      $("#id_category").change(function(){
        self.checkCategory($(this).val())
      })
      

      $('#canceled_question').click(function() {
        const checked = $(this).is(':checked')
        $('input:checkbox.check-is-correct').prop('checked', checked);

        if (checked) {
          $('input:checkbox.check-is-correct').prop('disabled', 'disabled');
        } else {
          $('input:checkbox.check-is-correct').removeAttr('disabled')
        }
      })

      {% if object.is_canceled %}
        $('#canceled_question').click();
      {% endif %}

      $('form').submit(function(e) {
          $('input[type="checkbox"]:disabled').each(function(e) {
            $(this).removeAttr('disabled');
          })
      });

      $('#'+"{{form.coordinations.auto_id}}").select2({closeOnSelect: false})
      
      {% if is_popup %}
        if(!window.opener && !window.opener.app_question) {
          Swal.fire({
            title: 'Ops...',
            html: 'Algo deu errado ao tentar cadastrar ou editar esta questão! <br> Para cadastrar ou editar a questão você precisa usar o modo popup.',
            icon: 'error',
          }).then((response) =>{
            window.close()
          })
        }
      {% endif %}
        
      $("button[type='submit']").on("click", function(event) {  
        $("input[required='required'], select[required='required']").each(function() {
            if ($(this).val() == "" || $(this).val() == null) {
              $(".tab-pane").removeClass("fade active show")
              $(".nav-link").removeClass("active")
              $(this).closest(".tab-pane").addClass("fade active show")
              return false;
            }
          });
        if(!app_question.no_tags){
          event.preventDefault()
          app_question.requestStatusTags()
        }
      });
      this.checkIfExistTemplate()
      
      {% if not form.instance|check_can_be_updated:user %}
        $(window).on('load',  () => {
          tinymce.get("{{form.enunciation.auto_id}}").setMode('readonly');
          inputs = $('input').filter(function() {
            return this.id.match(/id_question-option-form-\d+-id/);
          });
          inputs.each((i, e) => {
            tinymce.get(e.id.replace('-id', '-text')).setMode('readonly');
          })
        })
      {% endif %}

      document.getElementById('custom-toolbar-undo').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('Undo');
      })

      document.getElementById('custom-toolbar-redo').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('Redo');
      })

      document.getElementById('custom-toolbar-image').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('mceImage');
      })

      document.getElementById('custom-toolbar-media').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('mceMedia');
      })
      
      document.getElementById('custom-toolbar-indent').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('Indent');
      })

      document.getElementById('custom-toolbar-outdent').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('Outdent');
      })

      document.getElementById('custom-toolbar-superscript').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('Superscript');
      })

      document.getElementById('custom-toolbar-subscript').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('Subscript');
      })

      document.getElementById('custom-toolbar-numlist').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('InsertOrderedList');
      })

      document.getElementById('custom-toolbar-bullist').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('InsertUnorderedList');
      })
      
      document.getElementById('custom-toolbar-tiny_mce_wiris').addEventListener('click', function () {
        window.WirisPlugin.currentInstance.openNewFormulaEditor()
      })

      document.getElementById('custom-toolbar-clearformat').addEventListener('click', function () {
        tinymce.activeEditor.execCommand('removeformat');
      })
    },
    beforeDestroy() {
      window.removeEventListener('keydown', this.handleKeydown);
      if (this.questionForm) 
        this.questionForm.removeEventListener('submit', this.handleSubmitFormQuestion);
      }
  })


</script>

{% endblock %}
