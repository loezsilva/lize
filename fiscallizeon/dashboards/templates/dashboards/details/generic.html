{% extends 'redesign/base.html' %}
{% load split %}
{% load permissions %}

{% block title %}
  {% if who == 'classe' %}
    Desempenho da turma {{object.name}}
  {% elif who == 'student' %} 
    Desempenho do aluno {{object.name}}
  {% elif who == 'exam' %} 
    Desempenho do caderno {{object.name}}
  {% else %}
    Desempenho da escola 
  {% endif %}
  - Lize
{% endblock title %}

{% block css-additional %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
<style>
  /*///////////////////////////////////////////////////////////////////////////*/
  /* SELECT2 */
  /*///////////////////////////////////////////////////////////////////////////*/
  span#id-students-select2.select2-container .select2-selection--single, span#id-students-select2.select2-container--default .select2-selection--single .select2-selection__rendered {
    height: 72px;
  }

  * {
    font-family: inter !important;
  }

  .hover-gray:hover {
    background-color: #FAFBFC;
    font-weight: 600 !important;
  }

  span#id-students-select2.select2-container--default.select2-container--open.select2-container--below .select2-selection--single, span#id-students-select2.select2-container--default.select2-container--open.select2-container--below .select2-selection--multiple {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
  }

  span#id-students-select2.select2-container--default .select2-selection--single .select2-selection__arrow {
    height: 100%;
  }

  span#id-students-select2.select2-container .select2-selection--single .select2-selection__rendered {
    padding: 0;
  }

  span#id-students-select2.select2-container--default .select2-selection--single {
    border: 1px solid #E5E7EA;
    border-radius: 8px;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
  }

  span#id-students-select2 .select2-container--default .select2-selection--single .select2-selection__arrow b {
    border-color: #D0D5DD transparent transparent transparent;
  }

  span#id-students-select2 .select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b {
    border-color: transparent transparent #D0D5DD transparent;
  }

  span#id-students-select2-dropdown .select2-dropdown {
    border: 1px solid #E5E7EA;
    box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05);
    border-bottom-right-radius: 8px;
    border-bottom-left-radius: 8px;
  }

  span#id-students-select2-dropdown .select2-search__field {
    border: unset;
  }

  /*///////////////////////////////////////////////////////////////////////////*/
  /* DATERANGEPICKER */
  /*///////////////////////////////////////////////////////////////////////////*/

  .daterangepicker .ranges li.active {
    background-color: #FF8F3E;
  }

  .daterangepicker td.in-range {
    background-color: #FFF6EB;
  }

  .daterangepicker td.active, .daterangepicker td.active:hover {
    background-color: #F47605;
  }

  /*///////////////////////////////////////////////////////////////////////////*/
  /* RESET ECHARTS TOOLTIP */
  /*///////////////////////////////////////////////////////////////////////////*/

  .reset-echarts-tooltip {
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    padding: 0 !important;
    background-color: unset !important;
  }
  .dropdown-toggle {
    border: none;
  }
  .filter-option-inner-inner {
    text-align: right;
  }
  input:focus {
    border-color: transparent !important;
    box-shadow: none !important;
  }
  @media print {
    * {
      overflow: hidden !important;
    }
    .content-header {
      display: none;
    }
    .no-print {
      display: none;
    }
    body, .content {
      height: auto;
      width: 100%;
    }
  }
</style>
{% endblock %}

{% block content-body %}<div id="app" class="content-body p-0 m-0" style="overflow-x: hidden;">{% endblock content-body %}

{% block content-fixed %}
<div class="tw-flex tw-justify-center tw-bg-white">
  <div class="tw-max-w-[100rem] tw-flex-1">
    <div class="tw-bg-[#F9FAFB] tw-pb-6 tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]">
      <div class="no-print">
        <div class="d-flex align-items-center justify-content-between" style="padding-top: 24px;">
          <a href="#" onclick="history.back()" class="tw-inline-flex tw-items-center tw-gap-3 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600" style="font-family: 'Inter'; font-size: 14px; line-height: 24px; font-weight: 400; color: #374151;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M19 12H5M5 12L12 19M5 12L12 5" stroke="#9BA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            Voltar
          </a>
          <div>
            <button type="button" @click="printPage()" class="tw-rounded-md tw-px-3.5 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-100">
              Gerar PDF
            </button>
            <button v-if="(who=='school' || who=='turmas') && what=='exams'" type="button" @click="generateLinks()" class="tw-rounded-md tw-px-3.5 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-100">
              Gerar links de divulgação
            </button>
          </div>
        </div>
      </div>
      
      {% comment %}
      <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-6 sm:tw-flex-nowrap tw-w-full" style="padding-top: 24px;">
        <div class="tw-flex tw-items-center tw-gap-5">
          <div
            style="width: 60px; height: 60px; background-color: #FFFFFF; border: 1px solid #E5E7EA; border-radius: 12px; display: flex; align-items: center; justify-content: center;"
          >
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M21 21H4.6C4.03995 21 3.75992 21 3.54601 20.891C3.35785 20.7951 3.20487 20.6422 3.10899 20.454C3 20.2401 3 19.9601 3 19.4V3M21 7L15.5657 12.4343C15.3677 12.6323 15.2687 12.7313 15.1545 12.7684C15.0541 12.8011 14.9459 12.8011 14.8455 12.7684C14.7313 12.7313 14.6323 12.6323 14.4343 12.4343L12.5657 10.5657C12.3677 10.3677 12.2687 10.2687 12.1545 10.2316C12.0541 10.1989 11.9459 10.1989 11.8455 10.2316C11.7313 10.2687 11.6323 10.3677 11.4343 10.5657L7 15M21 7H17M21 7V11" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
          <h1 class="tw-text-xl tw-font-semibold tw-leading-7 tw-text-[#374151] sm:tw-truncate sm:tw-text-2xl sm:tw-tracking-tight tw-mb-0" style="font-weight: 600; font-size: 24px; line-height: 32px; font-family: 'Inter'; margin-bottom: 0px;">
            {% if who == 'classe' %}
              Desempenho da turma {{object.name}} - {{object.coordination.unity.name}}
            {% elif who == 'student' %} 
              Desempenho do aluno {{object.name|truncatewords:'1'}} {{object.get_classes_current_year.0.name}} - {{object.get_classes_current_year.0.coordination.unity.name}}
            {% elif who == 'student' %} 
              Desempenho do caderno {{object.name}}
            {% endif %}
          </h1>
        </div> 
        <!-- <div class="tw-ml-auto tw-flex tw-items-center tw-gap-3">
          <button type="button" class="tw-flex tw-gap-2 tw-rounded-md tw-px-4 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-100">
            Baixar
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M17.5 12.5V13.5C17.5 14.9001 17.5 15.6002 17.2275 16.135C16.9878 16.6054 16.6054 16.9878 16.135 17.2275C15.6002 17.5 14.9001 17.5 13.5 17.5H6.5C5.09987 17.5 4.3998 17.5 3.86502 17.2275C3.39462 16.9878 3.01217 16.6054 2.77248 16.135C2.5 15.6002 2.5 14.9001 2.5 13.5V12.5M14.1667 8.33333L10 12.5M10 12.5L5.83333 8.33333M10 12.5V2.5" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
          <button type="button" class="tw-flex tw-gap-2 tw-rounded-md tw-px-4 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-100">
            Compartilhar
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M17.5 7.50001L17.5 2.50001M17.5 2.50001H12.5M17.5 2.50001L10 10M8.33333 2.5H6.5C5.09987 2.5 4.3998 2.5 3.86502 2.77248C3.39462 3.01217 3.01217 3.39462 2.77248 3.86502C2.5 4.3998 2.5 5.09987 2.5 6.5V13.5C2.5 14.9001 2.5 15.6002 2.77248 16.135C3.01217 16.6054 3.39462 16.9878 3.86502 17.2275C4.3998 17.5 5.09987 17.5 6.5 17.5H13.5C14.9001 17.5 15.6002 17.5 16.135 17.2275C16.6054 16.9878 16.9878 16.6054 17.2275 16.135C17.5 15.6002 17.5 14.9001 17.5 13.5V11.6667" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div> -->
      </div>
      {% endcomment %}
        
    </div>
    <div class="tw-pb-8 tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="padding-bottom: 40px;">
      <div class="tw-pt-8" :style="loadingRequest ? 'pointer-events: none;':''">
        <h3 class="no-print" style="font-size: 16px; line-height: 24px; font-weight: 500; color: #101828; margin-bottom: 16px;">
          Encontramos para você
        </h3>
        <div class="tw-grid tw-grid-cols-1 tw-gap-x-4 tw-gap-y-8 sm:tw-grid-cols-8">
          <div class="sm:tw-col-span-4 sm:tw-col-start-1">
            <search-component></search-component>
          </div>
          <div class="sm:tw-col-span-2">
            <select-component ref="selectComponent"></select-component>
          </div>
          <div class="sm:tw-col-span-2">
            <div id="id-date" class="tw-flex tw-justify-between tw-w-full tw-rounded-md tw-border-0 tw-p-6 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" style="font-size: 16px; font-weight: 500; line-height: 24px;">
              <span class="tw-truncate"></span>
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M21 10H3M16 2V6M8 2V6M7.8 22H16.2C17.8802 22 18.7202 22 19.362 21.673C19.9265 21.3854 20.3854 20.9265 20.673 20.362C21 19.7202 21 18.8802 21 17.2V8.8C21 7.11984 21 6.27976 20.673 5.63803C20.3854 5.07354 19.9265 4.6146 19.362 4.32698C18.7202 4 17.8802 4 16.2 4H7.8C6.11984 4 5.27976 4 4.63803 4.32698C4.07354 4.6146 3.6146 5.07354 3.32698 5.63803C3 6.27976 3 7.11984 3 8.8V17.2C3 18.8802 3 19.7202 3.32698 20.362C3.6146 20.9265 4.07354 21.3854 4.63803 21.673C5.27976 22 6.11984 22 7.8 22Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </div>
          </div>
        </div>

        <!-- <div class="tw-grid tw-grid-cols-1 tw-gap-x-4 tw-gap-y-8 sm:tw-grid-cols-8">
          <div class="sm:tw-col-span-4 sm:tw-col-start-1">
            <select class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" style="padding: 24px;">
              <option>Alexandre Carlos Dantas</option>
              <option>Alexandra Barros da Silva</option>
              <option selected>Alex Oliveira</option>
            </select>
          </div>
          <div class="sm:tw-col-span-2">
            <select class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" style="font-size: 16px; font-family: 'Inter'; font-weight: 500; line-height: 24px; padding: 24px;">
              <option>Português</option>
              <option selected>Ciências</option>
              <option>Matemática</option>
            </select>
          </div>
          <div class="sm:tw-col-span-2">
            <input type="date" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" style="font-size: 16px; font-family: 'Inter'; font-weight: 500; line-height: 24px; padding: 24px;" />
          </div>
        </div> -->
      </div>
    </div>
    <hr style="margin: 0; border-color: #E5E7EA;" />
    <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="padding-top: 40px;">
      <h3 style="font-family: 'Inter'; font-size: 30px; line-height: 34px; font-weight: 500; color: #282F3E; letter-spacing: -0.01em; margin-bottom: 0;">
        Desempenho Geral
      </h3>
    </div>
    <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="padding-top: 24px;">
      <div class="tw-grid tw-grid-cols-1 tw-gap-x-8 tw-gap-y-16 sm:tw-grid-cols-3">
        <div style="display: flex; flex-direction: column; border: 1px solid #E5E7EA; height: 320px; border-radius: 12px; padding: 24px;" ref="average">
          <div class="tw-flex tw-justify-between tw-items-center tw-pb-2">
            <h3 style="font-size: 16px; line-height: 24px; font-weight: 500; color: #101828; margin-bottom: 0;">
              Média geral
            </h3>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-left: 8px;" data-toggle="tooltip" title="A média geral representa o desempenho em relação à média de toda a escola. A comparação é feita com base no percentual de acertos nas atividades avaliadas.">
              <g clip-path="url(#clip0_2002_1216)">
                <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              <defs>
                <clipPath id="clip0_2002_1216">
                  <rect width="16" height="16" fill="white"/>
                </clipPath>
              </defs>
            </svg>
          </div>
          <div>
            <span class="tw-flex tw-items-center">
              <template v-if="schoolAverage">
                <template v-if="schoolAverage.toFixed(0) > average.data.toFixed(0)">
                  <span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7 7L17 17M17 17V7M17 17H7" stroke="#D92D20" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </span>
                  <span style="font-size: 14px; font-family: 'Inter'; font-weight: 600; line-height: 20px; color: #D92D20; margin-left: 4px;">#{(schoolAverage - average.data).toFixed(0)}%</span>
                  <span style="font-size: 12px; font-family: 'Roboto'; font-weight: 400; line-height: 16px; color: #D92D20; margin-left: 8px;">abaixo da média da escola</span>
                </template>
                <template v-else-if="schoolAverage.toFixed(0) < average.data.toFixed(0)">
                  <span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <path d="M4.66602 11.3333L11.3327 4.66666M11.3327 4.66666V11.3333M11.3327 4.66666H4.66602" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </span>
                  <span style="font-size: 14px; font-family: 'Inter'; font-weight: 600; line-height: 20px; color: #41C588; margin-left: 4px;">#{(average.data - schoolAverage).toFixed(0)}%</span>
                  <span style="font-size: 12px; font-family: 'Roboto'; font-weight: 400; line-height: 16px; color: #667085; margin-left: 8px;">melhor que a média da escola</span>
                </template>
              </template>
            </span>
          </div>
          <div style="flex: 1;">
            <skeleton-card v-if="['loading', 'idle'].includes(average.status)"></skeleton-card>
            <div id="chartAvg" style="height: 100%;" :style="{ 'visibility': ['loading', 'idle'].includes(average.status) ? 'hidden':''  }"></div>
          </div>
        </div>
        <div style="display: flex; flex-direction: column; border: 1px solid #E5E7EA; height: 320px; border-radius: 12px; padding-top: 24px;" ref="progressByMonth">
          <div class="tw-flex tw-justify-between tw-items-center tw-pb-2" style="padding: 0 24px;">
            <h3 style="font-size: 16px; line-height: 24px; font-weight: 500; color: #101828; margin-bottom: 0;">
              Progresso
            </h3>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-left: 8px;" data-toggle="tooltip" title="O gráfico de progresso mostra a evolução do desempenho ao longo dos meses. O valor representa a média de acertos mensais nas atividades realizadas.">
              <g clip-path="url(#clip0_2002_1216)">
                <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              <defs>
                <clipPath id="clip0_2002_1216">
                  <rect width="16" height="16" fill="white"/>
                </clipPath>
              </defs>
            </svg>
          </div>
          <div style="flex: 1;">
            <skeleton-card v-if="['loading', 'idle'].includes(progressByMonth.status)"></skeleton-card>
            <div id="chartProgressByMonth" style="height: 100%;" :style="{ 'visibility': ['loading', 'idle'].includes(progressByMonth.status) ? 'hidden':''  }"></div>
          </div>
        </div>
        <div style="display: flex; flex-direction: column; border: 1px solid #E5E7EA; height: 320px; border-radius: 12px; padding: 24px;" ref="hitsAndMisses">
          <div class="tw-flex tw-justify-between tw-items-center tw-pb-4">
            <h3 style="font-size: 16px; line-height: 24px; font-weight: 500; color: #101828; margin-bottom: 0;">
              Acertos e erros
            </h3>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-left: 8px;" data-toggle="tooltip" title="Este gráfico de pizza ilustra a proporção de acertos e erros em todas as atividades realizadas. O percentual central refere-se à quantidade de respostas corretas.">
              <g clip-path="url(#clip0_2002_1216)">
                <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </g>
              <defs>
                <clipPath id="clip0_2002_1216">
                  <rect width="16" height="16" fill="white"/>
                </clipPath>
              </defs>
            </svg>
          </div>
          <div style="flex: 1;">
            <skeleton-card v-if="['loading', 'idle'].includes(hitsAndMisses.status)"></skeleton-card>
            <div id="chartHitsAndMisses" style="height: 100%;" :style="{ 'visibility': ['loading', 'idle'].includes(hitsAndMisses.status) ? 'hidden':''  }"></div>
          </div>
        </div>
      </div>
    </div>
    {% if who == 'classe' or who == 'school' %}
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="padding-top: 24px;">
        <div class="row m-0 tw-gap-y-16">
          <div class="col-12 col-lg-8 pl-0 pr-2" ref="performanceBySubjects">
            <div style="display: flex; flex-direction: column; border: 1px solid #E5E7EA; height: 320px; border-radius: 12px; padding: 24px;">
              <div class="tw-flex tw-justify-between tw-items-center tw-pb-2">
                <h3 style="font-size: 16px; line-height: 24px; font-weight: 500; color: #101828; margin-bottom: 0;">
                  Performance média por disciplina
                </h3>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-left: 8px;">
                  <g clip-path="url(#clip0_2002_1216)">
                    <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_2002_1216">
                      <rect width="16" height="16" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </div>
              <div style="flex: 1;">
                <skeleton-card v-if="['loading', 'idle'].includes(performanceBySubjects.status)"></skeleton-card>
                <div id="performanceBySubjectsChart" style="height: 100%;" :style="{ 'visibility': ['loading', 'idle'].includes(performanceBySubjects.status) ? 'hidden':''  }"></div>
              </div>
            </div>
          </div>
          <div class="col-12 col-lg-4 pr-0 pl-4" ref="questionsSummary">
            <div style="display: flex; flex-direction: column; border: 1px solid #E5E7EA; height: 320px; border-radius: 12px; padding: 24px;">
              <div class="tw-flex tw-justify-between tw-items-center tw-pb-2">
                <h3 style="font-size: 16px; line-height: 24px; font-weight: 500; color: #101828; margin-bottom: 0;">
                  Desempenho nas questões
                </h3>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-left: 8px;" data-toggle="tooltip" title="O gráfico detalha o desempenho da turma nas questões categorizadas como fáceis, moderadas e difíceis. Os percentuais indicam a média de acertos para cada nível de dificuldade.">
                  <g clip-path="url(#clip0_2002_1216)">
                    <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_2002_1216">
                      <rect width="16" height="16" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </div>
              <skeleton-card v-if="questionsSummary.status == 'loading'"></skeleton-card>
              <template v-if="questionsSummary.status == 'success'">
                
                <div class="tw-flex tw-flex-col mt-2">
                  <div class="tw-flex tw-flex-col">
                    <div class="tw-flex tw-justify-between">
                      <p class="tw-font-normal tw-mb-0" style="font-weight: 600; font-size: 14px; line-height: 20px;">Fáceis</p>
                    </div>
                    <div class="d-flex justify-content-between aling-items-center">
                      <div class="w-100 d-flex align-items-center">
                        <div class="tw-overflow-hidden tw-rounded-sm w-100" style="background-color: #41C58810;">
                          <div class="tw-h-2 tw-rounded-sm" :style="{ width: questionsSummary.data.easy_avg + '%', backgroundColor: '#41C588' }"></div>
                        </div>
                      </div>
                      <p class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-[#001737] tw-mb-0 ml-3" style="font-size: 16px; font-weight: 500; line-height: 24px; color: #101828;">#{questionsSummary.data.easy}/#{questionsSummary.data.total}</p>
                    </div>
                  </div>
                  <div class="tw-flex tw-flex-col">
                    <div class="tw-flex tw-justify-between">
                      <p class="tw-text-xs tw-font-normal tw-mb-0" style="font-weight: 400; font-size: 14px; line-height: 20px; color: #667085;">Média de acerto de #{questionsSummary.data.easy_avg.toFixed(0)}%</p>
                    </div>
                  </div>
                </div>
                <hr class="my-2">
                <div class="tw-flex tw-flex-col">
                  <div class="tw-flex tw-flex-col">
                    <div class="tw-flex tw-justify-between">
                      <p class="tw-font-normal tw-mb-0" style="font-weight: 600; font-size: 14px; line-height: 20px;">Moderadas</p>
                    </div>
                    <div class="d-flex justify-content-between aling-items-center">
                      <div class="w-100 d-flex align-items-center">
                        <div class="tw-overflow-hidden tw-rounded-sm w-100" style="background-color: #F1AA5910;">
                          <div class="tw-h-2 tw-rounded-sm" :style="{ width: questionsSummary.data.medium_avg + '%', backgroundColor: '#F1AA59' }"></div>
                        </div>
                      </div>
                      <p class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-[#001737] tw-mb-0 ml-3" style="font-size: 16px; font-weight: 500; line-height: 24px; color: #101828;">#{questionsSummary.data.medium}/#{questionsSummary.data.total}</p>
                    </div>
                  </div>
                  <div class="tw-flex tw-flex-col">
                    <div class="tw-flex tw-justify-between">
                      <p class="tw-text-xs tw-font-normal tw-mb-0" style="font-weight: 400; font-size: 14px; line-height: 20px; color: #667085;">Média de acerto de #{questionsSummary.data.medium_avg.toFixed(0)}%</p>
                    </div>
                  </div>
                </div>
                <hr class="my-2">
                <div class="tw-flex tw-flex-col mb-2">
                  <div class="tw-flex tw-flex-col">
                    <div class="tw-flex tw-justify-between">
                      <p class="tw-font-normal tw-mb-0" style="font-weight: 600; font-size: 14px; line-height: 20px;">Difíceis</p>
                    </div>
                    <div class="d-flex justify-content-between aling-items-center">
                      <div class="w-100 d-flex align-items-center">
                        <div class="tw-overflow-hidden tw-rounded-sm w-100" style="background-color: #D92D2010;">
                          <div class="tw-h-2 tw-rounded-sm" :style="{ width: questionsSummary.data.hard_avg + '%', backgroundColor: '#D92D20' }"></div>
                        </div>
                      </div>
                      <p class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-[#001737] tw-mb-0 ml-3" style="font-size: 16px; font-weight: 500; line-height: 24px; color: #101828;">#{questionsSummary.data.hard}/#{questionsSummary.data.total}</p>
                    </div>
                  </div>
                  <div class="tw-flex tw-flex-col">
                    <div class="tw-flex tw-justify-between">
                      <p class="tw-text-xs tw-font-normal tw-mb-0" style="font-weight: 400; font-size: 14px; line-height: 20px; color: #667085;">Média de acerto de #{questionsSummary.data.hard_avg.toFixed(0)}%</p>
                    </div>
                  </div>
                </div>

              </template>
            </div>
          </div>
        </div>
      </div>
      
      {% comment %}
        <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="padding-top: 24px;">
          <div class="tw-grid tw-grid-cols-1 tw-gap-x-8 tw-gap-y-16 sm:tw-grid-cols-1" ref="distribution">
            <div style="display: flex; flex-direction: column; border: 1px solid #E5E7EA; border-radius: 12px; padding: 24px;">
              <div class="tw-flex tw-justify-between tw-items-center tw-pb-2">
                <h3 style="font-size: 16px; line-height: 24px; font-weight: 500; color: #101828; margin-bottom: 0;">
                  Mapa de calor de acerto e erros
                </h3>
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-left: 8px;">
                  <g clip-path="url(#clip0_2002_1216)">
                    <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </g>
                  <defs>
                    <clipPath id="clip0_2002_1216">
                      <rect width="16" height="16" fill="white"/>
                    </clipPath>
                  </defs>
                </svg>
              </div>
              <div style="flex: 1;">
                <skeleton-card v-if="['loading', 'idle'].includes(distribution.status)"></skeleton-card>
                <div id="distributionChart" style="min-height: 360px; height: 100%;" :style="{ 'visibility': ['loading', 'idle'].includes(distribution.status) ? 'hidden':''  }"></div>
              </div>
              <div class="d-flex align-items-center w-100" style="color: #667085;">
                <div>Acertos</div>
                <div class="mx-2" style="width: 80px; height: 8px; background: linear-gradient(90deg, #FF8F3D 0%, #FFE9D8 100%);"></div>
                <div>Erros</div>
              </div>
            </div>
          </div>
        </div>
      {% endcomment %}
        
    {% endif %}
    <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" id="challengesID" ref="challenges">
      <skeleton-card v-if="['loading', 'idle'].includes(challenges.status)"></skeleton-card>
      <span class="tw-flex tw-items-center tw-justify-between tw-pb-6" style="margin-top: 20p; padding-top: 72px;" v-if="challenges.data.length > 1">
        <div class="tw-flex tw-items-center">
          <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
            Histórico de desafios
          </h3>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" title="Este gráfico ilustra o histórico de desempenho nos últimos 20 instrumentos avaliativos aplicados. Cada barra representa a média de acertos em cada avaliação realizada.">
            <g clip-path="url(#clip0_2002_1216)">
              <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </g>
            <defs>
              <clipPath id="clip0_2002_1216">
                <rect width="16" height="16" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </div>
      </span>
      <div id="chartChallenges" style="width: 100%; height: 100px;" :style="['loading', 'idle'].includes(challenges.status) || challenges.data.length < 2 ? 'visibility: hidden;':''"></div>
      <div class="tw-flex tw-justify-center tw-pt-2" :class="{ 'd-none': challenges.data.length < 2 }">
        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Últimos 20 instrumentos avaliativos do período selecionado</p>
      </div>
    </div>

    <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="padding-top: 32px; padding-bottom: 32px;">
      <hr class="tw-m-0" style="border-color: #E5E7EA;" />
    </div>

    <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem] tw-pt-10">
      <div class="tw-flex tw-justify-between">
        <ul id="tab-header" role="tablist" class="tw-list-none tw-w-full tw-flex tw-mb-0">
          <li
            class="tw-w-full tw-text-center tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-[1.625rem] tw-cursor-pointer tw-border tw-border-[#E5E7EA] tw-rounded-tl-xl tw-border-b-0"
            :class="[activeTab === 'tab-1' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFB]']"
            @click="changeTab('tab-1')"
          >
            <span
              role="tab"
              aria-controls="tab-1"
              aria-selected="true"
              class="d-flex align-items-center justify-content-center tw-text-base tw-px-12 tw-font-medium tw-text-[#001737]"
            >
              Assuntos <div class="d-flex align-items-center justify-content-center tw-bg-primary-600 text-white mx-3 rounded-circle" style="width: 30px; height: 30px;">#{topics.status == 'success' ? topics.data.length : '-'}</div>
            </span>
          </li>
          <li
            class="tw-w-full tw-text-center tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-[1.625rem] tw-cursor-pointer tw-border tw-border-[#E5E7EA] tw-border-b-0 tw-border-l-0"
            :class="[activeTab === 'tab-2' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFB]']"
            @click="changeTab('tab-2')"
          >
            <span
              role="tab"
              aria-controls="tab-1"
              aria-selected="true"
              class="d-flex align-items-center justify-content-center tw-text-base tw-px-12 tw-font-medium tw-text-[#001737]"
            >
              Habilidades <div class="d-flex align-items-center justify-content-center tw-bg-primary-600 text-white mx-3 rounded-circle" style="width: 30px; height: 30px;">#{abilities.status == 'success' ? abilities.data.length : '-'}</div>
            </span>
          </li>
          <li
            class="tw-w-full tw-border tw-border-[#E5E7EA] tw-text-center tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-[1.625rem] tw-cursor-pointer tw-rounded-tr-xl tw-border-b-0 tw-border-l-0"
            :class="[activeTab === 'tab-3' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFB]']"
            @click="changeTab('tab-3')"
          >
            <span
              role="tab"
              aria-controls="tab-1"
              aria-selected="true"
              class="d-flex align-items-center justify-content-center tw-text-base tw-px-12 tw-font-medium tw-text-[#001737]"
            >
              Competências <div class="d-flex align-items-center justify-content-center tw-bg-primary-600 text-white mx-3 rounded-circle" style="width: 30px; height: 30px;">#{abilities.status == 'success' ? competences.data.length : '-'}</div>
            </span>
          </li>
        </ul>
      </div>
      <div id="tab-content" style="max-height: 480px; overflow-y: auto;">
        <div
          id="tab-1"
          role="tabpanel"
          aria-labelledby="tab-1-content"
          :style="{ display: activeTab === 'tab-1' ? 'block' : 'none' }"
        >
          <div class="tw-bg-white sm:tw-rounded-b-xl tw-pt-8 tw-border tw-border-[#E5E7EA] tw-mb-8">
            <div class="px-5" style="padding-bottom: 60px;" ref="topics">
              <span class="tw-flex justify-content-between tw-pb-6">
                <div class="tw-flex tw-items-center">
                  <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                    Grau de domínio nos assuntos
                  </h3>
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" title="Esta aba apresenta o grau de domínio em diferentes assuntos específicos. O valor reflete a porcentagem de acertos nas atividades relacionadas a cada assunto.">
                    <g clip-path="url(#clip0_2002_1216)">
                      <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </g>
                    <defs>
                      <clipPath id="clip0_2002_1216">
                        <rect width="16" height="16" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </div>
                <div class="d-flex justify-content-end">
                  <div class="row">
                    <div class="col">
                      <select id="inputFilterTopicsSubjects" v-model="subjectsBNCCs.selectedTopics" multiple data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0 mr-3">
                        <option :value="subject.id" v-for="subject in subjectsBNCCs.topics">#{subject.name}</option>
                      </select>
                    </div>
                  </div>
                </div>
              </span>
              <div>
                <skeleton-card v-if="['loading', 'idle'].includes(topics.status)"></skeleton-card>
                <ul role="list" class="tw-grid tw-gap-6 sm:tw-grid-cols-4">
                  <li class="tw-list-none tw-flex tw-flex-col tw-gap-6 tw-rounded-xl tw-bg-white tw-border tw-border-[#E5E7EA] tw-p-6" v-for="bncc in topics.data.filter(b => subjectsBNCCs.selectedTopics.length ? subjectsBNCCs.selectedTopics.includes(b.subject_id) : true)">
                    <h3 data-toggle="tooltip" :title="bncc.text" class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-gray-900 text-truncate mb-0">
                      #{bncc.text}
                      <br>
                      <span style="font-size: 0.7rem;">#{bncc.subject_name}</span>
                    </h3>
                    <div class="tw-flex tw-flex-col tw-gap-2">
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Grau de domínio</p>
                        <p class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-[#001737] tw-mb-0">#{bncc.performance.toFixed(2)}%</p>
                      </div>
                      <div class="tw-overflow-hidden tw-rounded-[0.25rem]" :style="{ backgroundColor: bncc.performance < 25 ? '#D92D2010' : bncc.performance >= 25 && bncc.performance < 50 ? '#F3B36410' : bncc.performance >= 50 && bncc.performance < 75 ? '#0C7BDB10' : '#41C58810' }">
                        <div class="tw-h-2 tw-rounded-sm" :style="{ width: bncc.performance +'%', backgroundColor: bncc.performance < 25 ? '#D92D20': bncc.performance >= 25 && bncc.performance < 50 ? '#F3B364' : bncc.performance >= 50 && bncc.performance < 75 ? '#0C7BDB' : '#41C588' }"></div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div
          id="tab-2"
          role="tabpanel"
          aria-labelledby="tab-2-content"
          :style="{ display: activeTab === 'tab-2' ? 'block' : 'none' }"
        >
          <div class="tw-bg-white sm:tw-rounded-b-xl tw-pt-8 tw-border tw-border-[#E5E7EA] tw-mb-8">
            <div class="px-5" style="padding-bottom: 60px;" ref="abilities">
              <span class="tw-flex justify-content-between tw-pb-6">
                <div class="tw-flex tw-items-center">
                  <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                    Grau de domínio nas habilidades
                  </h3>
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" title="Esta aba apresenta o grau de domínio em diferentes habilidades. O valor reflete a porcentagem de acertos nas atividades relacionadas a cada assunto.">
                    <g clip-path="url(#clip0_2002_1216)">
                      <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </g>
                    <defs>
                      <clipPath id="clip0_2002_1216">
                        <rect width="16" height="16" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </div>
                <div class="d-flex justify-content-end">
                  <div class="row">
                    <div class="col">
                      <select id="inputFilterAbilitiesSubjects" v-model="subjectsBNCCs.selectedAbilities" data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0 mr-3">
                        <option :value="subject.id" v-for="subject in subjectsBNCCs.abilities">#{subject.name}</option>
                      </select>
                    </div>
                  </div>
                </div>
              </span>
              <div>
                <skeleton-card v-if="['loading', 'idle'].includes(abilities.status)"></skeleton-card>
                <ul role="list" class="tw-grid tw-gap-6 sm:tw-grid-cols-4">
                  <li class="tw-list-none tw-flex tw-flex-col tw-gap-6 tw-rounded-xl tw-bg-white tw-border tw-border-[#E5E7EA] tw-p-6" v-for="bncc in abilities.data.filter(b => subjectsBNCCs.selectedAbilities.length ? subjectsBNCCs.selectedAbilities.includes(b.subject_id) : true)">
                    <h3 data-toggle="tooltip" :title="bncc.text" class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-gray-900 text-truncate mb-0">
                      #{bncc.code ? bncc.code+ '-':'' } #{bncc.text}
                      <br>
                      <span style="font-size: 0.7rem;">#{bncc.subject_name}</span>
                    </h3>
                    <div class="tw-flex tw-flex-col tw-gap-2">
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Grau de domínio</p>
                        <p class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-[#001737] tw-mb-0">#{bncc.performance.toFixed(2)}%</p>
                      </div>
                      <div class="tw-overflow-hidden tw-rounded-[0.25rem]" :style="{ backgroundColor: bncc.performance < 25 ? '#D92D2010' : bncc.performance >= 25 && bncc.performance < 50 ? '#F3B36410' : bncc.performance >= 50 && bncc.performance < 75 ? '#0C7BDB10' : '#41C58810' }">
                        <div class="tw-h-2 tw-rounded-sm" :style="{ width: bncc.performance +'%', backgroundColor: bncc.performance < 25 ? '#D92D20': bncc.performance >= 25 && bncc.performance < 50 ? '#F3B364' : bncc.performance >= 50 && bncc.performance < 75 ? '#0C7BDB' : '#41C588' }"></div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <div
          id="tab-3"
          role="tabpanel"
          aria-labelledby="tab-3-content"
          :style="{ display: activeTab === 'tab-3' ? 'block' : 'none' }"
        >
          <div class="tw-bg-white sm:tw-rounded-b-xl tw-pt-8 tw-border tw-border-[#E5E7EA] tw-mb-8">
            <div class="px-5" style="padding-bottom: 60px;" ref="competences">
              <span class="tw-flex justify-content-between tw-pb-6">
                <div class="tw-flex tw-items-center">
                  <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                    Grau de domínio nas competências
                  </h3>
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" title="Esta aba apresenta o grau de domínio em diferentes competências. O valor reflete a porcentagem de acertos nas atividades relacionadas a cada assunto.">
                    <g clip-path="url(#clip0_2002_1216)">
                      <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </g>
                    <defs>
                      <clipPath id="clip0_2002_1216">
                        <rect width="16" height="16" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </div>
                <div class="d-flex justify-content-end">
                  <div class="row">
                    <div class="col">
                      <select id="inputFilterCompetencesSubjects" v-model="subjectsBNCCs.selectedCompetences" data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0 mr-3">
                        <option :value="subject.id" v-for="subject in subjectsBNCCs.competences">#{subject.name}</option>
                      </select>
                    </div>
                  </div>
                </div>
              </span>
              <div>
                <skeleton-card v-if="['loading', 'idle'].includes(competences.status)"></skeleton-card>
                <ul role="list" class="tw-grid tw-gap-6 sm:tw-grid-cols-4">
                  <li class="tw-list-none tw-flex tw-flex-col tw-gap-6 tw-rounded-xl tw-bg-white tw-border tw-border-[#E5E7EA] tw-p-6" v-for="bncc in competences.data.filter(b => subjectsBNCCs.selectedCompetences.length ? subjectsBNCCs.selectedCompetences.includes(b.subject_id) : true)">
                    <h3 data-toggle="tooltip" :title="bncc.text" class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-gray-900 text-truncate mb-0">
                      #{bncc.code ? bncc.code+ '-':'' } #{bncc.text}
                      <br>
                      <span style="font-size: 0.7rem;">#{bncc.subject_name}</span>
                    </h3>
                    <div class="tw-flex tw-flex-col tw-gap-2">
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Grau de domínio</p>
                        <p class="tw-font-['Roboto'] tw-text-sm tw-font-medium tw-text-[#001737] tw-mb-0">#{bncc.performance.toFixed(2)}%</p>
                      </div>
                      <div class="tw-overflow-hidden tw-rounded-[0.25rem]" :style="{ backgroundColor: bncc.performance < 25 ? '#D92D2010' : bncc.performance >= 25 && bncc.performance < 50 ? '#F3B36410' : bncc.performance >= 50 && bncc.performance < 75 ? '#0C7BDB10' : '#41C58810' }">
                        <div class="tw-h-2 tw-rounded-sm" :style="{ width: bncc.performance +'%', backgroundColor: bncc.performance < 25 ? '#D92D20': bncc.performance >= 25 && bncc.performance < 50 ? '#F3B364' : bncc.performance >= 50 && bncc.performance < 75 ? '#0C7BDB' : '#41C588' }"></div>
                      </div>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% if who == 'classe' or who == 'school' %}
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem] tw-pt-12" ref="generalHistogram">
        <span class="tw-flex tw-items-center mb-5">
          <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
            Nível de aprendizado dos alunos
          </h3>
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2" data-toggle="tooltip" title="O nível de aprendizado dos alunos mostra a classificação da turma em uma escala que varia de 'Crítico' a 'Esperado'. O valor percentual indica o quanto os alunos estão atingindo os objetivos de aprendizado.">
            <g clip-path="url(#clip0_2002_1216)">
              <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </g>
            <defs>
              <clipPath id="clip0_2002_1216">
                <rect width="16" height="16" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </span>
        <div style="position: relative;" v-if="generalHistogram.data">
          <div :style="{ display: 'flex', flexDirection: 'column', alignItems: 'center', position: 'absolute', top: '-52px', left: `calc(${getMarkPositionAndColor().position}% - 27px)` }">
            <svg width="54" height="40" viewBox="0 0 54 40" fill="none" style="margin-bottom: 4px;">
              <path d="M27 37.5279L36.0615 30.9443L32.6003 20.2918L21.3997 20.2918L17.9385 30.9443L27 37.5279Z" :fill="getMarkPositionAndColor().color" :stroke="getMarkPositionAndColor().color" stroke-width="4"/>
              <rect x="2" y="2" width="50" height="32" rx="6" :fill="getMarkPositionAndColor().color"/>
              <rect x="2" y="2" width="50" height="32" rx="6" :stroke="getMarkPositionAndColor().color" stroke-width="4"/>
              <text x="50%" y="50%" text-anchor="middle" alignment-baseline="middle" fill="#FFFFFF" font-size="16px" font-family="Roboto" style="line-height: 20px; font-weight: 500;">#{generalHistogram.performance.toFixed(0)}%</text>
            </svg>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37256 18.6274 0 12 0C5.37256 0 0 5.37256 0 12C0 18.6274 5.37256 24 12 24ZM12 16C14.2091 16 16 14.2092 16 12C16 9.79083 14.2091 8 12 8C9.79089 8 8 9.79083 8 12C8 14.2092 9.79089 16 12 16Z" fill="#E5E7EA"/>
              <path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="white"/>
            </svg>
          </div>
          <div class="tw-flex tw-gap-1">
            <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['0-40'])+'%' }" v-if="generalHistogram.data['0-40']" class="tw-h-2 tw-bg-[#D92D20] tw-rounded-tl tw-rounded-bl"></div>
            <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['40-60'])+'%' }" v-if="generalHistogram.data['40-60']" class="tw-h-2 tw-bg-[#F3B364]"></div>
            <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['60-75'])+'%' }" v-if="generalHistogram.data['60-75']" class="tw-h-2 tw-bg-[#0C7BDB]"></div>
            <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['75-100'])+'%' }" v-if="generalHistogram.data['75-100']" class="tw-h-2 tw-bg-[#41C588] tw-rounded-tr tw-rounded-br"></div>
          </div>
          <div class="tw-flex tw-gap-1 tw-pt-4" v-if="generalHistogram.status == 'success'">
            <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['0-40'])+'%' }" v-if="generalHistogram.data['0-40']">
              <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['0-40']}</p>
              <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-text-nowrap tw-mb-0">Crítico</p>
            </div>
            <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['40-60'])+'%' }" v-if="generalHistogram.data['40-60']">
              <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['40-60']}</p>
              <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-text-nowrap tw-mb-0">Atenção</p>
            </div>
            <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['60-75'])+'%' }" v-if="generalHistogram.data['60-75']">
              <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['60-75']}</p>
              <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Esperado</p>
            </div>
            <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['75-100'])+'%' }" v-if="generalHistogram.data['75-100']">
              <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['75-100']}</p>
              <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Excepcional</p>
            </div>
          </div>
        </div>
      </div>
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="margin-top: 30px;">
        <span class="tw-flex tw-items-center tw-justify-between tw-pb-6">
          <div class="tw-flex tw-items-center">
            <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
              Alunos em destaque
            </h3>
          </div>
        </span>
      </div>
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem]" style="margin-top: 10px;" ref="classeRanking">
        <div class="row">
          <div class="col-12">
            <skeleton-card v-if="['loading', 'idle'].includes(classeRanking.status)"></skeleton-card>
            <table class="table" v-if="!['loading', 'idle'].includes(classeRanking.status)">
              <tr v-for="student in classeRanking.data">
                <td class="align-middle" style="border-left: 4px solid;" :style="{ borderLeftColor: student.performance < 40 ? '#D92D20': student.performance >= 40 && student.performance <= 60 ? '#F3B364' : student.performance > 60 && student.performance <= 75 ? '#0C7BDB' : '#41C588' }">
                  <div class="d-flex align-items-center">
                    <span style="color: #101828; font-size: 16px; font-weight: 500;">#{String(student.ranking).padStart(2, '0')}º</span>
                    <div class="text-uppercase d-flex align-items-center justify-content-center rounded-circle mx-3" style="width: 40px; height: 40px; background-color: #F9FAFB;">
                      <strong>#{getInitials(student.name)}</strong>
                    </div>
                    <span>#{student.name}</span>
                  </div>
                </td>
                <td class="align-middle">
                  <div class="align-middle d-flex align-items-center justify-content-end">
                    <span style="color: #101828; font-size: 16px; font-weight: 500;">#{student.performance.toFixed(0)}%</span>
                    <a class="ml-2" style="color: #667085;" target="_blank" :href="'{% url 'dashboards:dashboards' %}?who=student&who_id='+student.id">
                      <svg width="18" height="18" viewBox="0 0 20 20" fill="none">
                        <path d="M17.5 17.5H3.83333C3.36662 17.5 3.13327 17.5 2.95501 17.4092C2.79821 17.3293 2.67072 17.2018 2.59083 17.045C2.5 16.8667 2.5 16.6334 2.5 16.1667V2.5M17.5 5.83333L12.9714 10.3619C12.8064 10.5269 12.7239 10.6094 12.6288 10.6404C12.5451 10.6675 12.4549 10.6675 12.3712 10.6404C12.2761 10.6094 12.1936 10.5269 12.0286 10.3619L10.4714 8.80474C10.3064 8.63973 10.2239 8.55723 10.1288 8.52632C10.0451 8.49912 9.95493 8.49912 9.87124 8.52632C9.77611 8.55723 9.6936 8.63973 9.5286 8.80474L5.83333 12.5M17.5 5.83333H14.1667M17.5 5.83333V9.16667" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </svg>
                    </a>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    {% endif %}
      
  </div>
</div>
{% endblock content-fixed %}

{% block js-additional %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment-with-locales.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
<script>
  moment.locale('pt-br')
  var app = new Vue({
    delimiters: ['#{', '}'],
    el: '#app',
    components: {
      'skeleton-card': Vue.component('skeleton-card', {
          template: `
              <div class="lize-card mb-3" style="border: none;">
                  <div class="lize-card-body p-4">
                      <div class="row p-3">
                          <div class="col-3 skeleton-loader"></div>
                          <div class="offset-6"></div>
                          <div class="col-3 skeleton-loader"></div>
                      </div>
                      <div class="row">
                          <div class="col-8">
                              <div class="skeleton-loader"></div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-4">
                              <div class="skeleton-loader"></div>
                          </div>
                      </div>
                      <div class="row p-3 mt-3 mb-0">
                          <div class="col-3 skeleton-loader"></div>
                          <div class="offset-6"></div>
                          <div class="col-3 skeleton-loader"></div>
                      </div>
                  </div>
              </div>
          `,
      }),
      'select-component': Vue.component('select-component', {
        props: [],
        delimiters: ["#{", "}"],
        data: function() {
            return {
              controls: {
                show: false,
                loading: false,
              },
              search: {
                term: '',
                foundedSubjects: [],
                foundedExams: [],
                foundedStages: [],
              },
              groups: {
                subjects: {
                  expanded: false,
                  selecteds: [],
                },
                exams: {
                  expanded: false,
                  selecteds: [],
                },
                stages: {
                  expanded: false,
                  selecteds: [],
                },
                topics: {
                  expanded: false,
                  selecteds: [],
                },
                abilities: {
                  expanded: false,
                  selecteds: [],
                },
                competences: {
                  expanded: false,
                  selecteds: [],
                },
              },
              what: '',
              whatIDS: [],
              availablesWhats: {
                exams: ['exams', 'subjects', 'topics'],
                classes: ['exams', 'subjects', 'topics'],
              },
            }
        },
        methods: {
          resetArrays(exclude) {
            if(!exclude == 'exams') {
              this.groups.exams.selecteds = []
            } 
            if(!exclude == 'subjects') {
              this.groups.subjects.selecteds = []
            }
            if(!exclude == 'stages') {
              this.groups.stages.selecteds = []
            }
            if(!exclude == 'topics') {
              this.groups.topics.selecteds = []
            }
            if(!exclude == 'abilities') {
              this.groups.abilities.selecteds = []
            }
            if(!exclude == 'competences') {
              this.groups.competences.selecteds = []
            }
          },
          selectItem(item, itemType) {
            let id = item.id ? item.id : item
            this.what = itemType
            this.resetArrays(itemType)
            this.groups[itemType].selecteds.includes(id) ? this.groups[itemType].selecteds.splice(this.groups[itemType].selecteds.indexOf(id), 1):this.groups[itemType].selecteds.push(id)
          },
          applySelection() {
            this.whatIDS = []
            if(this.what) {
              this.groups[this.what].selecteds.forEach((id) => this.whatIDS.push(id))
              if(this.groups[this.what].selecteds.length) {
                this.$parent.addOrUpdateUrlParam('what', this.what)
                this.$parent.addOrUpdateUrlParam('what_ids', this.groups[this.what].selecteds.join(','))
              } else {
                this.$parent.removeUrlParam('what')
                this.$parent.removeUrlParam('what_ids')
              }
            } else {
              this.$parent.removeUrlParam('what')
              this.$parent.removeUrlParam('what_ids')
            }
          },
          getNames() {
            let names = []
            if(this.what == 'subjects') {
              names = this.$parent.availablesSubjects.filter(s => this.groups.subjects.selecteds.includes(s.id)).map((s) => s.name.split(' - ')[0]).join(', ')
            } else if(this.what == 'exams') {
              names = this.$parent.availablesExams.filter(s => this.groups.exams.selecteds.includes(s.id)).map((s) => s.name.split(' - ')[0]).join(', ')
            } else if(this.what == 'stages') {
              names = this.$parent.availablesStages.filter(s => this.groups.stages.selecteds.includes(s.id)).map((s) => s.name.split(' - ')[0]).join(', ')
            } else if(this.what == 'topics') {
              names = this.$parent.availablesTopics.filter(s => this.groups.topics.selecteds.includes(s.id)).map((s) => s.name.split(' - ')[0]).join(', ')
            } else if(this.what == 'abilities') {
              names = this.$parent.availablesAbilities.filter(s => this.groups.abilities.selecteds.includes(s.id)).map((s) => s.name.split(' - ')[0]).join(', ')
            } else if(this.what == 'competences') {
              names = this.$parent.availablesCompetences.filter(s => this.groups.competences.selecteds.includes(s.id)).map((s) => s.name.split(' - ')[0]).join(', ')
            }
            return names.length ? names : 'Todas'
          },
          onClickOutside() {
            this.controls.show = false
          },
        },
        watch: {
          what: function(val) {
            this.$parent.what = val
          },
          'controls.show': function(val) {
            if(val === false) {
              this.applySelection()
              this.$parent.resetLoadings()
            }
          },
          'whatIDS.length': function(val) {
            if(this.what == 'subjects') {
              this.$parent.whatIDS = this.groups.subjects.selecteds
            }
            if(this.what == 'exams') {
              this.$parent.whatIDS = this.groups.exams.selecteds
            }
            if(this.what == 'stages') {
              this.$parent.whatIDS = this.groups.stages.selecteds
            }
            if(this.what == 'topics') {
              this.$parent.whatIDS = this.groups.topics.selecteds
            }
            if(this.what == 'abilities') {
              this.$parent.whatIDS = this.groups.abilities.selecteds
            }
            if(this.what == 'competences') {
              this.$parent.whatIDS = this.groups.competences.selecteds
            }
          },
          'search.term': function(val) {
            if(val.length) {

              this.search.foundedSubjects = this.$parent.availablesSubjects.filter(s => s.name.toLowerCase().includes(val.toLowerCase()))
              this.search.foundedExams = this.$parent.availablesExams.filter(s => s.name.toLowerCase().includes(val))
              this.search.foundedStages = this.$parent.availablesStages.filter(s => s.name.toLowerCase().includes(val))
              this.search.foundedTopics = this.$parent.availablesTopics.filter(s => s.name.toLowerCase().includes(val))
              this.search.foundedAbilities = this.$parent.availablesAbilities.filter(s => s.name.toLowerCase().includes(val))
              this.search.foundedCompetences = this.$parent.availablesCompetences.filter(s => s.name.toLowerCase().includes(val))

              this.groups.subjects.expanded = true
              this.groups.exams.expanded = true
              this.groups.stages.expanded = true
              this.groups.topics.expanded = true
              this.groups.abilities.expanded = true
              this.groups.competences.expanded = true

              this.groups.subjects.selecteds = []
              this.groups.exams.selecteds = []
              this.groups.stages.selecteds = []
              this.groups.topics.selecteds = []
              this.groups.abilities.selecteds = []
              this.groups.competences.selecteds = []

            } else {

              this.groups.subjects.expanded = false
              this.groups.exams.expanded = false
              this.groups.stages.expanded = false
              this.groups.topics.expanded = false
              this.groups.abilities.expanded = false
              this.groups.competences.expanded = false
              
            }
          },
        },
        directives: {
          'click-outside': {
            bind: function(el, binding, vNode) {
              // Provided expression must evaluate to a function.
              if (typeof binding.value !== 'function') {
                const compName = vNode.context.name
                let warn = `[Vue-click-outside:] provided expression '${binding.expression}' is not a function, but has to be`
                if (compName) { warn += `Found in component '${compName}'` }
    
                console.warn(warn)
              }
              // Define Handler and cache it on the element
              const bubble = binding.modifiers.bubble
              const handler = (e) => {
                if (bubble || (!el.contains(e.target) && el !== e.target)) {
                  binding.value(e)
                }
              }
              el.__vueClickOutside__ = handler
    
              // add Event Listeners
              document.addEventListener('click', handler)
            },
    
            unbind: function(el, binding) {
              // Remove Event Listeners
              document.removeEventListener('click', el.__vueClickOutside__)
              el.__vueClickOutside__ = null
            }
          },
        },
        template: `
          <div style="border: 1px solid #D0D5DD; border-radius: .375rem;" v-click-outside="onClickOutside" @click="controls.show = true">
            <div class="dropdown">
              <div :disabled="controls.loading" data-toggle="dropdown" aria-expanded="false" class="text-truncate tw-block tw-w-full tw-border-0 tw-p-6 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" style="font-size: 16px; font-weight: 500; line-height: 24px;">
                <div class="d-flex align-items-center justify-content-between">
                  <span>#{getNames()}</span>
                  <span>
                    <svg width="14" height="8" viewBox="0 0 14 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M1 1L7 7L13 1" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                  </span>
                </div>
              </div>
              <div class="dropdown-menu mt-0" style="background border-radius: 0 0 .375rem .375rem; border-top: none; min-width: 100%;">
                <div class="row m-0">
                  <div class="col-12 px-0" style="border-bottom: 1px solid #F5F6F7;">
                    <div class="input-group">
                      <div class="input-group-prepend">
                        <span class="input-group-text bg-white border-0">
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 14L11.1 11.1M12.6667 7.33333C12.6667 10.2789 10.2789 12.6667 7.33333 12.6667C4.38781 12.6667 2 10.2789 2 7.33333C2 4.38781 4.38781 2 7.33333 2C10.2789 2 12.6667 4.38781 12.6667 7.33333Z" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </span>
                      </div>
                      <input type="text" v-model="search.term" style="color: #D0D5DD; font-size: 14px;" class="form-control border-0 py-4" placeholder="Pesquisar" aria-label="Pesquisar">
                    </div>
                  </div>
                </div>
                <div style="overflow-y: scroll; max-height: 260px;">
                  <div class="row m-0" style="border-top: 1px solid #F5F6F7;" :class="{ 'd-none': search.term.length && !search.foundedSubjects.length }">
                    <div class="col-12">
                      <p class="d-flex justify-content-between mb-0 py-3 cp" @click="groups.subjects.expanded = !groups.subjects.expanded" style="font-size: 12px; color: #6C727F; font-weight: 400; line-height: 18px;">
                        Disciplinas 
                        <svg v-if="groups.subjects.expanded" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg v-else width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </p>
                      <div class="row" v-if="groups.subjects.expanded">
                        <div @click="selectItem(item, 'subjects')" v-for="item in search.term.length ? search.foundedSubjects : $parent.availablesSubjects" :style="groups.subjects.selecteds.includes(item.id) ? 'background-color: #FAFBFC;font-weight: 600 !important;':''" class="col-12 my-1 cp hover-gray d-flex flex-column mb-0 d-flex justify-content-center" style="height: 44px; color: #384250; font-size: 14px; font-weight: 400; line-height: 20px;">
                          <p class="text-truncate mb-0">#{item.name.split(' - ')[0]}</p>
                          <p class="text-muted text-truncate mb-0" style="font-size: 12px;">#{item.name.split(' - ')[1]}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row m-0" style="border-top: 1px solid #F5F6F7;" :class="{ 'd-none': search.term.length && !search.foundedExams.length }">
                    <div class="col-12">
                      <p class="d-flex justify-content-between mb-0 py-3 cp" @click="groups.exams.expanded = !groups.exams.expanded" style="font-size: 12px; color: #6C727F; font-weight: 400; line-height: 18px;">
                        Instrumentos avaliativos 
                        <svg v-if="groups.exams.expanded" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg v-else width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </p>
                      <div class="row" v-if="groups.exams.expanded">
                        <div @click="selectItem(item, 'exams')" v-for="item in search.term.length ? search.foundedExams : $parent.availablesExams" :style="groups.exams.selecteds.includes(item.id) ? 'background-color: #FAFBFC;font-weight: 600 !important;':''" class="col-12 my-1 cp hover-gray d-flex flex-column mb-0 d-flex justify-content-center" style="height: 44px; color: #384250; font-size: 14px; font-weight: 400; line-height: 20px;">
                          <p class="mb-0 text-truncate">#{item.name}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row m-0" style="border-top: 1px solid #F5F6F7;" :class="{ 'd-none': search.term.length && !search.foundedStages.length }">
                    <div class="col-12">
                      <p class="d-flex justify-content-between mb-0 py-3 cp" @click="groups.stages.expanded = !groups.stages.expanded" style="font-size: 12px; color: #6C727F; font-weight: 400; line-height: 18px;">
                        Etapa de ensino 
                        <svg v-if="groups.stages.expanded" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg v-else width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </p>
                      <div class="row" v-if="groups.stages.expanded">
                        <div @click="selectItem(item, 'stages')" v-for="item in search.term.length ? search.foundedStages : $parent.availablesStages" :style="groups.stages.selecteds.includes(item.id) ? 'background-color: #FAFBFC;font-weight: 600 !important;':''" class="col-12 my-1 cp hover-gray d-flex flex-column mb-0 d-flex justify-content-center" style="height: 44px; color: #384250; font-size: 14px; font-weight: 400; line-height: 20px;">
                          <p class="mb-0 text-truncate">#{item.name}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row m-0" style="border-top: 1px solid #F5F6F7;" :class="{ 'd-none': search.term.length && !search.foundedTopics.length }">
                    <div class="col-12">
                      <p class="d-flex justify-content-between mb-0 py-3 cp" @click="groups.topics.expanded = !groups.topics.expanded" style="font-size: 12px; color: #6C727F; font-weight: 400; line-height: 18px;">
                        Assuntos 
                        <svg v-if="groups.topics.expanded" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg v-else width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </p>
                      <div class="row" v-if="groups.topics.expanded">
                        <div @click="selectItem(item, 'topics')" v-for="item in search.term.length ? search.foundedTopics : $parent.availablesTopics" :style="groups.topics.selecteds.includes(item.id) ? 'background-color: #FAFBFC;font-weight: 600 !important;':''" class="col-12 my-1 cp hover-gray d-flex flex-column mb-0 d-flex justify-content-center" style="height: 44px; color: #384250; font-size: 14px; font-weight: 400; line-height: 20px;">
                          <p class="mb-0 text-truncate">#{item.name}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row m-0" style="border-top: 1px solid #F5F6F7;" :class="{ 'd-none': search.term.length && !search.foundedAbilities.length }">
                    <div class="col-12">
                      <p class="d-flex justify-content-between mb-0 py-3 cp" @click="groups.abilities.expanded = !groups.abilities.expanded" style="font-size: 12px; color: #6C727F; font-weight: 400; line-height: 18px;">
                        Habilidades 
                        <svg v-if="groups.abilities.expanded" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg v-else width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </p>
                      <div class="row" v-if="groups.abilities.expanded">
                        <div @click="selectItem(item, 'abilities')" v-for="item in search.term.length ? search.foundedAbilities : $parent.availablesAbilities" :style="groups.abilities.selecteds.includes(item.id) ? 'background-color: #FAFBFC;font-weight: 600 !important;':''" class="col-12 my-1 cp hover-gray d-flex flex-column mb-0 d-flex justify-content-center" style="height: 44px; color: #384250; font-size: 14px; font-weight: 400; line-height: 20px;">
                          <p class="mb-0 text-truncate">#{item.name}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row m-0" style="border-top: 1px solid #F5F6F7;" :class="{ 'd-none': search.term.length && !search.foundedCompetences.length }">
                    <div class="col-12">
                      <p class="d-flex justify-content-between mb-0 py-3 cp" @click="groups.competences.expanded = !groups.competences.expanded" style="font-size: 12px; color: #6C727F; font-weight: 400; line-height: 18px;">
                        Competências 
                        <svg v-if="groups.competences.expanded" width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <svg v-else width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </p>
                      <div class="row" v-if="groups.competences.expanded">
                        <div @click="selectItem(item, 'competences')" v-for="item in search.term.length ? search.foundedCompetences : $parent.availablesCompetences" :style="groups.competences.selecteds.includes(item.id) ? 'background-color: #FAFBFC;font-weight: 600 !important;':''" class="col-12 my-1 cp hover-gray d-flex flex-column mb-0 d-flex justify-content-center" style="height: 44px; color: #384250; font-size: 14px; font-weight: 400; line-height: 20px;">
                          <p class="mb-0 text-truncate">#{item.name}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `,
      }),
      {% include 'dashboards/includes/search-component.html' %},
    },
    data: {
      controls: {
        urlsParams: {},
        interval: null,
        activeRequests: 0,
      },
      topics: {
        status: 'idle',
        data: []
      },
      abilities: {
        status: 'idle',
        data: []
      },
      competences: {
        status: 'idle',
        data: []
      },
      availablesSubjects: [],
      availablesExams: [],
      availablesStages: [],
      availablesTopics: [],
      availablesAbilities: [],
      availablesCompetences: [],
      availablesPeriod: [],
      subjectsBNCCs: {
        topics: [],
        abilities: [],
        competences: [],
        selectedTopics: [],
        selectedAbilities: [],
        selectedCompetences: [],
      },
      performanceBySubjects: {
        status: 'idle',
        data: null,
        error: null,
      },
      questionsSummary: {
        status: 'idle',
        data: [],
        error: null,
      },
      challenges: {
        status: 'idle',
        data: [],
        error: null,
      },
      distribution: {
        status: 'idle',
        data: null,
        error: null,
      },
      progressByMonth: {
        status: 'idle',
        data: [],
        error: null,
      },
      hitsAndMisses: {
        status: 'idle',
        data: [],
        error: null,
      },
      generalHistogram: {
        status: 'idle',
        data: null,
        performance: 0,
        error: null,
        getColor: () => {
          let color = '#D92D20' 
          value = app.generalHistogram.performance
          if(value <= 40) {
            color = '#D92D20'
          } else if(value > 40 && value <= 60) {
            color = '#F3B364'
          } else if(value > 60 && value <= 75) {
            color = '#0C7BDB'
          } else if (value > 75) {
            color = '#41C588'
          }
          return color
        }
      },
      schoolAverage: 0,
      average: {
        status: 'idle',
        data: 0,
        error: null,
      },
      classeRanking: {
        status: 'idle',
        data: [],
        error: {}
      },
      activeTab: 'tab-1',
      what: '',
      whatIDS: [],
      who: '',
      whoIDS: [],
      period: {
        start: moment(),
        end: moment(),
      },
      loading: true,
      unities: [
        {% for unity in unities %}
          {
            id: "{{unity.id}}",
            name: "{{unity.name}}"
          },
        {% endfor %}
      ],
    },
    computed: {
      loadingRequest: function() {
        return this.controls.activeRequests > 0
      }
    },
    watch: {
      
    },
    methods: {
      addOrUpdateUrlParam(key, value) {
        let url = new URL(window.location.href);
        let params = new URLSearchParams(url.search);

        params.set(key, value); // Adiciona ou atualiza o parâmetro

        url.search = params.toString();
        window.history.pushState({}, '', url);
      },
      removeUrlParam(key) {
        let url = new URL(window.location.href);
        let params = new URLSearchParams(url.search);

        params.delete(key); // Remove o parâmetro

        url.search = params.toString();
        window.history.pushState({}, '', url);
      },
      async generateLinks() {
        Swal.fire({
          title: 'Confirmação',
          text: "Gerando links de divulgação, por favor aguarde...",
          icon: 'info',
          timer: 3000,
          timerProgressBar: true
        })
        
        let url = new URL(window.location.href);
        let params = new URLSearchParams(url.search);

        let what = params.get('what') == null ? this.what : params.get('what');
        let what_ids = params.get('what_ids') == null ? this.whatIDS : params.get('what_ids').split(',');
        
        await axios({
          method: 'POST',
          url: `{% url 'dashboards:generate-links' user.client.id %}`,
          data: {
            "who": "{{who}}",
            "who_ids": ["{{who_id|default:''}}"],
            "operation": "get_avg_x_school",
            "what": what,
            "what_ids": what_ids,
            "filters": {
              "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
              "user_unities": this.unities.map((u) => u.id),
            }
          }
        }).catch((e) => {
          Swal.fire({
            title: 'Erro',
            text: 'Não foi possível gerar os links, tente novamente.',
            icon: 'error',
            confirmButtonText: 'Ok'
          })
        }).then((response) => {
          const url = window.URL.createObjectURL(new Blob([response.data]));
          const link = document.createElement('a');
          link.href = url;
          link.setAttribute('download', 'links-students.csv');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
        })
      },
      getHistogramProportion(value) {
        let total = this.generalHistogram.data['0-40'] + this.generalHistogram.data['40-60'] + this.generalHistogram.data['60-75'] + this.generalHistogram.data['75-100']
        return value / total * 100
      },
      getMarkerPosition(value) {
        if (value >= 0 && value < 40) {
          return { index: 0, proportion: value / 40, color: '#D92D20' };
        } else if (value >= 40 && value < 60) {
          return { index: 1, proportion: (value - 40) / 20, color: '#F3B364' };
        } else if (value >= 60 && value < 75) {
          return { index: 2, proportion: (value - 60) / 15, color: '#0C7BDB' };
        } else if (value >= 75 && value <= 100) {
          return { index: 3, proportion: (value - 75) / 25, color: '#41C588' };
        }
      },
      getMarkPositionAndColor(value) {
        if (!value) {
          value = this.generalHistogram.performance
        }
        let numbers = [this.generalHistogram.data['0-40'], this.generalHistogram.data['40-60'], this.generalHistogram.data['60-75'], this.generalHistogram.data['75-100']]
        let positionAndColor = this.getMarkerPosition(value)
        let width = 0
        let positionWidth = this.getHistogramProportion(numbers[positionAndColor.index])
        numbers.filter((n, i) => i < positionAndColor.index).forEach((value, index) => {
          width += this.getHistogramProportion(numbers[index])
        })        
        return { position: width + (positionWidth * positionAndColor.proportion), color: positionAndColor.color }
      },
      moment(date) {
        return moment(date)
      },
      changeTab(tab) {
        this.activeTab = tab
      },
      async fetchGeneralHistogramData() {
        if(this.generalHistogram.status == 'idle' && this.isVisible(this.$refs.generalHistogram)) {
          this.generalHistogram.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_histogram",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.generalHistogram.status = 'success'
            this.generalHistogram.data = response.data[0]
          }).catch(() => {
            this.generalHistogram.status = 'error'
          })
        }
      },
      async fetchStudentAvgXClasseData() {
        if(this.average.status == 'idle' && this.isVisible(this.$refs.average)) {
          this.average.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "operation": "get_avg_x_classe",
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.average.status = 'success'
            let data = response.data[0]
            this.average.data = data.student_grade_avg
            let myChart = echarts.init(document.getElementById('chartAvg'))
            this.fetchSchoolAverageData()
            myChart.setOption({
                grid: {
                  top: '15%',
                  right: 0,
                  bottom: '10%',
                  left: 0,
                },
                xAxis: {
                  type: 'category',
                  data: [
                    {
                      value: '{{object.name|truncatewords:2}}',
                      textStyle: {
                        color: '#001737',
                        fontWeight: 500
                      }
                    },
                    {
                      value: '{{object.get_classes_current_year.0.name}}',
                      textStyle: {
                        color: '#667085'
                      }
                    }
                  ],
                  axisLine: {
                    lineStyle: {
                      color: '#E5E7EA'
                    }
                  },
                  axisTick: {
                    show: false
                  },
                  axisLabel: {
                    fontFamily: 'Inter',
                    margin: 8,
                    fontSize: 14,
                  }
                },
                yAxis: {
                  max: 'dataMax',
                  show: false,
                },
                series: [
                  {
                    type: 'bar',
                    barCategoryGap: 32,
                    label: {
                      show: true,
                      formatter: '{@score}%',
                      position: 'insideTop',
                      padding: [24, 0, 0, 0],
                      fontFamily: 'Roboto',
                      fontSize: 30,
                      fontWeight: 500,
                    },
                    itemStyle: {
                      barBorderRadius: [8, 8, 0, 0]
                    },
                    data: [
                      {
                        value: data.student_grade_avg,
                        label: {
                          color: '#FFFFFF',
                        },
                        itemStyle: {
                          color: '#FF8F3D'
                        }
                      },
                      {
                        value: data.classe_grade_avg,
                        label: {
                          color: '#282F3E',
                        },
                        itemStyle: {
                          color: '#FFF4EC'
                        }
                      }
                    ]
                  }
                ]
              })
          }).catch((e) => {
            this.average.status = 'error'
          })
        }
      },
      async fetchClasseAvgXSchoolData() {
        if(this.average.status == 'idle' && this.isVisible(this.$refs.average)) {
          this.average.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "operation": "get_avg_x_school",
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.average.status = 'success'
            let data = response.data[0]
            this.average.data = data.grade_avg
            this.generalHistogram.performance = this.average.data
            this.fetchSchoolAverageData(data.school_grade_avg)
            let myChart = echarts.init(document.getElementById('chartAvg'))
            myChart.setOption({
                grid: {
                  top: '15%',
                  right: 0,
                  bottom: '10%',
                  left: 0,
                },
                xAxis: {
                  type: 'category',
                  data: [
                    {
                      value: '{{object.name|truncatewords:2}}',
                      textStyle: {
                        color: '#001737',
                        fontWeight: 500
                      }
                    },
                    {
                      value: 'Escola',
                      textStyle: {
                        color: '#667085'
                      }
                    }
                  ],
                  axisLine: {
                    lineStyle: {
                      color: '#E5E7EA'
                    }
                  },
                  axisTick: {
                    show: false
                  },
                  axisLabel: {
                    fontFamily: 'Inter',
                    margin: 8,
                    fontSize: 14,
                  }
                },
                yAxis: {
                  max: 'dataMax',
                  show: false,
                },
                series: [
                  {
                    type: 'bar',
                    barCategoryGap: 32,
                    label: {
                      show: true,
                      formatter: '{@score}%',
                      position: 'insideTop',
                      padding: [24, 0, 0, 0],
                      fontFamily: 'Roboto',
                      fontSize: 30,
                      fontWeight: 500,
                    },
                    itemStyle: {
                      barBorderRadius: [8, 8, 0, 0]
                    },
                    data: [
                      {
                        value: data.grade_avg.toFixed(0),
                        label: {
                          color: '#FFFFFF',
                        },
                        itemStyle: {
                          color: '#FF8F3D'
                        }
                      },
                      {
                        value: data.school_grade_avg.toFixed(0),
                        label: {
                          color: '#282F3E',
                        },
                        itemStyle: {
                          color: '#FFF4EC'
                        }
                      }
                    ]
                  }
                ]
              })
          }).catch(() => {
            this.average.status = 'error'
          })
        }
      },
      async fetchProgressByMonthData() {
        if(this.progressByMonth.status == 'idle' && this.isVisible(this.$refs.progressByMonth)) {
          this.progressByMonth.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_avg_group_by_month",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.progressByMonth.status = 'success'
            let data = response.data[0]
            this.progressByMonth.data = data
            let myChart2 = echarts.init(document.getElementById('chartProgressByMonth'))
            
            myChart2.setOption({
              grid: {
                top: '30%',
                right: 0,
                bottom: 30,
                left: 0,
                backgroundColor: new echarts.graphic.LinearGradient(0, 1, 0, 0, [
                  {
                    offset: 0,
                    color: 'rgba(255,244,236,1)'
                  },
                  {
                    offset: 1,
                    color: 'rgba(255,244,236,0)'
                  }
                ]),
                borderWidth: 0,
                show: true,
              },
              tooltip: {
                trigger: 'item',
                formatter: '{c0}%',
                backgroundColor: '#FF8F3D',
                textStyle: {
                  fontFamily: 'Roboto',
                  fontSize: 16,
                  lineHeight: 20,
                  fontWeight: 500,
                  color: '#FFFFFF',
                },
              },
              xAxis: {
                type: 'category',
                data: data.map((m, i) => {
                  month = m.month.slice(0, 3)
                  if (i == data.length - 1) {
                    return {
                      value: month,
                      textStyle: {
                        color: '#001737',
                        fontWeight: 500,
                        fontFamily: 'Roboto',
                        fontSize: 14,
                        lineHeight: 20,
                      },
                    }
                  }
                  return month
                }),
                axisTick: {
                  show: false,
                },
                axisLine: {
                  lineStyle: {
                    color: '#E5E7EA'
                  }
                },
                axisLabel: {
                  margin: 8,
                  color: '#667085',
                  fontWeight: 400,
                  fontFamily: 'Inter',
                  fontSize: 14,
                  lineHeight: 20,
                },
              },
              yAxis: {
                show: false,
                min: 0,
              },
              series: [
                {
                  type: 'line',
                  lineStyle: {
                    color: '#FF8F3D',
                    width: 2,
                  },
                  label: {
                    show: true,  // Exibir o rótulo
                    position: 'top',  // Posição do rótulo em relação ao ponto
                    formatter: '{c}',  // Formato do rótulo (neste caso, o valor do ponto)
                    padding: [12, 0, 0, 0],
                    fontFamily: 'Roboto',
                    fontSize: 16,
                    fontWeight: 500,
                  },
                  itemStyle: {
                    color: '#FF8F3D',
                  },
                  symbolSize: 12,
                  data: data.map(m => m.performance.toFixed(0)),
                }
              ]
            })
          }).catch((e) => {
            this.progressByMonth.status = 'error'
          })
        }
      },
      async fetchHitsAndMissesData() {
        if(this.hitsAndMisses.status == 'idle' && this.isVisible(this.$refs.hitsAndMisses)) {
          this.hitsAndMisses.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "operation": "get_hits_and_misses",
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.hitsAndMisses.status = 'success'
            let data = response.data[0]
            this.hitsAndMisses.data = data
            let hits = data.hits
            let misses = data.misses
            let total = data.questions_count

            let myChart3 = echarts.init(document.getElementById('chartHitsAndMisses'))
            myChart3.setOption({
              tooltip: {
                trigger: 'item'
              },
              legend: {
                bottom: 0,
                left: 'center',
                data: ['Acertos', 'Erros']
              },
              series: [
                {
                  name: 'Acertos e erros',
                  type: 'pie',
                  radius: ['40%', '70%'],
                  label: {
                    show: false,
                  },
                  markPoint: {
                    tooltip: { show: false },
                    label: {
                      show: true,
                      formatter: '{b}',
                      color: '#282F3E',
                      fontFamily: 'Inter',
                      fontSize: 24,
                      lineHeight: 20,
                      fontWeight: 500,
                      letterSpacing: '-0.01em',
                    },
                    data: [{
                      name: `${total ? (hits / total * 100).toFixed(0) : 0}%`,
                      symbol: 'circle',
                      itemStyle: { color: 'transparent' },
                      x: '50%',
                      y: '50%',
                    }],
                  },
                  data: [
                    {
                      name: 'Acertos',
                      value: (hits / total * 100).toFixed(2),
                      itemStyle: { color: '#FF8F3D' },
                      emphasis: { itemStyle: { color: '#FF8024' } }
                    },
                    {
                      name: 'Erros',
                      value: (100 - (hits / total * 100)).toFixed(2),
                      itemStyle: { color: '#FFF4EC' },
                      emphasis: { itemStyle: { color: '#FFE5D3' } }
                    }
                  ]
                }
              ],
            })
          }).catch((e) => {
            this.hitsAndMisses.status = 'error'
          })
        }
      },
      startSelectInputsAndTooltips(selector = 'select') {
        if ($(selector).length && $(selector).data('selectpicker')) {
          // Se já foram inicializados, apenas atualize as options
          $(selector).each(function() {
            var $this = $(this);
            var options = $this.find('option');
            $this.selectpicker('destroy');
            $this.empty().append(options);
            $this.selectpicker({
              style: 'btn-white',
              placeholder: "Selecione as disciplinas",
              noneSelectedText: 'Nenhuma seleção',
              noneResultsText: 'Nenhum resultado encontrado',
            })
          });
        } else {
          $(selector).selectpicker({
            style: 'btn-white',
            placeholder: "Selecione as disciplinas",
            noneSelectedText: 'Nenhuma seleção',
            noneResultsText: 'Nenhum resultado encontrado',
          })
        }
        $('[data-toggle="tooltip"]').tooltip()
      },
      async fetchTopicsData() {
        if(this.topics.status == 'idle' && this.isVisible(this.$refs.topics)) {
          this.topics.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_topics_avg",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.topics.status = 'success'
            this.topics.data = response.data[0]
            this.subjectsBNCCs.topics = []
            this.topics.data.forEach((t) => {
              if(!this.subjectsBNCCs.topics.find((_t) => t.subject_name && t.subject_id == _t.id)) {
                this.subjectsBNCCs.topics.push({
                  id: t.subject_id,
                  name: t.subject_name,
                })
              }
            })
          }).catch(() => {
            this.topics.status = 'error'
          }).finally(() => {
            this.startSelectInputsAndTooltips()
            this.fetchAbilitiesData()
            this.fetchCompetencesData()
          })
        }
      },
      async fetchAbilitiesData() {
        this.abilities.status = 'loading'
        return await axios({
          method: 'POST',
          url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
          data: {
            "who": "{{who}}",
            "who_ids": ["{{who_id|default:''}}"],
            "what": this.what,
            "what_ids": this.whatIDS.length ? this.whatIDS: null,
            "operation": "get_abilities_avg",
            "filters": {
              "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
              "user_unities": this.unities.map((u) => u.id),
            }
          }
        }).then((response) => {
          this.abilities.status = 'success'
          this.abilities.data = response.data[0]
          this.subjectsBNCCs.abilities = []
          this.abilities.data.forEach((t) => {
            if(!this.subjectsBNCCs.abilities.find((_t) => t.subject_name && t.subject_id == _t.id)) {
              this.subjectsBNCCs.abilities.push({
                id: t.subject_id,
                name: t.subject_name,
              })
            }
          })
        }).catch(() => {
          this.abilities.status = 'error'
        }).finally(() => {
          this.startSelectInputsAndTooltips()
        })
      },
      async fetchCompetencesData() {
        this.competences.status = 'loading'
        return await axios({
          method: 'POST',
          url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
          data: {
            "who": "{{who}}",
            "who_ids": ["{{who_id|default:''}}"],
            "what": this.what,
            "what_ids": this.whatIDS.length ? this.whatIDS: null,
            "operation": "get_competences_avg",
            "filters": {
              "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
              "user_unities": this.unities.map((u) => u.id),
            }
          }
        }).then((response) => {
          this.competences.status = 'success'
          this.competences.data = response.data[0]
          this.subjectsBNCCs.competences = []
          this.competences.data.forEach((t) => {
            if(!this.subjectsBNCCs.competences.find((_t) => t.subject_name && t.subject_id == _t.id)) {
              this.subjectsBNCCs.competences.push({
                id: t.subject_id,
                name: t.subject_name,
              })
            }
          })
        }).catch(() => {
          this.competences.status = 'error'
        }).finally(() => {
          this.startSelectInputsAndTooltips()
        })
      },
      async fetchSchoolAverageData(schoolAverage) {
        if(schoolAverage) {
          this.schoolAverage = schoolAverage
          return
        }
        return await axios({
          method: 'POST',
          url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
          data: {
            "who": "school",
            "who_ids": ["{{user.client.id}}"],
            "what": this.what,
            "what_ids": this.whatIDS.length ? this.whatIDS: null,
            "operation": "get_avg",
            "filters": {
              "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
              "user_unities": this.unities.map((u) => u.id),
            }
          }
        }).then((response) => {
          this.schoolAverage = response.data[0]
        })
      },
      async fetchRankingData() {
        if(this.classeRanking.status == 'idle' && this.isVisible(this.$refs.classeRanking)) {
          this.classeRanking.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_ranking",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.classeRanking.status = 'success'
            this.classeRanking.data = response.data[0]
          }).catch(() => {
            this.classeRanking.status = 'error'
          })
        }
      },
      async fetchChallengesData() {
        if(this.challenges.status == 'idle' && this.isVisible(this.$refs.challenges)) {
          this.challenges.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": '{{who}}',
              "who_ids": ["{{object.id}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_challenges",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.challenges.status = 'success'
            // let data = response.data[0]
            this.challenges.data = response.data[0]

            let myChart4 = echarts.init(document.getElementById('chartChallenges'))
            myChart4.setOption({
              grid: {
                // show: true,
                // backgroundColor: 'rgb(255, 0, 0)',
                top: 0,
                right: -4,
                bottom: 0,
                left: -4,
                height: '100px',
              },
              xAxis: {
                show: false,
                type: 'category',
                data: this.challenges.data,
                axisTick: {
                  show: false
                },
              },
              yAxis: {
                show: false,
              },
              tooltip: {
                trigger: 'item',
                className: 'reset-echarts-tooltip',
                position: 'top', // Posiciona o tooltip na parte superior
                enterable: true, // Permite que o usuário entre no tooltip
                formatter: (params) => {
                  const { id, name, performance, hits, misses, partials, questions, date } = params.data;
                  return `
                    <div class="tw-w-fit tw-flex tw-flex-col tw-bg-white tw-border tw-border-[#E6E8EC] tw-rounded-lg">
                      <div class="tw-border-b tw-border-[#F3F3F3]">
                        <div class="tw-flex tw-items-center tw-justify-between tw-px-4 tw-pt-2 tw-pb-[0.563rem]">
                          <div>
                            <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">${name.toUpperCase().slice(0,10)}</p>
                          </div>
                          <div>
                            <p class="tw-text-xs tw-font-medium tw-text-[#667085] tw-mb-0">${moment(date).format('D, MMM')}</p>
                          </div>
                        </div>
                      </div>
                      <div class="tw-flex tw-gap-8 tw-p-4">
                        <div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${questions} questões</p>
                          </div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${hits} acertos</p>
                          </div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${misses} erros</p>
                          </div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${partials} parciais</p>
                          </div>
                        </div>
                        <div class="tw-flex tw-items-center tw-justify-center">
                          <p class="tw-text-3xl tw-leading-[2.125rem] tw-font-medium tw-text-[#FF8F3D] tw-tracking-[0.01em] tw-mb-0">${performance}%</p>
                        </div>
                      </div>
                      <div class="tw-px-4 tw-pb-4">
                        <a href="${'{% url 'exams:exams_detail_v2' pk='00000000-0000-0000-0000-000000000000' %}'.replace('00000000-0000-0000-0000-000000000000', id)}" target="_blank" class="btn-block text-center tw-w-full tw-rounded-lg tw-bg-primary-600 tw-px-3 tw-py-3 tw-text-sm tw-font-semibold tw-text-white hover:tw-bg-primary-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">Visualizar</a>
                      </div>
                    </div>
                  `
                },
              },
              series: [
                {
                  itemStyle: {
                    barBorderRadius: 2,
                    color: '#FFF8F2',
                  },
                  data: this.challenges.data.map((d) => {
                    if (true) {
                      return { ...d, value: d.performance, itemStyle: { color: '#FF8F3D' } }
                    }
                    return d.performance
                  }),
                  barCategoryGap: 8,
                  type: 'bar'
                }
              ]
            })
          }).catch((e) => {
            this.challenges.status = 'error'
          })
        }
      },
      callbackDateRangePicker(start, end) {
        this.period.start = start
        this.period.end = end
        
        let text = start.format('D [de] MMMM YYYY') + ' - ' + end.format('D [de] MMMM YYYY');
        let ranges = $('#id-date').data('daterangepicker').ranges;
        for (let key in ranges) {
          if (key === 'Customizado') continue;
          if (ranges[key][0].isSame(start) && ranges[key][1].isSame(end)) {
            text = key;
            break;
          }
        }
        $('#id-date span').html(`${text}`);
      },
      startDataPicker() {
        ///////////////////////////////////////////////////////////////////////////////
        // DATERANGEPICKER
        ///////////////////////////////////////////////////////////////////////////////

        $('#id-date').daterangepicker({
          'locale': {
            "format": "DD/MM/YYYY",
            "separator": " - ",
            "applyLabel": "Aplicar",
            "cancelLabel": "Cancelar",
            "fromLabel": "De",
            "toLabel": "Para",
            "customRangeLabel": "Customizado",
            "weekLabel": "W",
            "daysOfWeek": ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"],
            "monthNames": ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"],
            "firstDay": 1
          },
          startDate: this.period.start,
          endDate: this.period.end,
          ranges: {
            'Hoje': [moment(), moment()],
            'Ontem': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
            'Últimos 7 dias': [moment().subtract(6, 'days'), moment()],
            'Últimos 30 dias': [moment().subtract(29, 'days'), moment()],
            'Este mês': [moment().startOf('month'), moment().endOf('month')],
            'Último mês': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
          }
        }, this.callbackDateRangePicker);
        this.callbackDateRangePicker(this.period.start, this.period.end);
      },
      startSearch() {
        ///////////////////////////////////////////////////////////////////////////////
        // SELECT2
        ///////////////////////////////////////////////////////////////////////////////
        let studentsSelect2Object = $('#id-students').select2({
          ajax: {
            url: 'https://api.github.com/search/repositories',
            dataType: 'json',
            delay: 250,
            data: function (params) {
              return {
                q: params.term,
                page: params.page
              };
            },
            processResults: function (data, params) {
              params.page = params.page || 1;

              return {
                results: data.items,
                pagination: {
                  more: (params.page * 30) < data.total_count
                }
              };
            },
            cache: true
          },
          placeholder: 'Search...',
          minimumInputLength: 1,
          templateResult: formatRepo,
          templateSelection: formatRepoSelection
        });

        studentsSelect2Object.data('select2').$container.attr('id', 'id-students-select2');
        studentsSelect2Object.data('select2').$dropdown.attr('id', 'id-students-select2-dropdown');

        $('#id-students').on('select2:open', function () {
          $('.select2-search--dropdown .select2-search__field').attr('placeholder', 'Pesquisar aluno');
        });

        $('#id-students').on('select2:close', function () {
          $('.select2-search--dropdown .select2-search__field').attr('placeholder', null);
        });

        function formatRepo(repo) {
          if (repo.loading) return repo.text;

          let $container = $(
            "<div class='select2-result-content clearfix' style='display: flex; gap: 0.5rem;'>" +
              "<div class='select2-result-content__avatar'><img src='" + repo.owner.avatar_url + "' style='max-width: 50px; height: 50px;' /></div>" +
              "<div class='select2-result-content__meta'>" +
                "<div class='select2-result-content__title' style='font-size: 0.875rem; line-height: 1.25rem;'></div>" +
                "<div class='select2-result-content__description' style='font-size: 0.75rem; line-height: 1rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px;'></div>" +
              "</div>" +
            "</div>"
          );

          $container.find(".select2-result-content__title").text(repo.full_name);
          $container.find(".select2-result-content__description").text(repo.description);

          return $container;
        }

        function formatRepoSelection(repo) {
          // console.log(repo)

          if (!repo.id) return ''

          let $state = $(`
            <div>
              <div class="tw-flex tw-items-center tw-gap-3 tw-p-3">
                <img src="${repo.owner.avatar_url}" style="width: 48px; height: 48px; border-radius: 9999px;" />
                <div class="tw-flex tw-flex-col">
                  <span class="tw-text-base tw-font-medium tw-text-[#101828]">${repo.full_name || repo.text}</span>
                  <span class="tw-text-sm tw-font-normal tw-text-[#667085]">Ensino Fundamental - Nível 2</span>
                </div>
              </div>
            </div>
          `);

          return $state;
        }
      },
      async fetchAvailablesFilters() {
        return await axios({
          method: 'POST',
          url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
          data: {
            "who": "{{who}}",
            "who_ids": ["{{who_id|default:''}}"],
            "what": "{{who}}",
            "what_ids": ["{{who_id|default:''}}"],
            "operation": "get_availables_filters",
            "filters": {
              "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
              "user_unities": this.unities.map((u) => u.id),
            }
          }
        })
      },
      async fetchPerformanceBySubjects() {
        if(this.performanceBySubjects.status == 'idle' && this.isVisible(this.$refs.performanceBySubjects)) {
          this.performanceBySubjects.status = 'loading'
          return await axios({
            method: 'post',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`, 
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_subjects_avg",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.performanceBySubjects.status = 'success'
            this.performanceBySubjects.data = response.data[0]
            
            let performanceBySubjectsChartElement = document.getElementById('performanceBySubjectsChart')
            let performanceBySubjectsChart = echarts.init(performanceBySubjectsChartElement)

            performanceBySubjectsChart.setOption({
              grid: {
                top: 25,
                right: 0,
                bottom: 34,
                left: 32,
              },
              tooltip: {
                position: 'top',
                formatter: (params) => {
                  let subject = this.performanceBySubjects.data[params.dataIndex];
                  return subject.name + ': ' + subject.performance.toFixed(0) + '%';
                }
              },
              xAxis: {
                type: 'category',
                data: this.performanceBySubjects.data.filter(s => s.performance).map(s => s.name.toUpperCase().slice(0,3)),
                axisLine: {
                  lineStyle: {
                    color: '#E5E7EA'
                  }
                },
                axisTick: {
                  show: false
                },
                axisLabel: {
                  fontFamily: 'Inter',
                  margin: 16,
                  fontSize: 14,
                  color: '#667085'
                }
              },
              yAxis: {
                type: 'value',
                axisLabel: {
                  fontFamily: 'Inter',
                  margin: 32,
                  fontSize: 12,
                  color: '#D0D5DD',
                  align: 'left',
                },
                splitLine: {
                  lineStyle: {
                    color: ['#E5E7EA']
                  }
                }
              },
              series: [
                {
                  label: {
                    show: true,
                    formatter: '{@score}%',
                    position: 'top',
                    padding: [12, 0, 0, 0],
                    fontFamily: 'Roboto',
                    fontSize: 16,
                    fontWeight: 500,
                    // color: '#FFF'
                  },
                  itemStyle: {
                    barBorderRadius: [8, 8, 0, 0],
                    color: '#FF8F3D',
                  },
                  data: this.performanceBySubjects.data.filter(s => s.performance).map(s => s.performance.toFixed(0)),
                  type: 'bar'
                }
              ]
            })
            const resizeObserver = new ResizeObserver(entries => {
              performanceBySubjectsChart.resize()
            })
            resizeObserver.observe(performanceBySubjectsChartElement)
          }).catch((error) => {
            this.performanceBySubjects.status = 'error'
            this.performanceBySubjects.error = error
            console.error(error)
          })
        }
      },
      async fetchQuestionsSummary() {
        if(this.questionsSummary.status == 'idle' && this.isVisible(this.$refs.questionsSummary)) {
          this.questionsSummary.status = 'loading'
          return await axios({
            method: 'post',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`, 
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_questions_summary_hits",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.questionsSummary.status = 'success'
            this.questionsSummary.data = response.data[0]
          }).catch((e) => {
            this.questionsSummary.status = 'error'
          })
        }
      },
      async fetchDistribution() {
        if(this.distribution.status == 'idle' && this.isVisible(this.$refs.distribution)) {
          this.distribution.status = 'loading'
          return await axios({
            method: 'post',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`, 
            data: {
              "who": "{{who}}",
              "who_ids": ["{{who_id|default:''}}"],
              "what": this.what,
              "what_ids": this.whatIDS.length ? this.whatIDS: null,
              "operation": "get_hits_and_misses_questions",
              "filters": {
                "period": [this.period.start.format("YYYY-MM-DD"), this.period.end.format("YYYY-MM-DD")],
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => { 
            this.distribution.status = 'success'
            this.distribution.data = response.data[0]
            
            let distributionChartElement = document.getElementById('distributionChart')
            let distributionChart = echarts.init(distributionChartElement)

            {% comment %} const x = this.distribution.data.map((e) => e.id) {% endcomment %}
            {% comment %} const y = this.distribution.data.map((e) => e.id) {% endcomment %}
            
            let questions = this.distribution.data;

            let numRows = Math.ceil(questions.length / 20);  // Número de linhas necessárias
            let data = [];

            questions.forEach((question, idx) => {
              let x = idx % 20;
              let y = numRows - 1 - Math.floor(idx / 20);
              let normalizedHits = question.total > 0 ? question.hits / question.total : 0  // Normalizar os acertos
              data.push({ question: question, value: [x, y, normalizedHits]});
            });

            distributionChart.setOption({
              tooltip: {
                position: 'top'
              },
              animation: false,
              grid: {
                top: 26,
                right: 0,
                bottom: 20,
                left: 0,
              },
              xAxis: {
                type: 'category',
                {% comment %} data: x, {% endcomment %}
                {% comment %} data: ['Q1', 'Q2', 'Q3', 'Q4', 'Q5', 'Q6', 'Q7', 'Q8', 'Q9', 'Q10', 'Q11', 'Q12', 'Q13', 'Q14', 'Q15', 'Q16', 'Q17', 'Q18', 'Q19', 'Q20'], {% endcomment %}
                splitArea: {
                  show: false
                },
                axisLabel: {
                  show: false
                },
                splitLine: { show: false } // desativa linhas de divisão
              },
              yAxis: {
                type: 'category',
                {% comment %} data: y, {% endcomment %}
                splitArea: {
                  show: false
                },
                axisLabel: {
                  show: false
                },
                splitLine: { show: false } // desativa linhas de divisão
              },
              visualMap: {
                show: false,
                min: 0,
                max: 1,
                calculable: true,
                orient: 'horizontal',
                left: 'center',
                bottom: '15%',
                inRange: {
                  color: ['#FFE9D8', '#FF8F3D']
                },
              },
              series: [
                {
                  name: 'Acertos e erros',
                  type: 'heatmap',
                  data: data,
                  label: {
                    show: false
                  },
                  itemStyle: {
                    borderColor: '#fff',  // Cor da borda dos quadrados
                    borderWidth: 5,      // Largura da borda dos quadrados
                    borderRadius: 4,
                    // maxWidth: 1, // Define a largura máxima de cada célula
                    // maxHeight: 1, // Define a largura máxima de cada célula
                  },
                  emphasis: {
                    itemStyle: {
                      shadowBlur: 10,
                      shadowColor: 'rgba(0, 0, 0, 0.5)'
                    }
                  },
                  symbolSize: [5, 5],
                }
              ],
              tooltip: {
                trigger: 'item',
                className: 'reset-echarts-tooltip',
                position: 'top', // Posiciona o tooltip na parte superior
                enterable: true, // Permite que o usuário entre no tooltip
                formatter: (params) => {
                  const question = params.data.question
                  return `
                    <div class="tw-w-fit tw-flex tw-flex-col tw-bg-white tw-border tw-border-[#E6E8EC] tw-rounded-lg">
                      <div class="tw-border-b tw-border-[#F3F3F3]">
                        <div class="tw-flex tw-items-center tw-justify-between tw-px-4 tw-pt-2 tw-pb-[0.563rem]">
                          <div>
                            <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">${question.exam_name}</p>
                          </div>
                        </div>
                      </div>
                      <div class="tw-flex tw-gap-8 tw-p-4">
                        <div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${question.hits} Total de acertos</p>
                          </div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${question.total} Total de respostas</p>
                          </div>
                        </div>
                        <div class="tw-flex tw-items-center tw-justify-center">
                          <p class="tw-text-3xl tw-leading-[2.125rem] tw-font-medium tw-text-[#FF8F3D] tw-tracking-[0.01em] tw-mb-0">${(question.hits / question.total * 100).toFixed(2)}%</p>
                        </div>
                      </div>
                      <div class="tw-px-4 tw-pb-4">
                        <a href="${'{% url 'exams:exams_detail_v2' pk='00000000-0000-0000-0000-000000000000' %}'.replace('00000000-0000-0000-0000-000000000000', question.exam_id)}?turma={{who_id|default:''}}" target="_blank" class="btn-block text-center tw-w-full tw-rounded-lg tw-bg-primary-600 tw-px-3 tw-py-3 tw-text-sm tw-font-semibold tw-text-white hover:tw-bg-primary-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">Visualizar</a>
                      </div>
                    </div>
                  `
                },
              },
            })
            const resizeObserver = new ResizeObserver(entries => {
              distributionChart.resize()
            })
            resizeObserver.observe(distributionChartElement)
          }).catch((error) => {
            this.distribution.status = 'error'
            this.distribution.error = error
            console.error(error)
          }) 
        }
      },
      resetLoadings() {
        this.average.status = 'idle'
        this.progressByMonth.status = 'idle'
        this.hitsAndMisses.status = 'idle'
        this.challenges.status = 'idle'
        this.performanceBySubjects.status = 'idle'
        this.questionsSummary.status = 'idle'
        this.distribution.status = 'idle'
        this.topics.status = 'idle'
        this.abilities.status = 'idle'
        this.competences.status = 'idle'
        this.classeRanking.status = 'idle'
        this.generalHistogram.status = 'idle'
      },
      async fetchData(who = 'all') {
        this.loading = true
        {% if who == 'classe' or who == 'school' %} 
          this.fetchClasseAvgXSchoolData()
          this.fetchPerformanceBySubjects()
          this.fetchRankingData()
          // this.fetchDistribution()     
          this.fetchGeneralHistogramData()     
          this.fetchQuestionsSummary()     
        {% else %}
          this.fetchStudentAvgXClasseData()
        {% endif %}
        
        this.fetchProgressByMonthData()
        this.fetchHitsAndMissesData()
        this.fetchTopicsData()
        this.fetchChallengesData()
        this.loading = false
      },
      getInitials(text) {
        let textSplited = text.split(' ')
        try {
          if (textSplited.length > 1) {
            return `${textSplited[0][0]}${textSplited[textSplited.length - 1][0]}`
          } else {
            return textSplited.slice(0, 2)
          }
        } catch {
          return text[0].slice(0, 2)
        }
      },
      isVisible(element) {
        const rect = element.getBoundingClientRect();
        const viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight);
        
        // Verifica se o elemento está acima ou abaixo da janela de visualização
        const above = rect.bottom < 0;
        const below = rect.top > viewHeight;

        // Calcula a porcentagem do elemento visível na tela
        const visibleHeight = Math.min(viewHeight, rect.bottom) - Math.max(0, rect.top);
        const percentVisible = (visibleHeight / rect.height) * 100;

        const minPercentViewed = 50

        // Retorna true se pelo menos 20% do elemento estiver visível
        return !(above || below) && percentVisible >= minPercentViewed;
      },
      buildURL(params = {}) {
        const url = new URL(window.location.href);
        const searchParams = new URLSearchParams(url.search);

        // Adiciona os novos parâmetros
        for (const [key, value] of Object.entries(params)) {
          searchParams.set(key, value);
        }

        // Atualiza a URL com os novos parâmetros
        url.search = searchParams.toString();

        // Salva os parâmetros no localStorage
        localStorage.setItem('urlParams', url.search);
        return url.toString();
      },
      getURLParams() {
        const urlParams = new URLSearchParams(localStorage.getItem('urlParams'));
        const params = {};
        for (const [key, value] of urlParams.entries()) {
          params[key] = value;
        }
        return params;
      },
      handleOnLoadCharts() {
        this.controls.interval = setInterval(() => {
          this.fetchData()
        }, 250)
      },
      handleUrlsParamsOnInit() {
        const urlsParams = this.controls.urlsParams
        if(urlsParams.period) {
          let period = urlsParams.period.split(',')
          let start = period[0]
          let end = period[1]
          this.period.start = moment(start)
          this.period.end = moment(end)
        }
        if(urlsParams.what) {
          this.what = urlsParams.what
          this.whatIDS = String(urlsParams.what_ids) ? urlsParams.what_ids.split(',') : urlsParams.what_ids
          this.whatIDS.forEach((id) =>{
            this.$refs.selectComponent.selectItem(id, this.what)
          })
        }
        if(urlsParams.who) {
          this.who = urlsParams.who
          this.whoIDS = [urlsParams.who_id]
        }
      },
      printPage() {
        window.print()
      }
    },
    async mounted() {
      axios.interceptors.request.use((config) => {
        this.controls.activeRequests++
        return config;
      }, (error) => {
        this.controls.activeRequests--
        return Promise.reject(error);
      });
      axios.interceptors.response.use((response) => {
        this.controls.activeRequests--
        return response;
      }, (error) => {
          this.controls.activeRequests--;
          return Promise.reject(error);
      });
      await this.fetchAvailablesFilters().then((response) => {
          let data = response.data[0]
          this.availablesExams = data.exams
          this.availablesSubjects = data.subjects
          this.availablesStages = data.stages
          this.availablesTopics = data.topics
          this.availablesAbilities = data.abilities
          this.availablesCompetences = data.competences
          this.availablesPeriod = data.period
          this.period.start = moment(this.availablesPeriod[0])
          this.period.end = moment(this.availablesPeriod[1])
        }).then(() => {
        this.$nextTick().then(() => {
          this.buildURL()
        }).then(() => {
          this.controls.urlsParams = this.getURLParams()
        }).then(() => {
          this.handleUrlsParamsOnInit()
        }).then(() => {
          this.startDataPicker()
        }).then(() => {
          this.fetchData()
          this.handleOnLoadCharts()
        })
      })
      $(document).on('click', '.dropdown-menu', function (e) {
        e.stopPropagation();
      });
    }
  })
</script>
{% endblock js-additional %}