{% extends 'redesign/base.html' %}

{% load split %}
{% load permissions %}
{% load static %}

{% block title %}Dashboard (Coordenação) - Lize{% endblock title %}

{% block css-additional %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css">
<link rel="stylesheet" href="{% static 'css/swiper.min.css' %}" />
<style>
  .dropdown-toggle {
    border: none;
  }
  .filter-option-inner-inner {
    text-align: right;
  }
  @media print {
    * {
      overflow: hidden !important;
    }
    .no-print {
      display: none;
    }
    body, .content {
      height: auto;
      width: 100%;
    }
  }
  .hovable:hover path {
    stroke: #FF8F3D;
  }

  .scroll::-webkit-scrollbar {
    width: 5px; /* Define a largura do scroll */
  }

  /* Estiliza a parte do scroll que será a "track" */
  .scroll::-webkit-scrollbar-track {
    background: #f1f1f1; /* Cor de fundo do track */
  }

  /* Estiliza o "polegar" que é a parte que se move */
  .scroll::-webkit-scrollbar-thumb {
    background: #D3D6DB; /* Cor do polegar */
    border-radius: 10px; /* Bordas arredondadas */
  }

  /* Quando o usuário passa o mouse sobre o polegar */
  .scroll::-webkit-scrollbar-thumb:hover {
    background: #D3D6DB; /* Cor ao passar o mouse */
  }
  .swiper-slide {
    flex-shrink: 0;
    width: auto; /* Ou outro valor de ajuste */
  }
  .swiper-container {
    width: 100%;
    overflow: hidden;
  }
</style>
{% endblock %}

{% block header %}
{% endblock header %}

{% block content-body %}<div id="app" class="content-body tw-p-0 tw-h-full">{% endblock content-body %}

{% block content-fixed %}
<div class="tw-flex tw-justify-center tw-bg-white">
  <div class="w-100 tw-flex-1 tw-max-w-[100rem]">
    <div>
      <div class="tw-bg-[#F9FAFB] tw-pb-16 tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem] no-print">
        <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-6 sm:tw-flex-nowrap tw-w-full tw-pt-12">
          <div>
            <h1 class="tw-text-3xl tw-font-medium tw-text-[#374151] tw--tracking-wide sm:tw-truncate tw-mb-2"><!-- style="font-family: 'Inter';" -->
              Olá, {{ user.some_name|split|first }}
            </h1>
            <p class="tw-font-normal tw-text-sm tw-text-[#667085] tw-mb-0"><!-- style="font-family: 'Inter';" -->#{greeting()}</p>
          </div>
          <div class="tw-ml-auto tw-flex tw-items-center">
            
            {% if user.can_navigate_between_profiles  %}
            <div class= "tw-mr-2">
              {% if user.user_type == "teacher" %}
                <form method="post" action="{% url 'core:switch_user_profile' %}">
                  {% csrf_token %}
                  <button type="submit" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold hover:tw-text-white tw-shadow-sm hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 tw-transition-colors" >
                    Navegar como coordenador
                  </button>
                </form>
              {% else %}
                <form method="post" action="{% url 'core:switch_user_profile' %}">
                    {% csrf_token %}
                    <button type="submit" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold hover:tw-text-white tw-shadow-sm hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600 tw-transition-colors">
                      Navegar como professor
                    </button>
                </form>
              {% endif %}
            </div>
            {% endif %}

            {% if user.is_staff %}
              <div>
                <label for="hijack-client" class="tw-sr-only ">Instituição</label>
                <select id="hijack-client" name="hijack-client" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-pl-3 tw-pr-10 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" style="min-width: 150px;">
                  <option value="{{ user.client.pk }}" selected>{{ user.client.name }}</option>
                </select>
              </div>
            {% else %} 
              <button type="button" @click="printPage()" class="tw-rounded-md tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-100">
                Gerar PDF
              </button>
            {% endif %} 
            <div class="tw-flex tw-items-center tw-gap-6 tw-ml-8">
              <div class="ab" data-headlessui-state="" style="position: relative;"> 
                <div id="vueNotifications">
                  <notifications-component></notifications-component>
                </div>
              </div>
              <div class="ly cuk cwo dcb lg:tw-h-7" aria-hidden="true"></div>
              <div class="ab" data-headlessui-state="" style="position: relative;">
                <button class="fm ls yu aqi" id="headlessui-menu-button-1" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state="" style="-webkit-appearance: button; background-color: transparent; background-image: none; border-width: 0; padding: 0.375rem; align-items: center; display: flex; margin: -0.375rem;{% if request.resolver_match.url_name == 'password_change' %} background-color: #FFFEFA; border-radius: 0.375rem;{% endif %}">
                  <span class="t" style="position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;">
                    Open user menu
                  </span>
                  <span style="background-color: rgb(243, 244, 246); border-radius: 9999px; width: 2rem; height: 2rem; display: inline-block; overflow: hidden; box-shadow: inset 0 0 0 0px #fff, inset 0 0 0 calc(1px + 0px) rgb(209 213 219 / 1), 0 0 #0000;"><svg style="width: 100%; height: 100%; color: rgb(209, 213, 219);" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"></path></svg></span>
                </button>
                <div class="tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-w-56 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none" aria-labelledby="headlessui-menu-button-1" id="headlessui-menu-items-1" role="menu" tabindex="0" data-headlessui-state="open" style="display: none;">
                  <div class="tw-px-4 tw-py-3" role="none">
                    <p class="tw-text-sm tw-mb-0" role="none">Conectado como</p>
                    <p class="tw-truncate tw-text-sm tw-font-semibold tw-text-gray-900 tw-mb-0" role="none">{{ user.email }}</p>
                  </div>
                  <div class="tw-py-1" role="none">
                    <p class="tw-truncate tw-px-4 tw-py-2 tw-mb-0" role="none">
                      <span class="tw-block tw-text-xs tw-text-gray-500" role="none">Instituição</span>
                      <span class="tw-mt-0.5 tw-font-semibold" role="none">{{ user.client.name }}</span>
                    </p>
                  </div>
                  <div class="tw-py-1" role="none">
                    {% if user.user_type == "teacher" or user.user_type == "coordination" %}
                      {% if not user.client.two_factor_enabled%}
                        <button   @click="openModalTwoFactorActivate" class="bt lp ara ark avv awk axq menu-dropdown" style="display: block; padding-left: 0.75rem; padding-right: 0.75rem; padding-top: 0.25rem; padding-bottom: 0.25rem; font-size: 0.875rem; line-height: 1.5rem; color: rgb(17, 24, 39); font-family: Inter, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11'; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; -o-tab-size: 4; tab-size: 4; font-variation-settings: normal;">
                          Autenticação de dois fatores
                        </button>
                      {% endif%}
                    {% endif%}
                    <a href="{% url 'accounts:password_change' %}" class="lp ara ark avv awk axq menu-dropdown" id="headlessui-menu-item-9" role="menuitem" tabindex="-1" data-headlessui-state="" style="display: block; padding-left: 0.75rem; padding-right: 0.75rem; padding-top: 0.25rem; padding-bottom: 0.25rem; font-size: 0.875rem; line-height: 1.5rem; color: rgb(17, 24, 39); font-family: Inter, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11'; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; -o-tab-size: 4; tab-size: 4; font-variation-settings: normal;">
                      Alterar senha
                    </a>
                    <a href="{% url 'accounts:logout' %}" class="lp ara ark avv awk axq menu-dropdown" id="headlessui-menu-item-10" role="menuitem" tabindex="-1" data-headlessui-state="" style="display: block; padding-left: 0.75rem; padding-right: 0.75rem; padding-top: 0.25rem; padding-bottom: 0.25rem; font-size: 0.875rem; line-height: 1.5rem; color: rgb(17, 24, 39); font-family: Inter, ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji'; font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11'; -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; -o-tab-size: 4; tab-size: 4; font-variation-settings: normal;">
                      Sair
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="tw-bg-[#F9FAFB] tw--mt-16 tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem] tw-pb-14">
        <div class="tw-relative tw-pt-8 no-print">
          <div class="tw-rounded-lg" style="box-shadow: 0px 1px 2px 0px rgba(16, 24, 40, 0.05),0px 0px 0px 4px rgba(249, 250, 251, 1); border: 1px solid #D0D5DD; position: absolute; width: 100%; background-color: #fff; z-index: 2;" v-click-outside="onClickOutsideSearch">
            <div class="tw-relative">
              <div class="tw-pointer-events-none tw-absolute tw-inset-y-0 tw-left-0 tw-flex tw-items-center tw-pl-5">
                <template v-if="searchStatus === 'loading'">
                  <svg class="tw-animate-spin tw-h-5 tw-w-5 tw-text-primary-600" fill="none" viewBox="0 0 24 24" style="pointer-events: none; position: absolute; top: 0px; bottom: 0px; left: 1rem; height: 100%; width: 1.25rem;">
                    <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </template>
                <template v-else>
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M4.5 22V17M4.5 7V2M2 4.5H7M2 19.5H7M13 3L11.2658 7.50886C10.9838 8.24209 10.8428 8.60871 10.6235 8.91709C10.4292 9.1904 10.1904 9.42919 9.91709 9.62353C9.60871 9.84281 9.24209 9.98381 8.50886 10.2658L4 12L8.50886 13.7342C9.24209 14.0162 9.60871 14.1572 9.91709 14.3765C10.1904 14.5708 10.4292 14.8096 10.6235 15.0829C10.8428 15.3913 10.9838 15.7579 11.2658 16.4911L13 21L14.7342 16.4911C15.0162 15.7579 15.1572 15.3913 15.3765 15.0829C15.5708 14.8096 15.8096 14.5708 16.0829 14.3765C16.3913 14.1572 16.7579 14.0162 17.4911 13.7342L22 12L17.4911 10.2658C16.7579 9.98381 16.3913 9.8428 16.0829 9.62353C15.8096 9.42919 15.5708 9.1904 15.3765 8.91709C15.1572 8.60871 15.0162 8.24209 14.7342 7.50886L13 3Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                  </svg>
                </template>
              </div>
              <input type="search" name="search" id="search-field" class="tw-block tw-w-full tw-bg-white tw-rounded-lg tw-border-0 tw-py-5 tw-pl-[3.75rem] tw-font-medium tw-text-gray-900 placeholder:tw-text-[#D0D5DD] focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600" placeholder="Pesquisa por caderno, gabaritos, alunos ou turmas…" autocomplete="off" v-model="searchTerm" @input="debouncedSearch" @focus="onFocusSearch" />
            </div>
            <template v-if="searchStatus !== 'idle' && searchTerm.length > 0 && searchActive">
              <hr class="tw-m-0 tw-border-[#F5F6F7]" />
              <div>
                <template v-if="searchStatus !== 'idle' && searchTerm.length > 0">
                  <template v-if="searchResults.length > 0">
                    <ul class="tw-max-h-80 tw-scroll-pb-2 tw-scroll-pt-11 tw-space-y-2 tw-overflow-y-auto tw-mb-0 tw-divide-y tw-divide-[#E5E7EA]" id="options" role="listbox">
                      <li v-for="groupResult in searchResults" :key="groupResult.id">
                        <div class="tw-flex tw-items-center tw-justify-between tw-px-4 tw-py-2.5">
                          <h2 class="tw-text-xs tw-text-[#6C727F]">
                            #{ groupResult.name }
                          </h2>
                          <a
                            :href="{% if user_type == 'teacher' %}getUrlWithNameQueryTeacher(groupResult){% elif user_type == 'student' %}getUrlWithNameQueryStudent(groupResult){% elif user_type == 'coordination' %}getUrlWithNameQuery(groupResult){% endif %}"
                            class="tw-text-sm"
                          >
                            Ver #{ groupResult.name.toLowerCase() }
                          </a>
                        </div>
                        <ul class="tw-mt-2 tw-mb-4 tw-text-sm tw-text-gray-800">
                          <li v-for="result in groupResult.results" :key="result.id" class="tw-flex tw-items-center tw-cursor-default tw-select-none tw-px-4 tw-py-1 hover:tw-bg-[#F9FAFA] lz-parent-visible" :id="'option-' + result.pk" role="option">
                            <span class="tw-w-full tw-flex tw-items-center tw-justify-between">
                              <span class="tw-flex tw-cursor-pointer" @click="redirect(`${getGroupLink(groupResult)}?q_pk=${result.pk}`)">
                                <span class="tw-mr-3">
                                  <template v-if="groupResult.name.toLowerCase() === 'cadernos'">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                      <path d="M9.99996 17.5L9.91658 17.3749C9.33771 16.5066 9.04828 16.0725 8.66588 15.7582C8.32734 15.4799 7.93726 15.2712 7.51796 15.1438C7.04434 15 6.52255 15 5.47898 15H4.33329C3.39987 15 2.93316 15 2.57664 14.8183C2.26304 14.6586 2.00807 14.4036 1.84828 14.09C1.66663 13.7335 1.66663 13.2668 1.66663 12.3333V5.16667C1.66663 4.23325 1.66663 3.76654 1.84828 3.41002C2.00807 3.09641 2.26304 2.84144 2.57664 2.68166C2.93316 2.5 3.39987 2.5 4.33329 2.5H4.66663C6.53347 2.5 7.46689 2.5 8.17993 2.86331C8.80713 3.18289 9.31707 3.69282 9.63665 4.32003C9.99996 5.03307 9.99996 5.96649 9.99996 7.83333M9.99996 17.5V7.83333M9.99996 17.5L10.0833 17.3749C10.6622 16.5066 10.9516 16.0725 11.334 15.7582C11.6726 15.4799 12.0627 15.2712 12.482 15.1438C12.9556 15 13.4774 15 14.5209 15H15.6666C16.6 15 17.0668 15 17.4233 14.8183C17.7369 14.6586 17.9918 14.4036 18.1516 14.09C18.3333 13.7335 18.3333 13.2668 18.3333 12.3333V5.16667C18.3333 4.23325 18.3333 3.76654 18.1516 3.41002C17.9918 3.09641 17.7369 2.84144 17.4233 2.68166C17.0668 2.5 16.6 2.5 15.6666 2.5H15.3333C13.4665 2.5 12.533 2.5 11.82 2.86331C11.1928 3.18289 10.6828 3.69282 10.3633 4.32003C9.99996 5.03307 9.99996 5.96649 9.99996 7.83333" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </template>
                                  <template v-else-if="groupResult.name.toLowerCase() === 'alunos'">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                      <path d="M16.6667 17.5C16.6667 16.337 16.6667 15.7555 16.5232 15.2824C16.2 14.217 15.3663 13.3834 14.301 13.0602C13.8278 12.9167 13.2463 12.9167 12.0834 12.9167H7.91671C6.75374 12.9167 6.17225 12.9167 5.69909 13.0602C4.63375 13.3834 3.80007 14.217 3.47691 15.2824C3.33337 15.7555 3.33337 16.337 3.33337 17.5M13.75 6.25C13.75 8.32107 12.0711 10 10 10C7.92897 10 6.25004 8.32107 6.25004 6.25C6.25004 4.17893 7.92897 2.5 10 2.5C12.0711 2.5 13.75 4.17893 13.75 6.25Z" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </template>
                                  <template v-else-if="groupResult.name.toLowerCase() === 'professores'">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                      <rect x="10.8337" y="12.501" width="4.1684" height="2.50104" rx="1" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                      <path fill-rule="evenodd" clip-rule="evenodd" d="M7.49897 17.5032H2.08005C1.84983 17.5032 1.66321 17.3166 1.66321 17.0864V16.7479C1.66596 15.7849 2.44594 15.0049 3.40894 15.0022H6.17009C7.13308 15.0049 7.91307 15.7849 7.91581 16.7479V17.0864C7.91581 17.3166 7.72919 17.5032 7.49897 17.5032Z" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                      <path fill-rule="evenodd" clip-rule="evenodd" d="M4.78949 12.9179C3.86883 12.9161 3.12372 12.1687 3.12463 11.2481C3.12556 10.3274 3.87216 9.58154 4.79283 9.58154C5.7135 9.58154 6.4601 10.3274 6.46102 11.2481C6.46194 12.1687 5.71683 12.9161 4.79616 12.9179H4.78949Z" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                      <path d="M3.33057 7.49891V4.16419C3.33057 3.24333 4.07707 2.49683 4.99793 2.49683H16.6695C17.5903 2.49683 18.3368 3.24333 18.3368 4.16419V13.3347C18.3368 14.2555 17.5903 15.002 16.6695 15.002H10" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </template>
                                  <template v-else-if="groupResult.name.toLowerCase() === 'aplicações'">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                      <path d="M16.6667 10.4167V5.66675C16.6667 4.26662 16.6667 3.56655 16.3942 3.03177C16.1545 2.56137 15.7721 2.17892 15.3017 1.93923C14.7669 1.66675 14.0668 1.66675 12.6667 1.66675H7.33337C5.93324 1.66675 5.23318 1.66675 4.6984 1.93923C4.22799 2.17892 3.84554 2.56137 3.60586 3.03177C3.33337 3.56655 3.33337 4.26662 3.33337 5.66675V14.3334C3.33337 15.7335 3.33337 16.4336 3.60586 16.9684C3.84554 17.4388 4.22799 17.8212 4.6984 18.0609C5.23318 18.3334 5.93324 18.3334 7.33337 18.3334H10M11.6667 9.16675H6.66671M8.33337 12.5001H6.66671M13.3334 5.83341H6.66671M12.0834 15.8334L13.75 17.5001L17.5 13.7501" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </template>
                                  <template v-else-if="groupResult.name.toLowerCase() === 'turmas'">
                                    <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                      <path stroke-width="2" stroke="#E5E7EA" stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
                                    </svg>
                                  </template>
                                  <template v-else-if="groupResult.name.toLowerCase() === 'provas'">
                                    <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                      <path stroke-width="2" stroke="#E5E7EA" stroke-linecap="round" stroke-linejoin="round" d="M9 12H12.75M9 15H12.75M9 18H12.75M15.75 18.75H18C18.5967 18.75 19.169 18.5129 19.591 18.091C20.0129 17.669 20.25 17.0967 20.25 16.5V6.108C20.25 4.973 19.405 4.01 18.274 3.916C17.9 3.88498 17.5256 3.85831 17.151 3.836M17.151 3.836C17.2174 4.05109 17.2501 4.27491 17.25 4.5C17.25 4.69891 17.171 4.88968 17.0303 5.03033C16.8897 5.17098 16.6989 5.25 16.5 5.25H12C11.586 5.25 11.25 4.914 11.25 4.5C11.25 4.269 11.285 4.046 11.35 3.836M17.151 3.836C16.868 2.918 16.012 2.25 15 2.25H13.5C13.0192 2.25011 12.5511 2.40414 12.1643 2.68954C11.7774 2.97493 11.492 3.3767 11.35 3.836M11.35 3.836C10.974 3.859 10.6 3.886 10.226 3.916C9.095 4.01 8.25 4.973 8.25 6.108V8.25M8.25 8.25H4.875C4.254 8.25 3.75 8.754 3.75 9.375V20.625C3.75 21.246 4.254 21.75 4.875 21.75H14.625C15.246 21.75 15.75 21.246 15.75 20.625V9.375C15.75 8.754 15.246 8.25 14.625 8.25H8.25ZM6.75 12H6.758V12.008H6.75V12ZM6.75 15H6.758V15.008H6.75V15ZM6.75 18H6.758V18.008H6.75V18Z" />
                                    </svg>
                                  </template>
                                </span>
                                <span class="tw-truncate" style="max-width: 500px;">
                                  #{ result.name }
                                </span>
                              </span>
                              <span class="tw-flex tw-gap-2 lz-element-invisible">
                                <a v-if="!['application', 'teacher'].includes(groupResult.id)" :href="'{% url 'dashboards:dashboards' %}?'+ generateCorrectParams(groupResult.name.toLowerCase(), result.pk)" class="tw-rounded-full tw-p-2 tw-text-primary-600 hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Dashboard">
                                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M17.5 17.5H3.83333C3.36662 17.5 3.13327 17.5 2.95501 17.4092C2.79821 17.3293 2.67072 17.2018 2.59083 17.045C2.5 16.8667 2.5 16.6334 2.5 16.1667V2.5M17.5 5.83333L12.9714 10.3619C12.8064 10.5269 12.7239 10.6094 12.6288 10.6404C12.5451 10.6675 12.4549 10.6675 12.3712 10.6404C12.2761 10.6094 12.1936 10.5269 12.0286 10.3619L10.4714 8.80474C10.3064 8.63973 10.2239 8.55723 10.1288 8.52632C10.0451 8.49912 9.95493 8.49912 9.87124 8.52632C9.77611 8.55723 9.6936 8.63973 9.5286 8.80474L5.83333 12.5M17.5 5.83333H14.1667M17.5 5.83333V9.16667" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                  </svg>
                                </a>
                                <a :href="{% if user_type == 'teacher' %}getUrlActionTeacher(groupResult, 0, result.pk){% elif user_type == 'student' %}getUrlActionStudent(groupResult, 0, result.pk){% elif user_type == 'coordination' %}getUrlAction(groupResult, 0, result.pk){% endif %}" class="tw-rounded-full tw-p-2 tw-text-primary-600 hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" :title="{% if user_type == 'teacher' %}getNameActionTeacher(groupResult, 0){% elif user_type == 'student' %}getNameActionStudent(groupResult, 0){% elif user_type == 'coordination' %}getNameAction(groupResult, 0){% endif %}">
                                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FF8F3D" stroke-width="2" v-html="{% if user_type == 'teacher' %}getIconActionTeacher(groupResult, 0){% elif user_type == 'student' %}getIconActionStudent(groupResult, 0){% elif user_type == 'coordination' %}getIconAction(groupResult, 0){% endif %}"></svg>
                                </a>
                                <a v-if="getUrlAction(groupResult, 1, result.pk)" :href="{% if user_type == 'teacher' %}getUrlActionTeacher(groupResult, 1, result.pk){% elif user_type == 'student' %}getUrlActionStudent(groupResult, 1, result.pk){% elif user_type == 'coordination' %}getUrlAction(groupResult, 1, result.pk){% endif %}" class="tw-rounded-full tw-p-2 tw-text-primary-600 hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" :title="{% if user_type == 'teacher' %}getNameActionTeacher(groupResult, 1){% elif user_type == 'student' %}getNameActionStudent(groupResult, 1){% elif user_type == 'coordination' %}getNameAction(groupResult, 1){% endif %}">
                                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FF8F3D" stroke-width="2" v-html="{% if user_type == 'teacher' %}getIconActionTeacher(groupResult, 1){% elif user_type == 'student' %}getIconActionStudent(groupResult, 1){% elif user_type == 'coordination' %}getIconAction(groupResult, 1){% endif %}"></svg>
                                </a>
                              </span>
                            </span>
                          </li>
                        </ul>
                      </li>
                    </ul>
                  </template>
                  <template v-else-if="searchResults.length === 0 && searchStatus === 'success'">
                    <div class="tw-px-6 tw-py-14 tw-text-center sm:tw-px-14">
                      <svg class="tw-mx-auto tw-h-6 tw-w-6 tw-text-gray-400 tw-mb-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                      </svg>
                      <p class="tw-text-sm tw-text-gray-900">
                        Não encontramos nenhum registro com esse termo. Por favor, tente novamente.
                      </p>
                    </div>
                  </template>
                </template>
              </div>
            </template>
          </div>
        </div>
        <div style="padding-top: 4.5rem;">
          <div class="row">
            <div class="col-5 d-flex align-items-center">
              <div>
                <h3 class="d-flex tw-text-base text-truncate mb-0 tw-font-medium tw-text-[#101828] tw-mb-0 align-items-center">
                  Calendário de entregas
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="As atividades serão mostradas de acordo com os deadlines inseridos nos cadernos e aplicações.">
                    <g clip-path="url(#clip0_2002_1216)">
                      <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </g>
                    <defs>
                      <clipPath id="clip0_2002_1216">
                        <rect width="16" height="16" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                </h3>
              </div>
              <div class="m-3 text-muted d-flex align-items-center cp">
                <span class="d-flex" id="dropdownMenuButton" data-toggle="dropdown">
                  #{moment().month(calendar.selectedMonth - 1).format("MMMM")} 
                  <svg width="20" height="20" class="mx-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </span>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 1 }" @click="calendar.selectedMonth = 1" href="javacript:;">Janeiro</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 2 }" @click="calendar.selectedMonth = 2" href="javacript:;">Fevereiro</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 3 }" @click="calendar.selectedMonth = 3" href="javacript:;">Março</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 4 }" @click="calendar.selectedMonth = 4" href="javacript:;">Abril</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 5 }" @click="calendar.selectedMonth = 5" href="javacript:;">Maio</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 6 }" @click="calendar.selectedMonth = 6" href="javacript:;">Junho</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 7 }" @click="calendar.selectedMonth = 7" href="javacript:;">Julho</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 8 }" @click="calendar.selectedMonth = 8" href="javacript:;">Agosto</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 9 }" @click="calendar.selectedMonth = 9" href="javacript:;">Setembro</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 10 }" @click="calendar.selectedMonth = 10" href="javacript:;">Outubro</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 11 }" @click="calendar.selectedMonth = 11" href="javacript:;">Novembro</a>
                  <a class="dropdown-item" :class="{active: calendar.selectedMonth == 12 }" @click="calendar.selectedMonth = 12" href="javacript:;">Dezembro</a>
                </div>
                <div style="width: 35px; height: 35px; border: 1px solid #E5E7EA;" class="prev-slide rounded-circle d-flex mx-2 align-items-center justify-content-center">
                  <svg width="24" height="24" class="hovable" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
                <div style="width: 35px; height: 35px; border: 1px solid #E5E7EA;" class="next-slide rounded-circle d-flex align-items-center justify-content-center">
                  <svg width="24" height="24" class="hovable" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
            </div>
            <div class="col-7 d-flex justify-content-end">
              <div class="d-flex justify-content-end">
                <div class="row mb-0">
                  <div class="col-6 d-flex align-items-center">
                    <select v-model="filters.school.selectedUnity" id="inputSchoolUnities" :disabled="loadingRequest" data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0 mr-3">
                      <option value="">Todas as unidades</option>
                      <option :value="unity.id" v-for="unity in unities">#{unity.name}</option>
                    </select>
                  </div>
                  <div class="col-6 d-flex align-items-center">
                    <select v-model="filters.cards.selectedStage" id="inputSchoolStages" data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0" style="font-family: 'Inter';">
                      <option value="">Todas as etapas</option>
                      <option :value="stage.id" v-for="stage in stages">#{stage.name}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="swiper-container">
                <div class="swiper-wrapper">
                  <template v-for="day in calendar.days">
                    <div class="swiper-slide">
                      <div class="card"  :style="{ border: day.format('YYYY-MM-DD') == moment().format('YYYY-MM-DD')  ? '1px solid #FAAF56':'' }" style="height: 160px; width: 150px; border-radius: 12px;">
                        <div class="card-body py-3 px-0">
                          <div class="d-flex align-items-center justify-content-between px-3">
                            <span class="text-muted" style="font-size: .7rem;">#{day.format('ddd')}</span>
                            <span class="text-dark" style="font-size: .9rem; font-weight: bold;">#{day.format('DD')}</span>
                          </div>
                          <div class="mt-2 pl-3 mr-1 scroll" style="overflow-y: auto; overflow-x: hidden; max-height: 100px;">
                            <div class="row mb-1 cp" @click="openModalEventSummary(event)" v-for="event in calendar.events.filter(e => moment(e.deadline).format('YYYY-MM-DD') == day.format('YYYY-MM-DD'))">
                                <template v-if="event == calendar.selectedEvent && calendar.loading">
                                  <p class="text-muted mx-3" style="font-size: .9rem;">
                                    Carregando <i class="fas fa-spin fa-spinner"></i>
                                  </p>
                                </template>
                                <template v-else>
                                <div class="col-12">
                                  <p class="text-muted m-0 text-truncate tooltips" :data-tippy-content="event.count +' '+ event.text" :style="{ borderLeft: '2px solid '+ event.color }" style="font-size: .9rem; padding-left: 4px;"><strong>#{event.count}</strong> #{event.type}</p>
                                </div>
                              </template>
                            </div>
                            <template v-if="!calendar.events.filter(e => moment(e.deadline).format('YYYY-MM-DD') == day.format('YYYY-MM-DD')).length">
                              <p class="text-muted" style="font-size: .9rem;">
                                Sem eventos nesta data.
                              </p>
                            </template>
                          </div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </div>
          <div class="row no-print tw-pt-6">
            <div class="col-12">
              <h3 class="tw-text-base mb-0 tw-font-medium tw-text-[#101828] tw-mb-0">Acompanhamento de tarefas</h3>
              <p class="modal-title mb-0 text-muted">As informações são atualizadas a cada 10 minutos</p>
              {% if user.client.last_generation_followup_dashboard %}
                <p class="d-none modal-title mb-0 text-muted" style="font-size: .7rem;">Dash de acompanhamento foi ferado em: {{user.client.last_generation_followup_dashboard}}</p>            
              {% endif %}
              {% if user.client.last_generation_dashboard %}
                <p class="d-none">Dash geral foi gerado em: {{user.client.last_generation_dashboard}}</p>            
              {% endif %}
            </div>
            <!-- <div class="col-6 d-flex justify-content-end">
              <div class="row">
                <div class="col-6">
                  <select v-model="filters.school.selectedUnity" id="inputSchoolUnities" :disabled="loadingRequest" data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0 mr-3">
                    <option value="">Todas as unidades</option>
                    <option :value="unity.id" v-for="unity in unities">#{unity.name}</option>
                  </select>
                </div>
                <div class="col-6">
                  <select v-model="filters.cards.selectedStage" id="inputSchoolStages" data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0" style="font-family: 'Inter';">
                    <option value="">Todas as etapas</option>
                    <option :value="stage.id" v-for="stage in stages">#{stage.name}</option>
                  </select>
                </div>
              </div>
            </div> -->
          </div>
          <dl class="row m-0 tw-mb-0 tw-pt-6">
            <div class="py-1 px-1" :class="controls.width <= 1600 ? 'col-6':'col-3'">
              <div class="tw-relative tw-overflow-hidden tw-rounded-lg tw-bg-white tw-px-4 tw-pb-12 tw-pt-5 tw-border sm:tw-pt-5 h-100" ref="elaborations">
                <skeleton-card v-if="cards.elaborations.status == 'loading'" class="p-3"></skeleton-card>
                <div v-show="cards.elaborations.status == 'success'">
                  <dd class="tw-flex tw-items-baseline tw-mb-0">
                    <div class="tw-mb-5 d-flex">
                      <div>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="tw-mb-3">
                          <path d="M20 12.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H12M14 11H8M10 15H8M16 7H8M14.5 19L16.5 21L21 16.5" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p class="tw-truncate tw-text-base tw-font-medium tw-text-[#101828] tw-mb-1 d-flex align-items-center">
                          Elaborações
                          <svg width="16" height="16" viewBox="0 0 16 16" data-tippy-content="Os dados analisados nesse cartão são apenas os que estão dentro no prazo." fill="none" class="tooltips m-2">
                            <g clip-path="url(#clip0_2002_1216)">
                              <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              </path>
                            </g> 
                            <defs>
                              <clipPath id="clip0_2002_1216">
                                <rect width="16" height="16" fill="white"></rect>
                              </clipPath>
                            </defs>
                          </svg>
                        </p>
                        <p class="tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" style="max-width: 210px;">Há #{cards.elaborations.data.incomplete} questões a serem elaboradas</p>
                      </div>
                      <div style="min-width: 70px;">
                        <div data-chart="idElaborationDataChart" class="tw-absolute tw-top-0 tw-right-0 tw-mt-8 tw-mr-8"></div>
                      </div>
                    </div>
                    <div class="tw-absolute tw-inset-x-0 tw-bottom-0 tw-px-4 tw-py-4 sm:tw-px-6 tw-border-t tw-border-t-[#F5F6F7]">
                      <div class="tw-text-sm" v-if="cards.elaborations.data.incomplete > 0">
                        <a href="javascript:;" @click="followupDetail('elaborations')" class="tw-group tw-flex tw-text-xs tw-font-normal tw-text-[#667085] hover:tw-text-primary-500">
                          Acompanhe<span class="tw-sr-only"> as estatísticas das elaborações</span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-1 tw-text-[#D0D5DD] group-hover:tw-text-primary-500">
                            <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </dd>
                </div>
              </div>
            </div>

            <div class="py-1 px-1" :class="controls.width <= 1600 ? 'col-6':'col-3'">
              <div class="tw-relative tw-overflow-hidden tw-rounded-lg tw-bg-white tw-px-4 tw-pb-12 tw-pt-5 tw-border sm:tw-pt-5 h-100" ref="reviews">
                <skeleton-card v-if="cards.reviews.status == 'loading'" class="p-3"></skeleton-card>
                <div v-show ="cards.reviews.status == 'success'">
                  <dd class="tw-flex tw-items-baseline tw-mb-0">
                    <div class="tw-mb-5 d-flex">
                      <div>
                        <svg width="24" height="24" viewBox="0 0 24 24" class="tw-mb-3" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <p class="tw-truncate tw-text-base tw-font-medium tw-text-[#101828] tw-mb-1 d-flex align-items-center">
                          Revisões
                          <svg width="16" height="16" viewBox="0 0 16 16" data-tippy-content="Os dados analisados nesse cartão são apenas os que estão dentro no prazo." fill="none" class="tooltips m-2">
                            <g clip-path="url(#clip0_2002_1216)">
                              <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              </path>
                            </g> 
                            <defs>
                              <clipPath id="clip0_2002_1216">
                                <rect width="16" height="16" fill="white"></rect>
                              </clipPath>
                            </defs>
                          </svg>
                        </p>
                        <p class="tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0">Há #{cards.reviews.data.incomplete} revisões aguardando</p>
                      </div>
                      <div style="min-width: 70px;">
                        <div data-chart="idReviewsDataChart" class="tw-absolute tw-top-0 tw-right-0 tw-mt-8 tw-mr-8"></div>
                      </div>
                    </div>
                    <div class="tw-absolute tw-inset-x-0 tw-bottom-0 tw-px-4 tw-py-4 sm:tw-px-6 tw-border-t tw-border-t-[#F5F6F7]">
                      <div class="tw-text-sm" v-if="cards.reviews.data.incomplete > 0">
                        <a href="javascript:;" @click="followupDetail('reviews')" class="tw-group tw-flex tw-text-xs tw-font-normal tw-text-[#667085] hover:tw-text-primary-500"><!-- style="font-family: 'Roboto';" -->
                          Acompanhe<span class="tw-sr-only"> as estatísticas das revisões</span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-1 tw-text-[#D0D5DD] group-hover:tw-text-primary-500">
                            <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </dd>
                </div>
              </div>
            </div>

            <div class="py-1 px-1" :class="controls.width <= 1600 ? 'col-6':'col-3'">
              <div class="tw-relative tw-overflow-hidden tw-rounded-lg tw-bg-white tw-px-4 tw-pb-12 tw-pt-5 tw-border sm:tw-pt-5 h-100" ref="uploads">
                <skeleton-card v-if="cards.uploads.status == 'loading'" class="p-3"></skeleton-card>
                <div v-show="cards.uploads.status == 'success'">
                  <dd class="tw-flex tw-items-baseline tw-mb-0">
                    <div class="tw-mb-5 d-flex">
                      <div>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="tw-mb-3">
                          <path d="M12 21L11.8999 20.8499C11.2053 19.808 10.858 19.287 10.3991 18.9098C9.99286 18.5759 9.52476 18.3254 9.02161 18.1726C8.45325 18 7.82711 18 6.57482 18H5.2C4.07989 18 3.51984 18 3.09202 17.782C2.71569 17.5903 2.40973 17.2843 2.21799 16.908C2 16.4802 2 15.9201 2 14.8V6.2C2 5.07989 2 4.51984 2.21799 4.09202C2.40973 3.71569 2.71569 3.40973 3.09202 3.21799C3.51984 3 4.07989 3 5.2 3H5.6C7.84021 3 8.96031 3 9.81596 3.43597C10.5686 3.81947 11.1805 4.43139 11.564 5.18404C12 6.03968 12 7.15979 12 9.4M12 21V9.4M12 21L12.1001 20.8499C12.7947 19.808 13.142 19.287 13.6009 18.9098C14.0071 18.5759 14.4752 18.3254 14.9784 18.1726C15.5467 18 16.1729 18 17.4252 18H18.8C19.9201 18 20.4802 18 20.908 17.782C21.2843 17.5903 21.5903 17.2843 21.782 16.908C22 16.4802 22 15.9201 22 14.8V6.2C22 5.07989 22 4.51984 21.782 4.09202C21.5903 3.71569 21.2843 3.40973 20.908 3.21799C20.4802 3 19.9201 3 18.8 3H18.4C16.1598 3 15.0397 3 14.184 3.43597C13.4314 3.81947 12.8195 4.43139 12.436 5.18404C12 6.03968 12 7.15979 12 9.4" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p class="tw-truncate tw-text-base tw-font-medium tw-text-[#101828] tw-mb-1 d-flex align-items-center">
                          Envio de cartões
                          <svg width="16" height="16" viewBox="0 0 16 16" data-tippy-content="Os dados analisados nesse cartão são apenas os que estão dentro no prazo." fill="none" class="tooltips m-2">
                            <g clip-path="url(#clip0_2002_1216)">
                              <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              </path>
                            </g> 
                            <defs>
                              <clipPath id="clip0_2002_1216">
                                <rect width="16" height="16" fill="white"></rect>
                              </clipPath>
                            </defs>
                          </svg>
                        </p>
                        <p class="tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0">Há #{cards.uploads.data.incomplete} cartões a serem enviados</p>
                      </div>
                      <div style="min-width: 70px;">
                        <div data-chart="idUploadsDataChart" class="tw-absolute tw-top-0 tw-right-0 tw-mt-8 tw-mr-8"></div>
                      </div>
                    </div>
                    <div class="tw-absolute tw-inset-x-0 tw-bottom-0 tw-px-4 tw-py-4 sm:tw-px-6 tw-border-t tw-border-t-[#F5F6F7]">
                      <div class="tw-text-sm" v-if="cards.uploads.data.incomplete > 0">
                        <a href="javascript:;" @click="followupDetail('uploads')" class="tw-group tw-flex tw-text-xs tw-font-normal tw-text-[#667085] hover:tw-text-primary-500"><!-- style="font-family: 'Roboto';" -->
                          Acompanhe<span class="tw-sr-only"> as estatísticas das aplicações</span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-1 tw-text-[#D0D5DD] group-hover:tw-text-primary-500">
                            <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </dd>
                </div>
              </div>
            </div>

            <div class="py-1 px-1" :class="controls.width <= 1600 ? 'col-6':'col-3'">
              <div class="tw-relative tw-overflow-hidden tw-rounded-lg tw-bg-white tw-px-4 tw-pb-12 tw-pt-5 tw-border sm:tw-pt-5 h-100" ref="corrections">
                <skeleton-card v-if="cards.corrections.status == 'loading'" class="p-3"></skeleton-card>
                <div v-show ="cards.corrections.status == 'success'">
                  <dd class="tw-flex tw-items-baseline tw-mb-0">
                    <div class="tw-mb-5 d-flex">
                      <div>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="tw-mb-3">
                          <path d="M22 11.0857V12.0057C21.9988 14.1621 21.3005 16.2604 20.0093 17.9875C18.7182 19.7147 16.9033 20.9782 14.8354 21.5896C12.7674 22.201 10.5573 22.1276 8.53447 21.3803C6.51168 20.633 4.78465 19.2518 3.61096 17.4428C2.43727 15.6338 1.87979 13.4938 2.02168 11.342C2.16356 9.19029 2.99721 7.14205 4.39828 5.5028C5.79935 3.86354 7.69279 2.72111 9.79619 2.24587C11.8996 1.77063 14.1003 1.98806 16.07 2.86572M22 4L12 14.01L9 11.01" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <p class="tw-truncate tw-text-base tw-font-medium tw-text-[#101828] tw-mb-1 d-flex align-items-center">
                          Correções
                          <svg width="16" height="16" viewBox="0 0 16 16" data-tippy-content="Os dados analisados nesse cartão são apenas os que estão dentro no prazo." fill="none" class="tooltips m-2">
                            <g clip-path="url(#clip0_2002_1216)">
                              <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                              </path>
                            </g> 
                            <defs>
                              <clipPath id="clip0_2002_1216">
                                <rect width="16" height="16" fill="white"></rect>
                              </clipPath>
                            </defs>
                          </svg>
                        </p>
                        <p class="tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" style="max-width: 210px;">Há #{cards.corrections.data.incomplete} correções pendentes</p>
                      </div>
                      <div style="min-width: 70px;">
                        <div data-chart="idCorrectionsDataChart" class="tw-absolute tw-top-0 tw-right-0 tw-mt-8 tw-mr-8"></div>
                      </div>
                    </div>
                    <div class="tw-absolute tw-inset-x-0 tw-bottom-0 tw-px-4 tw-py-4 sm:tw-px-6 tw-border-t tw-border-t-[#F5F6F7]">
                      <div class="tw-text-sm" v-if="cards.corrections.data.incomplete > 0">
                        <a href="javascript:;" @click="followupDetail('corrections')" class="tw-group tw-flex tw-text-xs tw-font-normal tw-text-[#667085] hover:tw-text-primary-500"><!-- style="font-family: 'Roboto';" -->
                          Acompanhe<span class="tw-sr-only"> as estatísticas das correções</span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-1 tw-text-[#D0D5DD] group-hover:tw-text-primary-500">
                            <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg>
                        </a>
                      </div>
                    </div>
                  </dd>
                </div>
              </div>
            </div>
          </dl>
        </div>
      </div>
      <hr class="tw-m-0 tw-border-[#E5E7EA]" />
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem] tw-pt-12" ref="generalHistogram">
        <template v-if="average.status == 'loading'">
          <skeleton-card></skeleton-card>
        </template>
        <template v-else>
          <span class="tw-flex tw-items-center tw-pb-4">
            <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
              Nível de aprendizado dos alunos
            </h3>
            <svg width="16" height="16" viewBox="0 0 16 16" data-tippy-content="Distribuição de alunos de acordo com a performance média de cada um deles. E a performance média em todos os cadernos." class="tooltips" fill="none" class="tw-ml-2">
              <g clip-path="url(#clip0_2002_1216)">
                <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </g>
              <defs>
                <clipPath id="clip0_2002_1216">
                  <rect width="16" height="16" fill="white" />
                </clipPath>
              </defs>
            </svg>
          </span>
          <template v-if="average.status == 'error'">
            <p class="modal-title mb-0 text-muted">
              Não foi possível carregar os dados.
            </p>
          </template>
          <template v-if="generalHistogram.status == 'success'">
            <div style="position: relative;">
              <div :style="{ display: 'flex', flexDirection: 'column', alignItems: 'center', position: 'absolute', top: '-52px', left: `calc(${getMarkPositionAndColor().position}% - 27px)` }">
                <svg width="54" height="40" viewBox="0 0 54 40" fill="none" style="margin-bottom: 4px;">
                  <path d="M27 37.5279L36.0615 30.9443L32.6003 20.2918L21.3997 20.2918L17.9385 30.9443L27 37.5279Z" :fill="getMarkPositionAndColor().color" :stroke="getMarkPositionAndColor().color" stroke-width="4"/>
                  <rect x="2" y="2" width="50" height="32" rx="6" :fill="getMarkPositionAndColor().color"/>
                  <rect x="2" y="2" width="50" height="32" rx="6" :stroke="getMarkPositionAndColor().color" stroke-width="4"/>
                  <text x="50%" y="50%" text-anchor="middle" alignment-baseline="middle" fill="#FFFFFF" font-size="16px" font-family="Roboto" style="line-height: 20px; font-weight: 500;">#{generalHistogram.performance.toFixed(0)}%</text>
                </svg>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37256 18.6274 0 12 0C5.37256 0 0 5.37256 0 12C0 18.6274 5.37256 24 12 24ZM12 16C14.2091 16 16 14.2092 16 12C16 9.79083 14.2091 8 12 8C9.79089 8 8 9.79083 8 12C8 14.2092 9.79089 16 12 16Z" fill="#E5E7EA"/>
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="white"/>
                </svg>
              </div>
              <div class="tw-flex tw-gap-1">
                <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['0-40'])+'%' }" v-if="generalHistogram.data['0-40']" class="tw-h-2 tw-bg-[#D92D20] tw-rounded-tl tw-rounded-bl tooltips" data-tippy-content="Até 40%"></div>
                <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['40-60'])+'%' }" v-if="generalHistogram.data['40-60']" class="tw-h-2 tw-bg-[#F3B364] tooltips" data-tippy-content="Acima de 40% até 60%"></div>
                <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['60-75'])+'%' }" v-if="generalHistogram.data['60-75']" class="tw-h-2 tw-bg-[#0C7BDB] tooltips" data-tippy-content="Acima de 60% até 75%"></div>
                <div :style="{ 'min-width': '1px', 'width': getHistogramProportion(generalHistogram.data['75-100'])+'%' }" v-if="generalHistogram.data['75-100']" class="tw-h-2 tw-bg-[#41C588] tw-rounded-tr tw-rounded-br tooltips" data-tippy-content="Acima de 75%"></div>
              </div>
              <div class="tw-flex tw-gap-1 tw-pt-4" v-if="generalHistogram.status == 'success'">
                <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['0-40'])+'%' }" v-if="generalHistogram.data['0-40']">
                  <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['0-40']}</p>
                  <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-text-nowrap tw-mb-0 tooltips" data-tippy-content="Até 40%">Crítico</p>
                </div>
                <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['40-60'])+'%' }" v-if="generalHistogram.data['40-60']">
                  <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['40-60']}</p>
                  <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-text-nowrap tw-mb-0 tooltips" data-tippy-content="Acima de 40% até 60%">Atenção</p>
                </div>
                <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['60-75'])+'%' }" v-if="generalHistogram.data['60-75']">
                  <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['60-75']}</p>
                  <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0 tooltips" data-tippy-content="Acima de 60% até 75%">Esperado</p>
                </div>
                <div :style="{ 'min-width': '100px', 'width': getHistogramProportion(generalHistogram.data['75-100'])+'%' }" v-if="generalHistogram.data['75-100']">
                  <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">#{generalHistogram.data['75-100']}</p>
                  <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0 tooltips" data-tippy-content="Acima de 75%">Excepcional</p>
                </div>
              </div>
            </div>
          </template>
        </template>
      </div>
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-[8.75rem] tw-pt-10">
        <div class="tw-flex tw-justify-between">
          <ul id="tab-header" role="tablist" class="tw-list-none tw-w-full tw-flex tw-mb-0">
            <li
              class="tw-w-full tw-text-center tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-[1.625rem] tw-cursor-pointer tw-border tw-border-[#E5E7EA] tw-rounded-tl-xl tw-border-b-0"
              :class="[activeTab === 'tab-1' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFB]']"
              @click="changeTab('tab-1')"
            >
              <span
                role="tab"
                aria-controls="tab-1"
                aria-selected="true"
                class="tw-text-base tw-px-12 tw-font-medium tw-text-[#001737]"
              ><!-- style="font-family: 'Roboto';" -->
                Unidade(s)
              </span>
            </li>
            <li
              class="tw-w-full tw-text-center tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-[1.625rem] tw-cursor-pointer tw-border tw-border-[#E5E7EA] tw-border-b-0 tw-border-l-0"
              :class="[activeTab === 'tab-2' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFB]']"
              @click="!loading ? changeTab('tab-2'):''"
            >
              <span
                role="tab"
                aria-controls="tab-2"
                aria-selected="false"
                class="tw-text-base tw-px-12 tw-font-medium tw-text-[#001737]"
              ><!-- style="font-family: 'Roboto';" -->
                Turmas
              </span>
            </li>
            <li
              class="tw-w-full tw-border tw-border-[#E5E7EA] tw-text-center tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-[1.625rem] tw-cursor-pointer tw-rounded-tr-xl tw-border-b-0 tw-border-l-0"
              :class="[activeTab === 'tab-3' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFB]']"
              @click="!loading ? changeTab('tab-3'):''"
            >
              <span
                role="tab"
                aria-controls="tab-3"
                aria-selected="false"
                class="tw-text-base tw-px-12 tw-font-medium tw-text-[#001737]"
              ><!-- style="font-family: 'Roboto';" -->
                Professores
              </span>
            </li>
          </ul>
        </div>
        <div id="tab-content">
          <div
            id="tab-1"
            role="tabpanel"
            aria-labelledby="tab-1-content"
            :style="{ display: activeTab === 'tab-1' ? 'block' : 'none' }"
          >
            <div class="tw-bg-white sm:tw-rounded-b-xl tw-pt-8 tw-border tw-border-[#E5E7EA] tw-mb-8">
              <div class="tw-px-4 sm:tw-px-8 tw-pb-8 select-container">
                <div class="tw-flex">
                  <div class="tw-w-1/2">
                    <h3 class="tw-text-3xl tw-font-medium tw-text-[#101828] tw-tracking-[-0.01em] tw-mb-4">
                      Desempenho geral
                    </h3>
                    <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0"><!-- style="font-family: 'Roboto';" -->
                      Acompanhe a performance geral de todos os seus alunos e cada disciplina, bem como a taxa 
                    </p>
                  </div>
                  <div class="tw-w-1/2 tw-flex tw-items-end tw-justify-end">
                    <select class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0" id="inputSchoolSubjects" data-container=".select-container" v-model="filters.school.selectedSubjects" multiple><!-- style="font-family: 'Inter';" -->
                      <option :value="subject.id" v-for="subject in performanceBySubject.data">#{subject.name}</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="tw-px-4 sm:tw-px-8">
                <hr class="tw-m-0 tw-border-[#E5E7EA]" />
              </div>
              <div class="tw-grid tw-grid-cols-3 tw-h-[294px] tw-py-8">
                <div class="tw-flex tw-flex-col tw-px-4 sm:tw-px-8">
                  <div class="tw-flex tw-items-center tw-justify-between">
                    <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                      Acima do esperado
                    </h3>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Percentual de alunos que estão com performance acima de 60% nas disciplinas selecionadas">
                      <g clip-path="url(#clip0_2002_1216)">
                        <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </g>
                      <defs>
                        <clipPath id="clip0_2002_1216">
                          <rect width="16" height="16" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <skeleton-card mb-0 text-muted v-if="averageBySubjects.status == 'loading'"></skeleton-card>
                  <p class="mt-4 modal-title mb-0 text-muted" v-if="averageBySubjects.status == 'error' || performanceBySubject.status == 'error'">
                    Não foi possível carregar os dados.
                  </p>
                  <div
                    class="tw-flex-1"
                    :style="{ 'visibility': averageBySubjects.status == 'loading' ? 'hidden':''  }"
                    ref="averageBySubjects"
                  >
                    <div id="idAverageBySubjectsChart" style="min-height: 200px;"></div>
                  </div>
                  {% comment %} <div>
                    <span class="tw-flex tw-items-center tw-justify-center">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                          <path d="M4.66699 11.3333L11.3337 4.66665M11.3337 4.66665V11.3333M11.3337 4.66665H4.66699" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                      </span>
                      <span class="tw-text-sm tw-font-semibold tw-text-[#41C588] tw-ml-1"><!-- style="font-family: 'Inter';" -->3%</span>
                      <span class="tw-text-xs tw-font-normal tw-text-[#667085] tw-ml-2"><!-- style="font-family: 'Roboto';" -->comparado ao período anterior</span>
                    </span>
                  </div> 
                  {% endcomment %}
                </div>  
                <div class="tw-col-span-2 tw-flex tw-flex-col tw-border-l tw-border-l-[#E5E7EA] tw-px-4 sm:tw-px-8">
                  <div class="tw-flex tw-items-center tw-justify-between">
                    <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                      Performance por disciplina
                    </h3>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Performance Média dos alunos em cada disciplina em todos os cadernos">
                      <g clip-path="url(#clip0_2002_1216)">
                        <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </g>
                      <defs>
                        <clipPath id="clip0_2002_1216">
                          <rect width="16" height="16" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  
                  <skeleton-card v-if="performanceBySubject.status == 'loading'"></skeleton-card>
                  <template v-if="performanceBySubject.status == 'error'">
                    <p class="mt-4 modal-title mb-0 text-muted">Ocorreu um erro ao tentar carregar os dados, tente novamente em alguns minutos.</p>
                  </template>
                  <div
                    class="tw-flex-1"
                    :style="{ 'visibility': performanceBySubject.status == 'loading' ? 'hidden':''  }"
                    ref="performanceBySubject"
                  >
                    <div id="performanceBySubjectChart" style="min-height: 200%; max-width: 100%;"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            id="tab-2"
            role="tabpanel"
            aria-labelledby="tab-2-content"
            :style="{ display: activeTab === 'tab-2' ? 'block' : 'none' }"
          >
            <div class="tw-bg-white sm:tw-rounded-b-xl tw-pt-8 tw-border tw-border-[#E5E7EA] tw-mb-8">
              <div class="tw-px-4 sm:tw-px-8 tw-pb-8 select-container-classes">
                <div class="tw-flex">
                  <div class="tw-w-1/2">
                    <h3 class="tw-text-3xl tw-font-medium tw-text-[#101828] tw-tracking-[-0.01em] tw-mb-4">
                      Minhas turmas
                    </h3>
                    <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0" style="font-family: 'Roboto';">
                      Acompanhe a performance geral das turmas, frequencias nas provas e o desempenho em cada disciplina.
                    </p>
                  </div>
                  <div class="tw-w-1/2 tw-flex tw-items-end tw-justify-end">
                    <div v-show="classes.length">
                      <select v-model="filters.classes.selectedClasse" id="inputClasseClasses" data-live-search="true" data-container=".select-container-classes" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0" style="font-family: 'Inter';">
                        <option value="">Todas as turmas</option>
                        <option :value="classe.id" v-for="classe in classes">#{classe.name} - #{classe.coordination_name} - #{classe.grade.full_name}</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tw-px-4 sm:tw-px-6">
                <hr class="tw-m-0 tw-border-[#E5E7EA]" />
              </div>
              <div class="tw-grid tw-grid-cols-1 tw-divide-y tw-divide-gray-200 tw-overflow-hidden md:tw-grid-cols-3 md:tw-divide-x md:tw-divide-y-0 tw-px-8 tw-py-8">
                <div class="tw-flex tw-flex-col tw-pr-8">
                  <div class="tw-flex tw-flex-col tw-pb-[3.75rem]">
                    <div class="tw-flex tw-justify-between tw-items-center tw-pb-4">
                      <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                        Frequência nas provas
                      </h3>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Taxa de alunos presentes nas aplicações">
                        <g clip-path="url(#clip0_2002_1216)">
                          <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </g>
                        <defs>
                          <clipPath id="clip0_2002_1216">
                            <rect width="16" height="16" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                    <div :style="{ visibility: frequencyInExamsGeneral.status == 'loading' ? 'hidden' : '' }" ref="frequencyInExamsGeneral">
                      <p class="tw-text-5xl tw-font-medium tw-text-[#101828] tw-mb-2" style="font-family: 'Inter';">#{frequencyInExamsGeneral.data.toFixed(0)}%</p>
                      <!-- <p class="tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" style="font-family: 'Roboto';">Todas as turmas</p> -->
                    </div>
                  </div>
                  <skeleton-card v-if="frequencyInExams.status === 'loading'"></skeleton-card>
                  <template v-if="frequencyInExams.status == 'error'">
                    <p class="tw-text-sm tw-text-[#667085]">Não foi possível determinar a frequência das turmas.</p>
                  </template>
                  <div
                    class="tw-flex-1"
                    style="min-height: 78px;"
                    :style="{ visibility: frequencyInExams.status == 'loading' ? 'hidden' : '' }"
                    ref="frequencyInExams"
                  >
                    <div id="idFrequencyInExamsChart" class="tw-h-full"></div>
                  </div>
                  {% comment %} <div class="tw-pt-4">
                    <span class="tw-flex tw-items-center">
                      <span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                          <path d="M4.66699 11.3333L11.3337 4.66665M11.3337 4.66665V11.3333M11.3337 4.66665H4.66699" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                      </span>
                      <span class="tw-text-sm tw-font-semibold tw-text-[#41C588] tw-ml-1" style="font-family: 'Inter';">3%</span>
                      <span class="tw-text-xs tw-font-normal tw-text-[#667085] tw-ml-2" style="font-family: 'Roboto';">comparado ao período anterior</span>
                    </span>
                  </div> 
                  {% endcomment %}
                </div>
                <div class="tw-flex tw-flex-col tw-px-8">
                  <div class="tw-flex tw-flex-col tw-pb-[3.75rem]" ref="classeAverage">
                    <div class="tw-flex tw-justify-between tw-items-center">
                      <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                        Acima do esperado
                      </h3>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Percentual de alunos que estão com performance acima de 60%">
                        <g clip-path="url(#clip0_2002_1216)">
                          <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </g>
                        <defs>
                          <clipPath id="clip0_2002_1216">
                            <rect width="16" height="16" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                    <div :style="{ 'visibility': classeAverage.status == 'loading' ? 'hidden':'' }" ref="classeHistogram">
                      <p class="tw-text-5xl tw-font-medium tw-text-[#101828] tw-mb-2" style="font-family: 'Inter';" v-if="classeAverage.status == 'success'">#{classeAverage.data.toFixed(0)}%</p>
                      <p class="tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" style="font-family: 'Roboto';">Aproveitamento das turmas</p>
                    </div>
                  </div>
                  <skeleton-card v-if="classeAverage.status === 'loading'"></skeleton-card>
                  <template v-if="classeAverage.status == 'error'">
                    <p class="modal-title mb-0 text-muted">
                      Não foi possível carregar os dados.
                    </p>
                  </template>
                  <template v-if="classeAverage.status == 'success'">
                    <div>
                      <div class="tw-overflow-hidden tw-rounded-sm tw-bg-[#FFF4EC]">
                        <div class="tw-h-2 tw-rounded-sm tw-bg-primary-600" :style="{ width: classeAverage.data + '%' }"></div>
                      </div>
                    </div>
                    <div class="tw-flex tw-flex-col tw-gap-2 tw-pt-8" v-if="classeHistogram.status == 'success'">
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Acima de 75%</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{classeHistogram.data['75-100']}</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Acima de 60 até 75%</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{classeHistogram.data['60-75']}</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Acima de 40 até 60%</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{classeHistogram.data['40-60']}</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Abaixo de 40%</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{classeHistogram.data['0-40']}</p>
                      </div>
                    </div>
                  </template>
                </div>
                <div class="tw-flex tw-flex-col tw-pl-8">
                  <div>
                    <span class="tw-flex tw-justify-between tw-items-center tw-pb-4">
                      <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                        Desempenho por disciplina
                      </h3>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Performance média dos alunos em cada disciplina">
                        <g clip-path="url(#clip0_2002_1216)">
                          <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </g>
                        <defs>
                          <clipPath id="clip0_2002_1216">
                            <rect width="16" height="16" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                  </div>
                  <div class="d-flex align-items-center justify-content-center h-100" ref="classesSubjects">
                    <skeleton-card v-if="classesSubjects.status == 'loading'" style="width: 100%;"></skeleton-card>
                    <template v-if="classesSubjects.status == 'error'">
                      <p class="modal-title mb-0 text-muted">
                        Não foi possível carregar os dados das disciplinas.
                      </p>
                    </template>
                    <div class="cp" @click="selectClasseSubjectAndStartChart('previous')" :style="{ visibility: classesSubjects.status == 'loading' ? 'hidden' : '' }">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M15 18L9 12L15 6" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                    <div class="tw-flex-1 h-100" style="max-height: 200px; min-height: 78px;" :style="{ visibility: classesSubjects.status == 'loading' ? 'hidden' : '' }">
                      <div id="idClasseSelectedSubjectChart" class="h-100 w-100"></div>
                    </div>
                    <div class="cp" @click="selectClasseSubjectAndStartChart('next')" :style="{ visibility: classesSubjects.status == 'loading' ? 'hidden' : '' }">
                      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M9 18L15 12L9 6" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </div>
                  </div>
                  <div class="d-flex justify-content-center mt-3" :style="{ visibility: classesSubjects.status == 'loading' ? 'hidden' : '' }">
                    <p class="text-center w-75" style="font-family: Inter; font-size: 14px;font-weight: 400; line-height: 20px; color: #667085;">#{filters.classes.selectedSubject ? filters.classes.selectedSubject.name : ''}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div
            id="tab-3"
            role="tabpanel"
            aria-labelledby="tab-3-content"
            :style="{ display: activeTab === 'tab-3' ? 'block' : 'none' }"
          >
            <div class="tw-bg-white sm:tw-rounded-b-xl tw-pt-8 tw-border tw-border-[#E5E7EA] tw-mb-8">
              <div class="tw-px-4 sm:tw-px-8 tw-pb-8">
                <div class="tw-flex">
                  <div class="tw-w-1/2">
                    <h3 class="tw-text-3xl tw-font-medium tw-text-[#101828] tw-tracking-[-0.01em] tw-mb-4">
                      Professores
                    </h3>
                    <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0" style="font-family: 'Roboto';">
                      Acompanhe a performance de elaboração dos itens de seus professores
                    </p>
                  </div>
                  <div class="tw-w-1/2 tw-flex tw-items-end tw-justify-end">
                    <div v-show="teachers.length">
                      <select v-model="filters.teachers.selectedTeacher" id="inputTeacherTeachers" data-live-search="true" class="tw-text-[#667085] tw-text-sm tw-font-normal tw-border-0" style="font-family: 'Inter';">
                        <option value="">Todos os professores</option>
                        <option :value="teacher.id" v-for="teacher in teachers">#{teacher.name}</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="tw-px-4 sm:tw-px-6">
                <hr class="tw-m-0 tw-border-[#E5E7EA]" />
              </div>
              <div class="tw-grid tw-grid-cols-1 tw-divide-y tw-divide-gray-200 tw-overflow-hidden md:tw-grid-cols-3 md:tw-divide-x md:tw-divide-y-0 tw-px-8 tw-py-8">
                <div class="tw-pr-8">
                  <div class="tw-pb-6">
                    <div class="tw-flex tw-justify-between tw-items-center">
                      <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                        Professores em destaque
                      </h3>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Professores ordenados conforme a quantidade de itens elaborados e suas respectivas taxas de qualidade">
                        <g clip-path="url(#clip0_2002_1216)">
                          <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </g>
                        <defs>
                          <clipPath id="clip0_2002_1216">
                            <rect width="16" height="16" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                  </div>
                  <div class="tw-pb-9" ref="teacherRanking">
                    <ul role="list" class="tw-space-y-6 tw-mb-0">
                      <li class="tw-flex tw-w-full" v-for="(teacher, index) in teacherRanking.data">
                        <div class="tw-flex tw-w-full tw-min-w-0 tw-gap-x-3">
                          <div class="tw-isolate tw-flex tw--space-x-2">
                            <span class="tw-relative tw-z-30 tw-inline-flex tw-items-center tw-justify-center tw-h-12 tw-w-12 tw-min-w-12 tw-rounded-full tw-border tw-border-[#CFD1D4] tw-bg-white">
                              <span class="tw-text-base tw-font-medium tw-text-[#101828]">#{index + 1}</span>
                            </span>
                            <span class="tw-relative tw-z-30 tw-inline-flex tw-items-center tw-justify-center tw-h-12 tw-w-12 tw-min-w-12 tw-rounded-full tw-border tw-border-[#CFD1D4] tw-bg-white">
                              <span class="tw-text-base tw-font-medium tw-text-[#101828]">#{getInitials(teacher.name)}</span>
                            </span>
                          </div>
                          <div class="tw-min-w-0 tw-flex-auto">
                            <p class="tw-text-base tw-font-medium tw-text-[#101828] text-truncate">#{teacher.name}</p>
                            <p class="tw-truncate tw-text-sm tw-text-[#667085]">#{teacher.subject_name}</p>
                          </div>
                        </div>
                      </li>
                    </ul>
                    <skeleton-card v-if="teacherRanking.status == 'loading'" class="mt-4"></skeleton-card>
                    <template v-if="teacherRanking.status == 'error'">
                      <p class="tw-text-sm tw-text-[#667085]">Não foi possível carregar os professores.</p>
                    </template>
                  </div>
                  {% comment %} 
                    <div>
                      <span class="tw-flex tw-items-center tw-justify-start">
                        <span class="tw-text-xs tw-font-normal tw-text-[#9BA3AF]" style="font-family: 'Roboto';">Última atualização há 1 semana.</span>
                      </span>
                    </div> 
                  {% endcomment %}
                </div>
  
  
                <div class="tw-flex tw-flex-col tw-px-8">
                  <div class="tw-flex tw-flex-col" ref="teacherQuestionsSummary">
                    <div class="tw-flex tw-justify-between tw-items-center tw-pb-6">
                      <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                        Eficiência nas elaborações
                      </h3>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Taxa de questões que foram elaboradas e aplicadas com sucesso">
                        <g clip-path="url(#clip0_2002_1216)">
                          <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </g>
                        <defs>
                          <clipPath id="clip0_2002_1216">
                            <rect width="16" height="16" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    </div>
                    <div v-if="teacherQuestionsSummary.status == 'success'">
                      <p class="tw-text-5xl tw-font-medium tw-text-[#101828]" style="font-family: 'Inter';">#{(100 - teacherQuestionsSummary.data.reproveds_percent - teacherQuestionsSummary.data.annulleds_percent).toFixed(2)}</p>
                    </div>
                  </div>
                  <template v-if="teacherQuestionsSummary.status == 'success'">
                    <div>
                      <div class="tw-overflow-hidden tw-rounded-sm tw-bg-[#FFF4EC]" v-if="teacherQuestionsSummary.status == 'success'">
                        <div class="tw-h-2 tw-rounded-sm tw-bg-primary-600" :style="{ width: (100 - teacherQuestionsSummary.data.reproveds_percent - teacherQuestionsSummary.data.annulleds_percent) + '%' }"></div>
                      </div>
                    </div>
                    <div class="tw-flex tw-flex-col tw-gap-2 tw-pt-[4.375rem]" v-if="teacherQuestionsSummary.status == 'success'">
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Em aberto</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.openeds_percent}%</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Aprovadas</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.approveds_percent}%</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Atrasadas</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.lates_percent}%</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Reprovadas</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.reproveds_percent}%</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Anuladas</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.annulleds_percent}%</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Aguardando correção</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.correction_pending_percent}%</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Corrigidas</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.correcteds_percent}%</p>
                      </div>
                      <div class="tw-flex tw-justify-between">
                        <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">Usar depois</p>
                        <p class="tw-text-sm tw-font-semibold tw-text-[#101828] tw-mb-0">#{teacherQuestionsSummary.data.use_later_percent}%</p>
                      </div>
                    </div>
                  </template>
                  <template v-else-if="teacherQuestionsSummary.status == 'success' && !teacherQuestionsSummary.data">Nenhum dado relacionado ao professor selecionado.</template>   
                  <skeleton-card v-if="teacherQuestionsSummary.status == 'loading'" class="mt-4"></skeleton-card>
                  <template v-if="teacherQuestionsSummary.status == 'error'">
                    <p class="tw-text-sm tw-text-[#667085]">Não foi possível carregar as questões.</p>
                  </template>
                </div>
                <div class="tw-flex tw-flex-col tw-px-4 sm:tw-px-8">
                  <div class="tw-flex tw-items-center tw-justify-between tw-pb-6">
                    <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                      Taxa de qualidade dos itens
                    </h3>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2 tooltips" data-tippy-content="Taxa de qualidade dos itens considerando o preenchimento do assunto, habilidade, competência e nível de dificuldade.">
                      <g clip-path="url(#clip0_2002_1216)">
                        <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                      </g>
                      <defs>
                        <clipPath id="clip0_2002_1216">
                          <rect width="16" height="16" fill="white" />
                        </clipPath>
                      </defs>
                    </svg>
                  </div>
                  <!-- <div v-if="questionQualityRate.error">Failed to load (error)</div> -->
                  <!-- <div v-if="!questionQualityRate.data" style="visibility: hidden; max-height: 0;">Loading...</div> -->
                  <skeleton-card v-if="teacherQuestionsSummary.status == 'loading'" class="mt-4"></skeleton-card>
                  <template v-if="teacherQuestionsSummary.status == 'error'">
                    <p class="tw-text-sm tw-text-[#667085]">Não foi possível determinar a qualidade das questões.</p>
                  </template>
                  <div
                    :class="teacherQuestionsSummary.data ? 'tw-flex-1' : ''"
                    :style="{ visibility: !teacherQuestionsSummary.data || teacherQuestionsSummary.status === 'loading' ? 'hidden' : '' }"
                  >
                    <div id="idQuestionQualityRateChart" class="tw-h-full"></div>
                  </div>
                  {% comment %} 
                    <div>
                      <span class="tw-flex tw-items-center tw-justify-center">
                        <span>
                          <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M4.66699 11.3333L11.3337 4.66665M11.3337 4.66665V11.3333M11.3337 4.66665H4.66699" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                          </svg>
                        </span>
                        <span class="tw-text-sm tw-font-semibold tw-text-[#41C588] tw-ml-1"><!-- style="font-family: 'Inter';" -->3%</span>
                        <span class="tw-text-xs tw-font-normal tw-text-[#667085] tw-ml-2"><!-- style="font-family: 'Roboto';" -->comparado ao período anterior</span> 
                      </span>
                    </div> 
                  {% endcomment %}
                </div>
  
                <!-- <div class="tw-pl-8">
                  <div>
                    <span class="tw-flex tw-justify-between tw-items-center tw-pb-4">
                      <h3 class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">
                        Taxa de qualidade das questões
                      </h3>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="tw-ml-2">
                        <g clip-path="url(#clip0_2002_1216)">
                          <path d="M7.99967 10.6667V8M7.99967 5.33333H8.00634M14.6663 8C14.6663 11.6819 11.6816 14.6667 7.99967 14.6667C4.31778 14.6667 1.33301 11.6819 1.33301 8C1.33301 4.3181 4.31778 1.33333 7.99967 1.33333C11.6816 1.33333 14.6663 4.3181 14.6663 8Z" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </g>
                        <defs>
                          <clipPath id="clip0_2002_1216">
                            <rect width="16" height="16" fill="white" />
                          </clipPath>
                        </defs>
                      </svg>
                    </span>
                  </div>
                  <div>
                    <div id="my-chart-5"></div>
                  </div>
                  <div>
                  </div>
                </div> -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalEventSummary" tabindex="-1" aria-labelledby="modalEventSummaryLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable" style="border-radius: 16px;">
    <div class="modal-content" style="border-radius: 12px;" v-if="calendar.selectedEvent && calendar.selectedEvent.summary">
      <div class="modal-body p-4 h-100">
        <div class="row">
          <div class="col-12 d-flex justify-content-between align-items-center">
            <span class="text-muted" style="font-size: 1.3rem;">#{moment(calendar.selectedEvent.deadline).format('ddd')}</span>
            <span style="font-size: 2rem;">#{moment(calendar.selectedEvent.deadline).format('DD')}</span>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <h5 class="text-capitalize">#{calendar.selectedEvent.summary.text}</h5>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Caderno</th>
                  <th>Qtd. questões</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="item in calendar.selectedEvent.summary.items">
                  <td>#{item.name}</td>
                  <td>#{item.questions_count}</td>
                  <td>
                    <a :href="'{% url 'exams:exams_list' %}?q_name=' + item.name" target="_blank">Abrir</a>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalFollowupDetail" tabindex="-1" aria-labelledby="modalFollowupDetailLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable" style="border-radius: 12px;">
    <div class="modal-content" style="border-radius: 12px;">
      <div class="modal-header p-4">
        <div>
          <h5 class="modal-title mb-0" id="modalFollowupDetailLabel">Acompanhamento de tarefas</h5>
          <p class="modal-title mb-0 text-muted">As informações são atualizadas a cada 5 minutos</p>
        </div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-0">
        <div class="row m-0 px-3" style="background-color: #F9FAFB;">
          <div class="col-12">
            <div class="row mb-0 my-4">
              <div class="col-9 d-flex flex-column justify-content-center">
                <h3 class="mb-0">
                  <template v-if="modalFollowup.selectedFollowupCardType == 'elaborations'">Elaborações</template>
                  <template v-if="modalFollowup.selectedFollowupCardType == 'uploads'">Envio de cartões</template>
                  <template v-if="modalFollowup.selectedFollowupCardType == 'corrections'">Correções</template>
                  <template v-if="modalFollowup.selectedFollowupCardType == 'reviews'">Revisões</template>
                </h3>
                <p class="mb-0 mt-2 tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" v-if="modalFollowup.selectedFollowupCardType == 'elaborations' && cards.elaborations.status == 'success'">
                  Há #{cards.elaborations.data.incomplete} questões a serem elaboradas
                </p>
                <p class="mb-0 mt-2 tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" v-if="modalFollowup.selectedFollowupCardType == 'uploads' && cards.uploads.status == 'success'">
                  Há #{cards.uploads.data.incomplete} cartões a serem enviados
                </p>
                <p class="mb-0 mt-2 tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" v-if="cards.corrections.status == 'success' && modalFollowup.selectedFollowupCardType == 'corrections'">
                  Há #{cards.corrections.data.incomplete} correções pendentes
                </p>
                <p class="mb-0 mt-2 tw-text-xs tw-font-normal tw-text-[#667085] tw-mb-0" v-if="cards.reviews.status == 'success' && modalFollowup.selectedFollowupCardType == 'reviews'">
                  Há #{cards.reviews.data.incomplete} revisões aguardando
                </p>
              </div>
              <div class="col d-flex justify-content-between align-items-center">
                <div>
                  <div data-chart="idElaborationDataChart" v-show="modalFollowup.selectedFollowupCardType == 'elaborations'"></div>
                  <div data-chart="idUploadsDataChart" v-show="modalFollowup.selectedFollowupCardType == 'uploads'"></div>
                  <div data-chart="idCorrectionsDataChart" v-show="modalFollowup.selectedFollowupCardType == 'corrections'"></div>
                  <div data-chart="idReviewsDataChart" v-show="modalFollowup.selectedFollowupCardType == 'reviews'"></div>
                </div>
                <div style="border: 1px solid #D2D6DB50; width: 1px; height: 100%;"></div>
                <div class="d-flex">
                  <svg width="24" height="24" @click="getFollowupCard('previous')" class="mx-1 cp" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 18L9 12L15 6" stroke="#9BA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <svg width="24" height="24" @click="getFollowupCard('next')" class="mx-1 cp" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9 18L15 12L9 6" stroke="#9BA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row m-0 px-3 mt-4 mb-2">
          <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
              <template v-if="modalFollowup.selectedItem">
                <div class="text-muted">
                  <p @click="modalFollowup.selectedItem = null, $forceUpdate()" class="d-flex align-items-center tw-text tw-font-normal tw-text-[#667085] cp">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mx-1 cp"><path d="M15 18L9 12L15 6" stroke="#9BA3AF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    Voltar
                  </p>
                </div>
                <div class="d-flex" v-if="modalFollowup.selectedFollowupCardType != 'uploads'">
                  <div @click="changeViewBy('teachers')" class="cp" :style="modalFollowup.viewBy == 'teachers' ? 'background-color: #FFFFFF; border: 1px solid #E5E7EA; font-weight: 500;':'background-color: #F9FAFB; font-weight: 400; color: #667085;'" style="font-family: inter; height: 34px; padding: 7px 16px 7px 16px; gap: 8px; border-radius: 24px;">
                    Professores
                  </div>
                  <div @click="changeViewBy('exams')" class="cp" :style="modalFollowup.viewBy == 'exams' ? 'background-color: #FFFFFF; border: 1px solid #E5E7EA; font-weight: 500;':'background-color: #F9FAFB; font-weight: 400; color: #667085;'" style="font-family: inter; height: 34px; padding: 7px 16px 7px 16px; gap: 8px; border-radius: 24px;">
                    Cadernos
                  </div>
                </div>
              </template>
              <template v-else>
                <div class="text-muted">
                  <p class="mb-0 tw-text tw-font-normal tw-text-[#667085] tw-mb-0">
                    Listagem de pendências
                  </p>
                </div>
                <div class="d-flex">
                  <div @click="modalFollowup.sortedBy = 'urgency'" class="cp" :style="modalFollowup.sortedBy == 'urgency' ? 'background-color: #FFFFFF; border: 1px solid #E5E7EA; font-weight: 500;':'background-color: #F9FAFB; font-weight: 400; color: #667085;'" style="font-family: inter; height: 34px; padding: 7px 16px 7px 16px; gap: 8px; border-radius: 24px;">
                    <span class="tooltips" data-tippy-content="Ordena as pendências fazendo uma relação entre a quantidade de correções faltantes e o prazo limite de entrega">Por urgência</span>
                  </div>
                  <div @click="modalFollowup.sortedBy = 'date'" class="cp" :style="modalFollowup.sortedBy == 'date' ? 'background-color: #FFFFFF; border: 1px solid #E5E7EA; font-weight: 500;':'background-color: #F9FAFB; font-weight: 400; color: #667085;'" style="font-family: inter; height: 34px; padding: 7px 16px 7px 16px; gap: 8px; border-radius: 24px;">
                    Por data
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>
        <template v-if="modalFollowup.selectedFollowupCardType == 'elaborations'">
          <template v-if="!modalFollowup.selectedItem">
            <div class="row mx-0 px-3">
              <div class="col-12 mt-3 cp" @click="!loadingRequest ? getFollowupDetails('elaborations', elaboration.deadline):''" v-for="elaboration in modalFollowup.details.elaborations.filter(e => e.performance < 100)">
                <div class="card" style="border-radius: 8px;" :style="loadingRequest ? 'background-color: #E3E3E330;':''">
                  <div class="card-body p-3">
                    <div class="row">
                      <div class="col-6">
                        <p class="mb-0 tw-text tw-font-normal tw-text-[#667085] tw-mb-0 d-flex">
                          <svg width="19" height="20" class="mx-2" viewBox="0 0 19 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15.8327 10.4167V5.66667C15.8327 4.26654 15.8327 3.56647 15.5738 3.03169C15.3461 2.56129 14.9828 2.17883 14.5359 1.93915C14.0279 1.66667 13.3628 1.66667 12.0327 1.66667H6.96602C5.63589 1.66667 4.97083 1.66667 4.46279 1.93915C4.0159 2.17883 3.65257 2.56129 3.42488 3.03169C3.16602 3.56647 3.16602 4.26654 3.16602 5.66667V14.3333C3.16602 15.7335 3.16602 16.4335 3.42488 16.9683C3.65257 17.4387 4.0159 17.8212 4.46279 18.0609C4.97083 18.3333 5.63589 18.3333 6.96602 18.3333H9.49935M11.0827 9.16667H6.33268M7.91602 12.5H6.33268M12.666 5.83333H6.33268M11.4785 15.8333L13.0618 17.5L16.6243 13.75" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>                          
                          Elaboração
                        </p>
                      </div>
                      <div class="col-6 d-flex justify-content-end">
                        <p class="mb-0 tw-text tw-font-normal tw-mb-0 d-flex">    
                          #{elaboration.performance.toFixed(0)} % concluído                       
                        </p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <h5 class="mb-0">
                          #{elaboration.soliciteds - elaboration.total} questões solicitadas
                        </h5>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <p class="text-muted mb-0">
                          #{modalFollowup.getExamsNames(elaboration.exams)}  
                        </p>
                      </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                      <div class="d-flex">
                        <div v-for="i in elaboration.priorityValue" :class="{ 'bg-success': elaboration.priority == 'low', 'bg-warning': elaboration.priority == 'medium', 'bg-danger': elaboration.priority == 'high' }" style="width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                        <div v-for="i in 5 - elaboration.priorityValue" style="background-color: #E5E7EA; width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                      </div>
                      <div :class="{ 'text-danger': moment(elaboration.deadline+' 23:59:59') < moment() }">
                        <div class="tx-14">#{moment(elaboration.deadline+" 23:59:59").format("DD/MM/YYYY")}</div> 
                        <div class="tx-14">#{moment(elaboration.deadline+" 23:59:59") > moment() ? 'em '+ moment(elaboration.deadline).fromNow(true):'há '+moment(elaboration.deadline).toNow(true)}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>
          <template v-else>
            <div class="table-responsive scroll">
              <div class="mx-0 d-flex px-3">
                <div class="col-4 px-1" @click="!loadingRequest ? (modalFollowup.selectedItem.selectedUnity = unity, getFollowupDetails('elaborations', modalFollowup.selectedItem.deadline, unity.id)):''" v-for="unity in modalFollowup.selectedItem.unities.filter(u => u.awaiting_count > 0)">
                  <div class="lize-card cp lize-hover-warning" :class="{ 'lize-bd-warning lize-bg-warning-light': unity == modalFollowup.selectedItem.selectedUnity }" style="border-radius: 8px;">
                    <div class="card-body">
                      <h6 class="text-truncate mb-4">#{unity.name} <i v-if="modalFollowup.selectedItem.selectedUnity == unity && loadingRequest" class="fas fa-spin fa-spinner"></i></h6> 
                      <span class="lize-badge lize-badge-danger">#{unity.awaiting_count} aguardando</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <template v-if="modalFollowup.viewBy == 'exams'">
              <template v-if="modalFollowup.selectedItem.selectedUnity">
                <div class="row m-0 py-2 mx-2" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6>Caderno</h6>
                  </div> 
                  <div class="col">
                    <h6>&nbsp;</h6>
                  </div> 
                  <div class="col">
                    <h6>Questões</h6>
                  </div> 
                  <div class="col"></div>
                </div>
                <div v-for="exam in modalFollowup.selectedItem.selectedUnity.exams.filter(e => (e.soliciteds - e.total) > 0)" data-toggle="collapse" role="button" aria-expanded="false" class="row m-0 py-2 mx-2 cp" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6 class="py-3 mb-0 tx-16">#{exam.name}</h6>
                  </div> 
                  <div class="col d-flex align-items-center">
                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                      &nbsp;
                    </span>
                  </div>
                  <div class="col d-flex align-items-center">
                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                      #{exam.soliciteds - exam.total}
                    </span>
                  </div>
                  <div class="col d-flex">
                    <a target="_blank" :href="'/provas/'+exam.id+'/revisar/'" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                      Verificar
                    </a>
                  </div>
                </div>
              </template>
              <template v-else>
                <p>Você deve selecionar uma unidade</p>
              </template>
            </template>
            <template v-if="modalFollowup.viewBy == 'teachers'">
              <template v-if="modalFollowup.selectedItem.selectedUnity">
                <div class="row m-0 py-2 mx-2" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6>Professor</h6>
                  </div> 
                  <div class="col">
                    <h6>&nbsp;</h6>
                  </div> 
                  <div class="col">
                    <h6>Questões</h6>
                  </div> 
                  <div class="col"></div>
                </div>
                <div v-for="teacher in modalFollowup.selectedItem.selectedUnity.teachers.filter(e => (e.soliciteds - e.total) > 0)" data-toggle="collapse" role="button" aria-expanded="false" class="row m-0" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-12" @click="teacher.collapsed = !teacher.collapsed, $forceUpdate()">
                    <div class="row m-0 py-2 mx-2">
                      <div class="col-8">
                        <h6 class="py-3 mb-0 tx-16">#{teacher.name}</h6>
                      </div> 
                      <div class="col d-flex align-items-center">
                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                          &nbsp;
                        </span>
                      </div>
                      <div class="col d-flex align-items-center">
                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                          #{teacher.soliciteds - teacher.total}
                        </span>
                      </div>
                      <div class="col d-flex align-items-center">
                        <template v-if="teacher.collapsed">
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </template>
                        <template v-else>
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </template>
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="row m-0 p-3" v-if="teacher.collapsed" style="background-color: rgb(249, 250, 250);">
                      <div class="col-12">
                        <span class="text-muted mx-2">Detalhamento de pendências</span> 
                        <div class="row mt-3 mb-0">
                          <div class="col-12 mb-2" v-for="exam in teacher.exams.filter(e => (e.soliciteds - e.total) > 0)">
                            <div class="lize-card cp">
                              <div class="card-body py-2">
                                <div class="row m-0">
                                  <div class="col-8">
                                    <h6 class="py-3 mb-0 tx-16">#{exam.name}</h6>
                                  </div>
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger"></span>
                                  </div> 
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{exam.soliciteds - exam.total}</span>
                                  </div>
                                  <div class="col d-flex">
                                    <a target="_blank" :href="'/provas/'+exam.id+'/revisar/?teacher='+teacher.id" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                                      Verificar
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div> 
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
              <template v-else>
                <p>Você deve selecionar uma unidade</p>
              </template>
            </template>
          </template>
        </template>
        
        <template v-else-if="modalFollowup.selectedFollowupCardType == 'uploads'">
          <template v-if="!modalFollowup.selectedItem">
            <div class="row mx-0 px-3">
              <div class="col-12 mt-3 cp" @click="!loadingRequest ? getFollowupDetails('uploads', item.deadline):''" v-for="item in modalFollowup.details.uploads.filter(e => e.performance < 100)">
                <div class="card" style="border-radius: 8px;" :style="loadingRequest ? 'background-color: #E3E3E330;':''">
                  <div class="card-body p-3">
                    <div class="row">
                      <div class="col-6">
                        <p class="mb-0 tw-text tw-font-normal tw-text-[#667085] tw-mb-0 d-flex">
                          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="mr-2">
                            <path d="M12 21L11.8999 20.8499C11.2053 19.808 10.858 19.287 10.3991 18.9098C9.99286 18.5759 9.52476 18.3254 9.02161 18.1726C8.45325 18 7.82711 18 6.57482 18H5.2C4.07989 18 3.51984 18 3.09202 17.782C2.71569 17.5903 2.40973 17.2843 2.21799 16.908C2 16.4802 2 15.9201 2 14.8V6.2C2 5.07989 2 4.51984 2.21799 4.09202C2.40973 3.71569 2.71569 3.40973 3.09202 3.21799C3.51984 3 4.07989 3 5.2 3H5.6C7.84021 3 8.96031 3 9.81596 3.43597C10.5686 3.81947 11.1805 4.43139 11.564 5.18404C12 6.03968 12 7.15979 12 9.4M12 21V9.4M12 21L12.1001 20.8499C12.7947 19.808 13.142 19.287 13.6009 18.9098C14.0071 18.5759 14.4752 18.3254 14.9784 18.1726C15.5467 18 16.1729 18 17.4252 18H18.8C19.9201 18 20.4802 18 20.908 17.782C21.2843 17.5903 21.5903 17.2843 21.782 16.908C22 16.4802 22 15.9201 22 14.8V6.2C22 5.07989 22 4.51984 21.782 4.09202C21.5903 3.71569 21.2843 3.40973 20.908 3.21799C20.4802 3 19.9201 3 18.8 3H18.4C16.1598 3 15.0397 3 14.184 3.43597C13.4314 3.81947 12.8195 4.43139 12.436 5.18404C12 6.03968 12 7.15979 12 9.4" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>                          
                          </svg>
                          Upload
                        </p>
                      </div>
                      <div class="col-6 d-flex justify-content-end">
                        <p class="mb-0 tw-text tw-font-normal tw-mb-0 d-flex">    
                          #{item.performance.toFixed(0)} % concluído                       
                        </p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <h5 class="mb-0">
                          #{item.soliciteds - item.total} envio de cartões
                        </h5>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <p class="text-muted mb-0">
                          #{modalFollowup.getExamsNames(item.exams)}  
                        </p>
                      </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                      <div class="d-flex">
                        <div v-for="i in item.priorityValue" :class="{ 'bg-success': item.priority == 'low', 'bg-warning': item.priority == 'medium', 'bg-danger': item.priority == 'high' }" style="width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                        <div v-for="i in 5 - item.priorityValue" style="background-color: #E5E7EA; width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                      </div>
                      <div :class="{ 'text-danger': moment(item.deadline+' 23:59:59') < moment() }">
                        <div class="tx-14">#{moment(item.deadline+" 23:59:59").format("DD/MM/YYYY")}</div> 
                        <div class="tx-14">#{moment(item.deadline+" 23:59:59") > moment() ? 'em '+ moment(item.deadline).fromNow(true):'há '+moment(item.deadline).toNow(true)}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>
          <template v-else>
            <div class="table-responsive scroll">
              <div class="mx-0 d-flex px-3">
                <div class="col-4 px-1" @click="!loadingRequest ? (modalFollowup.selectedItem.selectedUnity = unity, getFollowupDetails('uploads', modalFollowup.selectedItem.deadline, unity.id)):''" v-for="unity in modalFollowup.selectedItem.unities.filter(u => u.awaiting_count > 0)">
                  <div class="lize-card cp lize-hover-warning" :class="{ 'lize-bd-warning lize-bg-warning-light': unity == modalFollowup.selectedItem.selectedUnity }" style="border-radius: 8px;">
                    <div class="card-body">
                      <h6 class="text-truncate mb-4">#{unity.name} <i v-if="modalFollowup.selectedItem.selectedUnity == unity && loadingRequest" class="fas fa-spin fa-spinner"></i></h6>
                      <span class="lize-badge lize-badge-danger">#{unity.awaiting_count} aguardando</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <template v-if="modalFollowup.selectedItem.selectedUnity">
              <div class="row m-0 pt-4 mx-2" style="border-bottom: 1px solid rgb(229, 231, 234);">
                <div class="col-8">
                  <h6>Caderno</h6>
                </div> 
                <div class="col">
                  <h6>&nbsp;</h6>
                </div> 
                <div class="col">
                  <h6>Obj.</h6>
                </div> 
                <div class="col">
                  <h6>Disc.</h6>
                </div> 
                <div class="col"></div>
              </div>
              <template v-for="exam in modalFollowup.selectedItem.selectedUnity.exams.filter(e => ((e.objectives + e.discursives) - (e.objectives_sent + e.discursives_sent)) > 0)">
                <div  @click="exam.collapsed = !exam.collapsed, $forceUpdate()" data-toggle="collapse" role="button" aria-expanded="false" class="row m-0 py-2 mx-2 cp" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6 class="py-3 mb-0 tx-16">#{exam.name}</h6>
                  </div> 
                  <div class="col d-flex align-items-center">
                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                      &nbsp;
                    </span>
                  </div>
                  <div class="col d-flex align-items-center">
                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                      #{exam.objectives - exam.objectives_sent}
                    </span>
                  </div>
                  <div class="col d-flex align-items-center">
                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                      #{exam.discursives - exam.discursives_sent}
                    </span>
                  </div>
                  <div class="col d-flex">
                    <a target="_blank" :href="'/provas/'+exam.id+'/v2/'" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                      Verificar
                    </a>
                  </div>
                </div>
                <div class="col-12" v-if="exam.collapsed">
                  <div class="row m-0 p-3" style="background-color: rgb(249, 250, 250);">
                    <div class="col-12">
                      <span class="text-muted mx-2">Detalhamento de pendências</span> 
                      <div class="row mt-3 mb-0">
                        <div class="col-12 mb-2" v-for="classe in exam.classes.filter(e => (e.discursives_sent + e.objectives_sent) < (e.discursives + e.objectives))">
                          <div class="lize-card cp">
                            <div class="card-body py-2">
                              <div class="row m-0">
                                <div class="col-8">
                                  <h6 class="py-3 mb-0 tx-16">#{classe.name}</h6>
                                </div>
                                <div class="col d-flex align-items-center">
                                  <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{(classe.objectives) - (classe.objectives_sent)}</span>
                                </div>
                                <div class="col d-flex align-items-center">
                                  <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{(classe.discursives) - (classe.discursives_sent)}</span>
                                </div>
                                <div class="col d-flex">
                                  <a target="_blank" :href="'/provas/'+exam.id+'/v2/?turma='+classe.id" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                                    Verificar
                                  </a>
                                </div>
                              </div>
                            </div>
                          </div> 
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
            </template>
            <template v-else>
              <p>Você deve selecionar uma unidade</p>
            </template>
          </template>
        </template>
        
        <template v-else-if="modalFollowup.selectedFollowupCardType == 'corrections'">
          <template v-if="!modalFollowup.selectedItem">
            <div class="row mx-0 px-3">
              <div class="col-12 mt-3 cp" @click="!loadingRequest ? getFollowupDetails('corrections', item.deadline):''" v-for="item in modalFollowup.details.corrections.filter(e => e.performance < 100)">
                <div class="card" style="border-radius: 8px;" :style="loadingRequest ? 'background-color: #E3E3E330;':''">
                  <div class="card-body p-3">
                    <div class="row">
                      <div class="col-6">
                        <p class="mb-0 tw-text tw-font-normal tw-text-[#667085] tw-mb-0 d-flex">
                          <svg width="19" height="19" viewBox="0 0 24 24" fill="none" class="mr-2"><path d="M22 11.0857V12.0057C21.9988 14.1621 21.3005 16.2604 20.0093 17.9875C18.7182 19.7147 16.9033 20.9782 14.8354 21.5896C12.7674 22.201 10.5573 22.1276 8.53447 21.3803C6.51168 20.633 4.78465 19.2518 3.61096 17.4428C2.43727 15.6338 1.87979 13.4938 2.02168 11.342C2.16356 9.19029 2.99721 7.14205 4.39828 5.5028C5.79935 3.86354 7.69279 2.72111 9.79619 2.24587C11.8996 1.77063 14.1003 1.98806 16.07 2.86572M22 4L12 14.01L9 11.01" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                          Correção
                        </p>
                      </div>
                      <div class="col-6 d-flex justify-content-end">
                        <p class="mb-0 tw-text tw-font-normal tw-mb-0 d-flex">    
                          #{item.performance.toFixed(0)} % concluído                       
                        </p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <h5 class="mb-0">
                          Correção de #{item.soliciteds - item.total} respostas  
                        </h5>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <p class="text-muted mb-0">
                          #{modalFollowup.getExamsNames(item.exams)}  
                        </p>
                      </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                      <div class="d-flex">
                        <div v-for="i in item.priorityValue" :class="{ 'bg-success': item.priority == 'low', 'bg-warning': item.priority == 'medium', 'bg-danger': item.priority == 'high' }" style="width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                        <div v-for="i in 5 - item.priorityValue" style="background-color: #E5E7EA; width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                      </div>
                      <div :class="{ 'text-danger': moment(item.deadline+' 23:59:59') < moment() }">
                        <div class="tx-14">#{moment(item.deadline+" 23:59:59").format("DD/MM/YYYY")}</div> 
                        <div class="tx-14">#{moment(item.deadline+" 23:59:59") > moment() ? 'em '+ moment(item.deadline).fromNow(true):'há '+moment(item.deadline).toNow(true)}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>
          <template v-else>
            <div class="table-responsive scroll">
              <div class="mx-0 d-flex px-3">
                <div class="col-4 px-1" @click="!loadingRequest ? (modalFollowup.selectedItem.selectedUnity = unity, getFollowupDetails('corrections', modalFollowup.selectedItem.deadline, unity.id)):''" v-for="unity in modalFollowup.viewBy == 'teachers' ? modalFollowup.selectedItem.unities.teachers.filter(e => e.awaiting_count > 0) : modalFollowup.selectedItem.unities.exams.filter(e => e.awaiting_count > 0)">
                  <div class="lize-card cp lize-hover-warning" :class="{ 'lize-bd-warning lize-bg-warning-light': unity == modalFollowup.selectedItem.selectedUnity }" style="border-radius: 8px;">
                    <div class="card-body">
                      <h6 class="text-truncate mb-4">#{unity.name} <i v-if="modalFollowup.selectedItem.selectedUnity == unity && loadingRequest" class="fas fa-spin fa-spinner"></i></h6>
                      <span class="lize-badge lize-badge-danger">#{unity.awaiting_count} aguardando</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <template v-if="modalFollowup.viewBy == 'exams'">
              <template v-if="modalFollowup.selectedItem.selectedUnity">
                <div class="row m-0 py-2 mx-2" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6>Caderno</h6>
                  </div> 
                  <div class="col">
                    <h6>&nbsp;</h6>
                  </div> 
                  <div class="col">
                    <h6>Obj.</h6>
                  </div> 
                  <div class="col">
                    <h6>Disc.</h6>
                  </div> 
                  <div class="col"></div>
                </div>
                <template v-for="exam in modalFollowup.selectedItem.selectedUnity.exams.filter(e => e.performance < 100)">
                  <div @click="exam.collapsed = !exam.collapsed, $forceUpdate()" data-toggle="collapse" role="button" aria-expanded="false" class="row m-0 py-2 mx-2 cp" style="border-bottom: 1px solid rgb(229, 231, 234);">
                    <div class="col-8">
                      <h6 class="py-3 mb-0 tx-16">#{exam.name}</h6>
                    </div> 
                    <div class="col d-flex align-items-center">
                      <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                        &nbsp;
                      </span>
                    </div>
                    <div class="col d-flex align-items-center">
                      <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                        #{exam.objectives - exam.objectives_sent}
                      </span>
                    </div>
                    <div class="col d-flex align-items-center">
                      <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                        #{exam.discursives - exam.discursives_sent}
                      </span>
                    </div>
                    <!-- <div class="col d-flex">
                      <a target="_blank" :href="'/provas/'+exam.id+'/v2/'" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                        Verificar
                      </a>
                    </div> -->
                  </div>
                  <div class="col-12" v-if="exam.collapsed">
                    <div class="row m-0 p-3" style="background-color: rgb(249, 250, 250);">
                      <div class="col-12">
                        <span class="text-muted mx-2">Detalhamento de pendências</span> 
                        <div class="row mt-3 mb-0">
                          <div class="col-12 mb-2" v-for="classe in exam.classes">
                            <div class="lize-card cp">
                              <div class="card-body py-2">
                                <div class="row m-0 d-flex justify-content-between">
                                  <div class="col-6">
                                    <h6 class="py-3 mb-0 tx-16">#{classe.name}</h6>
                                  </div>
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger"></span>
                                  </div> 
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{classe.objectives - classe.objectives_sent}</span>
                                  </div>
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{classe.discursives - classe.discursives_sent}</span>
                                  </div>
                                  <div class="col d-flex">
                                    <a target="_blank" :href="'/provas/'+exam.id+'/v2/?turma='+classe.id" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                                      Verificar
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div> 
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </template>
              <template v-else>
                <p>Você deve selecionar uma unidade</p>
              </template>
            </template>
            <template v-if="modalFollowup.viewBy == 'teachers'">
              <template v-if="modalFollowup.selectedItem.selectedUnity">
                <div class="row m-0 py-2 mx-2" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6>Professor</h6>
                  </div> 
                  <div class="col">
                    <h6>&nbsp;</h6>
                  </div> 
                  <div class="col">
                    <h6>Obj.</h6>
                  </div> 
                  <div class="col">
                    <h6>Disc.</h6>
                  </div> 
                  <div class="col"></div>
                </div>
                <template v-for="teacher in modalFollowup.selectedItem.selectedUnity.teachers.filter(e => e.awaiting_count > 0)">
                  <div data-toggle="collapse" role="button" aria-expanded="false" class="row m-0" style="border-bottom: 1px solid rgb(229, 231, 234);">
                    <div class="col-12">
                      <div class="row m-0 py-2 mx-2">
                        <div class="col-8" @click="teacher.collapsed = !teacher.collapsed, $forceUpdate()">
                          <h6 class="py-3 mb-0 tx-16">#{teacher.name}</h6>
                        </div> 
                        <div class="col d-flex align-items-center">
                          <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                            &nbsp;
                          </span>
                        </div>
                        <div class="col d-flex align-items-center">
                          <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                            #{teacher.objectives - teacher.objectives_sent}
                          </span>
                        </div>
                        <div class="col d-flex align-items-center">
                          <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                            #{teacher.discursives - teacher.discursives_sent}
                          </span>
                        </div>
                        <div class="col d-flex align-items-center" @click="teacher.collapsed = !teacher.collapsed, $forceUpdate()">
                          <template v-if="teacher.collapsed">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </template>
                          <template v-else>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                          </template>
                        </div>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="row m-0 p-3" v-if="teacher.collapsed" style="background-color: rgb(249, 250, 250);">
                        <div class="col-12">
                          <span class="text-muted mx-2">Detalhamento de pendências</span> 
                          <div class="row mt-3 mb-0">
                            <template v-for="exam in teacher.exams.filter(e => ((e.objectives + e.discursives) - (e.objectives_sent + e.discursives_sent)) > 0)">
                              <div class="col-12" @click="exam.collapsed = !exam.collapsed, $forceUpdate()">
                                <div class="lize-card cp">
                                  <div class="card-body py-2">
                                    <div class="row m-0">
                                      <div class="col-6">
                                        <h6 class="py-3 mb-0 tx-16">#{exam.name}</h6>
                                      </div>
                                      <div class="col d-flex align-items-center">
                                        <span class="py-3 mb-0 tx-14 align-self-center text-danger"></span>
                                      </div> 
                                      <div class="col d-flex align-items-center">
                                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{exam.objectives - exam.objectives_sent}</span>
                                      </div> 
                                      <div class="col d-flex align-items-center">
                                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{exam.discursives - exam.discursives_sent}</span>
                                      </div>
                                      <!-- <div class="col d-flex">
                                        <a target="_blank" :href="'/provas/'+exam.id+'/v2/'" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                                          Verificar
                                        </a>
                                      </div> -->
                                    </div>
                                  </div>
                                </div> 
                              </div>
                              <template v-if="exam.collapsed">
                                <div class="col-12 mb-2 px-4" v-for="classe in exam.classes.filter(e => ((e.objectives + e.discursives) - (e.objectives_sent + e.discursives_sent)) > 0)">
                                  <div class="lize-card cp">
                                    <div class="card-body py-2">
                                      <div class="row m-0">
                                        <div class="col-6">
                                          <h6 class="py-3 mb-0 tx-16">#{classe.name}</h6>
                                        </div>
                                        <div class="col d-flex align-items-center">
                                          <span class="py-3 mb-0 tx-14 align-self-center text-danger"></span>
                                        </div> 
                                        <div class="col d-flex align-items-center">
                                          <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{classe.objectives - classe.objectives_sent}</span>
                                        </div> 
                                        <div class="col d-flex align-items-center">
                                          <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{classe.discursives - classe.discursives_sent}</span>
                                        </div>
                                        <div class="col d-flex">
                                          <a target="_blank" :href="'/provas/'+exam.id+'/v2/?turma='+classe.id" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                                            Verificar
                                          </a>
                                        </div>
                                      </div>
                                    </div>
                                  </div> 
                                </div>
                              </template>
                            </template>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </template>
              </template>
              <template v-else>
                <p>Você deve selecionar uma unidade</p>
              </template>
            </template>
          </template>
        </template>

        <template v-if="modalFollowup.selectedFollowupCardType == 'reviews'">
          <template v-if="!modalFollowup.selectedItem">
            <div class="row mx-0 px-3">
              <div class="col-12 mt-3 cp" @click="!loadingRequest ? getFollowupDetails('reviews', item.deadline):''" v-for="item in modalFollowup.details.reviews.filter(e => e.performance < 100)">
                <div class="card" style="border-radius: 8px;" :style="loadingRequest ? 'background-color: #E3E3E330;':''">
                  <div class="card-body p-3">
                    <div class="row">
                      <div class="col-6">
                        <p class="mb-0 tw-text tw-font-normal tw-text-[#667085] tw-mb-0 d-flex">  
                          <svg width="19" height="19" viewBox="0 0 24 24" class="mr-2" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#D3D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>                       
                          Revisão
                        </p>
                      </div>
                      <div class="col-6 d-flex justify-content-end">
                        <p class="mb-0 tw-text tw-font-normal tw-mb-0 d-flex">    
                          #{item.performance.toFixed(0)} % concluído                       
                        </p>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <h5 class="mb-0">
                          #{item.soliciteds - item.total} questões solicitadas
                        </h5>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <p class="text-muted mb-0">
                          #{modalFollowup.getExamsNames(item.exams)}  
                        </p>
                      </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mt-3">
                      <div class="d-flex">
                        <div v-for="i in item.priorityValue" :class="{ 'bg-success': item.priority == 'low', 'bg-warning': item.priority == 'medium', 'bg-danger': item.priority == 'high' }" style="width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                        <div v-for="i in 5 - item.priorityValue" style="background-color: #E5E7EA; width: 27px; height: 6px; border-radius: 4px; margin-left: 4px;"></div>
                      </div>
                      <div :class="{ 'text-danger': moment(item.deadline+' 23:59:59') < moment() }">
                        <div class="tx-14">#{moment(item.deadline+" 23:59:59").format("DD/MM/YYYY")}</div> 
                        <div class="tx-14">#{moment(item.deadline+" 23:59:59") > moment() ? 'em '+ moment(item.deadline).fromNow(true):'há '+moment(item.deadline).toNow(true)}</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </template>
          <template v-else>
            <div class="table-responsive scroll">
              <div class="mx-0 d-flex px-3">
                <div class="col-4 px-1" @click="!loadingRequest ? (modalFollowup.selectedItem.selectedUnity = unity, getFollowupDetails('reviews', modalFollowup.selectedItem.deadline, unity.id)):''" v-for="unity in modalFollowup.selectedItem.unities.filter(u => u.awaiting_count > 0)">
                  <div class="lize-card cp lize-hover-warning" :class="{ 'lize-bd-warning lize-bg-warning-light': unity == modalFollowup.selectedItem.selectedUnity }" style="border-radius: 8px;">
                    <div class="card-body">
                      <h6 class="text-truncate mb-4">#{unity.name} <i v-if="modalFollowup.selectedItem.selectedUnity == unity && loadingRequest" class="fas fa-spin fa-spinner"></i></h6> 
                      <span class="lize-badge lize-badge-danger">#{unity.awaiting_count} aguardando</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <template v-if="modalFollowup.viewBy == 'exams'">
              <template v-if="modalFollowup.selectedItem.selectedUnity">
                <div class="row m-0 py-2 mx-2" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6>Caderno</h6>
                  </div> 
                  <div class="col">
                    <h6>&nbsp;</h6>
                  </div> 
                  <div class="col">
                    <h6>Questões</h6>
                  </div> 
                  <div class="col"></div>
                </div>
                <div v-for="exam in modalFollowup.selectedItem.selectedUnity.exams.filter(e => e.performance < 100)" data-toggle="collapse" role="button" aria-expanded="false" class="row m-0" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-12" @click="exam.collapsed = !exam.collapsed, $forceUpdate()">
                    <div class="row m-0 py-2 mx-2">
                      <div class="col-8">
                        <h6 class="py-3 mb-0 tx-16">#{exam.name}</h6>
                      </div> 
                      <div class="col d-flex align-items-center">
                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                          &nbsp;
                        </span>
                      </div>
                      <div class="col d-flex align-items-center">
                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                          #{exam.soliciteds - exam.total}
                        </span>
                      </div>
                      <div class="col d-flex align-items-center">
                        <template v-if="exam.collapsed">
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </template>
                        <template v-else>
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </template>
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="row m-0 p-3" v-if="exam.collapsed" style="background-color: rgb(249, 250, 250);">
                      <div class="col-12">
                        <span class="text-muted mx-2">Detalhamento de pendências</span> 
                        <div class="row mt-3 mb-0">
                          <div class="col-12 mb-2" v-for="teacher in exam.teachers.filter(e => (e.soliciteds - e.total) > 0)">
                            <div class="lize-card cp">
                              <div class="card-body py-2">
                                <div class="row m-0">
                                  <div class="col-8">
                                    <h6 class="py-3 mb-0 tx-16">#{teacher.name}</h6>
                                  </div>
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger"></span>
                                  </div> 
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{teacher.soliciteds - teacher.total}</span>
                                  </div>
                                  <div class="col d-flex">
                                    <a target="_blank" :href="'/provas/'+exam.id+'/revisar/'" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                                      Verificar
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div> 
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
              <template v-else>
                <p>Você deve selecionar uma unidade</p>
              </template>
            </template>
            <template v-if="modalFollowup.viewBy == 'teachers'">
              <template v-if="modalFollowup.selectedItem.selectedUnity">
                <div class="row m-0 py-2 mx-2" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-8">
                    <h6>Professor</h6>
                  </div> 
                  <div class="col">
                    <h6>&nbsp;</h6>
                  </div> 
                  <div class="col">
                    <h6>Questões</h6>
                  </div> 
                  <div class="col"></div>
                </div>
                <div v-for="teacher in modalFollowup.selectedItem.selectedUnity.teachers.filter(e => e.performance < 100)" data-toggle="collapse" role="button" aria-expanded="false" class="row m-0" style="border-bottom: 1px solid rgb(229, 231, 234);">
                  <div class="col-12" @click="teacher.collapsed = !teacher.collapsed, $forceUpdate()">
                    <div class="row m-0 py-2 mx-2">
                      <div class="col-8">
                        <h6 class="py-3 mb-0 tx-16">#{teacher.name}</h6>
                      </div> 
                      <div class="col d-flex align-items-center">
                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                          &nbsp;
                        </span>
                      </div>
                      <div class="col d-flex align-items-center">
                        <span class="py-3 mb-0 tx-14 align-self-center text-danger">
                          #{teacher.soliciteds - teacher.total}
                        </span>
                      </div>
                      <div class="col d-flex align-items-center">
                        <template v-if="teacher.collapsed">
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </template>
                        <template v-else>
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </template>
                      </div>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="row m-0 p-3" v-if="teacher.collapsed" style="background-color: rgb(249, 250, 250);">
                      <div class="col-12">
                        <span class="text-muted mx-2">Detalhamento de pendências</span> 
                        <div class="row mt-3 mb-0">
                          <div class="col-12 mb-2" v-for="exam in teacher.exams.filter(e => (e.soliciteds - e.total) > 0)">
                            <div class="lize-card cp">
                              <div class="card-body py-2">
                                <div class="row m-0">
                                  <div class="col-8">
                                    <h6 class="py-3 mb-0 tx-16">#{exam.name}</h6>
                                  </div>
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger"></span>
                                  </div> 
                                  <div class="col d-flex align-items-center">
                                    <span class="py-3 mb-0 tx-14 align-self-center text-danger">#{exam.soliciteds - exam.total}</span>
                                  </div>
                                  <div class="col d-flex">
                                    <a target="_blank" :href="'/provas/'+exam.id+'/revisar/?teacher='+teacher.id" class="btn btn-danger rounded btn-sm align-self-center" style="border-radius: 8px !important;">
                                      Verificar
                                    </a>
                                  </div>
                                </div>
                              </div>
                            </div> 
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
              <template v-else>
                <p>Você deve selecionar uma unidade</p>
              </template>
            </template>
          </template>
        </template>
      </div>
    </div>
  </div>
</div>

{% endblock content-fixed %}
{% block extra-modal %}
  {% include 'redesign/includes/modal_two_factor_activate.html' %}
{% endblock extra-modal %}

{% block js-additional %}
<script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/latest/moment-with-locales.min.js"></script>
<script src="{% static 'js/tippy/popper.min.js' %}"></script>
<script src="{% static 'js/tippy/tippy.min.js' %}"></script>
<script src="{% static 'js/swiper.min.js' %}"></script>

<script>
  moment.locale('pt-br')
  const app = new Vue({
    delimiters: ['#{', '}'],
    el: '#app',
    components: {
      'skeleton-card': Vue.component('skeleton-card', {
          template: `
            <div class="lize-card mb-3" style="border: none;">
              <div class="lize-card-body p-0">
                  <div class="row p-1">
                      <div class="col-3 skeleton-loader"></div>
                      <div class="offset-6"></div>
                      <div class="col-3 skeleton-loader"></div>
                  </div>
                  <div class="row">
                      <div class="col-8">
                          <div class="skeleton-loader"></div>
                      </div>
                  </div>
                  <div class="row">
                      <div class="col-4">
                          <div class="skeleton-loader"></div>
                      </div>
                  </div>
                  <div class="row p-1 mt-3 mb-0">
                      <div class="col-3 skeleton-loader"></div>
                      <div class="offset-6"></div>
                      <div class="col-3 skeleton-loader"></div>
                  </div>
              </div>
          </div>
          `,
      }),
    },
    data: {
      controls: {
        interval: null,
        width: window.innerWidth,
        activeRequests: 0,
      },
      searchTerm: '',
      searchResults: [],
      searchStatus: 'idle',
      debounceTimeout: null,
      searchActive: false,
      modalFollowup: {
        selectedFollowupCardType: 'elaborations',
        sortedBy: 'urgency',
        sortedByAsc: true,
        viewBy: 'teachers',
        selectedElaboration: null,
        details: {
          elaborations: [],
          uploads: [],
          corrections: [],
          reviews: [],
        },
        getExamsNames(exams) {
          names = []
          exams.forEach((e) => {

            name = e.name ? e.name.toUpperCase().slice(0, 3) : e.exam_name.toUpperCase().slice(0, 3)
            if(!names.includes(name)) {
              names.push(name)
            }
          })
          return names.join(', ')
        },
        getCompletedPercent(exams) {
          let percent = 0
          let soliciteds = exams.reduce((total, exam) => exam.soliciteds ? total += exam.soliciteds:total += exam.predict, 0)
          let total = exams.reduce((total, exam) => total += exam.total, 0)
          percent = total / soliciteds
          return percent > 1 ? 100 : (percent * 100).toFixed(0)
        },
      },

      ////////////////////////////////////////////////////////////////////////////////
      /// OTHER DATA
      ////////////////////////////////////////////////////////////////////////////////
      activeTab: 'tab-1',
      loading: true,
      average: {
        status: 'idle',
        data: 0,
        error: null,
      },
      averageBySubjects: {
        status: 'idle',
        data: 0,
        error: null,
      },
      performanceBySubject: {
        status: 'idle',
        chart: null,
        data: [],
        error: null,
      },
      frequencyInExams: {
        status: 'idle',
        chart: null,
        data: 0,
        error: null,
      },
      frequencyInExamsGeneral: {
        status: 'idle',
        chart: null,
        data: 0,
        error: null,
      },
      openExams: {
        status: 'idle',
        chart: null,
        data: null,
        error: null,
      },
      questionQualityRate: {
        status: 'idle',
        chart: null,
        data: null,
        error: null,
      },
      cards: {
        elaborations: {
          status: 'idle',
          chart: null,
          data: {},
          error: null,
        },
        corrections: {
          status: 'idle',
          chart: null,
          data: {},
          error: null,
        },
        uploads: {
          status: 'idle',
          chart: null,
          data: {},
          error: null,
        },
        reviews: {
          status: 'idle',
          chart: null,
          data: {},
          error: null,
        },
      },
      generalHistogram: {
        status: 'idle',
        chart: null,
        data: null,
        performance: 0,
        error: null,
        getColor: () => {
          let color = '#D92D20' 
          value = app.generalHistogram.performance
          if(value <= 40) {
            color = '#D92D20'
          } else if(value > 40 && value <= 60) {
            color = '#F3B364'
          } else if(value > 60 && value <= 75) {
            color = '#0C7BDB'
          } else if (value > 75) {
            color = '#41C588'
          }
          return color
        }
      },
      classeAverage: {
        status: 'idle',
        chart: null,
        data: 0,
        error: null,
      },
      classeHistogram: {
        status: 'idle',
        chart: null,
        data: null,
        error: null,
      },
      classesSubjects: {
        status: 'idle',
        chart: null,
        data: null,
        error: null,
      },
      teacherQuestionsSummary: {
        status: 'idle',
        chart: null,
        data: [],
        error: null,
      },
      teacherRanking: {
        status: 'idle',
        chart: null,
        data: [],
        error: null,
      },
      unities: [
        {% for unity in unities %}
          {
            id: "{{unity.id}}",
            name: "{{unity.name}}"
          },
        {% endfor %}
      ],
      stages: [
        {% for stage in stages %}
          {
            id: "{{stage.id}}",
            name: "{{stage.name}}"
          },
        {% endfor %}
      ],
      classes: [],
      teachers: [],
      filters: {
        cards: {
          selectedStage: '',
        },
        school: {
          selectedUnity: '',
          selectedSubjects: [],
        },
        classes: {
          selectedClasse: '',
          selectedSubject: '',
        },
        teachers: {
          selectedTeacher: '',
        }
      },
      calendar: {
        loading: false,
        events: [],
        lastDate: moment().format('YYYY-MM-DD'),
        days: [],
        selectedMonth: moment().format('M'),
        selectedEvent: null,
      },
     ////////////////////////////////////////////////////////////////////////////////
      /// TWO FACTOR
      ////////////////////////////////////////////////////////////////////////////////
      code:   "",
      isCodeInputVisible: false, 
      userTwoFactorEnable: {{user.two_factor_enabled|lower}},
      modalTitle: 'Ativar autenticação de dois fatores',
      modalMessage: 'Você está prestes a ativar a autenticação de dois fatores. Isso enviará um código de verificação para o seu e-mail sempre que você fizer login.',
      toggleButtonText: 'Ativar',
      errorMessage: '',
    },
    watch: {
      'calendar.selectedMonth': function(val) {
        this.getEventsAndCalendar()
      },
      activeTab: function(val) {
        if(val == 'tab-2') {
          this.fetchClasses().then((response) => {
            this.reCreateSelection('#inputClasseClasses')
            // this.resetLoadings(where='classes')
            // this.getData(where='classes')
          })
        }
      },
      loadingRequest: function (val) {
        if(val) {
          this.disableInputs(disable=true)
        } else {
          setTimeout(() => {
            this.disableInputs(disable=false)
          }, 300)
        }
      },
      'filters.classes.selectedClasse': function(val) {
        this.resetLoadings(where='classes')
        this.getData(where='classes')
      },
      'filters.teachers.selectedTeacher': function(val) {
        this.resetLoadings(where='teachers')
        this.getData(where='teachers')
      },
      'filters.cards.selectedStage': function(val) {
        this.resetLoadings(where='cards')
        this.getData(where='cards')
        this.getEventsAndCalendar()
      },
      'filters.school.selectedSubjects': function(val) {
        this.resetLoadings(where='school')
        this.getData(where='school')
      },
      'filters.school.selectedUnity': function(val) {
        this.fetchClasses().then((response) => {
          this.reCreateSelection('#inputClasseClasses')
          this.resetLoadings(where='classes')
          // this.getData(where='classes')
        })
        this.resetLoadings()
        this.getData()
        this.getEventsAndCalendar()
      },
      'modalFollowup.sortedBy': function(val) {
        this.applyOrdering()
      }
    },
    methods: {
      openModalTwoFactorActivate() {
        const allModals = document.querySelectorAll('.modal');
        $("#modalTwoFactorActivate").modal('show');

        if (this.userTwoFactorEnable) {
          this.modalTitle = 'Desativar autenticação de dois fatores';
          this.modalMessage = '<p>Para garantir a segurança da sua conta, enviaremos um código de verificação para o seu e-mail. Esse código será necessário para confirmar a desativação da autenticação de dois fatores.<br>Você deseja prosseguir?</p>';
          this.toggleButtonText = 'Desativar';
        } else {
          this.modalTitle = 'Ativar autenticação de dois fatores';
          this.modalMessage = '<p>Para garantir a segurança da sua conta, enviaremos um código de verificação para o seu e-mail.  Esse código será necessário para confirmar a ativação da autenticação de dois fatores.<br> Você deseja prosseguir? </p>';
          this.toggleButtonText = 'Ativar';
        }
      },
      closeModalUserTwoFactor() {
        $("#modalTwoFactorActivate").modal('hide');
        this.code = ""
        this.isCodeInputVisible = false
      },
      sendTwoFactorCode() {

        axios.post("{% url 'api2:send_two_factor_code' %}", {}, {
          headers: { 'X-CSRFToken':  '{{ csrf_token }}' }
        })
        .then(response => {
          this.isCodeInputVisible = true
        })
        .catch(error => {
          console.error(error);
        });
      },     
      verifyTwoFactorCode() {
        const code = this.code;  
      
        axios.post("{% url 'api2:verify_two_factor_code' %}", { code }, {
          headers: { 'X-CSRFToken': '{{ csrf_token }}' }
        })
        .then(response => {
          this.userTwoFactorEnable = response.data.two_factor_enabled;
          const message = `Autenticação de dois fatores ${response.data.two_factor_enabled ? 'ativada' : 'desativada'} com sucesso.`;
          this.showToast(message, response.data.two_factor_enabled);
          this.closeModalUserTwoFactor()
        })
        .catch(error => {
          this.errorMessage = 'Código inválido ou expirado.';

          console.log('Erro: ' + error.response.data.error);
        });
      }, 
      showToast(message, isActivated) {
        const title = isActivated ? 'Ativada!' : 'Desativada!';
        Swal.fire({
          title: title,
          text: message,
          icon: 'success',
          showConfirmButton: false,
          timer: 1500,
          timerProgressBar: true,
          toast: true,
          position: 'top-end',
        });
      },
      openModalEventSummary(event) {
        this.calendar.selectedEvent = event
        this.calendar.loading = true
        let eventCopy = Object.assign({}, event)
        eventCopy['deadline'] = moment(eventCopy['deadline']).format('YYYY-MM-DD')
        axios({
          url: `{% url 'api:calendar-get-summary' %}?unity=${this.filters.school.selectedUnity}&stage=${this.filters.cards.selectedStage}`,
          method: 'post',
          data: eventCopy,
        }).then((response) => {
          this.calendar.selectedEvent.summary = response.data
          $("#modalEventSummary").modal('show')
        }).finally(() => {
          this.calendar.loading = false
        })
      },
      startCalendarSwiper() {
        const swiper = new Swiper('.swiper-container', {
            loop: false,
            navigation: {
              nextEl: '.next-slide',
              prevEl: '.prev-slide',
            },
            autoplay: false,
            mousewheel: {
              enabled: true,
            },
            breakpoints: {
              0: {
                slidesPerView: 1.9,
                spaceBetween: 10,
              },
              576: {
                slidesPerView: 3.3,
                spaceBetween: 10,
              },
              768: {
                slidesPerView: 4.3,
                spaceBetween: 10,
              },
              992: {
                slidesPerView: 5.1,
                spaceBetween: 10,
              },
              1200: {
                slidesPerView: 4,
                spaceBetween: 10,
              },
              1300: {
                slidesPerView: 4.5,
                spaceBetween: 10,
              },
              1400: {
                slidesPerView: 5.5,
                spaceBetween: 10,
              },
              1600: {
                slidesPerView: 6.8,
                spaceBetween: 10,
              },
              1750: {
                slidesPerView: 7.5,
                spaceBetween: 10,
              },
              1900: {
                slidesPerView: 8.5,
                spaceBetween: 10,
              },
            },
        })

        swiper.on('slideChange', function () {
        });

        if(this.moment().format('M') == this.calendar.selectedMonth) {
          swiper.slideTo(moment().format('DD') - 1)
        } else {
          swiper.slideTo(1)
          swiper.slideTo(0)
        }
      },
      generateDays() {
        const startOfMonth = moment().month(this.calendar.selectedMonth - 1).startOf('month');
        const endOfMonth = moment().month(this.calendar.selectedMonth - 1).endOf('month');
        let days = [];
        let day = startOfMonth.clone();

        while (day <= endOfMonth) {
          days.push(day.clone());
          day.add(1, 'day');
        }
        this.calendar.days = days
        this.startCalendarSwiper()
      },
      async getEvents() {
        return axios.get(`${"{% url 'api:calendar-get-calendar' pk=9999 %}".replace('9999', this.calendar.selectedMonth)}?unity=${this.filters.school.selectedUnity}&stage=${this.filters.cards.selectedStage}`)
      },
      async getEventsAndCalendar() {
        await this.getEvents(this.calendar.selectedMonth).then((response) => {
          this.calendar.events = response.data.map((e) => ({ ...e, summary: null}))
        }).finally(() => {
          this.generateDays()
        })
      },
      changeViewBy(type) {
        if(this.modalFollowup.selectedFollowupCardType == 'corrections') {
          if(type == 'teachers') {
            this.modalFollowup.selectedItem.selectedUnity = this.modalFollowup.selectedItem.unities.teachers.at(0)
          } else if(type == 'exams') {
            this.modalFollowup.selectedItem.selectedUnity = this.modalFollowup.selectedItem.unities.exams.at(0)
          }
        }
        this.modalFollowup.viewBy = type
      },
      applyOrdering() {
        if(this.modalFollowup.sortedBy == 'urgency') {

          this.modalFollowup.details.elaborations = this.modalFollowup.details.elaborations.sort((a, b) => this.modalFollowup.sortedByAsc ? a.priorityValue > b.priorityValue : a.priorityValue < b.priorityValue)
          this.modalFollowup.details.uploads = this.modalFollowup.details.uploads.sort((a, b) => this.modalFollowup.sortedByAsc ? a.priorityValue > b.priorityValue : a.priorityValue < b.priorityValue)
          this.modalFollowup.details.corrections = this.modalFollowup.details.corrections.sort((a, b) => this.modalFollowup.sortedByAsc ? a.priorityValue > b.priorityValue : a.priorityValue < b.priorityValue)
          
        } else if(this.modalFollowup.sortedBy == 'date') {

          this.modalFollowup.details.elaborations = this.modalFollowup.details.elaborations.sort((a, b) => {
            const dateA = moment(a.deadline);
            const dateB = moment(b.deadline);
            return this.modalFollowup.sortedByAsc ? dateA.diff(dateB) : dateB.diff(dateA);
          });

          this.modalFollowup.details.uploads = this.modalFollowup.details.uploads.sort((a, b) => {
            const dateA = moment(a.deadline);
            const dateB = moment(b.deadline);
            return this.modalFollowup.sortedByAsc ? dateA.diff(dateB) : dateB.diff(dateA);
          });

          this.modalFollowup.details.corrections = this.modalFollowup.details.corrections.sort((a, b) => {
            const dateA = moment(a.deadline);
            const dateB = moment(b.deadline);
            return this.modalFollowup.sortedByAsc ? dateA.diff(dateB) : dateB.diff(dateA);
          });

        }
      },
      handlerPriority(item) {
        let magicNumber = 200

        let a = moment(item.deadline)
        let b = moment()

        let diffDays = a.diff(b, 'days') ? a.diff(b, 'days') : 1
        
        let quantityPerDay = (item.incomplete / Math.abs(diffDays))

        if(diffDays < 0){
          item.priorityValue = 5
        }else if(quantityPerDay <= magicNumber) {
          item.priorityValue = 1
        } else if(quantityPerDay > magicNumber * 2) {
          item.priorityValue = 5
        } else if(quantityPerDay > magicNumber * 1.8) {
          item.priorityValue = 4
        } else if(quantityPerDay > magicNumber * 1.6) {
          item.priorityValue = 3
        } else if(quantityPerDay > magicNumber * 1.4) {
          item.priorityValue = 2
        }

        if([4, 5].includes(item.priorityValue)) {
          item.priority = 'high'
        } else if([2, 3].includes(item.priorityValue)) {
          item.priority = 'medium'
        }
      },
      greeting() {
        const now = new Date();
        const hours = now.getHours();
        if (hours >= 6 && hours < 12) {
            return "Que seu dia comece cheio de alegria e energia! Bom dia ☀️";
        } else if (hours >= 12 && hours < 18) {
            return "Espero que sua tarde seja produtiva e cheia de boas surpresas! Boa tarde 🌞";
        } else {
            return "Que seja uma noite tranquila e revigorante! Boa noite 🌟";
        }
      },
      getHistogramProportion(value) {
        let total = this.generalHistogram.data['0-40'] + this.generalHistogram.data['40-60'] + this.generalHistogram.data['60-75'] + this.generalHistogram.data['75-100']
        return value / total * 100
      },
      getMarkerPosition(value) {
        if (value >= 0 && value < 40) {
          return { index: 0, proportion: value / 40, color: '#D92D20' };
        } else if (value >= 40 && value < 60) {
          return { index: 1, proportion: (value - 40) / 20, color: '#F3B364' };
        } else if (value >= 60 && value < 75) {
          return { index: 2, proportion: (value - 60) / 15, color: '#0C7BDB' };
        } else if (value >= 75 && value <= 100) {
          return { index: 3, proportion: (value - 75) / 25, color: '#41C588' };
        }
      },
      getMarkPositionAndColor(value) {
        try {
            if (!value) {
              value = this.generalHistogram.performance
            }
            let numbers = [this.generalHistogram.data['0-40'], this.generalHistogram.data['40-60'], this.generalHistogram.data['60-75'], this.generalHistogram.data['75-100']]
            let positionAndColor = this.getMarkerPosition(value)
            let width = 0
            let positionWidth = this.getHistogramProportion(numbers[positionAndColor.index])
            numbers.filter((n, i) => i < positionAndColor.index).forEach((value, index) => {
            width += this.getHistogramProportion(numbers[index])
          })        
          return { position: width + (positionWidth * positionAndColor.proportion), color: positionAndColor.color }
        } catch {
          return { position: 0, color: '#D92D20'}
        }
      },
      followupDetail(type) {
        $('#modalFollowupDetail').modal('show')
        this.modalFollowup.selectedFollowupCardType = type
        this.modalFollowup.selectedItem = null
        this.getFollowupDetails(type)
      },
      getFollowupDetails(type, deadline, unityID = null) {
        let operation = ''
        if(type == 'elaborations') {
          operation = deadline ? 'get_followup_questions_elaboration_deadline':'get_followup_questions_elaboration'
        } else if(type == 'uploads') {
          operation = deadline ? 'get_followup_uploads_deadline':'get_followup_uploads'
        } else if(type == 'corrections') {
          operation = deadline ? 'get_followup_corrections_deadline':'get_followup_corrections'
        } else if(type == 'reviews') {
          operation = deadline ? 'get_followup_reviews_deadline':'get_followup_reviews'
        }

        if (deadline) {
          axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "operation": operation,
              "from_cache": false,
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity]: null,
              "filters": {
                "deadline": deadline,
                "stage": this.filters.cards.selectedStage ? this.filters.cards.selectedStage : null,
                "user_unities": this.unities.map((u) => u.id),
                "followup_unity": unityID
              }
            }
          }).then((response) => {
            let unities = response.data[0]

            if(unityID) {
              if(type == 'corrections') {
                unities.teachers.forEach((u) => {
                  unity = this.modalFollowup.selectedItem.unities.teachers.find(_u => _u.id == u.id)
                  unity.teachers = u.teachers
                  this.$forceUpdate()
                })

                unities.exams.forEach((u) => {
                  unity = this.modalFollowup.selectedItem.unities.exams.find(_u => _u.id == u.id)
                  unity.exams = u.exams
                  this.$forceUpdate()
                })
              } else {
                this.modalFollowup.selectedItem.selectedUnity.exams = unities.at(0).exams
                this.modalFollowup.selectedItem.selectedUnity.teachers = unities.at(0).teachers
                this.$forceUpdate()
              }
            } else {
              this.modalFollowup.selectedItem = {
                deadline: deadline,
                selectedUnity: null,
                unities: unities,
              }
              if(this.modalFollowup.selectedFollowupCardType == 'corrections') {
                if(this.modalFollowup.viewBy == 'teachers') {
                  this.modalFollowup.selectedItem.selectedUnity = this.modalFollowup.selectedItem.unities.teachers.at(0)
                } else if(this.modalFollowup.viewBy == 'exams') {
                  this.modalFollowup.selectedItem.selectedUnity = this.modalFollowup.selectedItem.unities.exams.at(0)
                }
              } else {
                this.modalFollowup.selectedItem.selectedUnity = this.modalFollowup.selectedItem.unities.at(0)
              }
              this.getFollowupDetails(type, deadline, this.modalFollowup.selectedItem.selectedUnity.id)
              this.$forceUpdate()

            }
          })
        } else {
          axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "operation": operation,
              "from_cache": false,
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity]: null,
              "filters": {
                "stage": this.filters.cards.selectedStage ? this.filters.cards.selectedStage : null,
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            if(type == 'elaborations') {
              this.modalFollowup.details.elaborations = response.data[0].map(i => ({ ...i, priority: 'low', priorityValue: 1 }))
              this.modalFollowup.details.elaborations.forEach((item) => this.handlerPriority(item))
            } else if(type == 'uploads') {
              this.modalFollowup.details.uploads = response.data[0].map(i => ({ ...i, priority: 'low', priorityValue: 1 }))
              this.modalFollowup.details.uploads.forEach((item) => this.handlerPriority(item))
            } else if(type == 'corrections') {
              this.modalFollowup.details.corrections = response.data[0].map(i => ({ ...i, priority: 'low', priorityValue: 1 }))
              this.modalFollowup.details.corrections.forEach((item) => this.handlerPriority(item))
            } else if(type == 'reviews') {
              this.modalFollowup.details.reviews = response.data[0].map(i => ({ ...i, priority: 'low', priorityValue: 1 }))
              this.modalFollowup.details.reviews.forEach((item) => this.handlerPriority(item))
            }
          })
        }
      },
      getFollowupCard(type) {
        let options = ['elaborations', 'uploads', 'corrections', 'reviews']
        let currentIndex = options.indexOf(this.modalFollowup.selectedFollowupCardType)
        
        if (type == 'next') {
          newIndex = currentIndex + 1
          newIndex > options.length -1 ? this.modalFollowup.selectedFollowupCardType = options.at(0) : this.modalFollowup.selectedFollowupCardType = options.at(newIndex)
        } else {
          newIndex = currentIndex - 1
          newIndex < 0 ? this.modalFollowup.selectedFollowupCardType = options.at(options.length - 1) : this.modalFollowup.selectedFollowupCardType = options.at(newIndex)
        }
        this.followupDetail(this.modalFollowup.selectedFollowupCardType)
      },
      fetchClasses()  {
        return new Promise((resolve) => {
          axios.get(`{% url 'classes:classes_list_api' %}?simple_serializer=true&school_year=${new Date().getFullYear()}&${this.filters.school.selectedUnity ? 'coordination__unity='+this.filters.school.selectedUnity:'' }`).then((response) => {
            this.classes = response.data
          }).finally(() => {
            resolve(this.classes)
          })
        })
      },
      fetchTeachers()  {
        return new Promise((resolve) => {
          axios.get(`{% url 'inspectors:inspectors_list_api' %}?${this.filters.school.selectedUnity ? 'coordinations__unity='+this.filters.school.selectedUnity:'' }`).then((response) => {
            this.teachers = response.data
          }).finally(() => {
            resolve(this.teachers)
          })
        })
      },
      generateCorrectParams(name, id) {
        let url_params = `who=${name}&who_id=${id}`
        if(['cadernos', 'exam', 'exams'].includes(name)) {
          url_params = `who=school&what=exams&what_ids=${id}`
        } else if(['disciplinas', 'subject', 'subjects'].includes(name)) {
          url_params = `who=school&what=subjects&what_ids=${id}`
        }
        return url_params
      },
      getGroupLink(groupResult) {
        const applicationListUrl = "{% url 'applications:applications_list' %}"
        const examListUrl = "{% url 'exams:exams_list' %}"
        const studentListUrl = "{% url 'students:students_list' %}"
        const teacherListUrl = "{% url 'inspectors:teachers_list' %}"
        const schoolClassListUrl = "{% url 'classes:classes_list' %}"

        if (groupResult.name.toLowerCase() === 'aplicações') {
          return applicationListUrl
        } else if (groupResult.name.toLowerCase() === 'cadernos') {
          return examListUrl
        } else if (groupResult.name.toLowerCase() === 'alunos') {
          return studentListUrl
        } else if (groupResult.name.toLowerCase() === 'professores') {
          return teacherListUrl
        } else if (groupResult.name.toLowerCase() === 'turmas') {
          return schoolClassListUrl
        }

        return '#'
      },
      getGroupLinkTeacher(groupResult) {
        const examListUrl = "{% url 'exams:exams_list' %}"

        if (groupResult.name.toLowerCase() === 'cadernos') {
          return examListUrl
        }

        return '#'
      },
      getGroupLinkStudent(groupResult) {
        const examListUrl = "{% url 'applications:application_student_list' %}"

        if (groupResult.name.toLowerCase() === 'provas') {
          return examListUrl
        }

        return '#'
      },
      getUrlWithNameQuery(groupResult) {
        const url = this.getGroupLink(groupResult)

        const queryParam = 'q_name=' + this.searchTerm
        return url + '?' + queryParam
      },
      getUrlWithNameQueryTeacher(groupResult) {
        const url = this.getGroupLinkTeacher(groupResult)

        const queryParam = 'q_name=' + this.searchTerm
        return url + '?' + queryParam
      },
      getUrlWithNameQueryStudent(groupResult) {
        const url = this.getGroupLinkStudent(groupResult)

        const queryParam = 'q_name=' + this.searchTerm
        return url + '?' + queryParam
      },
      getUrlAction(groupResult, action, pk) {
        const urlsApplication = [
          "{% url 'applications:applications_add_del_student' pk='00000000-0000-0000-0000-000000000000' %}",
          "{% url 'applications:applications_update' pk='00000000-0000-0000-0000-000000000000' %}",
        ]
        
        let urlsExam = ['', '']
        if(Boolean("{{user|has_perm:'exams.change_exam'|default:''|default_if_none:''}}")) {
          urlsExam[0] = "{% url 'exams:exams_update' pk='00000000-0000-0000-0000-000000000000' %}"
        }
        if(Boolean("{{user|has_perm:'exams.can_diagram_exam'|default:''|default_if_none:''}}")) {
          urlsExam[1] = "{% url 'exams:exam-print-v2' pk='00000000-0000-0000-0000-000000000000' %}"
        }

        let urlsStudent = ['', '']
        if(Boolean("{{user|has_perm:'students.change_student'|default:''|default_if_none:''}}")) {
          urlsStudent[0] = "{% url 'students:students_update' pk='00000000-0000-0000-0000-000000000000' %}"
        }
        if(Boolean("{{user|has_perm:'students.can_reset_password'|default:''|default_if_none:''}}")) {
          urlsStudent[1] = `{% url 'students:students_list' %}?q_pk=${pk}&reset_password=${pk}`
        }

        let urlsTeacher = ['', '']
        if(Boolean("{{user|has_perm:'inspectors.change_teacher'|default:''|default_if_none:''}}")) {
          urlsTeacher[0] = "{% url 'inspectors:teachers_update' pk='00000000-0000-0000-0000-000000000000' %}"
        }
        if(Boolean("{{user|has_perm:'inspectors.can_reset_password'|default:''|default_if_none:''}}")) {
          urlsTeacher[1] = `{% url 'inspectors:teachers_list' %}?q_pk=${pk}&reset_password=${pk}`
        }

        let urlsSchoolClass = ['', '']
        if(Boolean("{{user|has_perm:'classes.change_schoolclass'|default:''|default_if_none:''}}")) {
          urlsSchoolClass[0] = "{% url 'classes:classes_update' pk='00000000-0000-0000-0000-000000000000' %}"
        }

        let urls = ['#', '#']
        if (groupResult.name.toLowerCase() === 'aplicações') {
          urls = urlsApplication
        } else if (groupResult.name.toLowerCase() === 'cadernos') {
          urls = urlsExam
        } else if (groupResult.name.toLowerCase() === 'alunos') {
          urls = urlsStudent
        } else if (groupResult.name.toLowerCase() === 'professores') {
          urls = urlsTeacher
        } else if (groupResult.name.toLowerCase() === 'turmas') {
          urls = urlsSchoolClass
        }
        return urls[action].replace('00000000-0000-0000-0000-000000000000', pk)
      },
      getUrlActionStudent(groupResult, action, pk) {
          const urlsApplication = [
            "{% url 'applications:application_exam_student_detail_v2' pk='00000000-0000-0000-0000-000000000000' %}",
            "{% url 'applications:application_exam_student_detail_insight' pk='00000000-0000-0000-0000-000000000000' %}",
          ]
          let urls = ['#', '#']
          if (groupResult.name.toLowerCase() === 'provas') {
            urls = urlsApplication
          }
          return urls[action].replace('00000000-0000-0000-0000-000000000000', pk)
      },
      getUrlActionTeacher(groupResult, action, pk) {
        const urlsExam = [
          "{% url 'exams:exams_preview' pk='00000000-0000-0000-0000-000000000000' %}",
          "{% url 'exams:exams_detail_v2' pk='00000000-0000-0000-0000-000000000000' %}",
        ]
        let urls = ['#', '#']
        if (groupResult.name.toLowerCase() === 'cadernos') {
          urls = urlsExam
        }
        return urls[action].replace('00000000-0000-0000-0000-000000000000', pk)
      },
      getNameAction(groupResult, action) {
        const namesApplication = ["Adicionar remover alunos", "Editar"]
        const namesExam = ["Editar", "Diagramação"]
        const namesStudent = ["Editar", "Resetar senha"]
        const namesTeacher = ["Editar", "Resetar senha"]
        const namesSchoolClass = ["Editar", "#"]
        let urls = ['#', '#']
        if (groupResult.name.toLowerCase() === 'aplicações') {
          urls = namesApplication
        } else if (groupResult.name.toLowerCase() === 'cadernos') {
          urls = namesExam
        } else if (groupResult.name.toLowerCase() === 'alunos') {
          urls = namesStudent
        } else if (groupResult.name.toLowerCase() === 'professores') {
          urls = namesTeacher
        } else if (groupResult.name.toLowerCase() === 'turmas') {
          urls = namesSchoolClass
        }
        return urls[action]
      },
      getNameActionStudent(groupResult, action) {
        const namesApplication = ['Ver resultado', 'Revisar questões']
        let urls = ['#', '#']
        if (groupResult.name.toLowerCase() === 'provas') {
          urls = namesApplication
        }
        return urls[action]
      },
      getNameActionTeacher(groupResult, action) {
        const namesApplication = ['Visualizar', 'Correção de respostas']
        let urls = ['#', '#']
        if (groupResult.name.toLowerCase() === 'cadernos') {
          urls = namesApplication
        }
        return urls[action]
      },
      getIconAction(groupResult, action) {
        const editIcon = '<path d="M11 3.99998H6.8C5.11984 3.99998 4.27976 3.99998 3.63803 4.32696C3.07354 4.61458 2.6146 5.07353 2.32698 5.63801C2 6.27975 2 7.11983 2 8.79998V17.2C2 18.8801 2 19.7202 2.32698 20.362C2.6146 20.9264 3.07354 21.3854 3.63803 21.673C4.27976 22 5.11984 22 6.8 22H15.2C16.8802 22 17.7202 22 18.362 21.673C18.9265 21.3854 19.3854 20.9264 19.673 20.362C20 19.7202 20 18.8801 20 17.2V13M7.99997 16H9.67452C10.1637 16 10.4083 16 10.6385 15.9447C10.8425 15.8957 11.0376 15.8149 11.2166 15.7053C11.4184 15.5816 11.5914 15.4086 11.9373 15.0627L21.5 5.49998C22.3284 4.67156 22.3284 3.32841 21.5 2.49998C20.6716 1.67156 19.3284 1.67155 18.5 2.49998L8.93723 12.0627C8.59133 12.4086 8.41838 12.5816 8.29469 12.7834C8.18504 12.9624 8.10423 13.1574 8.05523 13.3615C7.99997 13.5917 7.99997 13.8363 7.99997 14.3255V16Z" stroke-linecap="round" stroke-linejoin="round"/>'
        const diagramIcon = '<path d="M17.5 17H6.5M17.5 13H6.5M3 9H21M7.8 3H16.2C17.8802 3 18.7202 3 19.362 3.32698C19.9265 3.6146 20.3854 4.07354 20.673 4.63803C21 5.27976 21 6.11984 21 7.8V16.2C21 17.8802 21 18.7202 20.673 19.362C20.3854 19.9265 19.9265 20.3854 19.362 20.673C18.7202 21 17.8802 21 16.2 21H7.8C6.11984 21 5.27976 21 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3 18.7202 3 17.8802 3 16.2V7.8C3 6.11984 3 5.27976 3.32698 4.63803C3.6146 4.07354 4.07354 3.6146 4.63803 3.32698C5.27976 3 6.11984 3 7.8 3Z" stroke-linecap="round" stroke-linejoin="round"/>'
        const keiIcon = '<path d="M17 8.99994C17 8.48812 16.8047 7.9763 16.4142 7.58579C16.0237 7.19526 15.5118 7 15 7M15 15C18.3137 15 21 12.3137 21 9C21 5.68629 18.3137 3 15 3C11.6863 3 9 5.68629 9 9C9 9.27368 9.01832 9.54308 9.05381 9.80704C9.11218 10.2412 9.14136 10.4583 9.12172 10.5956C9.10125 10.7387 9.0752 10.8157 9.00469 10.9419C8.937 11.063 8.81771 11.1823 8.57913 11.4209L3.46863 16.5314C3.29568 16.7043 3.2092 16.7908 3.14736 16.8917C3.09253 16.9812 3.05213 17.0787 3.02763 17.1808C3 17.2959 3 17.4182 3 17.6627V19.4C3 19.9601 3 20.2401 3.10899 20.454C3.20487 20.6422 3.35785 20.7951 3.54601 20.891C3.75992 21 4.03995 21 4.6 21H7V19H9V17H11L12.5791 15.4209C12.8177 15.1823 12.937 15.063 13.0581 14.9953C13.1843 14.9248 13.2613 14.8987 13.4044 14.8783C13.5417 14.8586 13.7588 14.8878 14.193 14.9462C14.4569 14.9817 14.7263 15 15 15Z" stroke-linecap="round" stroke-linejoin="round"/>'
        const addUserIcon = '<path d="M12 15.5H7.5C6.10444 15.5 5.40665 15.5 4.83886 15.6722C3.56045 16.06 2.56004 17.0605 2.17224 18.3389C2 18.9067 2 19.6044 2 21M19 21V15M16 18H22M14.5 7.5C14.5 9.98528 12.4853 12 10 12C7.51472 12 5.5 9.98528 5.5 7.5C5.5 5.01472 7.51472 3 10 3C12.4853 3 14.5 5.01472 14.5 7.5Z" stroke-linecap="round" stroke-linejoin="round"/>'

        const iconsApplication = [addUserIcon, editIcon]
        const iconsExam = [editIcon, diagramIcon]
        const iconsStudent = [editIcon, keiIcon]
        const iconsTeacher = [editIcon, keiIcon]
        const iconsSchoolClass = [editIcon, '']

        let icons = ['', '']
        if (groupResult.name.toLowerCase() === 'aplicações') {
          icons = iconsApplication
        } else if (groupResult.name.toLowerCase() === 'cadernos') {
          icons = iconsExam
          if(!Boolean("{{user|has_perm:'exams.change_exam'|default:''|default_if_none:''}}")) {
            icons[0] = ''
          }
          if(!Boolean("{{user|has_perm:'exams.can_diagram_exam'|default:''|default_if_none:''}}")) {
            icons[1] = ''
          }
        } else if (groupResult.name.toLowerCase() === 'alunos') {
          icons = iconsStudent
          if(!Boolean("{{user|has_perm:'students.change_student'|default:''|default_if_none:''}}")) {
            icons[0] = ''
          }
          if(!Boolean("{{user|has_perm:'students.can_reset_password'|default:''|default_if_none:''}}")) {
            icons[1] = ''
          }
        } else if (groupResult.name.toLowerCase() === 'professores') {
          icons = iconsTeacher
          if(!Boolean("{{user|has_perm:'inspectors.change_teacher'|default:''|default_if_none:''}}")) {
            icons[0] = ''
          }
          if(!Boolean("{{user|has_perm:'inspectors.can_reset_password'|default:''|default_if_none:''}}")) {
            icons[1] = ''
          }
        } else if (groupResult.name.toLowerCase() === 'turmas') {
          icons = iconsSchoolClass
          if(!Boolean("{{user|has_perm:'classes.change_schoolclass'|default:''|default_if_none:''}}")) {
            icons[0] = ''
          }
        }
        return icons[action]
      },
      getIconActionStudent(groupResult, action) {
        const eyeIcon = '<path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke-linecap="round" stroke-linejoin="round"/>'
        const reviewIcon = '<path d="M14 11H8M10 15H8M16 7H8M20 10.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H11.5M22 22L20.5 20.5M21.5 18C21.5 19.933 19.933 21.5 18 21.5C16.067 21.5 14.5 19.933 14.5 18C14.5 16.067 16.067 14.5 18 14.5C19.933 14.5 21.5 16.067 21.5 18Z" stroke-linecap="round" stroke-linejoin="round"/>'

        const iconsApplication = [eyeIcon, reviewIcon]

        let icons = ['', '']
        if (groupResult.name.toLowerCase() === 'provas') {
          icons = iconsApplication
        }
        return icons[action]
      },
      getIconActionTeacher(groupResult, action) {
        const eyeIcon = '<path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke-linecap="round" stroke-linejoin="round"/>'
        const eraseIcon = '<path d="M17.9995 13L10.9995 6.00004M20.9995 21H7.99955M10.9368 20.0628L19.6054 11.3941C20.7935 10.2061 21.3875 9.61207 21.6101 8.92709C21.8058 8.32456 21.8058 7.67551 21.6101 7.07298C21.3875 6.388 20.7935 5.79397 19.6054 4.60592L19.3937 4.39415C18.2056 3.2061 17.6116 2.61207 16.9266 2.38951C16.3241 2.19373 15.675 2.19373 15.0725 2.38951C14.3875 2.61207 13.7935 3.2061 12.6054 4.39415L4.39366 12.6059C3.20561 13.794 2.61158 14.388 2.38902 15.073C2.19324 15.6755 2.19324 16.3246 2.38902 16.9271C2.61158 17.6121 3.20561 18.2061 4.39366 19.3941L5.06229 20.0628C5.40819 20.4087 5.58114 20.5816 5.78298 20.7053C5.96192 20.815 6.15701 20.8958 6.36108 20.9448C6.59126 21 6.83585 21 7.32503 21H8.67406C9.16324 21 9.40784 21 9.63801 20.9448C9.84208 20.8958 10.0372 20.815 10.2161 20.7053C10.418 20.5816 10.5909 20.4087 10.9368 20.0628Z" stroke-linecap="round" stroke-linejoin="round"/>'

        const iconsApplication = [eyeIcon, eraseIcon]

        let icons = ['', '']
        if (groupResult.name.toLowerCase() === 'cadernos') {
          icons = iconsApplication
        }
        return icons[action]
      },
      debouncedSearch() {
        if (this.searchTerm.length === 0) {
          this.searchResults = []
          this.searchStatus = 'idle'
          return
        }

        clearTimeout(this.debounceTimeout)
        this.debounceTimeout = setTimeout(() => {
          this.performSearch()
        }, 750) // debounce delay 300ms
      },
      performSearch() {
        this.searchStatus = 'loading'

        fetch(`/api/v1/search/?q=${this.searchTerm}`)
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok')
            }
            return response.json()
          })
          .then(data => {
            this.searchResults = data
            this.searchStatus = 'success'
          })
          .catch(error => {
            this.searchStatus = 'error'
          })
      },
      onFocusSearch() {
        this.searchActive = true
      },
      onClickOutsideSearch() {
        this.searchActive = false
      },
      redirect(url) {
        window.location.href = url
      },
      showSearchGlobal() {
        const url = new URL(window.location.href)
        const resetPassword = url.searchParams.get('searchglobal')
        return Boolean(resetPassword)
      },

      ////////////////////////////////////////////////////////////////////////////////
      /// OTHER METHODS
      ////////////////////////////////////////////////////////////////////////////////
      async fetchElaborationData() {
        if(this.cards.elaborations.status == 'idle' && this.isVisible(this.$refs.elaborations)) {
          this.cards.elaborations.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "operation": "get_card_followup_questions_elaboration",
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity]: null,
              "filters": {
                "stage": this.filters.cards.selectedStage ? this.filters.cards.selectedStage : null,
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.cards.elaborations.status = 'success'
            this.cards.elaborations.data = response.data[0]
            
            let value = this.cards.elaborations.data.performance

            let color = {
              light: value >= 50 && value < 70 ? '#FEF7EF' : value >= 70 ? '#ECF9F3':'#FBEAE9', 
              accent: value >= 50 && value < 70 ? '#F3B364' : value >= 70 ? '#41C588':'#D92D20'
            }
    
            let elaborationDataChartElement = $('[data-chart="idElaborationDataChart"]')
            
            elaborationDataChartElement.html(`
              <svg width="64" height="64" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                <path stroke="${color.light}" stroke-linecap="round" stroke-width="3.8" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                <path stroke="${color.accent}" stroke-linecap="round" stroke-width="3.8" stroke-dasharray="${value}, 100" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                <text x="50%" y="50%" fill="#101828" font-size="8" font-size="16px"  alignment-baseline="middle" text-anchor="middle" style="line-height: 24px; font-weight: 500;">${value}%</text>
              </svg>
            `)
          }).catch(() => {
            this.cards.elaborations.status = 'error'
          })
        }
      },
      async fetchUploadsData() {
        if(this.cards.uploads.status == 'idle' && this.isVisible(this.$refs.uploads)) {
          this.cards.uploads.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "operation": "get_card_followup_uploads",
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity]: null,
              "filters": {
                "stage": this.filters.cards.selectedStage ? this.filters.cards.selectedStage : null,
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.cards.uploads.status = 'success'
            this.cards.uploads.data = response.data[0]
            
            let value = this.cards.uploads.data.performance.toFixed(0)

            let color = {
              light: value >= 50 && value < 70 ? '#FEF7EF' : value >= 70 ? '#ECF9F3':'#FBEAE9', 
              accent: value >= 50 && value < 70 ? '#F3B364' : value >= 70 ? '#41C588':'#D92D20'
            }
            
            let applicationDataChartElement = $('[data-chart="idUploadsDataChart"]')
            
            applicationDataChartElement.html(`
              <svg width="64" height="64" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                <path stroke="${color.light}" stroke-linecap="round" stroke-width="3.8" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                <path stroke="${color.accent}" stroke-linecap="round" stroke-width="3.8" stroke-dasharray="${value}, 100" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                <text x="50%" y="50%" fill="#101828" font-size="8" font-size="16px"  alignment-baseline="middle" text-anchor="middle" style="line-height: 24px; font-weight: 500;">${value}%</text>
              </svg>
            `)
          }).catch(() => {
            this.cards.elaborations.status = 'error'
          })
        }
      },
      async fetchCorrectionsData() {
        if(this.cards.corrections.status == 'idle' && this.isVisible(this.$refs.corrections)) {
          this.cards.corrections.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "operation": "get_card_followup_corrections",
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity]: null,
              "filters": {
                "stage": this.filters.cards.selectedStage ? this.filters.cards.selectedStage : null,
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.cards.corrections.data = response.data[0]
            
            if (this.cards.corrections.data) {
              this.cards.corrections.status = 'success'
              let value = this.cards.corrections.data.performance.toFixed(0)
  
              let color = {
                light: value >= 50 && value < 70 ? '#FEF7EF' : value >= 70 ? '#ECF9F3':'#FBEAE9', 
                accent: value >= 50 && value < 70 ? '#F3B364' : value >= 70 ? '#41C588':'#D92D20'
              }
              let correctionsDataChartElement = $('[data-chart="idCorrectionsDataChart"]')
              
              correctionsDataChartElement.html(`
                <svg width="64" height="64" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                  <path stroke="${color.light}" stroke-linecap="round" stroke-width="3.8" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                  <path stroke="${color.accent}" stroke-linecap="round" stroke-width="3.8" stroke-dasharray="${value}, 100" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                  <text x="50%" y="50%" fill="#101828" font-size="8" font-size="16px"  alignment-baseline="middle" text-anchor="middle" style="line-height: 24px; font-weight: 500;">${value}%</text>
                </svg>
              `)
            }
          }).catch(() => {
            this.cards.corrections.status = 'error'
          })
        }
      },
      async fetchReviewsData() {
        if(this.cards.reviews.status == 'idle' && this.isVisible(this.$refs.reviews)) {
          this.cards.reviews.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "operation": "get_card_followup_reviews",
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity]: null,
              "filters": {
                "stage": this.filters.cards.selectedStage ? this.filters.cards.selectedStage : null,
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.cards.reviews.data = response.data[0]
            
            if (this.cards.reviews.data) {
              this.cards.reviews.status = 'success'
              let value = this.cards.reviews.data.performance.toFixed(0)
  
              let color = {
                light: value >= 50 && value < 70 ? '#FEF7EF' : value >= 70 ? '#ECF9F3':'#FBEAE9', 
                accent: value >= 50 && value < 70 ? '#F3B364' : value >= 70 ? '#41C588':'#D92D20'
              }
              let reviewsDataChartElement = $('[data-chart="idReviewsDataChart"]')
              
              reviewsDataChartElement.html(`
                <svg width="64" height="64" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg">
                  <path stroke="${color.light}" stroke-linecap="round" stroke-width="3.8" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                  <path stroke="${color.accent}" stroke-linecap="round" stroke-width="3.8" stroke-dasharray="${value}, 100" fill="none" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                  <text x="50%" y="50%" fill="#101828" font-size="8" font-size="16px"  alignment-baseline="middle" text-anchor="middle" style="line-height: 24px; font-weight: 500;">${value}%</text>
                </svg>
              `)
            }
          }).catch(() => {
            this.cards.reviews.status = 'error'
          })
        }
      },
      async fetchGeneralHistogramData() {
        if(this.generalHistogram.status == 'idle' && this.isVisible(this.$refs.generalHistogram)) {
          this.generalHistogram.status = 'loading'
          this.average.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
              "operation": "get_histogram",
              "filters": {
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.generalHistogram.status = 'success'
            this.generalHistogram.data = response.data[0]
            this.fetchAverage()
          }).catch(() => {
            this.generalHistogram.status = 'error'
            this.average.status = 'error'
          })
        }
      },
      async fetchClasseHistogramData() {
        if(this.classeHistogram.status == 'idle' && this.isVisible(this.$refs.classeHistogram)) {
          this.classeHistogram.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": this.filters.classes.selectedClasse ? 'classes': 'unities',
              "what_ids": this.filters.classes.selectedClasse ? [this.filters.classes.selectedClasse]: this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
              "operation": "get_histogram",
              "filters": {
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.classeHistogram.status = 'success'
            this.classeHistogram.data = response.data[0]
          }).catch((error) => {
            this.classeHistogram.status = 'error'
            this.classeHistogram.error = error
          })
        }
      },
      async fetchClasseAverageData() {
        if(this.classeAverage.status == 'idle' && this.isVisible(this.$refs.classeAverage)) {
          this.classeAverage.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": this.filters.classes.selectedClasse ? 'classes': 'unities',
              "what_ids": this.filters.classes.selectedClasse ? [this.filters.classes.selectedClasse]: this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
              "operation": "get_pass_rate",
              "filters": {
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.classeAverage.status = 'success'
            this.classeAverage.data = response.data[0]
          }).catch((error) => {
            this.classeAverage.status = 'error'
            this.classeAverage.error = error
          })
        }
      },
      selectClasseSubjectAndStartChart(action) {
        
        if (action == 'next') {
          let currentIndex = this.classesSubjects.data.indexOf(this.classesSubjects.data.find(s => s.id == this.filters.classes.selectedSubject.id))
          if(currentIndex < (this.classesSubjects.data.length - 1)) {
            this.filters.classes.selectedSubject = this.classesSubjects.data.at(currentIndex + 1)
          } else {
            this.filters.classes.selectedSubject = this.classesSubjects.data.at(0)
          }
        } else if(action == 'previous') {
          let currentIndex = this.classesSubjects.data.indexOf(this.classesSubjects.data.find(s => s.id == this.filters.classes.selectedSubject.id))
          if(currentIndex > 0) {
            this.filters.classes.selectedSubject = this.classesSubjects.data.at(currentIndex - 1)
          } else {
            this.filters.classes.selectedSubject = this.classesSubjects.data.at(0)
          }
        } else {
          this.filters.classes.selectedSubject = this.classesSubjects.data.at(0)
        }

        if (this.filters.classes.selectedSubject) {

          let openExamsChartElement = document.getElementById('idClasseSelectedSubjectChart')
          let openExamsChart = echarts.init(openExamsChartElement)
          openExamsChart.setOption({
            tooltip: {
              trigger: 'item'
            },
            series: [
              {
                type: 'pie',
                radius: ['60%', '100%'],
                label: { show: false },
                markPoint: {
                  tooltip: { show: false },
                  label: {
                    show: true,
                    formatter: '{b}',
                    color: '#282F3E',
                    fontFamily: 'Inter',
                    fontSize: 24,
                    lineHeight: 20,
                    fontWeight: 500,
                    letterSpacing: '-0.01em',
                  },
                  data: [{
                    name: `${String(this.filters.classes.selectedSubject.performance.toFixed(0))}%`,
                    symbol: 'circle',
                    itemStyle: { color: 'transparent' },
                    x: '50%',
                    y: '50%',
                  }],
                },
                data: [
                  {
                    name: '',
                    value: this.filters.classes.selectedSubject.performance.toFixed(2),
                    itemStyle: { color: '#FF8F3D' },
                    emphasis: { itemStyle: { color: '#FF8024' } }
                  },
                  {
                    name: '',
                    value: (100 - this.filters.classes.selectedSubject.performance).toFixed(2),
                    itemStyle: { color: '#FFF4EC' },
                    emphasis: { itemStyle: { color: '#FFE5D3' } }
                  }
                ]
              }
            ],
          })
          const resizeObserver = new ResizeObserver(entries => {
            openExamsChart.resize()
          })
          resizeObserver.observe(openExamsChartElement)
        }
      },
      async fetchClasseSubjectsData() {
        if(this.classesSubjects.status == 'idle' && this.isVisible(this.$refs.classesSubjects)) {
          this.classesSubjects.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": 'classe',
              "what_ids": this.filters.classes.selectedClasse ? [this.filters.classes.selectedClasse]: null,
              "operation": "get_subjects_avg",
              "filters": {
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.classesSubjects.status = 'success'
            this.classesSubjects.data = response.data[0]

            this.$nextTick(() => {
              this.selectClasseSubjectAndStartChart()
            })
          
          }).catch((error) => {
            this.classesSubjects.status = 'error'
            this.classesSubjects.error = error
          })
        }
      },
      async fetchTeacherQuestionsSummaryData() {
        if(this.teacherQuestionsSummary.status == 'idle' && this.isVisible(this.$refs.teacherQuestionsSummary)) {
          this.teacherQuestionsSummary.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": this.filters.teachers.selectedTeacher ? 'teachers': 'unities',
              "what_ids": this.filters.teachers.selectedTeacher ? [this.filters.teachers.selectedTeacher]: this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
              "operation": "get_questions_summary",
              "filters": {
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.teacherQuestionsSummary.status = 'success'
            this.teacherQuestionsSummary.data = response.data[0]
            this.fetchQuestionQualityRate()
          }).catch((error) => {
            this.teacherQuestionsSummary.status = 'error'
            this.teacherQuestionsSummary.error = error
          }).finally(() => {
            this.$forceUpdate()
          })
        }
      },
      async fetchTeacherRankingData() {
        if(this.teacherRanking.status == 'idle' && this.isVisible(this.$refs.teacherRanking)) {
          this.teacherRanking.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": 'unities',
              "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
              "operation": "get_teachers_ranking",
              "filters": {
                "user_unities": this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.teacherRanking.status = 'success'
            this.teacherRanking.data = response.data[0]
            this.fetchQuestionQualityRate()
          }).catch((error) => {
            this.teacherRanking.status = 'error'
            this.teacherRanking.error = error
          })
        }
      },
      changeTab(tab) {
        this.activeTab = tab
      },
      getFilteredSubjects() {
        return this.performanceBySubject.data.filter(s => this.filters.school.selectedSubjects.length ? this.filters.school.selectedSubjects.includes(s.id) : true)
      },
      async fetchAverage() {
        return await axios({
          method: 'POST',
          url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
          data: {
            "who": "school",
            "who_ids": ["{{user.client.id}}"],
            "what": 'unities',
            "what_ids": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
            "operation": "get_avg",
            "filters": {
              "user_unities": this.unities.map((u) => u.id),
            }
          }
        }).then((response) => {
          this.average.status = 'success'
          let data = response.data.at(0)
          this.average.data = data
          this.generalHistogram.performance = this.average.data
        }).catch((error) => {
          this.average.status = 'error'
        })
      },
      async fetchAverageBySubjects() {
        if((this.averageBySubjects.status == 'idle' || this.performanceBySubject.status == 'idle')) {
          this.averageBySubjects.status = 'loading'
          return await axios({
            method: 'POST',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`,
            data: {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": 'subjects',
              "what_ids": this.getFilteredSubjects().map(s => s.id),
              "operation": "get_pass_rate",
              "filters": {
                "user_unities": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : this.unities.map((u) => u.id),
              }
            }
          }).then((response) => {
            this.averageBySubjects.status = 'success'
            this.averageBySubjects.data = response.data[0]

            let averageBySubjectsChartElement = document.getElementById('idAverageBySubjectsChart')
            if(!echarts.getInstanceByDom(averageBySubjectsChartElement)) {
              this.averageBySubjects.chart = echarts.init(averageBySubjectsChartElement)
            }
            this.averageBySubjects.chart.setOption({
              tooltip: {
                trigger: 'item'
              },
              series: [
                {
                  type: 'pie',
                  radius: ['40%', '70%'],
                  label: { show: false },
                  markPoint: {
                    tooltip: { show: true },
                    label: {
                      show: true,
                      formatter: '{b}',
                      color: '#282F3E',
                      fontFamily: 'Inter',
                      fontSize: 24,
                      lineHeight: 20,
                      fontWeight: 500,
                      letterSpacing: '-0.01em',
                    },
                    data: [{
                      name: `${String(this.averageBySubjects.data).slice(0, 2)}%`,
                      symbol: 'circle',
                      itemStyle: { color: 'transparent' },
                      x: '50%',
                      y: '50%',
                    }],
                  },
                  data: [
                    {
                      name: 'Aprovados',
                      value: this.averageBySubjects.data.toFixed(2),
                      itemStyle: { color: '#FF8F3D' },
                      emphasis: { itemStyle: { color: '#FF8024' } }
                    },
                    {
                      name: 'Reprovados',
                      value: (100 - this.averageBySubjects.data).toFixed(2),
                      itemStyle: { color: '#FFF4EC' },
                      emphasis: { itemStyle: { color: '#FFE5D3' } }
                    }
                  ]
                }
              ],
            })          
          }).catch((error) => {
            this.averageBySubjects.status = 'error'
          }).finally(() => {
            this.$forceUpdate()
          })
        }
      },
      async fetchPerformanceBySubject() {
        if(this.performanceBySubject.status == 'idle' && this.isVisible(this.$refs.performanceBySubject)) {
          this.performanceBySubject.status = 'loading'
          
          return await axios({
            method: 'post',
            url: `{% url 'dashboards:get-data-from-service' user.client.id %}`, 
            data: {
              "who": "school",
                "who_ids": ["{{user.client.id}}"],
                "operation": "get_subjects_avg",
                "filters": {
                  "user_unities": this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : this.unities.map((u) => u.id),
                }
            }
          }).then((response) => {
            this.performanceBySubject.status = 'success'
            this.performanceBySubject.data = response.data[0]

            if(!this.filters.school.selectedSubjects.length && this.performanceBySubject.data.length) {
              this.filters.school.selectedSubjects = this.performanceBySubject.data.slice(0, 8).map(s => s.id)
            }
            if(this.filters.school.selectedSubjects.length) {
              let selectedSubjects = this.getFilteredSubjects()
              let performanceBySubjectChartElement = document.getElementById('performanceBySubjectChart')
              if(!echarts.getInstanceByDom(performanceBySubjectChartElement)) {
                this.performanceBySubject.chart = echarts.init(performanceBySubjectChartElement)
              }
              this.performanceBySubject.chart.setOption({
                grid: {
                  // show: true,
                  // backgroundColor: 'rgb(255, 0, 0)',
                  top: 25,
                  right: 0,
                  bottom: 34,
                  left: 32,
                },
                tooltip: {
                  position: 'top',
                  formatter: (params) => {
                    let subject = selectedSubjects[params.dataIndex];
                    return subject.name + ': ' + subject.performance.toFixed(2) + '%';
                  }
                },
                xAxis: {
                  type: 'category',
                  data: selectedSubjects.map(s => s.name.toUpperCase().slice(0,3)),
                  axisLine: {
                    lineStyle: {
                      color: '#E5E7EA'
                    }
                  },
                  axisTick: {
                    show: false
                  },
                  axisLabel: {
                    fontFamily: 'Inter',
                    margin: 16,
                    fontSize: 14,
                    color: '#667085'
                  }
                },
                yAxis: {
                  type: 'value',
                  axisLabel: {
                    fontFamily: 'Inter',
                    margin: 32,
                    fontSize: 12,
                    color: '#D0D5DD',
                    align: 'left',
                  },
                  splitLine: {
                    lineStyle: {
                      color: ['#E5E7EA']
                    }
                  }
                },
                series: [
                  {
                    label: {
                      show: true,
                      formatter: '{@score}%',
                      position: 'insideTop',
                      padding: [12, 0, 0, 0],
                      fontFamily: 'Roboto',
                      fontSize: 16,
                      fontWeight: 500,
                      color: '#FFF'
                    },
                    itemStyle: {
                      barBorderRadius: [8, 8, 0, 0],
                      color: '#FF8F3D',
                    },
                    data: selectedSubjects.map(s => s.performance.toFixed(0)),
                    type: 'bar'
                  }
                ]
              })
              this.fetchAverageBySubjects()
            }
          }).catch((error) => {
            this.performanceBySubject.status = 'error'
            this.performanceBySubject.error = error
          }).finally(() => {
            this.startOrReloadInput("#inputSchoolSubjects")
          })
        }
      },
      async fetchFrequencyInExams() {
        if(this.frequencyInExams.status == 'idle' && this.isVisible(this.$refs.frequencyInExams)) {
          this.frequencyInExams.status = 'loading'
          return await axios.post(`{% url 'dashboards:get-data-from-service' user.client.id %}`, {
              "who": "school",
              "who_ids": ["{{user.client.id}}"],
              "what": this.filters.classes.selectedClasse ? 'classes': 'unities',
              "what_ids": this.filters.classes.selectedClasse ? [this.filters.classes.selectedClasse]: this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
              "operation": "get_exams_frequency",
              "filters": {
                "user_unities": this.unities.map((u) => u.id),
              }
          }).then((response) => {
            this.frequencyInExams.status = 'success'
            this.frequencyInExams.data = response.data[0]
            let frequencyInExamsChartElement = document.getElementById('idFrequencyInExamsChart')
            let frequencyInExamsChart = echarts.init(frequencyInExamsChartElement)
            frequencyInExamsChart.setOption({
              grid: {
                // show: true,
                // backgroundColor: 'rgb(255, 0, 0)',
                top: 0,
                right: -6,
                bottom: 0,
                left: -6,
              },
              xAxis: {
                type: 'category',
                data: this.frequencyInExams.data.slice(0, 10),
                axisTick: {
                  show: false
                },
                axisLabel: {
                  show: false,
                },
                axisLine: {
                  show: false,
                }
              },
              yAxis: {
                show: false,
              },
              tooltip: {
                trigger: 'item',
                className: 'reset-echarts-tooltip',
                position: 'right', // Posiciona o tooltip na parte superior
                enterable: true, // Permite que o usuário entre no tooltip
                formatter: (params) => {
                  const { exam_id, exam_name, performance, misseds, presents } = params.data;
                  return `
                    <div class="tw-w-fit tw-flex tw-flex-col tw-bg-white tw-border tw-border-[#E6E8EC] tw-rounded-lg">
                      <div class="tw-border-b tw-border-[#F3F3F3]">
                        <div class="tw-flex tw-items-center tw-justify-between tw-px-4 tw-pt-2 tw-pb-[0.563rem]">
                          <div>
                            <p class="tw-text-base tw-font-medium tw-text-[#101828] tw-mb-0">${exam_name}</p>
                          </div>
                        </div>
                      </div>
                      <div class="tw-flex tw-gap-8 tw-p-4">
                        <div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${presents} presentes</p>
                          </div>
                          <div class="tw-flex tw-items-center tw-gap-1">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                              <path d="M6 12L10 8L6 4" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                            <p class="tw-text-sm tw-font-normal tw-text-[#667085] tw-mb-0">${misseds} faltantes</p>
                          </div>
                        </div>
                        <div class="tw-flex tw-items-center tw-justify-center">
                          <p class="tw-text-3xl tw-leading-[2.125rem] tw-font-medium tw-text-[#FF8F3D] tw-tracking-[0.01em] tw-mb-0">${performance.toFixed(2)}%</p>
                        </div>
                      </div>
                      <div class="tw-px-4 tw-pb-4">
                        <a href="${'{% url 'exams:exams_detail_v2' pk='00000000-0000-0000-0000-000000000000' %}'.replace('00000000-0000-0000-0000-000000000000', exam_id)}" class="tw-w-full tw-rounded-lg tw-bg-primary-600 tw-px-3 tw-py-3 tw-text-sm tw-font-semibold tw-text-white hover:tw-bg-primary-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600">Visualizar</a>
                      </div>
                    </div>
                  `
                },
              },
              series: [
                {
                  barWidth: 9.57,
                  barGap: 12,
                  itemStyle: {
                    barBorderRadius: 2,
                    {% comment %} color: '#FFF4EC', {% endcomment %}
                    color: '#FF8F3D'
                  },
                  data: this.frequencyInExams.data.slice(0, 10).map((f) => {
                    return { ...f, value: f.performance.toFixed(0) }
                  }),
                  type: 'bar'
                }
              ],
            })
            const resizeObserver = new ResizeObserver(entries => {
              frequencyInExamsChart.resize()
            })
            resizeObserver.observe(frequencyInExamsChartElement)
          }).catch((error) => {
            this.frequencyInExams.status = 'error'
            this.frequencyInExams.error = error
          }).finally(() => {
            this.$forceUpdate()
          })
        }
      },
      async fetchFrequencyInExamsGeneral() {
        if(this.frequencyInExamsGeneral.status == 'idle' && this.isVisible(this.$refs.frequencyInExamsGeneral)) {
          this.frequencyInExamsGeneral.status = 'loading'
          return await axios.post(`{% url 'dashboards:get-data-from-service' user.client.id %}`, {
            "who": "school",
            "who_ids": ["{{user.client.id}}"],
            "operation": "get_frequency",
            "what": this.filters.classes.selectedClasse ? 'classes': 'unities',
            "what_ids": this.filters.classes.selectedClasse ? [this.filters.classes.selectedClasse]: this.filters.school.selectedUnity ? [this.filters.school.selectedUnity] : null,
            "filters": {
              "user_unities": this.unities.map((u) => u.id),
            }
          }).then((response) => {
            this.frequencyInExamsGeneral.status = 'success'
            this.frequencyInExamsGeneral.data = response.data[0]
            console.log(this.frequencyInExamsGeneral.data)
          }).catch((error) => {
            this.frequencyInExamsGeneral.status = 'error'
            this.frequencyInExamsGeneral.error = error
          })
        }
      },
      async fetchQuestionQualityRate() {
        if (this.teacherQuestionsSummary.status == 'success' && this.teacherQuestionsSummary.data && this.teacherQuestionsSummary.data.quality) {
          let questionQualityRateChartElement = document.getElementById('idQuestionQualityRateChart')
          let questionQualityRateChart = echarts.init(questionQualityRateChartElement)
          questionQualityRateChart.setOption({
            tooltip: {
              trigger: 'item'
            },
            series: [
              {
                type: 'pie',
                radius: ['40%', '70%'],
                label: { show: false },
                markPoint: {
                  tooltip: { show: false },
                  label: {
                    show: true,
                    formatter: '{b}',
                    color: '#282F3E',
                    fontFamily: 'Inter',
                    fontSize: 24,
                    lineHeight: 20,
                    fontWeight: 500,
                    letterSpacing: '-0.01em',
                  },
                  data: [{
                    name: `${this.teacherQuestionsSummary.data.quality}%`,
                    symbol: 'circle',
                    itemStyle: { color: 'transparent' },
                    x: '50%',
                    y: '50%',
                  }],
                },
                data: [
                  {
                    name: 'Qualificadas',
                    value: this.teacherQuestionsSummary.data.quality.toFixed(2),
                    itemStyle: { color: '#FF8F3D' },
                    emphasis: { itemStyle: { color: '#FF8024' } }
                  },
                  {
                    name: 'Desqualificadas',
                    value: (100 - this.teacherQuestionsSummary.data.quality).toFixed(2),
                    itemStyle: { color: '#FFF4EC' },
                    emphasis: { itemStyle: { color: '#FFE5D3' } }
                  }
                ]
              }
            ],
          })
          const resizeObserver = new ResizeObserver(entries => {
            questionQualityRateChart.resize()
          })
          resizeObserver.observe(questionQualityRateChartElement)
        }
      },
      resetLoadings(where = 'all') {
        if(where == 'cards' || where == 'all') {
          this.cards.uploads.status = 'idle'
          this.cards.corrections.status = 'idle'
          this.cards.elaborations.status = 'idle'
          this.cards.reviews.status = 'idle'
        }
        if(where == 'school' || where == 'all') {
          this.averageBySubjects.status = 'idle'
          this.generalHistogram.status = 'idle'
          this.performanceBySubject.status = 'idle'
        }
        if(where == 'classes' || where == 'all') {
          this.frequencyInExamsGeneral.status = 'idle'
          this.frequencyInExams.status = 'idle'
          this.classeHistogram.status = 'idle'
          this.classeAverage.status = 'idle'
          this.classesSubjects.status = 'idle'
        } 
        if(where == 'teachers' || where == 'all') {
          this.teacherQuestionsSummary.status = 'idle'
          this.teacherRanking.status = 'idle'
        }
      },
      async getData(where) {
        if(!where || where == 'school') {
          // School
          this.fetchPerformanceBySubject()
          this.fetchGeneralHistogramData()
        }
        if(!where || where == 'classes') {
          // Classes
          this.fetchFrequencyInExamsGeneral()
          this.fetchFrequencyInExams()
          this.fetchClasseHistogramData()
          this.fetchClasseAverageData()
          this.fetchClasseSubjectsData()
        }
        if(!where || where == 'teachers') {
          // Teachers
          this.fetchTeacherQuestionsSummaryData()
          this.fetchTeacherRankingData()
        }
        if(!where || where == 'cards') {
          // Cards
          this.fetchElaborationData()
          this.fetchUploadsData()
          this.fetchCorrectionsData()
          this.fetchReviewsData()
        }
      },
      reCreateSelection(selector) {
        $(selector).selectpicker("destroy")
        $(selector).selectpicker({
          style: 'btn-white',
          placeholder: "Selecione uma opção",
          noneSelectedText: 'Nenhuma seleção',
          noneResultsText: 'Nenhum resultado encontrado',
        })
      },
      moment(date) {
        return moment(date)
      },
      getInitials(text) {
        let textSplited = text.split(' ')
        try {
          if (textSplited.length > 1) {
            return `${textSplited[0][0]}${textSplited[textSplited.length - 1][0]}`
          } else {
            return textSplited.slice(0, 2)
          }
        } catch {
          return text[0]
        }
      },
      isVisible(element) {
        if(element) {
          const rect = element.getBoundingClientRect();
          const viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight);
          
          // Verifica se o elemento está acima ou abaixo da janela de visualização
          const above = rect.bottom < 0;
          const below = rect.top > viewHeight;
  
          // Calcula a porcentagem do elemento visível na tela
          const visibleHeight = Math.min(viewHeight, rect.bottom) - Math.max(0, rect.top);
          const percentVisible = (visibleHeight / rect.height) * 100;
  
          const minPercentViewed = 50
  
          // Retorna true se pelo menos 20% do elemento estiver visível
          return !(above || below) && percentVisible >= minPercentViewed;
        }
      },
      handleOnLoadCharts() {
        this.controls.interval = setInterval(() => {
          this.getData()
        }, 250)
      },
      startOrReloadInput(selector) {
        let element = $(selector)
        if(!element.hasClass('selectpicker')) {
          $(selector).selectpicker({
            style: 'btn-white',
            maxWidth: '80px',
            placeholder: "Selecione as disciplinas",
            noneSelectedText: 'Nenhuma seleção',
            noneResultsText: 'Nenhum resultado encontrado',
          })
        }
      },
      disableInputs(disable=false) {
        if (disable) {
          $('.bootstrap-select button').addClass('disabled');
        } else {
          $('.bootstrap-select button').removeClass('disabled');
        }
      },
      startSelectInputs() {
        $("#inputSchoolUnities").selectpicker({
          style: 'btn-transparent',
          placeholder: "Selecione a unidade",
          noneSelectedText: 'Nenhuma seleção',
          noneResultsText: 'Nenhum resultado encontrado',
        })
        $("#inputSchoolStages").selectpicker({
          style: 'btn-transparent',
          placeholder: "Selecione a etapa de ensino",
          noneSelectedText: 'Nenhuma seleção',
          noneResultsText: 'Nenhum resultado encontrado',
        })
        $("#inputClasseClasses").selectpicker({
          style: 'btn-white',
          placeholder: "Selecione a turma",
          noneSelectedText: 'Nenhuma seleção',
          noneResultsText: 'Nenhum resultado encontrado',
        })
        $("#inputTeacherTeachers").selectpicker({
          style: 'btn-white',
          placeholder: "Selecione o professor",
          noneSelectedText: 'Nenhuma seleção',
          noneResultsText: 'Nenhum resultado encontrado',
        })
      },
      printPage() {
        window.print()
      },
      loadLocalStorageFilters() {
        if(localStorage.getItem('dashboardsFilters-{{user.id}}-{{user.client.id}}')) {
          this.filters = JSON.parse(localStorage.getItem('dashboardsFilters-{{user.id}}-{{user.client.id}}'))
        }
      },
      saveLocalStorageFilters() {
        localStorage.setItem('dashboardsFilters-{{user.id}}-{{user.client.id}}', JSON.stringify(this.filters))
      },
    },
    directives: {
      'click-outside': {
        bind: function(el, binding, vNode) {
          // Provided expression must evaluate to a function.
          if (typeof binding.value !== 'function') {
            const compName = vNode.context.name
            let warn = `[Vue-click-outside:] provided expression '${binding.expression}' is not a function, but has to be`
            if (compName) { warn += `Found in component '${compName}'` }

            console.warn(warn)
          }
          // Define Handler and cache it on the element
          const bubble = binding.modifiers.bubble
          const handler = (e) => {
            if (bubble || (!el.contains(e.target) && el !== e.target)) {
              binding.value(e)
            }
          }
          el.__vueClickOutside__ = handler

          // add Event Listeners
          document.addEventListener('click', handler)
        },

        unbind: function(el, binding) {
          // Remove Event Listeners
          document.removeEventListener('click', el.__vueClickOutside__)
          el.__vueClickOutside__ = null
        }
      }
    },
    updated: function() {
      tippy('.tooltips', {
        placement: 'top',
        allowHTML: true,
        theme: 'custom',
        zIndex: 1,
      })
    },
    computed: {
      loadingRequest: function() {
        return this.controls.activeRequests > 0
      }
    },
    async mounted() {
      axios.interceptors.request.use((config) => {
        this.controls.activeRequests++
        return config;
      }, (error) => {
        this.controls.activeRequests--
        return Promise.reject(error);
      });
      axios.interceptors.response.use((response) => {
        this.controls.activeRequests--
        return response;
      }, (error) => {
          this.controls.activeRequests--;
          return Promise.reject(error);
      });
      this.$nextTick().then(() => {
        this.loadLocalStorageFilters()
      }).then(() => {
        this.getEventsAndCalendar()
      }).then(() => {
        this.handleOnLoadCharts()
        setInterval(() => {
          this.saveLocalStorageFilters()
        }, 300)
      }).then(() => {
        this.startSelectInputs()
      })
      this.loading = false
    },
  })
</script>
{% endblock js-additional %}
