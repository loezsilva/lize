{% load permissions %}

'search-component': Vue.component('search-component', {
  props: [],
  delimiters: ["#{", "}"],
  data: function() {
    return {
      searchTerm: '',
      searchStatus: 'idle',
      debounceTimeout: null,
      searchActive: false,
      searchResults: [],
      superSearchStatus: 'idle',
      superSearchResults: [],
    }
  },
  methods: {
    debouncedSearch() {
      if (this.searchTerm.length === 0) {
        this.searchResults = []
        this.searchStatus = 'idle'
        return
      }
      clearTimeout(this.debounceTimeout)
      this.debounceTimeout = setTimeout(() => {
        this.performSearch()
      }, 750) // debounce delay 300ms
    },
    performSearch() {
      this.searchStatus = 'loading'
      fetch(`/api/v1/search/?q=${this.searchTerm}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok')
          }
          return response.json()
        })
        .then(data => {
          this.searchResults = data
          this.searchStatus = 'success'
        })
        .catch(error => {
          console.error(error)
          this.searchStatus = 'error'
      })
    },
    getGroupLink(groupResult) {
      const applicationListUrl = "{% url 'applications:applications_list' %}"
      const examListUrl = "{% url 'exams:exams_list' %}"
      const studentListUrl = "{% url 'students:students_list' %}"
      const teacherListUrl = "{% url 'inspectors:teachers_list' %}"
      const schoolClassListUrl = "{% url 'classes:classes_list' %}"

      if (groupResult.name.toLowerCase() === 'cadernos') {
        return examListUrl
      } else if (groupResult.name.toLowerCase() === 'alunos') {
        return studentListUrl
      } else if (groupResult.name.toLowerCase() === 'professores') {
        return teacherListUrl
      } else if (groupResult.name.toLowerCase() === 'turmas') {
        return schoolClassListUrl
      } if (groupResult.name.toLowerCase() === 'aplicações') {
        return applicationListUrl
      } 

      return '#'
    },
    getUrlWithNameQuery(groupResult) {
      const url = this.getGroupLink(groupResult)

      const queryParam = 'q_name=' + this.searchTerm
      return url + '?' + queryParam
    },
    getGroupLinkTeacher(groupResult) {
      const examListUrl = "{% url 'exams:exams_list' %}"

      if (groupResult.name.toLowerCase() === 'cadernos') {
        return examListUrl
      }

      return ''
    },
    getUrlWithNameQueryTeacher(groupResult) {
      const url = this.getGroupLinkTeacher(groupResult)

      const queryParam = 'q_name=' + this.searchTerm
      return url + '?' + queryParam
    },
    getUrlWithNameQueryStudent(groupResult) {
      const url = this.getGroupLinkStudent(groupResult)

      const queryParam = 'q_name=' + this.searchTerm
      return url + '?' + queryParam
    },
    getUrlAction(groupResult, action, pk) {
      const urlsApplication = [
        "{% url 'applications:applications_add_del_student' pk='00000000-0000-0000-0000-000000000000' %}",
        "{% url 'applications:applications_update' pk='00000000-0000-0000-0000-000000000000' %}",
      ]
      
      let urlsExam = ['', '']
      if(Boolean("{{user|has_perm:'exams.change_exam'|default:''|default_if_none:''}}")) {
        urlsExam[0] = "{% url 'exams:exams_update' pk='00000000-0000-0000-0000-000000000000' %}"
      }
      if(Boolean("{{user|has_perm:'exams.can_diagram_exam'|default:''|default_if_none:''}}")) {
        urlsExam[1] = "{% url 'exams:exam-print-v2' pk='00000000-0000-0000-0000-000000000000' %}"
      }

      let urlsStudent = ['', '']
      if(Boolean("{{user|has_perm:'students.change_student'|default:''|default_if_none:''}}")) {
        urlsStudent[0] = "{% url 'students:students_update' pk='00000000-0000-0000-0000-000000000000' %}"
      }
      if(Boolean("{{user|has_perm:'students.can_reset_password'|default:''|default_if_none:''}}")) {
        urlsStudent[1] = `{% url 'students:students_list' %}?q_pk=${pk}&reset_password=${pk}`
      }

      let urlsTeacher = ['', '']
      if(Boolean("{{user|has_perm:'inspectors.change_teacher'|default:''|default_if_none:''}}")) {
        urlsTeacher[0] = "{% url 'inspectors:teachers_update' pk='00000000-0000-0000-0000-000000000000' %}"
      }
      if(Boolean("{{user|has_perm:'inspectors.can_reset_password'|default:''|default_if_none:''}}")) {
        urlsTeacher[1] = `{% url 'inspectors:teachers_list' %}?q_pk=${pk}&reset_password=${pk}`
      }

      let urlsSchoolClass = ['', '#']
      if(Boolean("{{user|has_perm:'classes.change_schoolclass'|default:''|default_if_none:''}}")) {
        urlsSchoolClass[0] = "{% url 'classes:classes_update' pk='00000000-0000-0000-0000-000000000000' %}"
      }

      let urls = ['#', '#']
      if (groupResult.name.toLowerCase() === 'aplicações') {
        urls = urlsApplication
      } else if (groupResult.name.toLowerCase() === 'cadernos') {
        urls = urlsExam
      } else if (groupResult.name.toLowerCase() === 'alunos') {
        urls = urlsStudent
      } else if (groupResult.name.toLowerCase() === 'professores') {
        urls = urlsTeacher
      } else if (groupResult.name.toLowerCase() === 'turmas') {
        urls = urlsSchoolClass
      }
      return urls[action].replace('00000000-0000-0000-0000-000000000000', pk)
    },
    getUrlActionStudent(groupResult, action, pk) {
        const urlsApplication = [
          "{% url 'applications:application_exam_student_detail_v2' pk='00000000-0000-0000-0000-000000000000' %}",
          "{% url 'applications:application_exam_student_detail_insight' pk='00000000-0000-0000-0000-000000000000' %}",
        ]
        let urls = ['#', '#']
        if (groupResult.name.toLowerCase() === 'provas') {
          urls = urlsApplication
        }
        return urls[action].replace('00000000-0000-0000-0000-000000000000', pk)
    },
    getUrlActionTeacher(groupResult, action, pk) {
      const urlsExam = [
        "{% url 'exams:exams_preview' pk='00000000-0000-0000-0000-000000000000' %}",
        "{% url 'exams:exams_detail_v2' pk='00000000-0000-0000-0000-000000000000' %}",
      ]
      let urls = ['#', '#']
      if (groupResult.name.toLowerCase() === 'cadernos') {
        urls = urlsExam
      }
      return urls[action].replace('00000000-0000-0000-0000-000000000000', pk)
    },
    getNameAction(groupResult, action) {
      const namesApplication = ["Adicionar remover alunos", "Editar"]
      const namesExam = ["Editar", "Diagramação"]
      const namesStudent = ["Editar", "Resetar senha"]
      const namesTeacher = ["Editar", "Resetar senha"]
      const namesSchoolClass = ["Editar", "#"]
      let urls = ['#', '#']
      if (groupResult.name.toLowerCase() === 'aplicações') {
        urls = namesApplication
      } else if (groupResult.name.toLowerCase() === 'cadernos') {
        urls = namesExam
      } else if (groupResult.name.toLowerCase() === 'alunos') {
        urls = namesStudent
      } else if (groupResult.name.toLowerCase() === 'professores') {
        urls = namesTeacher
      } else if (groupResult.name.toLowerCase() === 'turmas') {
        urls = namesSchoolClass
      }
      return urls[action]
    },
    getNameActionStudent(groupResult, action) {
      const namesApplication = ['Ver resultado', 'Revisar questões']
      let urls = ['#', '#']
      if (groupResult.name.toLowerCase() === 'provas') {
        urls = namesApplication
      }
      return urls[action]
    },
    getNameActionTeacher(groupResult, action) {
      const namesApplication = ['Visualizar', 'Correção de respostas']
      let urls = ['#', '#']
      if (groupResult.name.toLowerCase() === 'cadernos') {
        urls = namesApplication
      }
      return urls[action]
    },
    getIconAction(groupResult, action) {
      const editIcon = '<path d="M11 3.99998H6.8C5.11984 3.99998 4.27976 3.99998 3.63803 4.32696C3.07354 4.61458 2.6146 5.07353 2.32698 5.63801C2 6.27975 2 7.11983 2 8.79998V17.2C2 18.8801 2 19.7202 2.32698 20.362C2.6146 20.9264 3.07354 21.3854 3.63803 21.673C4.27976 22 5.11984 22 6.8 22H15.2C16.8802 22 17.7202 22 18.362 21.673C18.9265 21.3854 19.3854 20.9264 19.673 20.362C20 19.7202 20 18.8801 20 17.2V13M7.99997 16H9.67452C10.1637 16 10.4083 16 10.6385 15.9447C10.8425 15.8957 11.0376 15.8149 11.2166 15.7053C11.4184 15.5816 11.5914 15.4086 11.9373 15.0627L21.5 5.49998C22.3284 4.67156 22.3284 3.32841 21.5 2.49998C20.6716 1.67156 19.3284 1.67155 18.5 2.49998L8.93723 12.0627C8.59133 12.4086 8.41838 12.5816 8.29469 12.7834C8.18504 12.9624 8.10423 13.1574 8.05523 13.3615C7.99997 13.5917 7.99997 13.8363 7.99997 14.3255V16Z" stroke-linecap="round" stroke-linejoin="round"/>'
      const diagramIcon = '<path d="M17.5 17H6.5M17.5 13H6.5M3 9H21M7.8 3H16.2C17.8802 3 18.7202 3 19.362 3.32698C19.9265 3.6146 20.3854 4.07354 20.673 4.63803C21 5.27976 21 6.11984 21 7.8V16.2C21 17.8802 21 18.7202 20.673 19.362C20.3854 19.9265 19.9265 20.3854 19.362 20.673C18.7202 21 17.8802 21 16.2 21H7.8C6.11984 21 5.27976 21 4.63803 20.673C4.07354 20.3854 3.6146 19.9265 3.32698 19.362C3 18.7202 3 17.8802 3 16.2V7.8C3 6.11984 3 5.27976 3.32698 4.63803C3.6146 4.07354 4.07354 3.6146 4.63803 3.32698C5.27976 3 6.11984 3 7.8 3Z" stroke-linecap="round" stroke-linejoin="round"/>'
      const keiIcon = '<path d="M17 8.99994C17 8.48812 16.8047 7.9763 16.4142 7.58579C16.0237 7.19526 15.5118 7 15 7M15 15C18.3137 15 21 12.3137 21 9C21 5.68629 18.3137 3 15 3C11.6863 3 9 5.68629 9 9C9 9.27368 9.01832 9.54308 9.05381 9.80704C9.11218 10.2412 9.14136 10.4583 9.12172 10.5956C9.10125 10.7387 9.0752 10.8157 9.00469 10.9419C8.937 11.063 8.81771 11.1823 8.57913 11.4209L3.46863 16.5314C3.29568 16.7043 3.2092 16.7908 3.14736 16.8917C3.09253 16.9812 3.05213 17.0787 3.02763 17.1808C3 17.2959 3 17.4182 3 17.6627V19.4C3 19.9601 3 20.2401 3.10899 20.454C3.20487 20.6422 3.35785 20.7951 3.54601 20.891C3.75992 21 4.03995 21 4.6 21H7V19H9V17H11L12.5791 15.4209C12.8177 15.1823 12.937 15.063 13.0581 14.9953C13.1843 14.9248 13.2613 14.8987 13.4044 14.8783C13.5417 14.8586 13.7588 14.8878 14.193 14.9462C14.4569 14.9817 14.7263 15 15 15Z" stroke-linecap="round" stroke-linejoin="round"/>'
      const addUserIcon = '<path d="M12 15.5H7.5C6.10444 15.5 5.40665 15.5 4.83886 15.6722C3.56045 16.06 2.56004 17.0605 2.17224 18.3389C2 18.9067 2 19.6044 2 21M19 21V15M16 18H22M14.5 7.5C14.5 9.98528 12.4853 12 10 12C7.51472 12 5.5 9.98528 5.5 7.5C5.5 5.01472 7.51472 3 10 3C12.4853 3 14.5 5.01472 14.5 7.5Z" stroke-linecap="round" stroke-linejoin="round"/>'

      const iconsApplication = [addUserIcon, editIcon]
      const iconsExam = [editIcon, diagramIcon]
      const iconsStudent = [editIcon, keiIcon]
      const iconsTeacher = [editIcon, keiIcon]
      const iconsSchoolClass = [editIcon, '']

      let icons = ['', '']
      if (groupResult.name.toLowerCase() === 'aplicações') {
        icons = iconsApplication
      } else if (groupResult.name.toLowerCase() === 'cadernos') {
        icons = iconsExam
        if(!Boolean("{{user|has_perm:'exams.change_exam'|default:''|default_if_none:''}}")) {
          icons[0] = ''
        }
        if(!Boolean("{{user|has_perm:'exams.can_diagram_exam'|default:''|default_if_none:''}}")) {
          icons[1] = ''
        }
      } else if (groupResult.name.toLowerCase() === 'alunos') {
        icons = iconsStudent
        if(!Boolean("{{user|has_perm:'students.change_student'|default:''|default_if_none:''}}")) {
          icons[0] = ''
        }
        if(!Boolean("{{user|has_perm:'students.can_reset_password'|default:''|default_if_none:''}}")) {
          icons[1] = ''
        }
      } else if (groupResult.name.toLowerCase() === 'professores') {
        icons = iconsTeacher
        if(!Boolean("{{user|has_perm:'inspectors.change_teacher'|default:''|default_if_none:''}}")) {
          icons[0] = ''
        }
        if(!Boolean("{{user|has_perm:'inspectors.can_reset_password'|default:''|default_if_none:''}}")) {
          icons[1] = ''
        }
      } else if (groupResult.name.toLowerCase() === 'turmas') {
        icons = iconsSchoolClass
        if(!Boolean("{{user|has_perm:'classes.change_schoolclass'|default:''|default_if_none:''}}")) {
          icons[0] = ''
        }
      }
      return icons[action]
    },
    getIconActionStudent(groupResult, action) {
      const eyeIcon = '<path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke-linecap="round" stroke-linejoin="round"/>'
      const reviewIcon = '<path d="M14 11H8M10 15H8M16 7H8M20 10.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H11.5M22 22L20.5 20.5M21.5 18C21.5 19.933 19.933 21.5 18 21.5C16.067 21.5 14.5 19.933 14.5 18C14.5 16.067 16.067 14.5 18 14.5C19.933 14.5 21.5 16.067 21.5 18Z" stroke-linecap="round" stroke-linejoin="round"/>'

      const iconsApplication = [eyeIcon, reviewIcon]

      let icons = ['', '']
      if (groupResult.name.toLowerCase() === 'provas') {
        icons = iconsApplication
      }
      return icons[action]
    },
    getIconActionTeacher(groupResult, action) {
      const eyeIcon = '<path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke-linecap="round" stroke-linejoin="round"/><path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke-linecap="round" stroke-linejoin="round"/>'
      const eraseIcon = '<path d="M17.9995 13L10.9995 6.00004M20.9995 21H7.99955M10.9368 20.0628L19.6054 11.3941C20.7935 10.2061 21.3875 9.61207 21.6101 8.92709C21.8058 8.32456 21.8058 7.67551 21.6101 7.07298C21.3875 6.388 20.7935 5.79397 19.6054 4.60592L19.3937 4.39415C18.2056 3.2061 17.6116 2.61207 16.9266 2.38951C16.3241 2.19373 15.675 2.19373 15.0725 2.38951C14.3875 2.61207 13.7935 3.2061 12.6054 4.39415L4.39366 12.6059C3.20561 13.794 2.61158 14.388 2.38902 15.073C2.19324 15.6755 2.19324 16.3246 2.38902 16.9271C2.61158 17.6121 3.20561 18.2061 4.39366 19.3941L5.06229 20.0628C5.40819 20.4087 5.58114 20.5816 5.78298 20.7053C5.96192 20.815 6.15701 20.8958 6.36108 20.9448C6.59126 21 6.83585 21 7.32503 21H8.67406C9.16324 21 9.40784 21 9.63801 20.9448C9.84208 20.8958 10.0372 20.815 10.2161 20.7053C10.418 20.5816 10.5909 20.4087 10.9368 20.0628Z" stroke-linecap="round" stroke-linejoin="round"/>'

      const iconsApplication = [eyeIcon, eraseIcon]

      let icons = ['', '']
      if (groupResult.name.toLowerCase() === 'cadernos') {
        icons = iconsApplication
      }
      return icons[action]
    },
    onFocusSearch() {
      this.searchActive = true
    },
    onClickOutsideSearch() {
      this.searchActive = false
    },
    redirect(url) {
      window.location.href = url
    },
    getInitials(text) {
      let textSplited = text.split(' ')
      try {
        if (textSplited.length > 1) {
          return `${textSplited[0][0]}${textSplited[textSplited.length - 1][0]}`
        } else {
          return textSplited.slice(0, 2)
        }
      } catch {
        return text[0].slice(0, 2)
      }
    },
    // superSearch(term) {
    //   axios.get(``).then((response) => {
    //     this.superSearchResults = response.data
    //     this.superSearchStatus = 'success'
    //   }).catch(() => this.superSearchStatus == 'idle')
    // },
    generateCorrectParams(name, id) {
      {% if user_type == 'coordination' %}
        let url_params = `{% url 'dashboards:dashboards' %}?who=${name}&who_id=${id}`
        if(['cadernos', 'exam', 'exams'].includes(name)) {
          url_params = `?who=school&what=exams&what_ids=${id}`
        } else if(['disciplinas', 'subject', 'subjects'].includes(name)) {
          url_params = `?who=school&what=subjects&what_ids=${id}`
        }
        return url_params
      {% elif user_type == 'teacher' %}
        let url_params = `{% url 'core:dashboard_generic_teacher' %}?who=${name}&who_id=${id}`
        if(['cadernos', 'exam', 'exams'].includes(name)) {
          url_params = `?what=exams&what_ids=${id}`
        } else if(['disciplinas', 'subject', 'subjects'].includes(name)) {
          url_params = `?what=subjects&what_ids=${id}`
        }
        return url_params
      {% endif %}
    },
  },
  directives: {
    'click-outside': {
      bind: function(el, binding, vNode) {
        // Provided expression must evaluate to a function.
        if (typeof binding.value !== 'function') {
          const compName = vNode.context.name
          let warn = `[Vue-click-outside:] provided expression '${binding.expression}' is not a function, but has to be`
          if (compName) { warn += `Found in component '${compName}'` }

          console.warn(warn)
        }
        // Define Handler and cache it on the element
        const bubble = binding.modifiers.bubble
        const handler = (e) => {
          if (bubble || (!el.contains(e.target) && el !== e.target)) {
            binding.value(e)
          }
        }
        el.__vueClickOutside__ = handler

        // add Event Listeners
        document.addEventListener('click', handler)
      },

      unbind: function(el, binding) {
        // Remove Event Listeners
        document.removeEventListener('click', el.__vueClickOutside__)
        el.__vueClickOutside__ = null
      }
    },
  },
  watch: {
    
  },
  mounted() {
    {% if who != 'school' %}
      this.searchTerm = '{{object.name|default:""}}'
      this.performSearch()
    {% endif %}
  },
  template: `
    <div class="tw-relative">
      <div class="tw-rounded-lg" style="border: 1px solid #D0D5DD; border-radius: .375rem;" v-click-outside="onClickOutsideSearch">
        <div class="tw-relative">
          <div class="tw-pointer-events-none tw-absolute tw-inset-y-0 tw-left-0 w-100 rounded" :class="{ 'bg-white': !searchActive}">
            <template v-if="!searchActive">
              <div class="row m-0 h-100"> 
                <div class="col-12 d-flex align-items-center justify-content-between">
                  <div class="d-flex align-items-center">
                    <div class="d-flex align-items-center">
                      <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; background-color: #F9FAFB;">
                        {% if who == 'classe' %}
                          <svg width="22" height="19" viewBox="0 0 22 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M15 1.46776C16.4817 2.20411 17.5 3.73314 17.5 5.5C17.5 7.26686 16.4817 8.79589 15 9.53224M17 14.7664C18.5115 15.4503 19.8725 16.565 21 18M1 18C2.94649 15.5226 5.58918 14 8.5 14C11.4108 14 14.0535 15.5226 16 18M13 5.5C13 7.98528 10.9853 10 8.5 10C6.01472 10 4 7.98528 4 5.5C4 3.01472 6.01472 1 8.5 1C10.9853 1 13 3.01472 13 5.5Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        {% elif who == 'student' %}
                          <strong>#{getInitials('{{object.name}}')}</strong>
                        {% elif who == 'teacher' %}
                          <strong>#{getInitials('{{object.name}}')}</strong>
                        {% else %}
                          <strong>#{getInitials('{{object.name}}')}</strong>
                        {% endif %}
                      </div>
                    </div>
                    <div class="mx-2">
                      <h6 class="mb-0">{{object.name}}</h6>
                      <p class="text-muted mb-0">
                        {% if who == 'classe' %}
                          {{object.coordination.unity.name}}
                        {% elif who == 'student' %}
                          {{object.get_classes_current_year.0}}
                        {% endif %}
                      </p>
                    </div>
                  </div>
                  <div>
                    <svg width="14" height="8" viewBox="0 0 14 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M1 1L7 7L13 1" stroke="#D0D5DD" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </div>
                </div>
              </div>
            </template>
            <template v-else>
              <div class="row m-0 h-100">
                <div class="col-12 d-flex align-items-center">
                  <template v-if="searchStatus === 'loading'">
                    <svg class="tw-animate-spin tw-h-5 tw-w-5 tw-text-primary-600" fill="none" viewBox="0 0 24 24" style="pointer-events: none; position: absolute; top: 0px; bottom: 0px; left: 1rem; height: 100%; width: 1.25rem;">
                      <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                  </template>
                  <template v-else>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                      <path d="M4.5 22V17M4.5 7V2M2 4.5H7M2 19.5H7M13 3L11.2658 7.50886C10.9838 8.24209 10.8428 8.60871 10.6235 8.91709C10.4292 9.1904 10.1904 9.42919 9.91709 9.62353C9.60871 9.84281 9.24209 9.98381 8.50886 10.2658L4 12L8.50886 13.7342C9.24209 14.0162 9.60871 14.1572 9.91709 14.3765C10.1904 14.5708 10.4292 14.8096 10.6235 15.0829C10.8428 15.3913 10.9838 15.7579 11.2658 16.4911L13 21L14.7342 16.4911C15.0162 15.7579 15.1572 15.3913 15.3765 15.0829C15.5708 14.8096 15.8096 14.5708 16.0829 14.3765C16.3913 14.1572 16.7579 14.0162 17.4911 13.7342L22 12L17.4911 10.2658C16.7579 9.98381 16.3913 9.8428 16.0829 9.62353C15.8096 9.42919 15.5708 9.1904 15.3765 8.91709C15.1572 8.60871 15.0162 8.24209 14.7342 7.50886L13 3Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                  </template>
                </div>
              </div>
            </template>
          </div>
          <input type="search" name="search" id="search-field" class="text-truncate tw-block tw-w-full tw-border-0 tw-p-6 tw-text-gray-900 tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-primary-600 focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 pl-5 rounded" :placeholder="searchActive ? 'Pesquise por resultados e desempenho de provas, turmas e alunos':''" autocomplete="off" v-model="searchTerm" @input="debouncedSearch" @focus="onFocusSearch" />
        </div>
        <template v-if="searchStatus !== 'idle' && searchTerm.length > 0 && searchActive">
          <hr class="tw-m-0 tw-border-[#F5F6F7]" />
          <div>
            <template v-if="searchStatus !== 'idle' && searchTerm.length > 0">
              <template v-if="searchResults.length > 0">
                <ul class="tw-max-h-80 tw-scroll-pb-2 tw-scroll-pt-11 tw-space-y-2 tw-overflow-y-auto tw-mb-0 tw-divide-y tw-divide-[#E5E7EA]" id="options" role="listbox">
                  <li v-for="groupResult in searchResults.filter(f => !['application', 'teacher'].includes(f.id))" :key="groupResult.id">
                    <div class="tw-flex tw-items-center tw-justify-between tw-px-4 tw-py-2.5">
                      <h2 class="tw-text-xs tw-text-[#6C727F]">
                        #{ groupResult.name }
                      </h2>
                      <a
                        v-if="'{{user_type}}' != 'teacher' && groupResult.name.toLowerCase() == 'turmas'"
                        :href="{% if user_type == 'teacher' %}getUrlWithNameQueryTeacher(groupResult){% elif user_type == 'student' %}getUrlWithNameQueryStudent(groupResult){% elif user_type == 'coordination' %}getUrlWithNameQuery(groupResult){% endif %}"
                        class="tw-text-sm"
                      >
                        Ver #{ groupResult.name.toLowerCase() }
                      </a>
                    </div>
                    <ul class="tw-mt-2 tw-mb-4 tw-text-sm tw-text-gray-800">
                      <li v-for="result in groupResult.results" :key="result.id" class="tw-flex tw-items-center tw-cursor-default tw-select-none tw-px-4 tw-py-1 hover:tw-bg-[#F9FAFA] lz-parent-visible" :id="'option-' + result.pk" role="option">
                        <span class="tw-w-full tw-flex tw-items-center tw-justify-between py-1">
                          <span class="tw-flex tw-cursor-pointer" @click="redirect(generateCorrectParams(groupResult.name.toLowerCase(), result.pk))">
                            <span class="tw-mr-3">
                              <template v-if="groupResult.name.toLowerCase() === 'cadernos'">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                  <path d="M9.99996 17.5L9.91658 17.3749C9.33771 16.5066 9.04828 16.0725 8.66588 15.7582C8.32734 15.4799 7.93726 15.2712 7.51796 15.1438C7.04434 15 6.52255 15 5.47898 15H4.33329C3.39987 15 2.93316 15 2.57664 14.8183C2.26304 14.6586 2.00807 14.4036 1.84828 14.09C1.66663 13.7335 1.66663 13.2668 1.66663 12.3333V5.16667C1.66663 4.23325 1.66663 3.76654 1.84828 3.41002C2.00807 3.09641 2.26304 2.84144 2.57664 2.68166C2.93316 2.5 3.39987 2.5 4.33329 2.5H4.66663C6.53347 2.5 7.46689 2.5 8.17993 2.86331C8.80713 3.18289 9.31707 3.69282 9.63665 4.32003C9.99996 5.03307 9.99996 5.96649 9.99996 7.83333M9.99996 17.5V7.83333M9.99996 17.5L10.0833 17.3749C10.6622 16.5066 10.9516 16.0725 11.334 15.7582C11.6726 15.4799 12.0627 15.2712 12.482 15.1438C12.9556 15 13.4774 15 14.5209 15H15.6666C16.6 15 17.0668 15 17.4233 14.8183C17.7369 14.6586 17.9918 14.4036 18.1516 14.09C18.3333 13.7335 18.3333 13.2668 18.3333 12.3333V5.16667C18.3333 4.23325 18.3333 3.76654 18.1516 3.41002C17.9918 3.09641 17.7369 2.84144 17.4233 2.68166C17.0668 2.5 16.6 2.5 15.6666 2.5H15.3333C13.4665 2.5 12.533 2.5 11.82 2.86331C11.1928 3.18289 10.6828 3.69282 10.3633 4.32003C9.99996 5.03307 9.99996 5.96649 9.99996 7.83333" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </template>
                              <template v-else-if="groupResult.name.toLowerCase() === 'alunos'">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                  <path d="M16.6667 17.5C16.6667 16.337 16.6667 15.7555 16.5232 15.2824C16.2 14.217 15.3663 13.3834 14.301 13.0602C13.8278 12.9167 13.2463 12.9167 12.0834 12.9167H7.91671C6.75374 12.9167 6.17225 12.9167 5.69909 13.0602C4.63375 13.3834 3.80007 14.217 3.47691 15.2824C3.33337 15.7555 3.33337 16.337 3.33337 17.5M13.75 6.25C13.75 8.32107 12.0711 10 10 10C7.92897 10 6.25004 8.32107 6.25004 6.25C6.25004 4.17893 7.92897 2.5 10 2.5C12.0711 2.5 13.75 4.17893 13.75 6.25Z" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </template>
                              <template v-else-if="groupResult.name.toLowerCase() === 'professores'">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                  <rect x="10.8337" y="12.501" width="4.1684" height="2.50104" rx="1" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                  <path fill-rule="evenodd" clip-rule="evenodd" d="M7.49897 17.5032H2.08005C1.84983 17.5032 1.66321 17.3166 1.66321 17.0864V16.7479C1.66596 15.7849 2.44594 15.0049 3.40894 15.0022H6.17009C7.13308 15.0049 7.91307 15.7849 7.91581 16.7479V17.0864C7.91581 17.3166 7.72919 17.5032 7.49897 17.5032Z" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                  <path fill-rule="evenodd" clip-rule="evenodd" d="M4.78949 12.9179C3.86883 12.9161 3.12372 12.1687 3.12463 11.2481C3.12556 10.3274 3.87216 9.58154 4.79283 9.58154C5.7135 9.58154 6.4601 10.3274 6.46102 11.2481C6.46194 12.1687 5.71683 12.9161 4.79616 12.9179H4.78949Z" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                  <path d="M3.33057 7.49891V4.16419C3.33057 3.24333 4.07707 2.49683 4.99793 2.49683H16.6695C17.5903 2.49683 18.3368 3.24333 18.3368 4.16419V13.3347C18.3368 14.2555 17.5903 15.002 16.6695 15.002H10" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </template>
                              <template v-else-if="groupResult.name.toLowerCase() === 'aplicações'">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                  <path d="M16.6667 10.4167V5.66675C16.6667 4.26662 16.6667 3.56655 16.3942 3.03177C16.1545 2.56137 15.7721 2.17892 15.3017 1.93923C14.7669 1.66675 14.0668 1.66675 12.6667 1.66675H7.33337C5.93324 1.66675 5.23318 1.66675 4.6984 1.93923C4.22799 2.17892 3.84554 2.56137 3.60586 3.03177C3.33337 3.56655 3.33337 4.26662 3.33337 5.66675V14.3334C3.33337 15.7335 3.33337 16.4336 3.60586 16.9684C3.84554 17.4388 4.22799 17.8212 4.6984 18.0609C5.23318 18.3334 5.93324 18.3334 7.33337 18.3334H10M11.6667 9.16675H6.66671M8.33337 12.5001H6.66671M13.3334 5.83341H6.66671M12.0834 15.8334L13.75 17.5001L17.5 13.7501" stroke="#E5E7EA" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </template>
                              <template v-else-if="groupResult.name.toLowerCase() === 'turmas'">
                                <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                  <path stroke-width="2" stroke="#E5E7EA" stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z" />
                                </svg>
                              </template>
                              <template v-else-if="groupResult.name.toLowerCase() === 'provas'">
                                <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                  <path stroke-width="2" stroke="#E5E7EA" stroke-linecap="round" stroke-linejoin="round" d="M9 12H12.75M9 15H12.75M9 18H12.75M15.75 18.75H18C18.5967 18.75 19.169 18.5129 19.591 18.091C20.0129 17.669 20.25 17.0967 20.25 16.5V6.108C20.25 4.973 19.405 4.01 18.274 3.916C17.9 3.88498 17.5256 3.85831 17.151 3.836M17.151 3.836C17.2174 4.05109 17.2501 4.27491 17.25 4.5C17.25 4.69891 17.171 4.88968 17.0303 5.03033C16.8897 5.17098 16.6989 5.25 16.5 5.25H12C11.586 5.25 11.25 4.914 11.25 4.5C11.25 4.269 11.285 4.046 11.35 3.836M17.151 3.836C16.868 2.918 16.012 2.25 15 2.25H13.5C13.0192 2.25011 12.5511 2.40414 12.1643 2.68954C11.7774 2.97493 11.492 3.3767 11.35 3.836M11.35 3.836C10.974 3.859 10.6 3.886 10.226 3.916C9.095 4.01 8.25 4.973 8.25 6.108V8.25M8.25 8.25H4.875C4.254 8.25 3.75 8.754 3.75 9.375V20.625C3.75 21.246 4.254 21.75 4.875 21.75H14.625C15.246 21.75 15.75 21.246 15.75 20.625V9.375C15.75 8.754 15.246 8.25 14.625 8.25H8.25ZM6.75 12H6.758V12.008H6.75V12ZM6.75 15H6.758V15.008H6.75V15ZM6.75 18H6.758V18.008H6.75V18Z" />
                                </svg>
                              </template>
                            </span>
                            <span class="tw-truncate" style="max-width: 500px;">
                              #{ result.name }
                            </span>
                          </span>
                          {% comment %}
                            <span class="tw-flex tw-gap-2 lz-element-invisible">
                              <a :href="generateCorrectParams(groupResult.name.toLowerCase(), result.pk)" class="tw-rounded-full tw-p-2 tw-text-primary-600 hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Dashboard">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                  <path d="M17.5 17.5H3.83333C3.36662 17.5 3.13327 17.5 2.95501 17.4092C2.79821 17.3293 2.67072 17.2018 2.59083 17.045C2.5 16.8667 2.5 16.6334 2.5 16.1667V2.5M17.5 5.83333L12.9714 10.3619C12.8064 10.5269 12.7239 10.6094 12.6288 10.6404C12.5451 10.6675 12.4549 10.6675 12.3712 10.6404C12.2761 10.6094 12.1936 10.5269 12.0286 10.3619L10.4714 8.80474C10.3064 8.63973 10.2239 8.55723 10.1288 8.52632C10.0451 8.49912 9.95493 8.49912 9.87124 8.52632C9.77611 8.55723 9.6936 8.63973 9.5286 8.80474L5.83333 12.5M17.5 5.83333H14.1667M17.5 5.83333V9.16667" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                              </a>
                              <a :href="{% if user_type == 'teacher' %}getUrlActionTeacher(groupResult, 0, result.pk){% elif user_type == 'student' %}getUrlActionStudent(groupResult, 0, result.pk){% elif user_type == 'coordination' %}getUrlAction(groupResult, 0, result.pk){% endif %}" class="tw-rounded-full tw-p-2 tw-text-primary-600 hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" :title="{% if user_type == 'teacher' %}getNameActionTeacher(groupResult, 0){% elif user_type == 'student' %}getNameActionStudent(groupResult, 0){% elif user_type == 'coordination' %}getNameAction(groupResult, 0){% endif %}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FF8F3D" stroke-width="2" v-html="{% if user_type == 'teacher' %}getIconActionTeacher(groupResult, 0){% elif user_type == 'student' %}getIconActionStudent(groupResult, 0){% elif user_type == 'coordination' %}getIconAction(groupResult, 0){% endif %}"></svg>
                              </a>
                              <a :href="{% if user_type == 'teacher' %}getUrlActionTeacher(groupResult, 1, result.pk){% elif user_type == 'student' %}getUrlActionStudent(groupResult, 1, result.pk){% elif user_type == 'coordination' %}getUrlAction(groupResult, 1, result.pk){% endif %}" class="tw-rounded-full tw-p-2 tw-text-primary-600 hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" :title="{% if user_type == 'teacher' %}getNameActionTeacher(groupResult, 1){% elif user_type == 'student' %}getNameActionStudent(groupResult, 1){% elif user_type == 'coordination' %}getNameAction(groupResult, 1){% endif %}">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#FF8F3D" stroke-width="2" v-html="{% if user_type == 'teacher' %}getIconActionTeacher(groupResult, 1){% elif user_type == 'student' %}getIconActionStudent(groupResult, 1){% elif user_type == 'coordination' %}getIconAction(groupResult, 1){% endif %}"></svg>
                              </a>
                            </span>
                          {% endcomment %}
                        </span>
                      </li>
                    </ul>
                  </li>
                </ul>
              </template>
              <template v-else-if="searchResults.length === 0 && searchStatus === 'success'">
                <!-- <template v-if="superSearchStatus === 'loading'">
                  <div class="tw-px-6 tw-py-14 tw-text-center sm:tw-px-14 d-flex">
                    <svg width="20" height="20" class="tw-animate-spin tw-text-primary-600" fill="none" viewBox="0 0 24 24">
                      <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="tw-text-sm tw-text-gray-900">
                      Aguarde mais um pouco, vamos utilizar a busca inteligênte e sugerir algumas alternativas
                    </p>
                  </div>
                </template>
                <template if="superSearchResults.length > 0">
                  <div class="row m-0 h-100 my-2" v-for="item in superSearchResults"> 
                    <a :href="item.url" target="_blank" class="w-100" style="color: #FF8F3D;">
                      <div class="col-12 d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                          <div class="d-flex align-items-center">
                            <div class="rounded-circle d-flex align-items-center justify-content-center" style="width: 48px; height: 48px; background-color: #F9FAFB;">
                              <strong>#{getInitials(item.name)}</strong>
                            </div>
                          </div>
                          <div class="mx-2">
                            <h6 class="mb-0">#{item.name}</h6>
                          </div>
                        </div>
                        <div>
                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M21.2104 15.8899C20.5742 17.3944 19.5792 18.7202 18.3123 19.7512C17.0454 20.7823 15.5452 21.4874 13.9428 21.8047C12.3405 22.1221 10.6848 22.0421 9.12055 21.5717C7.55627 21.1014 6.13103 20.255 4.96942 19.1066C3.80782 17.9582 2.94522 16.5427 2.45704 14.9839C1.96886 13.4251 1.86996 11.7704 2.169 10.1646C2.46804 8.55873 3.1559 7.05058 4.17245 5.77198C5.189 4.49338 6.50329 3.48327 8.0004 2.82995M21.2392 8.17311C21.6395 9.13958 21.8851 10.1613 21.9684 11.2008C21.989 11.4576 21.9993 11.586 21.9483 11.7017C21.9057 11.7983 21.8213 11.8897 21.7284 11.9399C21.6172 11.9999 21.4783 11.9999 21.2004 11.9999H12.8004C12.5204 11.9999 12.3804 11.9999 12.2734 11.9455C12.1793 11.8975 12.1028 11.821 12.0549 11.7269C12.0004 11.62 12.0004 11.48 12.0004 11.1999V2.79995C12.0004 2.52208 12.0004 2.38315 12.0605 2.27193C12.1107 2.17903 12.2021 2.09464 12.2987 2.05204C12.4144 2.00105 12.5428 2.01134 12.7996 2.03193C13.839 2.11527 14.8608 2.36083 15.8272 2.76115C17.0405 3.2637 18.1429 4.00029 19.0715 4.92888C20.0001 5.85747 20.7367 6.95986 21.2392 8.17311Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </div>
                      </div>
                    </a>
                  </div>
                </template>
                <template v-else>
                  <div class="tw-px-6 tw-py-14 tw-text-center sm:tw-px-14">
                    <svg class="tw-mx-auto tw-h-6 tw-w-6 tw-text-gray-400 tw-mb-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z" />
                    </svg>
                    <p class="tw-text-sm tw-text-gray-900">
                      Não encontramos nenhum registro com esse termo. Por favor, tente novamente.
                    </p>
                  </div>
                </template> -->
              </template>
            </template>
          </div>
        </template>
      </div>
    </div>
  `,
})