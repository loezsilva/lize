{% extends 'redesign/base.html' %}
{% comment %} {% extends 'dashboard/base_fixed.html' %} {% endcomment %}
{% load static %}
{% load permissions %}

{% block title %}Gabaritos avulsos - Lize{% endblock title %}

{% block css-additional %}
<link href="{% static 'administration/lib/select2/css/select2.min.css' %}" rel="stylesheet" />
<link href="{% static 'administration/lib/bootstrap-tagsinput/bootstrap-tagsinput.css' %}" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/@sjmc11/tourguidejs/dist/css/tour.min.css">
<style>
  .tg-backdrop{
    z-index: 9999 !important;
  }
</style>
<style>
  .select2-selection__choice__remove{
    display: none !important;
  }
</style>
{% endblock %}

{% block content-fixed %}
<div class="tw-flex tw-justify-center">
  <div class="ard cer dcv tw-pb-8 tw-max-w-[100rem] tw-flex-1 tw-mb-16">
    <div class="ls" style="margin-top: 1.25rem; margin-bottom: 1.5rem; justify-content: space-between;">
      <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-6 sm:tw-flex-nowrap tw-w-full">
        <h1 class="tw-text-xl tw-font-semibold tw-leading-7 tw-text-[#374151] sm:tw-truncate sm:tw-text-2xl sm:tw-tracking-tight tw-mb-0">
          Seus gabaritos
        </h1>
        <div class="tw-order-last tw-flex tw-w-full tw-gap-x-8 tw-text-sm tw-font-semibold tw-leading-6 sm:tw-order-none sm:tw-w-auto sm:tw-border-l sm:tw-border-gray-200 sm:tw-pl-6 sm:tw-leading-7">
          <button data-tg-title="Filtrar gabaritos" data-tg-order="1" data-tg-tour='Acesse os filtros da listagem de gabaritos clicando aqui.' data-tg-group="default-template-list" type="button" class="tw-flex tw-items-center tw-text-[#667085] off-canvas-menu" id="headlessui-slider-over-button-1" data-toggle-off-canvas="#right-off-canvas">
            <span>Filtrar</span>
            <span class="ml-2">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M5 10H15M2.5 5H17.5M7.5 15H12.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </button>
        </div>
        <div class="tw-ml-auto tw-flex tw-gap-3">
          {% include "redesign/includes/breadcrumb-year.html" with year=year|force_escape %}
          {% if user.get_user_function == 'Coordenação' %}
            {% if user|has_perm:'exams.export_template_exam_results' %}
              <div>
                <button data-tg-title="Exportação CSV ou XLS" data-tg-order="2" data-tg-tour='Baixe os resultados dos gabaritos já aplicados utilizando esse botão.' data-tg-group="default-template-list" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold hover:tw-text-white tw-shadow-sm hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" type="button" id="dropdownMenuButton-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Exportar resultados
                  <svg class="tw--mr-1 tw-h-5 tw-w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                  </svg>
                </button>
                <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-w-56 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-1" style="font-size: inherit;">
                  <div class="tw-py-1" role="none">
                      <a href="{% url 'exports:exams_export_erp' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">
                        Resumido (para ERPs)
                      </a>
                      <a href="{% url 'exports:exams_export_answers' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                        Respostas detalhadas
                      </a>
                      <a href="{% url 'exports:exams_export_simple_report' %}" class="tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                        Acertos e erros
                      </a>
                  </div>
                </div>
              </div>
              {% if user|has_perm:'exams.add_template_exam' %}
                <a data-tg-title="Criar novo gabarito" data-tg-order="3" data-tg-tour='Cadastre um novo gabarito para ser aplicado.' data-tg-group="default-template-list" href="{% url 'omr:template_create' %}" class="tw-flex tw-items-center tw-gap-x-1 tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600 hover:tw-text-white">
                  Cadastrar gabarito
                </a>
              {% endif %}
            {% endif %}
          {% endif %}
        </div>
      </div>
    </div>
    {% if count_filters > 0 %}
      <div class="tw-bg-white sm:tw-rounded-lg tw-py-5 tw-border tw-border-[#E5E7EA] tw-mb-4">
        <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8" >
          <div class="tw-flex tw-justify-between">
            <div class="tw-flex tw-items-center">
              <p class="tw-mb-0 tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900 sm:tw-pl-0">
                Filtrando por
              </p>
              <div class="tw-space-x-2">
                {% if q_name %}
                  <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                    <button @click="removeFilter('q_name')" type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                      <span class="tw-sr-only">Remove</span>
                      <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                        <path d="M4 4l6 6m0-6l-6 6" />
                      </svg>
                      <span class="tw-absolute tw--inset-1"></span>
                    </button>
                    Nome da prova: {{ q_name }}
                    <!-- &{ filter.label }<template v-if="filter.showValues">:<span v-if="!filter.showCount">${ filter.values.join(', ') }</span><span v-else>${ filter.values.length }</span></template> -->
                  </span>
                {% endif %}
                {% if q_subjects %}
                  <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                    <button @click="removeFilter('q_subjects')" type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                      <span class="tw-sr-only">Remove</span>
                      <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                        <path d="M4 4l6 6m0-6l-6 6" />
                      </svg>
                      <span class="tw-absolute tw--inset-1"></span>
                    </button>
                    Disciplinas na prova:
                    {% for subject in subjects %}
                      {% if subject.pk|stringformat:'s' in q_subjects %}
                        {{ subject.name }} > {{ subject.knowledge_area.name }}
                      {% endif %}
                    {% endfor %}
                  </span>
                {% endif %}
                {% if q_grades %}
                  <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                    <button @click="removeFilter('q_grades')" type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                      <span class="tw-sr-only">Remove</span>
                      <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                        <path d="M4 4l6 6m0-6l-6 6" />
                      </svg>
                      <span class="tw-absolute tw--inset-1"></span>
                    </button>
                    Séries:
                    {% for grade in grades %}
                      {% if grade.pk|stringformat:'s' in q_grades %}
                        {{ grade }}
                      {% endif %}
                    {% endfor %}
                  </span>
                {% endif %}
                {% if q_is_unprecedented %}
                  <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                    <button @click="removeFilter('q_is_unprecedented')" type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                      <span class="tw-sr-only">Remove</span>
                      <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                        <path d="M4 4l6 6m0-6l-6 6" />
                      </svg>
                      <span class="tw-absolute tw--inset-1"></span>
                    </button>
                    Gabaritos inéditos: sim
                  </span>
                {% endif %}
              </div>
            </div>
            <div class="tw-flex tw-items-center">
              <a href="{% url 'omr:template_list' %}?year={{ year }}" class="tw-text-left tw-text-sm tw-font-semibold tw-text-[#667085] tw-flex tw-items-center hover:tw-text-[#667085]">
                Limpar filtro
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="tw-ml-2">
                  <path d="M15 5L5 15M5 5L15 15" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
    <div class="tw-bg-white sm:tw-rounded-lg tw-pt-5 tw-border tw-border-[#E5E7EA]">
      <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8">
        <div class="tw-flow-root">
          <div class="tw--mx-4 tw--my-2 tw-overflow-x-auto sm:tw--mx-6 lg:tw--mx-8">
            <div class="tw-inline-block tw-min-w-full tw-py-2 tw-align-middle sm:tw-px-6 lg:tw-px-8">
              <div class="tw-relative">
                <table class="tw-min-w-full tw-table-fixed tw-divide-y tw-divide-gray-300" style="min-height: 300px;">
                  <thead>
                    <tr>
                      <th scope="col" class="tw-min-w-[12rem] tw-w-full tw-py-3.5 tw-pr-3 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Nome</th>
                      {% if user.client_has_offset_answer_sheet or user.client_has_salta_answer_sheet %}
                      <th data-tg-title="Código da prova" data-tg-order="4" data-tg-tour='Código da prova' data-tg-group="default-template-list" scope="col" class="tw-px-8 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Código</th>
                      {% endif %}
                      <th data-tg-title="Qualidade do gabarito" data-tg-order="4" data-tg-tour='Saiba se o gabarito cadastrado já está totalmente qualificado com assuntos, habilidades e competências.' data-tg-group="default-template-list" scope="col" class="tw-px-8 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Qualidade</th>
                      <th data-tg-title="Situação do gabarito" data-tg-order="5" data-tg-tour='Visualize e altere a situação do gabarito diretamente da listagem.' data-tg-group="default-template-list" scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Situação</th>
                      <th scope="col" class="tw-relative tw-py-3.5 tw-pl-12 tw-pr-4 sm:tw-pr-3">
                        <span class="tw-sr-only">Ações</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody class="tw-divide-y tw-divide-gray-200 tw-bg-white">
                    {% for exam in object_list %}
                      <tr id="tr-{{ exam.pk }}">
                        <td class="tw-py-4 tw-pr-3 tw-text-sm tw-font-medium tw-text-gray-900">
                          <div class="tw-flex tw-items-center">
                            <div>
                              <div class="tw-font-medium tw-text-gray-900">{{ exam.name }}</div>
                              <div class="tw-flex tw-gap-2 tw-mt-2">
                                <div class="tw-flex">
                                  <span class="mr-2">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                      <g clip-path="url(#clip0_2_1917)">
                                        <path d="M5.83329 7.91664L1.66663 9.99997L9.70182 14.0176C9.81114 14.0722 9.8658 14.0996 9.92313 14.1103C9.97391 14.1198 10.026 14.1198 10.0768 14.1103C10.1341 14.0996 10.1888 14.0722 10.2981 14.0176L18.3333 9.99997L14.1666 7.91664M5.83329 12.0833L1.66663 14.1666L9.70182 18.1842C9.81114 18.2389 9.8658 18.2662 9.92313 18.277C9.97391 18.2865 10.026 18.2865 10.0768 18.277C10.1341 18.2662 10.1888 18.2389 10.2981 18.1842L18.3333 14.1666L14.1666 12.0833M1.66663 5.83331L9.70182 1.81571C9.81114 1.76105 9.86579 1.73372 9.92313 1.72297C9.97391 1.71344 10.026 1.71344 10.0768 1.72297C10.1341 1.73372 10.1888 1.76105 10.2981 1.81571L18.3333 5.83331L10.2981 9.8509C10.1888 9.90556 10.1341 9.93289 10.0768 9.94365C10.026 9.95317 9.97391 9.95317 9.92313 9.94365C9.86579 9.93289 9.81114 9.90556 9.70182 9.8509L1.66663 5.83331Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                      </g>
                                      <defs>
                                        <clipPath id="clip0_2_1917">
                                          <rect width="20" height="20" fill="white"/>
                                        </clipPath>
                                      </defs>
                                    </svg>
                                  </span>
                                  <span class="tw-text-[#9BA3AF]">{{ exam.total_question }} questões</span>
                                </div>
                                <div class="tw-flex">
                                  <span class="mr-2">
                                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                      <path d="M9.40217 2.8778C9.59424 2.48869 9.69028 2.29413 9.82065 2.23197C9.93408 2.17789 10.0659 2.17789 10.1793 2.23197C10.3097 2.29413 10.4057 2.48869 10.5978 2.8778L12.42 6.56944C12.4767 6.68432 12.5051 6.74176 12.5465 6.78635C12.5832 6.82584 12.6272 6.85783 12.6761 6.88056C12.7313 6.90623 12.7946 6.91549 12.9214 6.93402L16.9975 7.5298C17.4267 7.59253 17.6413 7.6239 17.7406 7.72874C17.827 7.81995 17.8677 7.94529 17.8512 8.06985C17.8323 8.21302 17.6769 8.36436 17.3662 8.66702L14.4178 11.5387C14.3259 11.6282 14.28 11.673 14.2503 11.7263C14.2241 11.7734 14.2072 11.8252 14.2007 11.8788C14.1934 11.9393 14.2042 12.0025 14.2259 12.129L14.9216 16.1851C14.995 16.6129 15.0317 16.8269 14.9627 16.9538C14.9027 17.0642 14.7961 17.1417 14.6725 17.1646C14.5305 17.1909 14.3384 17.0899 13.9542 16.8879L10.3103 14.9716C10.1967 14.9119 10.14 14.882 10.0802 14.8703C10.0272 14.8599 9.97274 14.8599 9.91979 14.8703C9.85998 14.882 9.80321 14.9119 9.68967 14.9716L6.04573 16.8879C5.66156 17.0899 5.46947 17.1909 5.32744 17.1646C5.20386 17.1417 5.09723 17.0642 5.03724 16.9538C4.96829 16.8269 5.00498 16.6129 5.07835 16.1851L5.77403 12.129C5.79572 12.0025 5.80656 11.9393 5.79923 11.8788C5.79273 11.8252 5.77589 11.7734 5.74963 11.7263C5.71998 11.673 5.67402 11.6282 5.58211 11.5387L2.63376 8.66702C2.32301 8.36436 2.16764 8.21302 2.14873 8.06985C2.13228 7.94529 2.17292 7.81995 2.25933 7.72874C2.35866 7.6239 2.57327 7.59253 3.0025 7.5298L7.07855 6.93402C7.20531 6.91549 7.26869 6.90623 7.32389 6.88056C7.37276 6.85783 7.41676 6.82584 7.45345 6.78635C7.49488 6.74176 7.52323 6.68432 7.57994 6.56944L9.40217 2.8778Z" stroke="#D2D6DB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </span>
                                  <span class="tw-text-[#9BA3AF]">{{ exam.total_weight|floatformat:2 }} pontos</span>
                                </div>
                              </div>
                            </div>
                          </div>
                        </td>
                        {% if user.client_has_offset_answer_sheet or user.client_has_salta_answer_sheet %}
                        <td class="tw-whitespace-nowrap tw-px-8 tw-py-4 tw-text-sm tw-text-gray-500">
                          {{exam.external_code|default_if_none:""|safe}}
                        </td>
                        {% endif %}
                        <td class="tw-whitespace-nowrap tw-px-8 tw-py-4 tw-text-sm tw-text-gray-500">
                          <div aria-label="Progress">
                            <div class="tw-flex tw-space-x-2">
                              {% if exam.get_quality_values == 3 %}
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#41C588] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#41C588] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#41C588] tw-h-[4px] tw-w-[40px]">
                                </div>
                              {% elif exam.get_quality_values == 2 %}
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#41C588] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#41C588] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#E5E7EA] tw-h-[4px] tw-w-[40px]">
                                </div>
                              {% elif exam.get_quality_values == 1 %}
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#FFCB56] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#E5E7EA] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#E5E7EA] tw-h-[4px] tw-w-[40px]">
                                </div>
                              {% else %}
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#E5E7EA] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#E5E7EA] tw-h-[4px] tw-w-[40px]">
                                </div>
                                <div class="tw-flex-1 tw-flex tw-rounded tw-bg-[#E5E7EA] tw-h-[4px] tw-w-[40px]">
                                </div>
                              {% endif %}
                              <!-- tw-bg-[#41C588] -->
                              <!-- tw-bg-[#FFCB56] -->
                              <!-- tw-bg-[#E5E7EA] -->
                            </div>
                          </div>
                        </td>
                        <td class="tw-whitespace-nowrap tw-px-3 tw-py-4 tw-text-sm tw-text-gray-500">
                          <button class="tw-inline-flex tw-items-center tw-rounded-full tw-px-3 tw-py-1 tw-text-xs tw-font-medium tw-ring-1 tw-ring-inset tw-ring-[#E5E7EA] hover:tw-bg-gray-100 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-gray-100" type="button" id="dropdownMenuButton-1-{{ exam.pk }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <template v-if="updateStatusFetchStatus === 'error'">
                              Falha ao carregar
                            </template>
                            <template v-else>
                              <template v-if="getExamByPk('{{ exam.pk }}').status === 0">
                                <span class="ml-1 mr-2">
                                  <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                    <path d="M2 7.5C2 7.5 2.5 7 4 7C5.5 7 6.5 8 8 8C9.5 8 10 7.5 10 7.5V1.5C10 1.5 9.5 2 8 2C6.5 2 5.5 1 4 1C2.5 1 2 1.5 2 1.5L2 11" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                </span>
                                <span class="tw-text-sm">
                                  Elaborando
                                </span>
                                <span class="ml-2">
                                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                </span>
                              </template>
                              <template v-else-if="getExamByPk('{{ exam.pk }}').status === 1">
                                <span class="ml-1 mr-2">
                                  <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                    <path d="M1.21006 6.35659C1.14197 6.24877 1.10792 6.19486 1.08886 6.11171C1.07455 6.04925 1.07455 5.95075 1.08886 5.88829C1.10792 5.80514 1.14197 5.75123 1.21006 5.64341C1.77276 4.75242 3.4477 2.5 6.0002 2.5C8.5527 2.5 10.2276 4.75242 10.7903 5.64341C10.8584 5.75123 10.8925 5.80514 10.9115 5.88829C10.9259 5.95075 10.9259 6.04925 10.9115 6.11171C10.8925 6.19486 10.8584 6.24877 10.7903 6.35659C10.2276 7.24758 8.5527 9.5 6.0002 9.5C3.4477 9.5 1.77276 7.24758 1.21006 6.35659Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                    <path d="M6.0002 7.5C6.82863 7.5 7.5002 6.82843 7.5002 6C7.5002 5.17157 6.82863 4.5 6.0002 4.5C5.17177 4.5 4.5002 5.17157 4.5002 6C4.5002 6.82843 5.17177 7.5 6.0002 7.5Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                </span>
                                <span class="tw-text-sm">
                                  Em análise
                                </span>
                                <span class="ml-2">
                                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                </span>
                              </template>
                              <template v-else-if="getExamByPk('{{ exam.pk }}').status === 2">
                                <span class="ml-1 mr-2">
                                  <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                    <g clip-path="url(#clip0_2_3631)">
                                      <path d="M3.75 6L5.25 7.5L8.25 4.5M11 6C11 8.76142 8.76142 11 6 11C3.23858 11 1 8.76142 1 6C1 3.23858 3.23858 1 6 1C8.76142 1 11 3.23858 11 6Z" stroke="#41C588" stroke-linecap="round" stroke-linejoin="round"/>
                                    </g>
                                    <defs>
                                      <clipPath id="clip0_2_3631">
                                        <rect width="16" height="16" fill="white"/>
                                      </clipPath>
                                    </defs>
                                  </svg>
                                </span>
                                <span class="tw-text-sm">
                                  Fechado
                                </span>
                                <span class="ml-2">
                                  <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M4 6L8 10L12 6" stroke="#D2D6DB" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                </span>
                              </template>
                            </template>
                          </button>
                          <div class="dropdown-menu tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-1-{{ exam.pk }}" style="font-size: inherit;">
                            <div class="tw-py-1" role="none">
                              <template v-if="getExamByPk('{{ exam.pk }}').status !== 0">
                                <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0" @click="updateStatus('{{ exam.pk }}', 0)">
                                  <span class="tw-flex tw-items-center">
                                    <span class="mr-2">
                                      <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                        <path d="M2 7.5C2 7.5 2.5 7 4 7C5.5 7 6.5 8 8 8C9.5 8 10 7.5 10 7.5V1.5C10 1.5 9.5 2 8 2C6.5 2 5.5 1 4 1C2.5 1 2 1.5 2 1.5L2 11" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                      </svg>
                                    </span>
                                    <span>
                                      Elaborando
                                    </span>
                                  </span>
                                </button>
                              </template>
                              <template v-if="getExamByPk('{{ exam.pk }}').status !== 1">
                                <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1" @click="updateStatus('{{ exam.pk }}', 1)">
                                  <span class="tw-flex tw-items-center">
                                    <span class="mr-2">
                                      <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                        <path d="M1.21006 6.35659C1.14197 6.24877 1.10792 6.19486 1.08886 6.11171C1.07455 6.04925 1.07455 5.95075 1.08886 5.88829C1.10792 5.80514 1.14197 5.75123 1.21006 5.64341C1.77276 4.75242 3.4477 2.5 6.0002 2.5C8.5527 2.5 10.2276 4.75242 10.7903 5.64341C10.8584 5.75123 10.8925 5.80514 10.9115 5.88829C10.9259 5.95075 10.9259 6.04925 10.9115 6.11171C10.8925 6.19486 10.8584 6.24877 10.7903 6.35659C10.2276 7.24758 8.5527 9.5 6.0002 9.5C3.4477 9.5 1.77276 7.24758 1.21006 6.35659Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M6.0002 7.5C6.82863 7.5 7.5002 6.82843 7.5002 6C7.5002 5.17157 6.82863 4.5 6.0002 4.5C5.17177 4.5 4.5002 5.17157 4.5002 6C4.5002 6.82843 5.17177 7.5 6.0002 7.5Z" stroke="#0C7BDB" stroke-linecap="round" stroke-linejoin="round"/>
                                      </svg>
                                    </span>
                                    <span>
                                      Em análise
                                    </span>
                                  </span>
                                </button>
                              </template>
                              <template v-if="getExamByPk('{{ exam.pk }}').status !== 2">
                                <button type="button" class="tw-w-full tw-text-gray-700 tw-block tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-2" @click="updateStatus('{{ exam.pk }}', 2)">
                                  <span class="tw-flex tw-items-center">
                                    <span class="mr-2">
                                      <svg width="16" height="16" viewBox="0 0 12 12" fill="none">
                                        <g clip-path="url(#clip0_2_3631)">
                                          <path d="M3.75 6L5.25 7.5L8.25 4.5M11 6C11 8.76142 8.76142 11 6 11C3.23858 11 1 8.76142 1 6C1 3.23858 3.23858 1 6 1C8.76142 1 11 3.23858 11 6Z" stroke="#41C588" stroke-linecap="round" stroke-linejoin="round"/>
                                        </g>
                                        <defs>
                                          <clipPath id="clip0_2_3631">
                                            <rect width="16" height="16" fill="white"/>
                                          </clipPath>
                                        </defs>
                                      </svg>
                                    </span>
                                    <span>
                                      Fechado
                                    </span>
                                  </span>
                                </button>
                              </template>
                            </div>
                          </div>
                        </td>
                        <td class="tw-whitespace-nowrap tw-py-4 tw-pl-12 tw-pr-4 tw-text-sm tw-font-medium sm:tw-pr-3">
                          <div class="tw-flex tw-items-center tw-justify-end tw-space-x-4">
                            {% if user|has_perm:'exams.change_template_exam' %}
                            <a href="{% url 'omr:template_update' pk=exam.pk %}" class="tw-rounded-full tw-bg-[#F9FAFA] tw-p-2 tw-text-primary-600 tw-shadow-sm hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Editar">
                              <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                <path d="M11 4.00023H6.8C5.11984 4.00023 4.27976 4.00023 3.63803 4.32721C3.07354 4.61483 2.6146 5.07377 2.32698 5.63826C2 6.27999 2 7.12007 2 8.80023V17.2002C2 18.8804 2 19.7205 2.32698 20.3622C2.6146 20.9267 3.07354 21.3856 3.63803 21.6732C4.27976 22.0002 5.11984 22.0002 6.8 22.0002H15.2C16.8802 22.0002 17.7202 22.0002 18.362 21.6732C18.9265 21.3856 19.3854 20.9267 19.673 20.3622C20 19.7205 20 18.8804 20 17.2002V13.0002M7.99997 16.0002H9.67452C10.1637 16.0002 10.4083 16.0002 10.6385 15.945C10.8425 15.896 11.0376 15.8152 11.2166 15.7055C11.4184 15.5818 11.5914 15.4089 11.9373 15.063L21.5 5.50023C22.3284 4.6718 22.3284 3.32865 21.5 2.50023C20.6716 1.6718 19.3284 1.6718 18.5 2.50022L8.93723 12.063C8.59133 12.4089 8.41838 12.5818 8.29469 12.7837C8.18504 12.9626 8.10423 13.1577 8.05523 13.3618C7.99997 13.5919 7.99997 13.8365 7.99997 14.3257V16.0002Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </a>
                            {% endif %}
                            {% if user|has_perm:'exams.export_template_exam_results' %}
                              <a href="{% url 'exams:exams_detail_v2' pk=exam.pk %}" class="tw-rounded-full tw-bg-[#F9FAFA] tw-p-2 tw-text-primary-600 tw-shadow-sm hover:tw-bg-[#fff4ec] focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:outline-offset-2 focus-visible:tw-outline-[#ffdec7]" data-toggle="tooltip" data-placement="top" title="Relatório por aluno">
                                <svg class="tw-h-5 tw-w-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                                  <path d="M12.0001 15C8.83002 15 6.01089 16.5306 4.21609 18.906C3.8298 19.4172 3.63665 19.6728 3.64297 20.0183C3.64785 20.2852 3.81546 20.6219 4.02546 20.7867C4.29728 21 4.67396 21 5.42733 21H18.5729C19.3262 21 19.7029 21 19.9747 20.7867C20.1847 20.6219 20.3523 20.2852 20.3572 20.0183C20.3635 19.6728 20.1704 19.4172 19.7841 18.906C17.9893 16.5306 15.1702 15 12.0001 15Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                  <path d="M12.0001 12C14.4854 12 16.5001 9.98528 16.5001 7.5C16.5001 5.01472 14.4854 3 12.0001 3C9.51481 3 7.5001 5.01472 7.5001 7.5C7.5001 9.98528 9.51481 12 12.0001 12Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                              </a>
                            {% endif %}
                            <div>
                              {% if user|has_module_perms:'exams' %}
                                <button class="tw-inline-flex tw-w-full tw-justify-center tw-gap-x-1.5 tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-[#667085] tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50" type="button" id="dropdownMenuButton-{{ exam.pk }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  Opções
                                  <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                                  </svg>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-origin-top-right tw-divide-y tw-divide-gray-100 tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-{{ exam.pk }}" style="font-size: inherit;">
                                  <div class="tw-flex tw-gap-1">
                                    <div class="tw-py-1" role="none">
                                      <p class="tw-px-4 tw-py-2" style="font-size: 10px; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Inter UI', Roboto, sans-serif; letter-spacing: .7px; color: #8392a5; text-transform: uppercase;">
                                        Geral
                                      </p>
                                      {% if user|has_perm:'exams.change_template_exam' %}
                                        <a href="{% url 'omr:template_update' pk=exam.pk %}" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">
                                          <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                                          </svg>
                                          Editar
                                        </a>
                                      {% endif %}
                                      {% if user|has_perm:'exams.can_view_result_exam' %}
                                      <a href="javascript:void(0)" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" @click="getDuplicateExam('{% url "omr:exam_template_duplicate" exam.pk %}', '{{ exam.name }}')" tabindex="-1" id="menu-item-0">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                          <path d="M10.5 2.0028C9.82495 2.01194 9.4197 2.05103 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8.05103 3.4197 8.01194 3.82495 8.0028 4.5M19.5 2.0028C20.1751 2.01194 20.5803 2.05103 20.908 2.21799C21.2843 2.40973 21.5903 2.71569 21.782 3.09202C21.949 3.4197 21.9881 3.82494 21.9972 4.49999M21.9972 13.5C21.9881 14.175 21.949 14.5803 21.782 14.908C21.5903 15.2843 21.2843 15.5903 20.908 15.782C20.5803 15.949 20.1751 15.9881 19.5 15.9972M22 7.99999V9.99999M14.0001 2H16M5.2 22H12.8C13.9201 22 14.4802 22 14.908 21.782C15.2843 21.5903 15.5903 21.2843 15.782 20.908C16 20.4802 16 19.9201 16 18.8V11.2C16 10.0799 16 9.51984 15.782 9.09202C15.5903 8.71569 15.2843 8.40973 14.908 8.21799C14.4802 8 13.9201 8 12.8 8H5.2C4.0799 8 3.51984 8 3.09202 8.21799C2.71569 8.40973 2.40973 8.71569 2.21799 9.09202C2 9.51984 2 10.0799 2 11.2V18.8C2 19.9201 2 20.4802 2.21799 20.908C2.40973 21.2843 2.71569 21.5903 3.09202 21.782C3.51984 22 4.07989 22 5.2 22Z" />
                                        </svg>
                                        Duplicar gabarito
                                      </a>
                                      {% endif %}
                                      {% if user|has_perm:'exams.can_view_result_exam' %}
                                        <a {% if exam.application_count %}href="{% url 'exams:dash_exam_teacher_detail_questions' exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-1">
                                          <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                          </svg>
                                          Ver resultados
                                        </a>
                                      {% endif %}
                                      {% if user|has_perm:'exams.delete_template_exam' %}
                                        <a href="javascript:void(0)" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-2" onClick="confirmCancel('{% url "omr:template_delete" exam.pk %}')">
                                          <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                          </svg>
                                          Remover
                                        </a>
                                      {% endif %}
                                    </div>
                                    {% if user|has_perm:'exams.export_template_exam_results' %}
                                      <div class="tw-py-1" role="none">
                                        <p class="tw-px-4 tw-py-2" style="font-size: 10px; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Inter UI', Roboto, sans-serif; letter-spacing: .7px; color: #8392a5; text-transform: uppercase;">
                                          Relatório
                                        </p>
                                        <a href="{% url 'exams:exams_detail_v2' pk=exam.pk %}" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-3">
                                          <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                                          </svg>
                                          Relatório por aluno
                                        </a>
                                        <a {% if exam.application_count %}href="{% url 'exports:exams_export_erp' %}?q_exam_id={{exam.pk}}&get_abstracts=true"{% else %}href="javascript:;" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-4">
                                          <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path d="M21 6H17.8C16.1198 6 15.2798 6 14.638 6.32698C14.0735 6.6146 13.6146 7.07354 13.327 7.63803C13 8.27976 13 9.11984 13 10.8V12M21 6L18 3M21 6L18 9M10 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V14" stroke-linecap="round" stroke-linejoin="round" />
                                          </svg>
                                          Exportar dados (Versão nova)
                                        </a>
                                        <a {% if exam.application_count %}href="{% url 'exports:exam_export' pk=exam.pk %}"{% else %}href="#" @click="alertExamNoAnswers()"{% endif %} class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-13">
                                          <!-- <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file" style="margin-right: 0.5rem;"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg> -->
                                          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                            <path d="M21 6H17.8C16.1198 6 15.2798 6 14.638 6.32698C14.0735 6.6146 13.6146 7.07354 13.327 7.63803C13 8.27976 13 9.11984 13 10.8V12M21 6L18 3M21 6L18 9M10 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V14" stroke-linecap="round" stroke-linejoin="round" />
                                          </svg>
                                          Exportar dados (Versão antiga)
                                        </a>
                                      </div>
                                    {% endif %}
                                    {% if user|has_perm:'exams.print_template_exam' %}
                                      {% if exam.questions.count > 0 %}
                                        <div class="py-1" role="none">
                                          <p class="tw-px-4 tw-py-2" style="font-size: 10px; font-weight: 600; font-family: -apple-system, BlinkMacSystemFont, 'Inter UI', Roboto, sans-serif; letter-spacing: .7px; color: #8392a5; text-transform: uppercase;">
                                            Impressão
                                          </p>
                                          <button type="button" class="tw-text-gray-700 tw-flex tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-5" onclick="openConfigurePrintModal(url='{% url "exams:exam_template_print" pk=exam.pk %}')">
                                            <svg fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" width="16" height="16" style="margin-right: 0.5rem;">
                                              <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                                            </svg>
                                            Gabarito para divulgação
                                          </button>
                                        </div>
                                      {% endif %}
                                    {% endif %}
                                  </div>
                                </div>
                              {% endif %}
                            </div>
                          </div>
                        </td>
                      </tr>
                    {% empty %}
                      <tr>
                        <td colspan="4"><p class="tw-py-4">Não há gabaritos cadastrados</p></td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        {% include 'redesign/includes/pagination.html' with objects=object_list %}
      </div>
    </div>
  </div>
</div>
{% endblock content-fixed %}

{% block slide-over %}
<div id="right-off-canvas" class="off-canvas off-canvas-right wd-400 bg-white" style="overflow-y: auto; overflow-x: hidden;">
  <form action="" method="GET">
    <input type="hidden" value="{{ year|force_escape }}" name="year" />
    <div class="row p-3">
      <div class="col-12">
        <h5>Filtrar cadernos de gabaritos</h5>
        <p>Adiciona abaixo os filtros que você deseja aplicar na listagem abaixo</p>
        <hr/>
      </div>
      <div class="col-12">
        <div class="form-group mb-3">
          <label for="exam_name_id" class="mb-1">Nome da prova</label>
          <input type="text" value="{{q_name}}" id="exam_name_id" name="q_name" class="form-control" placeholder="Digite o nome da prova aqui">
        </div>
      </div>
      <div class="col-12">
        <div class="form-group mb-3">
          <label for="subject_id" class="mb-1">Disciplinas na Prova</label>
          <select name="q_subjects" id="subject_id" class="form-control" multiple="multiple">
            {% for subject in subjects %}
              <option value="{{subject.pk}}" {% if subject.pk|stringformat:'s' in q_subjects %}selected="selected" {% endif %}>
                {{subject.name}} > {{subject.knowledge_area.name}}
            </option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="col-12">
        <div class="form-group mb-3">
          <label for="grade_id" class="mb-1">Séries</label>
          <select name="q_grades" id="grade_id" class="form-control" multiple="multiple">
            {% for grade in grades %}
            <option value="{{grade.pk}}" {% if grade.pk|stringformat:'s' in q_grades %}selected="selected"
              {% endif %}>
              {{grade}}
            </option>
            {% endfor %}
          </select>
        </div>
      </div>
      <div class="col-12 mt-2">
        <div class="custom-control custom-switch ">
          <input type="checkbox" id="is_unprecedented" name="q_is_unprecedented" class="custom-control-input"
            {% if q_is_unprecedented %}checked="checked"{% endif %}>
          <label class="custom-control-label" for="is_unprecedented">Gabaritos inéditos</label>
          <small class="form-text text-muted mt-0">Selecine caso queira ver apenas provas que ainda não foram utilizadas em nenhuma aplicação.</small>
        </div>
      </div>
      <div class="col-12 mt-5">
        <button type="submit" class="btn btn-primary btn-block">
          <i class="fas fa-search"></i>
          Aplicar filtro
        </button>
      </div>
    </div>
  </form>
</div>
{% endblock slide-over %}

{% block extra-modal %}
{% include 'includes/confirm_modal.html' %}

<div aria-hidden="true" class="modal  fade" id="exportAttachmentsModal" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-truncate" id="modal-exam-export-title"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="max-height: fit-content; height: fit-content;">
        <div id="exporting-info">
          <h6>Exportação em andamento... <i class="fas fa-spinner fa-spin text-primary mt-2"></i></h6>
          <p>Mantenha esta janela aberta enquanto geramos o link para download.</p>
        </div>
        <div id="exported-info" class="d-none">
          <p>Você pode baixar o arquivo ZIP com as respostas de anexo clicando no botão abaixo:</p>
          <a href="#" target="_blank" id="download-attachments-url" class="btn btn-primary btn-block">
            <i class="fas fa-download"></i>
            Baixar respostas
          </a>
        </div>
        <div id="exported-error" class="d-none">
          <p class="text-danger">Um erro aconteceu no processo de exportação. Tente novamente mais tarde.</p>
        </div>
      </div>
      <div class="modal-footer justify-content-center"></div>
    </div>
  </div>
</div>

<div aria-hidden="true" class="modal fade" id="configurePrintModal" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Configure a impressão do gabarito</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form id="configure_print_form_id" action="" method="get" target="_blank">
        <div class="modal-body" style="max-height: fit-content; height: fit-content;"style="max-height: fit-content; height: fit-content;">            
          <h6>Tipo de colunas:</h6>
          <div class="btn-group btn-group-toggle mb-3" data-toggle="buttons">
            <label class="btn btn-outline-primary btn-lg active">
              <input type="radio" name="separate_subjects" id="separate_subjects_default" value="0" autocomplete="off" checked>
              <i class="fas fa-file fa-lg"></i>
              Sequencial 
            </label>
            <label class="btn btn-outline-primary btn-lg">
              <input type="radio" name="separate_subjects" id="separate_subjects_" value="1" autocomplete="off">
              <i class="fas fa-copy fa-lg"></i>
              Agrupado por disciplina
            </label>
          </div>
          <div class="modal-footer">
            <div class="form-buttons-w text-right">
              <button class="btn btn-primary not-disable" type="submit">
                <i class="os-icon os-icon-check"></i>
                <span>Imprimir Gabarito</span>
              </button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<div aria-hidden="true" class="modal  fade" id="duplicateExamModal" role="dialog" tabindex="-1">
  <div class="modal-dialog modal-md" style="max-width: fit-content; width: fit-content;"role="document">
    <div class="modal-content tw-rounded-md">
      <div class="modal-header">
        <h5  class="modal-title tw-mt-1">Deseja realmente duplicar este gabarito?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
        <form id="duplicateExamForm" class="w-100" action="" method="POST">
          {% csrf_token %}
          <div class="modal-body" style="max-height: fit-content; height: fit-content;">
              <div class= "text-center">
                <p class="tw-mt-1 tw-mb-2 tw-text-base" id="examName"></p>
              </div>
            <div class="flex justify-between items-center tw-border tw-rounded-md tw-border-primary-600 tw-px-3 tw-pt-2">
                <label for="keepAlternatives" class=" ">
                    <input type="checkbox" value="keepAlternatives" id="keepAlternatives" name="keep_alternatives" class="tw-left-4 tw-top-1/2 tw--mt-2 tw-h-4 tw-w-4 tw-rounded tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600">
                    <span class="inline-block">Manter alternativas corretas</span>
                    <p class="text-muted tw-ml-5">
                      As repostas do gabarito serão mantidas ao selecionar esta opção.
                    </p>
                </label>
            </div>
            <div class="tw-border tw-rounded-md tw-border-primary-600 tw-px-3  tw-pt-2 tw-mt-2 tw-mb-2 ">
                <label for="keepPedagogicalData" class=" ">
                    <input type="checkbox" value="keepPedagogicalData" id="keepPedagogicalData" name="keep_pedagogical_data" class="tw-left-4 tw-top-1/2 tw--mt-2 tw-h-4 tw-w-4 tw-rounded tw-border-gray-300 tw-text-primary-600 focus:tw-ring-primary-600">
                    <span class="inline-block">Manter dados pedagógico das questões </span>
                    <p class="text-muted tw-ml-5">
                      Assuntos, habilidades e competências serão mantidos ao selecionar esta opção.
                    </p>
                  </label>
              </div>
          </div>
        
          <div class="modal-footer form-buttons-w  flex justify-between items-center form-buttons-w text-right">
              <button class="form-buttons-w text-right m-2  tw-items-center tw-justify-center tw-gap-x-1 tw-rounded-md tw-text-primary-600 tw-border tw-border-primary-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-shadow-sm hover:tw-text-white hover:tw-bg-primary-600 focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-primary-600" data-dismiss="modal" type="button">
                <i class="os-icon os-icon-cancel-circle"></i>
                <span>Cancelar</span>
              </button>
              <button class=" tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2.5 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 hover:tw-text-white focus-visible:tw-outline focus-visible:tw-outline-2 focus-visible:tw-outline-offset-2 focus-visible:tw-outline-blue-600" type="submit">
                <i class="os-icon os-icon-check"></i>
                <span>Sim, duplicar gabarito</span>
              </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock extra-modal %}

{% block js-additional %}
<script src="{% static 'administration/lib/bootstrap-tagsinput/bootstrap-tagsinput.min.js' %}"></script>
<script src="{% static 'administration/lib/select2/js/select2.min.js' %}"></script>
<script src="https://unpkg.com/@sjmc11/tourguidejs/dist/tour.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
  var app = new Vue({
    delimiters: ['${', '}'],
    el: '#app',
    data: {
      exam_json: [],
      exams: [
        {% for exam in object_list %}
          { 
            pk: "{{ exam.pk }}", 
            status: {{ exam.status }},
            name: "{{ exam.name }}"
          },
        {% endfor %}
      ],
      getExamByPk(pk) {
        return this.exams.find((exam) => exam.pk === pk);
      },
      updateStatusFetchStatus: 'idle',
    },
    methods: {
      getDuplicateExam(url, examName) {
        document.getElementById('duplicateExamForm').action = url
        document.getElementById('examName').innerText = examName; 
        $("#duplicateExamModal").modal("show")
      },
      removeFilter(filter) {
        const url = new URL(window.location.href);
        const urlParams = url.searchParams;
        urlParams.delete(filter);
        url.search = urlParams.toString();
        window.location.href = url.href;
      },
      alertExamNoAnswers() {
        Swal.fire({
          title: 'Erro',
          text: "Este gabarito ainda não possui respostas associadas pois não foi usado em nenhuma aplicação",
          icon: 'warning',
          confirmButtonText: 'Voltar'
        })
      },
      async updateStatus(pk, newStatus) {
        const url = "{% url 'api:exams-api:exam-update-status' exam_id='00000000-0000-0000-0000-000000000000' %}".replace('00000000-0000-0000-0000-000000000000', pk);

        this.updateStatusFetchStatus = 'loading';
        const res = await fetch(url, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: newStatus })
        })
        if (!res.ok) {
          this.updateStatusFetchStatus = 'error'
          throw new Error(`HTTP error! status: ${res.status}`);
        }
        const data = await res.json()
        this.exams.find(exam => exam.pk === pk).status = data.status;
        this.updateStatusFetchStatus = 'success';
        const message = 'Situação alterada com sucesso!';
        this.showToast(`<div class="tw-pointer-events-auto tw-w-full tw-max-w-sm tw-overflow-hidden tw-rounded-lg tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5"><div class="tw-p-4"><div class="tw-flex tw-items-start"><div class="tw-flex-shrink-0"><svg class="tw-h-6 tw-w-6 tw-text-green-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><div class="tw-ml-3 tw-w-0 tw-flex-1 tw-pt-0.5"><p class="tw-text-sm tw-font-medium tw-text-gray-900">${message}</p></div></div></div><div class="tw-relative tw-h-1 tw-overflow-hidden tw--mt-1"><div id="toast-progressbar" class="tw-w-full tw-h-1 tw-rounded-b-md tw-bg-[#00000033]"></div></div></div>`);
      },
      showToast(html, time = 1500) {
        const wrapper = document.createElement('div');
        wrapper.setAttribute('aria-live', 'assertive');
        wrapper.classList.add('tw-pointer-events-none', 'tw-fixed', 'tw-inset-0', 'tw-flex', 'tw-items-end', 'tw-px-4', 'tw-py-6', 'sm:tw-items-start', 'sm:tw-p-6');
        wrapper.innerHTML = `<div class="tw-flex tw-w-full tw-flex-col tw-items-center tw-space-y-4 sm:tw-items-end">${html}</div>`;
        document.body.appendChild(wrapper);

        const progressBar = document.getElementById('toast-progressbar');
        progressBar.style.display = 'flex';
        progressBar.style.transition = `width ${time/1000}s linear 0s`;
        setTimeout(function() { progressBar.style.width = '0%'; }, 1);
        setTimeout(function() { wrapper.remove(); }, time);
      },
    },
    mounted: function(){ 

      {% include 'help/includes/tour_guide.js' with group_guide_name='default-template-list' %}
    }
  })

  function openConfigurePrintModal(url, selector = "#configurePrintModal") {
    console.log(url, selector)
    document.getElementById('configure_print_form_id').action = url
    $(selector).modal("show")
  }

  function confirmCancelCopy(url) {
    document.getElementById('confirmCancelCopyFormId').action = url
    $("#confirmCancelCopyModal").modal("show")
  }

  $('#status_id').select2({
    placeholder: "Selecione uma opção",
    closeOnSelect: false
  });

  $('#subject_id').select2({
    placeholder: "Selecione uma opção",
    closeOnSelect: false,
    templateResult: function (data, container) {
      let subject_name = data.text.split('>')[0]
      let knowledge_area_name = data.text.split('>')[1]
      return $(
        `<strong class="select2-results__custom_option">${subject_name}</strong> <br> <span class="select2-results__custom_option">${knowledge_area_name}</span>`
      );
    },
  }).on('select2:selecting', function(e) {
    let cur = e.params.args.data.id;
    let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
    $(e.target).val(old).trigger('change');
    $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
    return false;
  });

  $('#grade_id').select2({
    placeholder: "Selecione uma opção",
    closeOnSelect: false
  }).on('select2:selecting', function(e) {
    let cur = e.params.args.data.id;
    let old = (e.target.value == '') ? [cur] : $(e.target).val().concat([cur]);
    $(e.target).val(old).trigger('change');
    $(e.params.args.originalEvent.currentTarget).attr('aria-selected', 'true');
    return false;
  });

  $('.table-responsive').on('show.bs.dropdown', function () {
    $('.table-responsive').css( "overflow", "inherit" );
  });

  $('.table-responsive').on('hide.bs.dropdown', function () {
    $('.table-responsive').css( "overflow", "auto" );
  })

  $(function () {
    'use strict'

    $('.off-canvas-menu').on('click', function (e) {
      e.preventDefault();
      var target = $(this).attr('data-toggle-off-canvas');
      $(target).addClass('show');
    });

    $('.off-canvas .close').on('click', function (e) {
      e.preventDefault();
      $(this).closest('.off-canvas').removeClass('show');
    })

    $(document).on('click touchstart', function (e) {
      if($(e.target).hasClass('select2-results__option') || $(e.target).hasClass('select2-results__custom_option')) {
        return
      }
      e.stopPropagation();

      if (!$(e.target).closest('.off-canvas-menu').length) {
        var offCanvas = $(e.target).closest('.off-canvas').length;
        if (!offCanvas) {
          $('.off-canvas.show').removeClass('show');
        }
      }
    });

    $('.export-attachments').on('click', function(e) {
      let examId = $(this).data('exam-id')
      let examName = $(this).data('exam-name')

      {% with task_id='1234567890'|random %}
      let exportAttachmentsUrl = "{% url 'exams:exam_export_attachments' pk='00000000-0000-0000-0000-000000000000' task_id=task_id %}"
      let exportAttachmentsStatusUrl = "{% url 'exams:exam_export_attachments_status' pk='00000000-0000-0000-0000-000000000000' task_id=task_id %}"
      {% endwith %}

      $('#exportAttachmentsModal').modal('show');
      $('#modal-exam-export-title').html(examName)

      $('#exporting-info').removeClass('d-none')
      $('#exported-info').addClass('d-none')
      $('#exported-error').addClass('d-none')

      axios.get(exportAttachmentsUrl.replace('00000000-0000-0000-0000-000000000000', examId))
      .then(function (response) {})

      let interval = setInterval(function(){
        axios.get(exportAttachmentsStatusUrl.replace('00000000-0000-0000-0000-000000000000', examId))
        .then(function (response) {
          if (response.data.details) {
            $('#download-attachments-url').attr('href', response.data.details)
            $('#exported-info').removeClass('d-none')
            $('#exporting-info').addClass('d-none')
            clearInterval(interval)
          }
        })
        .catch(function(response) {
          $('#exported-error').removeClass('d-none')
          $('#exporting-info').addClass('d-none')
          clearInterval(interval)
        })
      }, 1000)
    })
  });
</script>
{% endblock %}
