{% extends 'redesign/base.html' %}
{% comment %} {% extends 'dashboard/base_fixed.html' %} {% endcomment %}
{% load static %}
{% load widget_tweaks %}
{% load remove_line_break %}
{% load math %}
{% load permissions %}
{% load escape_single_quotes %}
{% load cdn_url %}

{% block css-additional %}
  <link href="{% static 'administration/lib/select2/css/select2.min.css' %}" rel="stylesheet" />
  <link rel="stylesheet" href="{% static 'administration/lib/datatables.net-responsive-dt/css/responsive.dataTables.min.css' %}">
  <link rel="stylesheet" href="https://unpkg.com/@sjmc11/tourguidejs/dist/css/tour.min.css">
  <style>
    .tg-backdrop{
      z-index: 9999 !important;
    }
    .errors span {
      cursor: pointer;
    }
    .dataTables_wrapper {
      width: 100%;
    }
    .dataTables_wrapper .dataTables_length label {
      font-size: 0.875rem;
      line-height: 1.25rem;
      font-weight: 500;
      white-space: nowrap;
      color: #9BA3AF;
      margin-bottom: 0;
      display: flex;
      align-items: center;
    }
    .dataTables_wrapper .dataTables_length select {
      display: block;
      padding-top: 0.375rem;
      padding-bottom: 0.375rem;
      border-radius: 0.375rem;
      border-color: #e5e7eb;
      box-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color);--tw-ring-inset: inset;
      --ring-color: #D1D5DB;
      width: 5rem;
      color: #111827;
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      margin-right: 0.5rem;
    }
    .dataTables_filter {
      margin-bottom: 1rem;
    }
    .dataTables_wrapper .dataTables_filter label {
      margin-bottom: 0;
    }
    .dataTables_wrapper .dataTables_filter input {
      margin-left: 0.5rem;
    }
  </style>
{% endblock css-additional %}

{% block title %}Detalhe da correção - Lize{% endblock title %}

{% comment %}
{% block breadcrumb-fixed %}
  <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-10">
    <div>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb breadcrumb-style1 mg-b-10">
          <li class="breadcrumb-item"><a href="{% url 'omr:omr_upload_list' %}">GABARITOS</a></li>
          <li class="breadcrumb-item active" aria-current="page">ENVIAR</li>
        </ol>
      </nav> 
      <h4>Gabaritos</h4>
    </div>
    <div class="d-none d-md-block">
        <a href="#" onclick="history.back(); return false;" class="btn btn-sm pd-x-15 btn-white btn-uppercase">
            <i data-feather="arrow-left" class="wd-10 mg-r-5"></i> Voltar
        </a>
    </div>
  </div>
{% endblock breadcrumb-fixed %}
{% endcomment %}

{% block content-fixed %}
<template>
  <div
    id="id_movable_window"
    class="tw-fixed tw-bg-white tw-border tw-text-xl tw-touch-none tw-box-border tw-p-5 tw-rounded-lg tw-clear-both tw-float-left tw-z-[10000]"
    style="width: 300px; height: 460px;"
    v-if="isOpenDraggingResizingWindow"
  >
    <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block">
      <button type="button" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" @click="hiddenDraggingResizingWindow">
        <span class="tw-sr-only">Fechar</span>
        <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="sm:tw-flex sm:tw-items-start">
      <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
        <h3 class="tw-text-base tw-font-semibold tw-leading-6 tw-text-gray-900" id="modal-title">
          Resposta do aluno
        </h3>
        <div class="tw-mt-2">
          <template v-if="imgLoading">
            <div class="tw-flex tw-items-center">
              <svg class="tw-animate-spin tw--ml-1 tw-mr-3 tw-h-5 tw-w-5" fill="none" viewBox="0 0 24 24">
                <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Carregando, aguarde...
            </div>
          </template>
          <img :src="selectedImage" v-show="!imgLoading" onLoad="app.imgLoading = false" class="tw-max-w-full">
        </div>
      </div>
    </div>
  </div>

  <div
    id="movableWindow"
    class="tw-fixed tw-bg-white tw-border tw-text-xl tw-touch-none tw-box-border tw-p-5 tw-rounded-lg tw-clear-both tw-float-left tw-z-[10000]"
    style="width: 300px; height: 460px;"
    v-if="showMovableWindow"
  >
    <div class="tw-absolute tw-right-0 tw-top-0 tw-hidden tw-pr-4 tw-pt-4 sm:tw-block">
      <button type="button" class="tw-rounded-md tw-bg-white tw-text-gray-400 hover:tw-text-gray-500 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-primary-500 focus:tw-ring-offset-2" @click="showMovableWindow = false, selectedError = ''">
        <span class="tw-sr-only">Fechar</span>
        <svg class="tw-h-6 tw-w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="sm:tw-flex sm:tw-items-start">
      <div class="tw-mt-3 tw-text-center sm:tw-mt-0 sm:tw-text-left">
        <h3 class="tw-text-base tw-font-semibold tw-leading-6 tw-text-gray-900" id="modal-title">
          Resposta do aluno
        </h3>
        <div class="tw-mt-2">
          <template v-if="imgLoading">
            <div class="tw-flex tw-items-center">
              <svg class="tw-animate-spin tw--ml-1 tw-mr-3 tw-h-5 tw-w-5" fill="none" viewBox="0 0 24 24">
                <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Carregando, aguarde...
            </div>
          </template>
          <img :src="selectedImage" v-show="!imgLoading" onLoad="app.imgLoading = false" class="tw-max-w-full">
        </div>
      </div>
    </div>
  </div>

  <div class="tw-flex tw-justify-center">
    <div class="ard cer dcv tw-pb-8 tw-max-w-[100rem] tw-flex-1">
      <div class="ls" style="margin-top: 1.25rem; margin-bottom: 1.5rem; justify-content: space-between;">
        <div class="tw-flex tw-flex-wrap tw-items-center tw-gap-6 sm:tw-flex-nowrap tw-w-full">
          <h1 class="tw-text-xl tw-font-semibold tw-leading-7 tw-text-[#374151] sm:tw-truncate sm:tw-text-2xl sm:tw-tracking-tight tw-mb-0">
            Detalhe da correção
          </h1>
          <div class="tw-order-last tw-flex tw-w-full tw-gap-x-8 tw-text-sm tw-font-semibold tw-leading-6 sm:tw-order-none sm:tw-w-auto sm:tw-border-l sm:tw-border-gray-200 sm:tw-pl-6 sm:tw-leading-7">
            <!-- <button type="button" class="tw-flex tw-items-center tw-text-[#667085] off-canvas-menu" id="headlessui-slider-over-button-1" data-toggle-off-canvas="#right-off-canvas">
              <span>Filtrar</span>
              <span class="ml-2">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M5 10H15M2.5 5H17.5M7.5 15H12.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </button> -->
          </div>
          <div class="tw-ml-auto tw-flex tw-gap-3">
            <button
              type="button"
              class="tw-flex tw-items-center tw-gap-2 tw-text-sm tw-font-semibold tw-text-[#667085]"
              onclick="history.back()"
            >
              <span>Fechar</span>
              <span>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M18 6L6 18M6 6L18 18" stroke="#D0D3D9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
            </button>
          </div>
        </div>
      </div>
      {% if count_filters > 0 %}
        <div class="tw-bg-white sm:tw-rounded-lg tw-py-5 tw-border tw-border-[#E5E7EA] tw-mb-4">
          <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8" >
            <div class="tw-flex tw-justify-between">
              <div class="tw-flex tw-items-center">
                <p class="tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900 sm:tw-pl-0">
                  Filtrando por
                </p>
                <div class="tw-space-x-2">
                  {% if q_name %}
                    <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                      <button type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                        <span class="tw-sr-only">Remove</span>
                        <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                          <path d="M4 4l6 6m0-6l-6 6" />
                        </svg>
                        <span class="tw-absolute tw--inset-1"></span>
                      </button>
                      Nome da prova: {{ q_name }}
                      <!-- &{ filter.label }<template v-if="filter.showValues">:<span v-if="!filter.showCount">${ filter.values.join(', ') }</span><span v-else>${ filter.values.length }</span></template> -->
                    </span>
                  {% endif %}
                  {% if q_subjects %}
                    <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                      <button type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                        <span class="tw-sr-only">Remove</span>
                        <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                          <path d="M4 4l6 6m0-6l-6 6" />
                        </svg>
                        <span class="tw-absolute tw--inset-1"></span>
                      </button>
                      Disciplinas na prova:
                      {% for subject in subjects %}
                        {% if subject.pk|stringformat:'s' in q_subjects %}
                          {{ subject.name }} > {{ subject.knowledge_area.name }}
                        {% endif %}
                      {% endfor %}
                    </span>
                  {% endif %}
                  {% if q_grades %}
                    <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                      <button type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                        <span class="tw-sr-only">Remove</span>
                        <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                          <path d="M4 4l6 6m0-6l-6 6" />
                        </svg>
                        <span class="tw-absolute tw--inset-1"></span>
                      </button>
                      Séries:
                      {% for grade in grades %}
                        {% if grade.pk|stringformat:'s' in q_grades %}
                          {{ grade }}
                        {% endif %}
                      {% endfor %}
                    </span>
                  {% endif %}
                  {% if q_is_unprecedented %}
                    <span class="tw-inline-flex tw-items-center tw-gap-x-0.5 tw-rounded tw-bg-[#F9FAFA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-[#384250]">
                      <button type="button" class="tw-group tw-relative tw--ml-1 tw-h-3.5 tw-w-3.5 tw-rounded-sm hover:tw-bg-gray-500/20">
                        <span class="tw-sr-only">Remove</span>
                        <svg viewBox="0 0 14 14" class="tw-h-3.5 tw-w-3.5 tw-stroke-gray-700/50 group-hover:tw-stroke-gray-700/75">
                          <path d="M4 4l6 6m0-6l-6 6" />
                        </svg>
                        <span class="tw-absolute tw--inset-1"></span>
                      </button>
                      Gabaritos inéditos: sim
                    </span>
                  {% endif %}
                </div>
              </div>
              <div class="tw-flex tw-items-center">
                <a href="{% url 'omr:template_list' %}" class="tw-text-left tw-text-sm tw-font-semibold tw-text-[#667085] tw-flex tw-items-center hover:tw-text-[#667085]">
                  Limpar filtro
                  <svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="tw-ml-2">
                    <path d="M15 5L5 15M5 5L15 15" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endif %}

      <div class="tw-bg-white sm:tw-rounded-lg tw-py-6 tw-border tw-border-[#E5E7EA] tw-mb-8" data-tg-title="Informações do upload" data-tg-order="2" data-tg-tour="Veja quem fez o envio do arquivo e qual situação da leitura das páginas." data-tg-group="default-omr-upload-detail">
        <div class="tw-px-4 sm:tw-px-6 lg:tw-px-8" >
          <div class="tw-flex tw-justify-between">
            <div class="tw-flex tw-flex-col tw-gap-2 tw-pr-10">
              <label class="tw-text-sm tw-font-medium tw-text-[#9BA3AF]">Usuário</label>
              <p class="tw-text-[1.75rem] tw-leading-9 tw-font-semibold tw-text-[#101828]">
                {{ object.user }}
              </p>
            </div>
            <div class="tw-flex">
              <div class="tw-flex tw-gap-12 tw-border-l tw-border-gray-200 tw-px-10">
                <div class="tw-flex tw-flex-col tw-gap-2">
                  <label class="tw-text-sm tw-font-medium tw-text-[#9BA3AF]">Situação</label>
                  <p class="tw-text-[1.75rem] tw-leading-9 tw-font-semibold tw-text-[#101828]">
                    {{ object.get_status_display }}
                  </p>
                </div>
              </div>
              <div class="tw-flex tw-gap-12 tw-border-l tw-border-gray-200 tw-pl-10">
                <div class="tw-flex tw-flex-col tw-gap-2">
                  <label class="tw-text-sm tw-font-medium tw-text-[#9BA3AF]">Páginas lidas</label>
                  <p class="tw-text-[1.75rem] tw-leading-9 tw-font-semibold tw-text-[#101828]">
                    {{ object.total_pages }}
                  </p>
                </div>
                <div class="tw-flex tw-flex-col tw-gap-2">
                  <label class="tw-text-sm tw-font-medium tw-text-[#9BA3AF]">Com erro</label>
                  <p class="tw-text-[1.75rem] tw-leading-9 tw-font-semibold tw-text-[#101828]">
                    #{totalErrorsCount}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      {% if object.status == 5 %}
        <div class="row">
          <div class="col-12">
            <div class="alert alert-primary fade show" role="alert">
              Aguarde enquanto as folhas de resposta estão sendo recorrigidas. Ao final do processo, atualizaremos esta página.
            </div>
          </div>
        </div>
      {% endif %}

      {% if object.processing_log %}
        <div class="row">
          <div class="col-12 mb-3">
            <div class="card">
              <div class="card-header">Erros registrados</div>
              <div class="card-body">
                {{ object.processing_log|linebreaksbr }}
              </div>
            </div>
          </div>
        </div>
      {% endif %}

      <div class="tw-flex tw-justify-between">
        <div class="tw-w-full">
          <ul id="myTab" role="tablist" class="tw-list-none tw-flex tw-mb-0">
            <li
              class="sm:tw-rounded-lg tw-border tw-border-[#E5E7EA] tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-5 tw-cursor-pointer"
              :class="[activeTab === 'list-of-students' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFA]']"
              style="min-width: 300px; border-bottom-left-radius: 0; border-bottom-right-radius: 0; border-bottom: 0; {% if object.get_unsolved_discursive_errors and object.status != 5 or object.get_unsolved_errors and object.status != 5 %} border-top-right-radius: 0;{% endif %}"
              @click="switchTab('list-of-students')"
              data-tg-title="Alunos detectados" data-tg-order="3" data-tg-tour="Veja os alunos que foram lidos automaticamente e realize as operações necessárias." data-tg-group="default-omr-upload-detail"
            >
              <span
                id="list-of-students-tab"
                role="tab"
                aria-controls="list-of-students"
                aria-selected="true"
                class="tw-text-sm tw-px-12"
                :class="[activeTab === 'list-of-students' ? 'tw-font-semibold tw-text-[#374151]' : 'tw-font-medium tw-text-[#384250]']"
              >
                Listagem de alunos
                {% if omr_students|length > 0 %}
                  <span class="tw-inline-flex tw-items-center tw-rounded-2xl tw-bg-[#E5E7EA] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-gray-800 tw-ml-1">
                    {{ omr_students|length }}
                  </span>
                {% endif %}
                <template v-if="omrStudentsUnchecked.length > 0">
                  <span class="tw-inline-flex tw-items-center tw-rounded-2xl tw-bg-[#D92D20] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-white tw-ml-1" data-tg-title="Pendências de alunos" data-tg-order="4" data-tg-tour="Veja quantos alunos estão com algum tipo de pendência aguardando revisão." data-tg-group="default-omr-upload-detail">
                    #{omrStudentsUnchecked.length}
                  </span>
                </template>
              </span>
            </li>
            {% if object.get_unsolved_discursive_errors and object.status != 5 or object.get_unsolved_errors and object.status != 5 %}
              <li
                class="sm:tw-rounded-lg tw-border tw-border-[#E5E7EA] tw-px-4 sm:tw-px-6 lg:tw-px-8 tw-py-5 tw-cursor-pointer"
                :class="[activeTab === 'reading-errors' ? 'tw-bg-white tw--mb-px' : 'tw-bg-[#F9FAFA]']"
                style="border-top-left-radius: 0; border-bottom-left-radius: 0; border-bottom-right-radius: 0; border-bottom: 0; border-left: 0;"
                @click="switchTab('reading-errors')"
                data-tg-title="Páginas aguardando revisão" data-tg-order="5" data-tg-tour="Corrijas as páginas que não foram detectadas automaticamente pelo sistema." data-tg-group="default-omr-upload-detail"
              >
                <span
                  id="reading-errors-tab"
                  role="tab"
                  aria-controls="reading-errors"
                  aria-selected="false"
                  class="tw-text-sm tw-px-12"
                  :class="[activeTab === 'reading-errors' ? 'tw-font-semibold tw-text-[#374151]' : 'tw-font-medium tw-text-[#384250]']"
                >
                  Erros de leitura
                  {% if formset|length > 0 %}
                    <span class="tw-inline-flex tw-items-center tw-rounded-2xl tw-bg-[#D92D20] tw-px-2 tw-py-1 tw-text-xs tw-font-medium tw-text-white tw-ml-1">
                      {{ formset|length }}
                    </span>
                  {% endif %}
                </span>
              </li>
            {% endif %}
          </ul>
        </div>
        <div class="tw-flex tw-items-center tw-gap-4">
          <!-- <p class="tw-text-sm tw-font-medium tw-text-[#9BA3AF] tw-whitespace-nowrap">Resultado por página</p>
          <select class="tw-block tw-w-20 tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
            <option>10</option>
            <option>20</option>
            <option>30</option>
          </select>
          <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Pesquisar"> -->
        </div>
      </div>
      <div id="myTabContent">
        <div
          id="list-of-students"
          role="tabpanel"
          aria-labelledby="list-of-students-tab"
          :style="{display: activeTab === 'list-of-students' ? 'block' : 'none'}"
        >
          <div class="tw-bg-white sm:tw-rounded-lg tw-py-6 tw-border tw-border-[#E5E7EA] tw-mb-8" style="border-top-left-radius: 0;">
            <div class="tw-px-4 sm:tw-px-6" >
              <div class="tw-flex tw-justify-between">
                <table id="table-uploadstudents" class="tw-min-w-full tw-divide-y tw-divide-[#E5E7EA]">
                  <thead>
                    <tr>
                      <th scope="col" class="tw-py-3.5 tw-pl-4 tw-pr-3 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Nome</th>
                      <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Prova</th>
                      <th scope="col" class="tw-px-3 tw-py-3.5 tw-text-left tw-text-sm tw-font-semibold tw-text-gray-900">Lidas/Corrigidas/Total</th>
                      <th scope="col" class="tw-relative tw-py-3.5 tw-pl-3 tw-pr-4">
                        <span class="tw-sr-only">Ações</span>
                      </th>
                    </tr>
                  </thead>
                  <tbody class="tw-divide-y tw-divide-gray-200 tw-bg-white">
                    {% for omr_student in omr_students %}
                      {% with omr_student.count_questions as questions_count %}
                        {% with omr_student.application_student.total_answered_questions as answered_questions_count %}
                          <tr data-trchecked="{{ omr_student.id }}" class="{% if answered_questions_count < questions_count and not omr_student.checked %}tw-bg-[#fef2e8]{% endif %}">
                            <td class="tw-whitespace-nowrap tw-py-5 tw-pl-4 tw-pr-3 tw-text-sm">
                              <div class="tw-flex tw-flex-col tw-justify-center">
                                <div class="tw-font-medium tw-text-gray-900">
                                  {{ omr_student.application_student.student.name }}
                                </div>
                                <div class="tw-mt-1 tw-text-gray-500">
                                  {{ omr_student.application_student.student.enrollment_number }}
                                </div>

                                {% comment %}
                                {% if omr_student.checked %}
                                  <p class="m-0 p-0 text-muted font-weight-bold">Checado por: {{omr_student.checked_by}} <span class="fas fa-clock" style="cursor: pointer;" data-toggle="modal" data-target="#historicalModal" @click="uploadGetHistorical('{{omr_student.id}}')"></span></p>
                                {% elif not omr_student.checked is None and not omr_student.checked %}
                                  <p class="m-0 p-0 text-muted font-weight-bold">{{omr_student.checked_by}} removeu o checado. <span class="fas fa-clock" style="cursor: pointer;" data-toggle="modal" data-target="#historicalModal" @click="uploadGetHistorical('{{omr_student.id}}')"></span></p>
                                {% endif %}
                                {% endcomment %}

                                {% if omr_student.checked %}
                                  <div class="tw-mt-1 tw-flex tw-items-center tw-gap-x-1.5 tw-cursor-pointer" data-toggle="modal" data-target="#historicalModal" @click="uploadGetHistorical('{{ omr_student.id }}')" data-check-label="{{ omr_student.id }}">
                                    <div class="tw-flex-none tw-rounded-full tw-bg-emerald-500/20 tw-p-1">
                                      <div class="tw-h-1.5 tw-w-1.5 tw-rounded-full tw-bg-emerald-500"></div>
                                    </div>
                                    <p class="tw-text-xs tw-leading-5 tw-text-gray-500">
                                      Checado por: {{ omr_student.checked_by }}.
                                    </p>
                                  </div>
                                {% elif not omr_student.checked is None and not omr_student.checked %}
                                  <div class="tw-mt-1 tw-flex tw-items-center tw-gap-x-1.5 tw-cursor-pointer" data-toggle="modal" data-target="#historicalModal" @click="uploadGetHistorical('{{ omr_student.id }}')" data-check-label="{{ omr_student.id }}">
                                    <div class="tw-flex-none tw-rounded-full tw-bg-rose-500/20 tw-p-1">
                                      <div class="tw-h-1.5 tw-w-1.5 tw-rounded-full tw-bg-rose-500"></div>
                                    </div>
                                    <p class="tw-text-xs tw-leading-5 tw-text-gray-500">
                                      Checado removido por: {{ omr_student.checked_by }}.
                                    </p>
                                  </div>
                                {% endif %}
                              </div>
                            </td>
                            <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-[#101928]">
                              {{ omr_student.application_student.application.exam }}
                            </td>
                            <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-gray-500">
                              {{ answered_questions_count|sub:omr_student.application_student.total_corrected_answers }} / {{ omr_student.application_student.total_corrected_answers }} / {{ questions_count }}
                            </td>
                            <td class="tw-relative tw-whitespace-nowrap tw-py-5 tw-pl-3 tw-pr-4 tw-text-right tw-text-sm tw-font-medium">
                              <div class="tw-flex tw-items-center tw-justify-end tw-gap-6">
                                <button class="tw-inline-flex tw-justify-center tw-gap-x-1.5 tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-[#667085] tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50" type="button" id="dropdownMenuButton-{{ omr_student.id }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  Opções
                                  <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                                  </svg>
                                </button>
                                <div class="dropdown-menu dropdown-menu-right tw-absolute tw-right-0 tw-z-10 tw-mt-2 tw-origin-top-right tw-rounded-md tw-bg-white tw-shadow-lg tw-ring-1 tw-ring-black tw-ring-opacity-5 focus:tw-outline-none tw-text-inherit tw-m-0 tw-p-0 tw-border-0" aria-labelledby="dropdownMenuButton-{{ omr_student.id }}" style="font-size: inherit;">
                                  <div class="tw-divide-y tw-divide-gray-100">
                                    {% if user|has_perm:'exams.can_correct_answers_exam' %}
                                      <div class="tw-py-1" role="none">
                                        <a href="{% url 'exams:exams_detail_v2' pk=omr_student.application_student.application.exam.pk %}?turma={{ omr_student.application_student.get_last_class_student.pk }}#{{ omr_student.application_student.pk }}" class="tw-text-gray-700 tw-flex tw-w-full tw-gap-2 tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" role="menuitem" tabindex="-1" id="menu-item-0">
                                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                            <path d="M17.9995 13L10.9995 6.00004M20.9995 21H7.99955M10.9368 20.0628L19.6054 11.3941C20.7935 10.2061 21.3875 9.61207 21.6101 8.92709C21.8058 8.32456 21.8058 7.67551 21.6101 7.07298C21.3875 6.388 20.7935 5.79397 19.6054 4.60592L19.3937 4.39415C18.2056 3.2061 17.6116 2.61207 16.9266 2.38951C16.3241 2.19373 15.675 2.19373 15.0725 2.38951C14.3875 2.61207 13.7935 3.2061 12.6054 4.39415L4.39366 12.6059C3.20561 13.794 2.61158 14.388 2.38902 15.073C2.19324 15.6755 2.19324 16.3246 2.38902 16.9271C2.61158 17.6121 3.20561 18.2061 4.39366 19.3941L5.06229 20.0628C5.40819 20.4087 5.58114 20.5816 5.78298 20.7053C5.96192 20.815 6.15701 20.8958 6.36108 20.9448C6.59126 21 6.83585 21 7.32503 21H8.67406C9.16324 21 9.40784 21 9.63801 20.9448C9.84208 20.8958 10.0372 20.815 10.2161 20.7053C10.418 20.5816 10.5909 20.4087 10.9368 20.0628Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          </svg>
                                          Correção de respostas
                                        </a>
                                      </div>
                                      <div class="tw-py-1" role="none">
                                        <button
                                          type="button"
                                          class="tw-text-gray-700 tw-flex tw-w-full tw-gap-2 tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900"
                                          role="menuitem"
                                          tabindex="-1"
                                          id="menu-item-1"
                                          title="Zerar prova do aluno"
                                          @click="clearApplicationStudent({
                                            omrID: '{{ omr_student.id }}',
                                            id: '{{ omr_student.application_student.id }}',
                                            student_name: '{{ omr_student.application_student.student.name|escape_single_quotes }}',
                                          })"
                                        >
                                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                            <path d="M10.5 5.14185C10.991 5.04813 11.493 5 12 5C14.1217 5 16.1566 5.84285 17.6569 7.34315C19.1571 8.84344 20 10.8783 20 13C20 13.507 19.9519 14.009 19.8582 14.5M18.1356 18.1337C17.9844 18.3144 17.8247 18.489 17.6569 18.6569C16.1566 20.1571 14.1217 21 12 21C9.87827 21 7.84344 20.1571 6.34315 18.6569C4.84285 17.1566 4 15.1217 4 13C4 10.8783 4.84285 8.84344 6.34315 7.34315C6.50948 7.17682 6.68238 7.01857 6.86123 6.86865M21 21L3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          </svg>
                                          Zerar prova
                                        </button>
                                        <button
                                          type="button"
                                          class="tw-text-gray-700 tw-flex tw-w-full tw-gap-2 tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900"
                                          role="menuitem"
                                          tabindex="-1"
                                          id="menu-item-2"
                                          title="O aluno faltou"
                                          @click="clearApplicationStudent(
                                            {
                                              omrID: '{{ omr_student.id }}',
                                              id: '{{ omr_student.application_student.id }}',
                                              student_name: '{{ omr_student.application_student.student.name|escape_single_quotes }}',
                                            },
                                            {{ omr_student.application_student.missed|lower }}
                                          )"
                                        >
                                          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                                            <path d="M9 9L15 15M15 9L9 15M7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C18.7202 3 17.8802 3 16.2 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                          </svg>
                                          {% if omr_student.application_student.missed %}
                                            Remover falta
                                          {% else %}
                                            Marcar falta
                                          {% endif %}
                                        </button>
                                      </div>
                                    {% endif %}
                                    <div class="tw-py-1" role="none" v-if="getFilesUrls('{{ omr_student.pk }}', 'discursive').length">
                                      <a href="javascript:;" @click.prevent="showDiscursiveScansModal('{{ omr_student.pk }}')" v-if="getFilesUrls('{{ omr_student.pk }}', 'discursive').length" target="_blank" class="tw-text-gray-700 tw-flex tw-w-full tw-gap-2 tw-items-center tw-px-4 tw-py-2 tw-text-sm hover:tw-bg-gray-100 hover:tw-text-gray-900" data-toggle="tooltip" title="Ver folha de respostas discursivas escaneadas" role="menuitem" tabindex="-1" id="menu-item-3">
                                        <i class="far fa-file-image"></i> Ver folhas de respostas discursivas  
                                      </a>
                                    </div>
                                  </div>
                                </div>
                                <button
                                  v-if="getFilesUrls('{{omr_student.pk}}').length"
                                  type="button"
                                  class="tw-flex tw-items-center tw-justify-center tw-w-10 tw-h-10 tw-rounded-full tw-bg-white tw-ring-1 tw-ring-slate-900/10 tw-shadow-sm"
                                  @click="showDraggingResizingWindow(getFilesUrls('{{omr_student.pk}}').at(getFilesUrls('{{omr_student.pk}}').length - 1))"
                                >
                                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                                    <path d="M14 11H8M10 15H8M16 7H8M20 10.5V6.8C20 5.11984 20 4.27976 19.673 3.63803C19.3854 3.07354 18.9265 2.6146 18.362 2.32698C17.7202 2 16.8802 2 15.2 2H8.8C7.11984 2 6.27976 2 5.63803 2.32698C5.07354 2.6146 4.6146 3.07354 4.32698 3.63803C4 4.27976 4 5.11984 4 6.8V17.2C4 18.8802 4 19.7202 4.32698 20.362C4.6146 20.9265 5.07354 21.3854 5.63803 21.673C6.27976 22 7.11984 22 8.8 22H11.5M22 22L20.5 20.5M21.5 18C21.5 19.933 19.933 21.5 18 21.5C16.067 21.5 14.5 19.933 14.5 18C14.5 16.067 16.067 14.5 18 14.5C19.933 14.5 21.5 16.067 21.5 18Z" stroke="#0C7BDB" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                  </svg>
                                </button>
                                <span class="tw-sr-only">{{ omr_student.checked }}</span>
                                {% if omr_student.checked or answered_questions_count < questions_count %}
                                  <button type="button" class="tw-flex tw-items-center tw-justify-center tw-w-10 tw-h-10 tw-rounded-full {% if omr_student.checked %}tw-bg-[#41C588]{% elif answered_questions_count < questions_count %}tw-bg-[#E5E7EA]{% endif %}" data-check="{{ omr_student.id }}" @click="uploadCheck('{{ omr_student.id }}')" title="{% if omr_student.checked %}Remover checado.{% elif answered_questions_count < questions_count %}Marcar como checado.{% endif %}">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                      <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                  </button>
                                {% endif %}
                              </div>
                            </td>
                          </tr>
                        {% endwith %}
                      {% endwith %}
                    {% empty %}
                      <tr>
                        <td colspan="4">
                          <p class="tw-text-gray-900 tw-font-semibold tw-py-4">Nenhuma folha de resposta lida</p>
                        </td>
                      </tr>
                    {% endfor %}

                    <!-- <tr>
                      <td class="tw-px-3 tw-py-5">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M12 16V12M12 8H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="#FFCB56" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </td>
                      <td class="tw-whitespace-nowrap tw-py-5 tw-pl-4 tw-pr-3 tw-text-sm sm:tw-pl-0">
                        <div class="tw-flex tw-flex-col tw-justify-center">
                          <div class="tw-font-medium tw-text-gray-900">Adam Diniz Schott</div>
                          <div class="tw-mt-1 tw-text-gray-500">22197992</div>
                        </div>
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-[#101928]">
                        1ª série - RECUPERAÇÃO (1º TRIMESTRE) - ART E LIT - OBJ/DISC
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-gray-500">
                        16 / 0 / 18
                      </td>
                      <td class="tw-relative tw-whitespace-nowrap tw-py-5 tw-pl-3 tw-pr-4 tw-text-right tw-text-sm tw-font-medium sm:tw-pr-0">
                        <div class="tw-flex tw-items-center tw-gap-6">
                          <button class="tw-inline-flex tw-justify-center tw-gap-x-1.5 tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-[#667085] tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50" type="button" id="dropdownMenuButton-0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Opções
                            <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                            </svg>
                          </button>
                          <button type="button">
                            <div class="tw-flex tw-items-center tw-justify-center tw-w-10 tw-h-10 tw-rounded-full tw-bg-[#41C588]">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                          </button>
                        </div>
                      </td>
                    </tr> -->
                    <!-- <tr>
                      <td class="tw-px-3 tw-py-5">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </td>
                      <td class="tw-whitespace-nowrap tw-py-5 tw-pl-4 tw-pr-3 tw-text-sm sm:tw-pl-0">
                        <div class="tw-flex tw-flex-col tw-justify-center">
                          <div class="tw-font-medium tw-text-gray-900">Adam Diniz Schott</div>
                          <div class="tw-mt-1 tw-text-gray-500">22197992</div>
                        </div>
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-[#101928]">
                        1ª série - RECUPERAÇÃO (1º TRIMESTRE) - ART E LIT - OBJ/DISC
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-gray-500">
                        16 / 0 / 18
                      </td>
                      <td class="tw-relative tw-whitespace-nowrap tw-py-5 tw-pl-3 tw-pr-4 tw-text-right tw-text-sm tw-font-medium sm:tw-pr-0">
                        <div class="tw-flex tw-items-center tw-gap-6">
                          <button class="tw-inline-flex tw-justify-center tw-gap-x-1.5 tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-[#667085] tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50" type="button" id="dropdownMenuButton-0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Opções
                            <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                            </svg>
                          </button>
                          <button type="button">
                            <div class="tw-flex tw-items-center tw-justify-center tw-w-10 tw-h-10 tw-rounded-full tw-bg-[#E5E7EA]">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                          </button>
                        </div>
                      </td>
                    </tr> -->
                    <!-- <tr>
                      <td class="tw-px-3 tw-py-5">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M12 16V12M12 8H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="#FFCB56" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </td>
                      <td class="tw-whitespace-nowrap tw-py-5 tw-pl-4 tw-pr-3 tw-text-sm sm:tw-pl-0">
                        <div class="tw-flex tw-flex-col tw-justify-center">
                          <div class="tw-font-medium tw-text-gray-900">Adam Diniz Schott</div>
                          <div class="tw-mt-1 tw-text-gray-500">22197992</div>
                        </div>
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-[#101928]">
                        1ª série - RECUPERAÇÃO (1º TRIMESTRE) - ART E LIT - OBJ/DISC
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-gray-500">
                        16 / 0 / 18
                      </td>
                      <td class="tw-relative tw-whitespace-nowrap tw-py-5 tw-pl-3 tw-pr-4 tw-text-right tw-text-sm tw-font-medium sm:tw-pr-0">
                        <div class="tw-flex tw-items-center tw-gap-6">
                          <button class="tw-inline-flex tw-justify-center tw-gap-x-1.5 tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-[#667085] tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50" type="button" id="dropdownMenuButton-0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Opções
                            <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                            </svg>
                          </button>
                          <button type="button">
                            <div class="tw-flex tw-items-center tw-justify-center tw-w-10 tw-h-10 tw-rounded-full tw-bg-[#41C588]">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                          </button>
                        </div>
                      </td>
                    </tr> -->
                    <!-- <tr>
                      <td class="tw-px-3 tw-py-5">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="#41C588" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </td>
                      <td class="tw-whitespace-nowrap tw-py-5 tw-pl-4 tw-pr-3 tw-text-sm sm:tw-pl-0">
                        <div class="tw-flex tw-flex-col tw-justify-center">
                          <div class="tw-font-medium tw-text-gray-900">Adam Diniz Schott</div>
                          <div class="tw-mt-1 tw-text-gray-500">22197992</div>
                        </div>
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-[#101928]">
                        1ª série - RECUPERAÇÃO (1º TRIMESTRE) - ART E LIT - OBJ/DISC
                      </td>
                      <td class="tw-whitespace-nowrap tw-px-3 tw-py-5 tw-text-sm tw-text-gray-500">
                        16 / 0 / 18
                      </td>
                      <td class="tw-relative tw-whitespace-nowrap tw-py-5 tw-pl-3 tw-pr-4 tw-text-right tw-text-sm tw-font-medium sm:tw-pr-0">
                        <div class="tw-flex tw-items-center tw-gap-6">
                          <button class="tw-inline-flex tw-justify-center tw-gap-x-1.5 tw-rounded-md tw-bg-white tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-[#667085] tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 hover:tw-bg-gray-50" type="button" id="dropdownMenuButton-0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            Opções
                            <svg class="tw--mr-1 tw-h-5 tw-w-5 tw-text-primary-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                              <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                            </svg>
                          </button>
                          <button type="button">
                            <div class="tw-flex tw-items-center tw-justify-center tw-w-10 tw-h-10 tw-rounded-full tw-bg-[#E5E7EA]">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </div>
                          </button>
                        </div>
                      </td>
                    </tr> -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div
          id="reading-errors"
          role="tabpanel"
          aria-labelledby="reading-errors-tab"
          :style="{display: activeTab === 'reading-errors' ? 'block' : 'none'}"
        >
          <div class="tw-bg-white sm:tw-rounded-lg tw-pt-6 tw-pb-8 tw-px-8 tw-border tw-border-[#E5E7EA]" style="border-top-left-radius: 0;">
            {% if object.get_unsolved_discursive_errors and object.status != 5 %}
              <form method="POST" action="{% url 'omr:omr_discursive_upload_fix' pk=object.pk %}">
                {% csrf_token %}
                {{ formset_discursive.management_form }}
                <table class="table">
                  <thead>
                    <tr>
                      <th>Problema</th>
                      <th>Gabarito</th>
                      <th>Questão</th>
                      <th>Arquivo</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for form in formset_discursive %}
                      {{ form.omr_error.as_hidden }}
                      {{ form.application_student.as_hidden }}
                      <tr>
                        <td>{{ form.category_description.value }}</td>
                        <td>
                          {% render_field form.omr_category class="form-control" %}
                        </td>
                        <td>
                          <select
                            name="{{ form.exam_question.html_name }}"
                            id="{{ form.exam_question.id_for_label }}"
                            class="form-control formset-select"
                          >
                            <option value="" selected="selected">Selecione a questão da prova...</option>
                            {% for exam_question in form.exam_question.field.queryset %}
                              {% if exam_question.randomized_print_number %}
                                <option value="{{ exam_question.pk }}">Questão {{ exam_question.randomized_print_number }}</option>
                              {% else %}
                                <option value="{{ exam_question.pk }}">Questão {{ exam_question.exam_question_number }}</option>
                              {% endif %}
                            {% endfor %}
                          </select>
                        </td>
                        <td>
                          {% if form.error_image %}
                            <a href="{{ form.error_image.value|cdn_url }}" target="_blank" rel="noopener noreferrer" data-toggle="tooltip" title="Ver folha de respostas escaneada">
                              <i class="far fa-file-image"></i>
                            </a>
                          {% endif %}
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
                <button type="submit" class="btn btn-primary float-right m-3">Corrigir erros</button>
              </form>
            {% endif %}

            {% if object.get_unsolved_errors and object.status != 5 %}
              <form method="POST" action="{% url 'omr:omr_upload_fix' pk=object.pk %}?v=2">
                {% csrf_token %}
                <!-- {{ formset.errors }} -->
                <!-- {{ formset.non_field_errors }} -->
                {{ formset.management_form }}
                <div>
                  <div class="tw-grid tw-grid-cols-12 tw-gap-4 tw-mb-4">
                    <p class="tw-text-sm tw-font-semibold tw-text-[#374151] tw-col-span-2">Problema</p>
                    <p class="tw-text-sm tw-font-semibold tw-text-[#374151]">Página</p>
                    <p class="tw-text-sm tw-font-semibold tw-text-[#374151] tw-col-span-2">Gabarito</p>
                    <p class="tw-text-sm tw-font-semibold tw-text-[#374151]">Versão</p>
                    <p class="tw-text-sm tw-font-semibold tw-text-[#374151] tw-col-span-2">Aluno</p>
                    <p class="tw-text-sm tw-font-semibold tw-text-[#374151] tw-col-span-2">Aplicação</p>
                    <p class="tw-text-sm tw-font-semibold tw-text-[#374151] tw-col-span-2">Ações</p>
                  </div>
                  <div class="tw-flex tw-flex-col tw-gap-2 tw-pb-6">
                    {% for form in formset %}
                      <!-- {{ form.errors }} -->
                      <!-- {{ form.non_field_errors }} -->
                      {{ form.omr_error.as_hidden }}
                      {{ form.category_description.as_hidden }}
                      {{ form.page_number.as_hidden }}
                      <div id="{{ form.omr_error.value }}" class="tw-grid tw-grid-cols-12 tw-gap-4 tw-bg-white tw-rounded-2xl tw-border tw-border-[#E5E7EA] tw-px-6 tw-py-5">
                        <div class="tw-flex tw-items-center tw-col-span-2">
                          {{ form.category_description.value }}
                        </div>
                        <div class="tw-flex tw-items-center tw-text-[#9BA3AF]">
                          {{ form.page_number.value }}
                        </div>
                        <div class="tw-flex tw-items-center tw-col-span-2">
                          {% render_field form.omr_category class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" %}
                        </div>
                        <div class="tw-flex tw-items-center">
                          {% render_field form.randomization_version class="tw-block tw-w-20 tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 formset-select" style="max-width: 80px;" required="required" %}
                        </div>
                        <div class="tw-flex tw-items-center tw-col-span-2">
                          <select
                            name="{{ form.student.html_name }}"
                            id="{{ form.student.id_for_label }}"
                            class="tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 student-formset formset-select"
                            style="width: 100%;"
                          >
                            {% if form.student.initial %}
                              <option value="{{ form.student.initial.pk }}" selected="selected">{{ form.student.initial }}</option>
                            {% endif %}
                          </select>
                        </div>
                        <div class="tw-flex tw-items-center tw-col-span-2">
                          <select
                            name="{{ form.application.html_name }}"
                            id="{{ form.application.id_for_label }}"
                            class="tw-block tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6 application-formset formset-select"
                            style="width: 100%;"
                          >
                            {% if form.application.initial %}
                              <option value="{{ form.application.initial.pk }}" selected="selected">{{ form.application.initial.exam.name }}</option>
                            {% endif %}
                          </select>
                        </div>
                        <div class="tw-flex tw-items-center tw-gap-2 tw-col-span-2">
                          {% if forloop.counter0 == 0 %}
                            <a href="#" id="copy-application" data-toggle="tooltip" title="Copiar aplicação para campos abaixo">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M12.8 21H9.7C8.57989 21 8.01984 21 7.59202 20.782C7.21569 20.5903 6.90973 20.2843 6.71799 19.908C6.5 19.4802 6.5 18.9201 6.5 17.8V9.7C6.5 8.57989 6.5 8.01984 6.71799 7.59202C6.90973 7.21569 7.21569 6.90973 7.59202 6.71799C8.01984 6.5 8.57989 6.5 9.7 6.5H17.8C18.9201 6.5 19.4802 6.5 19.908 6.71799C20.2843 6.90973 20.5903 7.21569 20.782 7.59202C21 8.01984 21 8.57989 21 9.7V14.8M16.5 3H9.4C7.15979 3 6.03969 3 5.18404 3.43597C4.43139 3.81947 3.81947 4.43139 3.43597 5.18404C3 6.03969 3 7.15979 3 9.4V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M15 19L18 22M18 22L21 19M18 22V16" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </a>
                          {% endif %}
                          {% if form.error_image %}
                            <a href="{{ form.error_image.value|cdn_url }}" target="_blank" rel="noopener noreferrer" data-toggle="tooltip" title="Ver folha de respostas escaneada">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M6 10V4.5C6 3.67157 6.67157 3 7.5 3C8.32843 3 9 3.67157 9 4.5V10C9 11.6569 7.65685 13 6 13C4.34315 13 3 11.6569 3 10V6M12.5 2H15.2C16.8802 2 17.7202 2 18.362 2.32698C18.9265 2.6146 19.3854 3.07354 19.673 3.63803C20 4.27976 20 5.11984 20 6.8V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </a>
                            <button type="button" @click="selectedError = 'formset-{{ forloop.counter }}', startMovableWindow('{{ form.error_image.value|cdn_url }}')" data-toggle="tooltip" title="Ver folha de respostas escaneada">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </button>
                          {% endif %}
                          <template v-if="loadingErrorDelete">
                            <button type="button">
                              <svg class="tw-animate-spin tw-h-5 tw-w-5 tw-text-white" fill="none" viewBox="0 0 24 24">
                                <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                              </svg>
                            </button>
                          </template>
                          <template v-else>
                            <button type="button" data-toggle="tooltip" title="Deletar este erro" @click="deleteError('{{form.omr_error.value}}')">
                              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M16 6V5.2C16 4.0799 16 3.51984 15.782 3.09202C15.5903 2.71569 15.2843 2.40973 14.908 2.21799C14.4802 2 13.9201 2 12.8 2H11.2C10.0799 2 9.51984 2 9.09202 2.21799C8.71569 2.40973 8.40973 2.71569 8.21799 3.09202C8 3.51984 8 4.0799 8 5.2V6M10 11.5V16.5M14 11.5V16.5M3 6H21M19 6V17.2C19 18.8802 19 19.7202 18.673 20.362C18.3854 20.9265 17.9265 21.3854 17.362 21.673C16.7202 22 15.8802 22 14.2 22H9.8C8.11984 22 7.27976 22 6.63803 21.673C6.07354 21.3854 5.6146 20.9265 5.32698 20.362C5 19.7202 5 18.8802 5 17.2V6" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                              </svg>
                            </button>
                          </template>
                        </div>
                      </div>
                    {% endfor %}

                    <!-- <div class="tw-grid tw-grid-cols-7 tw-bg-white tw-rounded-2xl tw-border tw-border-[#E5E7EA] tw-px-6 tw-py-5">
                      <div class="tw-flex tw-items-center">
                        QRCode não identificado
                      </div>
                      <div class="tw-flex tw-items-center tw-text-[#9BA3AF]">14</div>
                      <div class="tw-flex tw-items-center">
                        <select class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                          <option value="0" selected>Selecione</option>
                          <option value="1">1</option>
                        </select>
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="number" class="tw-block tw-w-20 tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" value="20">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pelo aluno">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pela aplicação">
                      </div>
                      <div class="tw-flex tw-items-center tw-gap-1">
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12.8 21H9.7C8.57989 21 8.01984 21 7.59202 20.782C7.21569 20.5903 6.90973 20.2843 6.71799 19.908C6.5 19.4802 6.5 18.9201 6.5 17.8V9.7C6.5 8.57989 6.5 8.01984 6.71799 7.59202C6.90973 7.21569 7.21569 6.90973 7.59202 6.71799C8.01984 6.5 8.57989 6.5 9.7 6.5H17.8C18.9201 6.5 19.4802 6.5 19.908 6.71799C20.2843 6.90973 20.5903 7.21569 20.782 7.59202C21 8.01984 21 8.57989 21 9.7V14.8M16.5 3H9.4C7.15979 3 6.03969 3 5.18404 3.43597C4.43139 3.81947 3.81947 4.43139 3.43597 5.18404C3 6.03969 3 7.15979 3 9.4V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M15 19L18 22M18 22L21 19M18 22V16" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M6 10V4.5C6 3.67157 6.67157 3 7.5 3C8.32843 3 9 3.67157 9 4.5V10C9 11.6569 7.65685 13 6 13C4.34315 13 3 11.6569 3 10V6M12.5 2H15.2C16.8802 2 17.7202 2 18.362 2.32698C18.9265 2.6146 19.3854 3.07354 19.673 3.63803C20 4.27976 20 5.11984 20 6.8V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div> -->
                    <!-- <div class="tw-grid tw-grid-cols-7 tw-bg-white tw-rounded-2xl tw-border tw-border-[#E5E7EA] tw-px-6 tw-py-5">
                      <div class="tw-flex tw-items-center">
                        QRCode não identificado
                      </div>
                      <div class="tw-flex tw-items-center tw-text-[#9BA3AF]">14</div>
                      <div class="tw-flex tw-items-center">
                        <select class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                          <option value="0" selected>Selecione</option>
                          <option value="1">1</option>
                        </select>
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="number" class="tw-block tw-w-20 tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" value="20">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pelo aluno">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pela aplicação">
                      </div>
                      <div class="tw-flex tw-items-center tw-gap-1">
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12.8 21H9.7C8.57989 21 8.01984 21 7.59202 20.782C7.21569 20.5903 6.90973 20.2843 6.71799 19.908C6.5 19.4802 6.5 18.9201 6.5 17.8V9.7C6.5 8.57989 6.5 8.01984 6.71799 7.59202C6.90973 7.21569 7.21569 6.90973 7.59202 6.71799C8.01984 6.5 8.57989 6.5 9.7 6.5H17.8C18.9201 6.5 19.4802 6.5 19.908 6.71799C20.2843 6.90973 20.5903 7.21569 20.782 7.59202C21 8.01984 21 8.57989 21 9.7V14.8M16.5 3H9.4C7.15979 3 6.03969 3 5.18404 3.43597C4.43139 3.81947 3.81947 4.43139 3.43597 5.18404C3 6.03969 3 7.15979 3 9.4V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M15 19L18 22M18 22L21 19M18 22V16" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M6 10V4.5C6 3.67157 6.67157 3 7.5 3C8.32843 3 9 3.67157 9 4.5V10C9 11.6569 7.65685 13 6 13C4.34315 13 3 11.6569 3 10V6M12.5 2H15.2C16.8802 2 17.7202 2 18.362 2.32698C18.9265 2.6146 19.3854 3.07354 19.673 3.63803C20 4.27976 20 5.11984 20 6.8V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div> -->
                    <!-- <div class="tw-grid tw-grid-cols-7 tw-bg-white tw-rounded-2xl tw-border tw-border-[#E5E7EA] tw-px-6 tw-py-5">
                      <div class="tw-flex tw-items-center">
                        QRCode não identificado
                      </div>
                      <div class="tw-flex tw-items-center tw-text-[#9BA3AF]">14</div>
                      <div class="tw-flex tw-items-center">
                        <select class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                          <option value="0" selected>Selecione</option>
                          <option value="1">1</option>
                        </select>
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="number" class="tw-block tw-w-20 tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" value="20">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pelo aluno">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pela aplicação">
                      </div>
                      <div class="tw-flex tw-items-center tw-gap-1">
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12.8 21H9.7C8.57989 21 8.01984 21 7.59202 20.782C7.21569 20.5903 6.90973 20.2843 6.71799 19.908C6.5 19.4802 6.5 18.9201 6.5 17.8V9.7C6.5 8.57989 6.5 8.01984 6.71799 7.59202C6.90973 7.21569 7.21569 6.90973 7.59202 6.71799C8.01984 6.5 8.57989 6.5 9.7 6.5H17.8C18.9201 6.5 19.4802 6.5 19.908 6.71799C20.2843 6.90973 20.5903 7.21569 20.782 7.59202C21 8.01984 21 8.57989 21 9.7V14.8M16.5 3H9.4C7.15979 3 6.03969 3 5.18404 3.43597C4.43139 3.81947 3.81947 4.43139 3.43597 5.18404C3 6.03969 3 7.15979 3 9.4V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M15 19L18 22M18 22L21 19M18 22V16" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M6 10V4.5C6 3.67157 6.67157 3 7.5 3C8.32843 3 9 3.67157 9 4.5V10C9 11.6569 7.65685 13 6 13C4.34315 13 3 11.6569 3 10V6M12.5 2H15.2C16.8802 2 17.7202 2 18.362 2.32698C18.9265 2.6146 19.3854 3.07354 19.673 3.63803C20 4.27976 20 5.11984 20 6.8V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div> -->
                    <!-- <div class="tw-grid tw-grid-cols-7 tw-bg-white tw-rounded-2xl tw-border tw-border-[#E5E7EA] tw-px-6 tw-py-5">
                      <div class="tw-flex tw-items-center">
                        QRCode não identificado
                      </div>
                      <div class="tw-flex tw-items-center tw-text-[#9BA3AF]">14</div>
                      <div class="tw-flex tw-items-center">
                        <select class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6">
                          <option value="0" selected>Selecione</option>
                          <option value="1">1</option>
                        </select>
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="number" class="tw-block tw-w-20 tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" value="20">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pelo aluno">
                      </div>
                      <div class="tw-flex tw-items-center">
                        <input type="text" class="tw-block tw-w-full tw-rounded-md tw-border-0 tw-py-1.5 tw-text-gray-900 tw-shadow-sm tw-ring-1 tw-ring-inset tw-ring-gray-300 placeholder:tw-text-gray-400 focus:tw-ring-2 focus:tw-ring-inset focus:tw-ring-primary-600 sm:tw-text-sm sm:tw-leading-6" placeholder="Busque pela aplicação">
                      </div>
                      <div class="tw-flex tw-items-center tw-gap-1">
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M12.8 21H9.7C8.57989 21 8.01984 21 7.59202 20.782C7.21569 20.5903 6.90973 20.2843 6.71799 19.908C6.5 19.4802 6.5 18.9201 6.5 17.8V9.7C6.5 8.57989 6.5 8.01984 6.71799 7.59202C6.90973 7.21569 7.21569 6.90973 7.59202 6.71799C8.01984 6.5 8.57989 6.5 9.7 6.5H17.8C18.9201 6.5 19.4802 6.5 19.908 6.71799C20.2843 6.90973 20.5903 7.21569 20.782 7.59202C21 8.01984 21 8.57989 21 9.7V14.8M16.5 3H9.4C7.15979 3 6.03969 3 5.18404 3.43597C4.43139 3.81947 3.81947 4.43139 3.43597 5.18404C3 6.03969 3 7.15979 3 9.4V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M15 19L18 22M18 22L21 19M18 22V16" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M6 10V4.5C6 3.67157 6.67157 3 7.5 3C8.32843 3 9 3.67157 9 4.5V10C9 11.6569 7.65685 13 6 13C4.34315 13 3 11.6569 3 10V6M12.5 2H15.2C16.8802 2 17.7202 2 18.362 2.32698C18.9265 2.6146 19.3854 3.07354 19.673 3.63803C20 4.27976 20 5.11984 20 6.8V17.2C20 18.8802 20 19.7202 19.673 20.362C19.3854 20.9265 18.9265 21.3854 18.362 21.673C17.7202 22 16.8802 22 15.2 22H8.8C7.11984 22 6.27976 22 5.63803 21.673C5.07354 21.3854 4.6146 20.9265 4.32698 20.362C4 19.7202 4 18.8802 4 17.2V16.5" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                        <button type="button">
                          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M2.42012 12.7132C2.28394 12.4975 2.21584 12.3897 2.17772 12.2234C2.14909 12.0985 2.14909 11.9015 2.17772 11.7766C2.21584 11.6103 2.28394 11.5025 2.42012 11.2868C3.54553 9.50484 6.8954 5 12.0004 5C17.1054 5 20.4553 9.50484 21.5807 11.2868C21.7169 11.5025 21.785 11.6103 21.8231 11.7766C21.8517 11.9015 21.8517 12.0985 21.8231 12.2234C21.785 12.3897 21.7169 12.4975 21.5807 12.7132C20.4553 14.4952 17.1054 19 12.0004 19C6.8954 19 3.54553 14.4952 2.42012 12.7132Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M12.0004 15C13.6573 15 15.0004 13.6569 15.0004 12C15.0004 10.3431 13.6573 9 12.0004 9C10.3435 9 9.0004 10.3431 9.0004 12C9.0004 13.6569 10.3435 15 12.0004 15Z" stroke="#FF8F3D" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                        </button>
                      </div>
                    </div> -->
                  </div>
                  <div>
                    <button
                      type="submit"
                      class="tw-inline-flex tw-w-full tw-justify-center tw-rounded-md tw-bg-blue-600 tw-px-3 tw-py-2 tw-text-sm tw-font-semibold tw-text-white tw-shadow-sm hover:tw-bg-blue-500 not-disable"
                    >
                      Corrigir erros
                    </button>
                  </div>
                </div>
              </form>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
{% endblock content-fixed %}

{% block extra-modal %}
  <div class="modal fade" id="historicalModal" tabindex="-1" aria-labelledby="historicalModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="historicalModalLabel">Histórico de alterações</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>Usuário</th>
                <th>Ação</th>
                <th>Data</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="history in historical">
                <td>#{history.checked_by}</td>
                <td>
                  <span class="badge badge-success" v-if="history.checked">Adicionou o checado</span>
                  <span class="badge badge-danger" v-else>Removeu o checado.</span>
                </td>
                <td>#{momentRef(history.history_date).format('LLL')}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="discursiveScans" tabindex="-1" aria-labelledby="discursiveScansLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="discursiveScansLabel">Arquivos escaneados de respostas discursivas</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body h-100">
          <div v-if="selectedStudent">
            <div class="row">
              <template  v-for="(url, index) in selectedStudent.scans.discursive_urls">
                <div @click="startMovableWindow(url)">
                  <div class="col-6 col-lg-3 col-xl mg-t-10">
                    <div class="card card-file">
                      <div class="dropdown-file"></div>
                      <div class="card-file-thumb tx-pink">
                        <i class="far fa-file-pdf"></i>
                      </div>
                      <div class="card-body">
                        <h6>
                          <a href="javascript:;" class="link-02">Folha escaneada #{index+1}</a>
                        </h6>
                      </div>
                    </div>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>
{% endblock extra-modal %}

{% block off-canvas %}
  <div id="right-off-canvas" class="off-canvas off-canvas-right wd-400 bg-white" style="overflow-y: auto; overflow-x: hidden;">
    <form action="" method="GET">
      <div class="row p-3">
        <div class="col-12">
          <h5>Filtrar gabaritos</h5>
          <p>Adiciona abaixo os filtros que você deseja aplicar na listagem abaixo</p>
          <hr />
        </div>
        <div class="col-12">
          <div class="form-group mb-3">
            <label for="exam_id" class="mb-1">Nome da prova</label>
            <input type="text" value="{{q_exam}}" id="exam_id" name="q_exam" class="form-control" placeholder="Digite o nome da prova">
          </div>
        </div>
        <div class="col-12">
          <div class="form-group mb-3">
            <label for="filename" class="mb-1">Nome do arquivo enviado</label>
            <input type="text" value="{{q_filename}}" id="filename" name="q_filename" class="form-control" placeholder="Digite o nome do arquivo">
          </div>
        </div>
        <div class="col-12">
          <div class="form-group mb-3">
            <label for="exam_id" class="mb-1">Status do Upload</label>
            <select class="form-control" name="q_status" id="omr_status_id">
              <option value="all" {% if q_status == "all" %}selected{%endif%}>Todos os status</option>
              <option value="0" {% if q_status == "0" %}selected{%endif%}>Em fila</option>
              <option value="1" {% if q_status == "1" %}selected{%endif%}>Processando</option>
              <option value="2" {% if q_status == "2" %}selected{%endif%}>Finalizado</option>
              <option value="3" {% if q_status == "3" %}selected{%endif%}>Erro</option>
              <option value="4" {% if q_status == "4" %}selected{%endif%}>Desconhecido</option>
              <option value="5" {% if q_status == "5" %}selected{%endif%}>Reprocessando</option>
            </select>
          </div>
        </div>
        <div class="col-6">
          <div class="form-group mb-3">
            <label for="initial_date" class="mb-1">Data Inicial</label>
            <input type="date" value="{{q_initial_date}}" id="initial_date" name="q_initial_date" class="form-control">
          </div>
        </div>
        <div class="col-6">
          <div class="form-group mb-3">
            <label for="final_date" class="mb-1">Data Final</label>
            <input type="date" value="{{q_final_date}}" id="final_date" name="q_final_date" class="form-control">
          </div>
        </div>
        <div class="col-12">
          <div class="form-group mb-3">
            <label for="classe_id" class="mb-1">Turmas</label>
            <select name="q_classes" id="classe_id" class="form-control" multiple="multiple">
              {% for classe in classes %}
              <option value="{{classe.pk}}" {% if classe.pk|stringformat:'s' in q_classes %}selected="selected" {% endif %}>
                {{classe}}
              </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="col-12">
          <div class="form-group mb-3">
            <label for="grade_id" class="mb-1">Séries</label>
            <select name="q_grades" id="grade_id" class="form-control" multiple="multiple">
              {% for grade in grades %}
                <option value="{{grade.pk}}" {% if grade.pk|stringformat:'s' in q_grades %} selected="selected" {% endif %}>
                  {{grade}}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="col-12">
          <div class="form-group mb-3">
            <label for="unity_id" class="mb-1">Unidade</label>
            <select name="q_unitys" id="unity_id" class="form-control" multiple="multiple">
              {% for unity in unitys %}
                <option value="{{unity.pk}}" {% if unity.pk|stringformat:'s' in q_unitys %} selected="selected" {% endif %}>
                  {{unity}}
                </option>
              {% endfor %}
            </select>
            <p class="text-muted">De acordo com as unidades do usuário que enviou o arquivo.</p>
          </div>
        </div>
        <div class="col-12">
          <div class="form-group mb-3">
            <label for="category_id" class="mb-1">Categoria do erro</label>
            <select name="q_categorys" id="category_id" class="form-control" multiple="multiple">
              <option value="2" {% if "2" in q_categorys %} selected="selected" {% endif %}> Marcações não identificadas </option>
              <option value="3" {% if "3" in q_categorys %} selected="selected" {% endif %}> Aluno não encontrado </option>
              <option value="1" {% if "1" in q_categorys %} selected="selected" {% endif %}> QRCode não identificado </option>
              <option value="0" {% if "0" in q_categorys %} selected="selected" {% endif %}> Outro </option>
            </select>
          </div>
        </div>
        <div class="col-12">
          <div class="custom-control custom-switch">
            <input {% if q_errors  %} checked="checked" {% endif %} type="checkbox" id="id_q_errors" name="q_errors" class="custom-control-input">
            <label class="custom-control-label" for="id_q_errors">Provas com erro</label>
            <small class="form-text text-muted mt-0">Exibe apenas provas com erros de correção.</small>
          </div>
        </div>
        <div class="col-12 mt-5">
          <button type="submit" class="btn btn-primary btn-block">
            <i class="fas fa-search"></i>
            Aplicar filtro
          </button>
        </div>
      </div>
      <input type="hidden" name="year" value="{{year}}" />
    </form>
  </div>
{% endblock %}

{% block js-additional %}
  <script src="{% static 'administration/lib/select2/js/select2.min.js' %}"></script>
  <script src="{% static 'administration/assets/vendor/jquery-ui.min.js' %}"></script>
  <script src="{% static 'administration/lib/datatables.net-responsive-dt/js/responsive.dataTables.min.js' %}"></script>
  <script src="{% static 'administration/lib/datatables.net/js/jquery.dataTables.min.js' %}"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  <script src="https://unpkg.com/interactjs/dist/interact.min.js"></script>
  <script src="https://unpkg.com/@sjmc11/tourguidejs/dist/tour.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
      moment.locale('pt-br')
      var app = new Vue({
          delimiters: ["#{", "}"],
          el: '#app',
          data: {
            omrStudentsUnchecked: [
              {% for omr_student in omr_students %}
                {% with omr_student.count_questions as questions_count %}
                  {% with omr_student.application_student.total_answered_questions as answered_questions_count %}
                    {% if not omr_student.checked and answered_questions_count < questions_count %}
                      {
                        "id": "{{ omr_student.pk }}",
                      },
                    {% endif %}
                  {% endwith %}
                {% endwith %}
              {% endfor %}
            ],
            activeTab: {% if object.get_unsolved_discursive_errors and object.status != 5 or object.get_unsolved_errors and object.status != 5 %}'reading-errors'{% else %}'list-of-students'{% endif %},
              totalErrorsCount: {{object.total_errors_count}},
              loadingErrorDelete: false,
              errorList: [
                  {% for form in formset %}
                      {
                          pk: '{{form.omr_error.value}}',
                          errorElement: '{{form.omr_error.auto_id}}',
                          categoryDescriptionElement: '{{form.category_description.auto_id}}',
                          errorImageElement: '{{form.error_image.auto_id}}',
                          pageNumberElement: '{{form.page_number.auto_id}}',
                      },
                  {% endfor %}
              ],
              selectedStudent: null,
              historical: [],
              omrStudents: [
                  {% for student in omr_students %}
                      {
                          "id": "{{student.pk}}",
                          "name": "{{student.application_student.student.name}}",
                          "scans": {{student.application_student.get_files_urls|safe}},
                      },
                  {% endfor %}
              ],
              showMovableWindow: false,
              selectedError: '',
              selectedImage: '',
              imgLoading: false,
              isOpenDraggingResizingWindow: false,
          },
          methods: {
            switchTab(tab) {
              this.activeTab = tab
            },
              deleteError(errorPk) {
                  Swal.fire({
                      icon: 'warning',
                      title: 'Remover esse erro?',
                      text: 'Certifique-se de que o erro não impacta na leitura das respostas.',
                      showConfirmButton: true,
                      showCancelButton: true,
                      confirmButtonText: 'Sim, remover o erro',
                      cancelButtonText: 'Voltar'
                    }).then((value) => {
                        if(value.isConfirmed){
                          this.loadingErrorDelete = true
                          axios.post("{% url 'omr:omr_delete_error' %}", {
                              pk: errorPk
                          }).then((res) => {
                              let errorInputs = this.errorList.find((object) => object.pk == errorPk)

                              $(`#${errorPk}`).remove()
                              $(`#${errorInputs.errorElement}`).remove()
                              $(`#${errorInputs.categoryDescriptionElement}`).remove()
                              $(`#${errorInputs.errorImageElement}`).remove()
                              $(`#${errorInputs.pageNumberElement}`).remove()
                              this.totalErrorsCount = this.totalErrorsCount - 1

                              window.location.reload()

                              swal.fire({
                                  toast: true,
                                  icon: 'success',
                                  text: 'erro removido',
                                  position: 'top',
                                  showConfirmButton: false,
                                  timer: 2000
                              })
                              this.loadingErrorDelete = false
                          }).catch((err) => {
                              this.loadingErrorDelete = false
                          })
                      }
                      return
                    });
              },
              momentRef(args) {
                return moment(args)
              },
              uploadCheck(id) {
                $('[data-check]').attr('disabled', true)
                const element = $(`[data-check="${id}"]`)
                const elementLabel = $(`[data-check-label="${id}"]`)
                const url = "{% url 'omr:omr_students_upload_check' pk='00000000-0000-0000-0000-000000000000' %}"

                element.html(`
                  <svg class="tw-animate-spin tw-h-5 tw-w-5 tw-text-white" fill="none" viewBox="0 0 24 24">
                    <circle class="tw-opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="tw-opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                `)

                axios
                  .put(url.replace('00000000-0000-0000-0000-000000000000', id), { checked: true })
                  .then(response => {
                    if (response.data) {
                      element.addClass('tw-bg-[#41C588]')
                      element.removeClass('tw-bg-[#E5E7EA]')
                      $(`[data-trchecked="${id}"]`).removeClass('tw-bg-[#fef2e8]')
                      element.prop('title', 'Remover checado')
                      element.html(`
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      `)
                      elementLabel.html(`
                        <div class="tw-flex-none tw-rounded-full tw-bg-emerald-500/20 tw-p-1">
                          <div class="tw-h-1.5 tw-w-1.5 tw-rounded-full tw-bg-emerald-500"></div>
                        </div>
                        <p class="tw-text-xs tw-leading-5 tw-text-gray-500">
                          Checado por: {{ user }}.
                        </p>
                      `)
                    } else {
                      element.addClass('tw-bg-[#E5E7EA]')
                      element.removeClass('tw-bg-[#41C588]')
                      $(`[data-trchecked="${id}"]`).addClass('tw-bg-[#fef2e8]')
                      element.prop('title', 'Marcar como checado')
                      element.html(`
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <path d="M7.5 12L10.5 15L16.5 9M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      `)
                      elementLabel.html(`
                        <div class="tw-flex-none tw-rounded-full tw-bg-rose-500/20 tw-p-1">
                          <div class="tw-h-1.5 tw-w-1.5 tw-rounded-full tw-bg-rose-500"></div>
                        </div>
                        <p class="tw-text-xs tw-leading-5 tw-text-gray-500">
                          Checado removido por: {{ user }}.
                        </p>
                      `)
                    }
                  })
                  .finally($('[data-check]').attr('disabled', false))

                this.omrStudentsUnchecked = this.omrStudentsUnchecked.filter(omrStudent => omrStudent.id !== id)
              },
              uploadGetHistorical(id) {
                  this.historical = []
                  url = "{% url 'omr:omr_students_upload_historical' pk='00000000-0000-0000-0000-000000000000' %}"
                  axios.get(url.replace("00000000-0000-0000-0000-000000000000", id)).then((response) => {
                      this.historical = response.data.history
                  })
              },
              showDiscursiveScansModal(studentId) {
                  const filteredStudents = this.omrStudents.filter(x => x.id == studentId);
                  this.selectedStudent = filteredStudents ? filteredStudents[0] : []
                  $('#discursiveScans').modal('show');
              },
              getFilesUrls(id, type = 'objective') {
                  omr = this.omrStudents.find(s => s.id == id)
                  
                  if(type == 'discursive') {
                      return omr.scans.discursive_urls
                  } else {
                      return omr.scans.objectives_urls
                  }

                  return []
              },
              showDraggingResizingWindow(image) {
                this.isOpenDraggingResizingWindow = true
                this.selectedImage = image

                let content = document.getElementById('id_movable_window')
                let windowWidth = window.innerWidth
                let windowHeight = window.innerHeight
                let contentWidth = content.offsetWidth
                let contentHeight = content.offsetHeight

                let leftPos = (windowWidth - contentWidth) / 2
                let topPos = (windowHeight - contentHeight) / 2

                let scrollX = window.scrollX || window.pageXOffset
                let scrollY = window.scrollY || window.pageYOffset

                content.style.left = leftPos + scrollX + 'px'
                content.style.top = topPos + scrollY + 'px'
              },
              hiddenDraggingResizingWindow() {
                this.isOpenDraggingResizingWindow = false
              },
              startMovableWindow(image) {
                  // console.log('startMovableWindow ...')
                  // let movableWindowConfigs = JSON.parse(localStorage.getItem('movableWindowConfigs'))
                  // $("#movableWindow").draggable({
                  //     stop: () => {
                  //         this.movableWindowSaveData()
                  //     }
                  // }).resizable({
                  //     stop: () => {
                  //         this.movableWindowSaveData()
                  //     }
                  // });
                  // if(movableWindowConfigs) {
                  //     $("#movableWindow").css({ ...movableWindowConfigs })
                  // } else {
                  //     $("#movableWindow").css({ 
                  //         'height': '300px', 
                  //         'width': '300px',
                  //         'top': 100,
                  //         'left': 100,
                  //     })
                  // }
                  this.showMovableWindow = true
                  this.selectedImage = image
              },
              // movableWindowSaveData() {
              //     object = {
              //         top: $("#movableWindow").css('top'),
              //         left: $("#movableWindow").css('left'),
              //         width: $("#movableWindow").css('width'),
              //         height: $("#movableWindow").css('height'),
              //     }
              //     localStorage.setItem('movableWindowConfigs', JSON.stringify(object))
              // },
              getUrl(url, id1, id2 = '') {
                  return url.replace('00000000-0000-0000-0000-000000000000', id1).replace('11111111-1111-1111-1111-111111111111', id2)
              },
              clearApplicationStudent(applicationStudent, missed = null) {
                  cleanUrl = "{% url 'applications:api_clear_and_missed_applicationstudent' pk='00000000-0000-0000-0000-000000000000' %}"
                  url = this.getUrl(cleanUrl, applicationStudent.id)
                  
                  let element = $(`[data-check="${applicationStudent.omrID}"]`)

                  if (missed != null) {
                      Swal.fire({
                          title: `Você confirma?`,
                          html: `Você esta prestes a marcar ou remover falta no aluno(a) <br/><strong>${applicationStudent.student_name}<strong>`,
                          showCancelButton: true,
                          confirmButtonText: 'Confirmar',
                          confirmButtonColor: '#736DD8',
                          showLoaderOnConfirm: true,
                      }).then((result) => {
                          if (result.isConfirmed) {
                              axios.patch(url, {  missed: !missed }).then((response) => {
                                  Swal.fire({
                                      icon: 'success',
                                      title: !missed ? 'Falta adicionada ao aluno':'A falta foi removida'
                                  })
                                  if(!missed && element.hasClass('btn-success')) {
                                      element.click()
                                  }
                              })
                          }
                      })
                  } else {
                      Swal.fire({
                          title: `Você quer digitar algum feedback?`,
                          html: `Você selecionou o aluno(a) <br/><strong>${applicationStudent.student_name}<strong>`,
                          input: 'text',
                          inputAttributes: {
                              autocapitalize: 'off'
                          },
                          showCancelButton: true,
                          confirmButtonText: 'Confirmar',
                          confirmButtonColor: '#736DD8',
                          showLoaderOnConfirm: true,
                          preConfirm: (value) => {
                              return axios.patch(url + '?clean_answers=true', {  feedback_after_clean: value }).then(response => {
                                  return response.data
                              }).catch(error => {
                                  if (error.response) {
                                      Swal.showValidationMessage(error.response.data)
                                  }
                              })
                          },
                          allowOutsideClick: () => !Swal.isLoading()
                      }).then((result) => {
                          if (result.isConfirmed) {
                              if (result.value) {
                                  Swal.fire({
                                      icon: 'success',
                                      title: 'Prova zerada com sucesso'
                                  })
                                  if(element.hasClass('btn-success')) {
                                      element.click()
                                  }
                                  $(`[data-questioncount="${applicationStudent.omrID}"]`).html("0")
                              }
                          }
                      })
                  }
              },
          },
          watch: {
              selectedImage: function(val) {
                  this.imgLoading = true
              }
          },
          mounted() {
              {% include 'help/includes/tour_guide.js' with group_guide_name='default-omr-upload-detail' %}

              $('[data-toggle="tooltip"]').tooltip()
      
              $('.application-formset').select2({
                  width: '100%',
                  placeholder: 'Buscar pelo nome da aplicação...',
                  minimumInputLength: 3,
                  allowClear: true,  
                  closeOnSelect: false,
                  escapeMarkup: function (text) {
                      return text;
                  },          
                  ajax: {
                      url: '{% url "applications:api_applications_list" %}',
                      delay: 250,              
                      data: function (params) {
                          return {
                              search: params.term
                          }
                      },
                      processResults: function(results) {
                          let new_results = $.map(results, function(element) {
                              element.text = element.exam_name
                              return element 
                          })
      
                          return {
                              results: new_results,
                          }
                      }
                  },            
                  templateResult: (data) => {
                      if(data.text){
                          result = `<span class="font-weight-bold">
                          <span class="mr-1">${data.text}</span>`
                      
                          if (data.date){
                              result += "<p class='m-0'>"                        
                              result += `<span class="badge mr-1 badge-primary font-weight-bold">${data.date}</span>`
                              result += "</p>"
                          }
                          result += "</span>"
                          return result
                      } else {
                          return "Buscar pela aplicação..."
                      }
                  }
              })
      
              $('.student-formset').select2({
                  width: '100%',
                  placeholder: 'Buscar pelo nome do aluno...',
                  minimumInputLength: 3,
                  allowClear: true,  
                  closeOnSelect: false,
                  escapeMarkup: function (text) {
                      return text;
                  },
                  ajax: {
                      url: '{% url "students:students_list_api" %}',
                      delay: 250,
                      data: function (params) {
                      return {
                          search: params.term
                      }
                      },
                      processResults: function(results) {
                          let new_results = $.map(results, function(element) {
                              element.text = element.name
                              return element 
                          })
                          return {
                              results: new_results,
                          }
                      }
                  },            
                  templateResult: (data) => {
                      if(data.text){
                          result = `<span class="font-weight-bold">
                          <span class="mr-1">${data.text}</span>`
                      
                          if (data.classes){
                              result += "<p class='m-0'>"
                              data.classes.forEach(element => {
                              result += `<span class="badge mr-1 badge-primary font-weight-bold">${element.name} - ${element.coordination_name}</span>`
                              });
                              result += "</p>"
                          }
                          result += "</span>"
                          return result
                      }else{
                          return "Buscar pelo nome do aluno..."
                      }
                  }
              })

              $('#copy-application').click(function() {
                  const data = $('#id_form-0-application').select2("data")
                  
                  if (data.length === 0) return
      
                  $(".application-formset").each(function(){
                      const newOption = new Option(data[0].text, data[0].id, false, false)
                      $(this).append(newOption).trigger('change')                
                  })
              })
      
              {% if object.status == 5 %}
                  let interval = setInterval(function() {
                      axios.get('{% url "omr:omr_upload_status" pk=object.pk %}')
                      .then(response => {
                          if (response.data.status != 5) {
                              clearInterval(interval)
                              window.location.reload()
                          }
                      })
                  }, 1000)
              {% endif %}
              {% if omr_students %}
                $('#table-uploadstudents').DataTable({
                  responsive: true,
                  pageLength: 50,
                  language: {
                    url: "//cdn.datatables.net/plug-ins/1.10.22/i18n/Portuguese-Brasil.json"
                  },
                });
              {% endif %}

            interact('#id_movable_window')
            .resizable({
              // resize from all edges and corners
              edges: { left: true, right: true, bottom: true, top: true },

              listeners: {
                move (event) {
                  var target = event.target
                  var x = (parseFloat(target.getAttribute('data-x')) || 0)
                  var y = (parseFloat(target.getAttribute('data-y')) || 0)

                  // update the element's style
                  target.style.width = event.rect.width + 'px'
                  target.style.height = event.rect.height + 'px'

                  // translate when resizing from top or left edges
                  x += event.deltaRect.left
                  y += event.deltaRect.top

                  target.style.transform = 'translate(' + x + 'px,' + y + 'px)'

                  target.setAttribute('data-x', x)
                  target.setAttribute('data-y', y)
                  // target.textContent = Math.round(event.rect.width) + '\u00D7' + Math.round(event.rect.height)
                }
              },
              modifiers: [
                // keep the edges inside the parent
                interact.modifiers.restrictEdges({
                  outer: 'parent'
                }),

                // minimum size
                interact.modifiers.restrictSize({
                  min: { width: 100, height: 50 }
                })
              ],

              inertia: true
            })
            .draggable({
              listeners: {
                move (event) {
                  var target = event.target
                  // keep the dragged position in the data-x/data-y attributes
                  var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx
                  var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy

                  // translate the element
                  target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'

                  // update the posiion attributes
                  target.setAttribute('data-x', x)
                  target.setAttribute('data-y', y)
                }
              },
              inertia: true,
              modifiers: [
                interact.modifiers.restrictRect({
                  restriction: 'parent',
                  endOnly: true
                })
              ]
            })

            interact('#movableWindow')
            .resizable({
              // resize from all edges and corners
              edges: { left: true, right: true, bottom: true, top: true },

              listeners: {
                move (event) {
                  var target = event.target
                  var x = (parseFloat(target.getAttribute('data-x')) || 0)
                  var y = (parseFloat(target.getAttribute('data-y')) || 0)

                  // update the element's style
                  target.style.width = event.rect.width + 'px'
                  target.style.height = event.rect.height + 'px'

                  // translate when resizing from top or left edges
                  x += event.deltaRect.left
                  y += event.deltaRect.top

                  target.style.transform = 'translate(' + x + 'px,' + y + 'px)'

                  target.setAttribute('data-x', x)
                  target.setAttribute('data-y', y)
                  // target.textContent = Math.round(event.rect.width) + '\u00D7' + Math.round(event.rect.height)
                }
              },
              modifiers: [
                // keep the edges inside the parent
                interact.modifiers.restrictEdges({
                  outer: 'parent'
                }),

                // minimum size
                interact.modifiers.restrictSize({
                  min: { width: 100, height: 50 }
                })
              ],

              inertia: true
            })
            .draggable({
              listeners: {
                move (event) {
                  var target = event.target
                  // keep the dragged position in the data-x/data-y attributes
                  var x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx
                  var y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy

                  // translate the element
                  target.style.transform = 'translate(' + x + 'px, ' + y + 'px)'

                  // update the posiion attributes
                  target.setAttribute('data-x', x)
                  target.setAttribute('data-y', y)
                }
              },
              inertia: true,
              modifiers: [
                interact.modifiers.restrictRect({
                  restriction: 'parent',
                  endOnly: true
                })
              ]
            })
        }
      })

  </script>
{% endblock %}
